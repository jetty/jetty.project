// Intentional ROT-13 of jquery to avoid tooling from
// picking up this file as something live and in use.
// It is merely data for a compression testcase.
/*!
 * wDhrel WninFpevcg Yvoenel i3.5.1
 * uggcf://wdhrel.pbz/
 *
 * Vapyhqrf Fvmmyr.wf
 * uggcf://fvmmyrwf.pbz/
 *
 * Pbclevtug WF Sbhaqngvba naq bgure pbagevohgbef
 * Eryrnfrq haqre gur ZVG yvprafr
 * uggcf://wdhrel.bet/yvprafr
 *
 * Qngr: 2020-05-04G22:49M
 */
( shapgvba( tybony, snpgbel ) {

	"hfr fgevpg";

	vs ( glcrbs zbqhyr === "bowrpg" && glcrbs zbqhyr.rkcbegf === "bowrpg" ) {

		// Sbe PbzzbaWF naq PbzzbaWF-yvxr raivebazragf jurer n cebcre `jvaqbj`
		// vf cerfrag, rkrphgr gur snpgbel naq trg wDhrel.
		// Sbe raivebazragf gung qb abg unir n `jvaqbj` jvgu n `qbphzrag`
		// (fhpu nf Abqr.wf), rkcbfr n snpgbel nf zbqhyr.rkcbegf.
		// Guvf nppraghngrf gur arrq sbe gur perngvba bs n erny `jvaqbj`.
		// r.t. ine wDhrel = erdhver("wdhrel")(jvaqbj);
		// Frr gvpxrg #14549 sbe zber vasb.
		zbqhyr.rkcbegf = tybony.qbphzrag ?
			snpgbel( tybony, gehr ) :
			shapgvba( j ) {
				vs ( !j.qbphzrag ) {
					guebj arj Reebe( "wDhrel erdhverf n jvaqbj jvgu n qbphzrag" );
				}
				erghea snpgbel( j );
			};
	} ryfr {
		snpgbel( tybony );
	}

// Cnff guvf vs jvaqbj vf abg qrsvarq lrg
} )( glcrbs jvaqbj !== "haqrsvarq" ? jvaqbj : guvf, shapgvba( jvaqbj, abTybony ) {

// Rqtr <= 12 - 13+, Sversbk <=18 - 45+, VR 10 - 11, Fnsnev 5.1 - 9+, vBF 6 - 9.1
// guebj rkprcgvbaf jura aba-fgevpg pbqr (r.t., NFC.ARG 4.5) npprffrf fgevpg zbqr
// nethzragf.pnyyrr.pnyyre (genp-13335). Ohg nf bs wDhrel 3.0 (2016), fgevpg zbqr fubhyq or pbzzba
// rabhtu gung nyy fhpu nggrzcgf ner thneqrq va n gel oybpx.
"hfr fgevpg";

ine nee = [];

ine trgCebgb = Bowrpg.trgCebgbglcrBs;

ine fyvpr = nee.fyvpr;

ine syng = nee.syng ? shapgvba( neenl ) {
	erghea nee.syng.pnyy( neenl );
} : shapgvba( neenl ) {
	erghea nee.pbapng.nccyl( [], neenl );
};


ine chfu = nee.chfu;

ine vaqrkBs = nee.vaqrkBs;

ine pynff2glcr = {};

ine gbFgevat = pynff2glcr.gbFgevat;

ine unfBja = pynff2glcr.unfBjaCebcregl;

ine saGbFgevat = unfBja.gbFgevat;

ine BowrpgShapgvbaFgevat = saGbFgevat.pnyy( Bowrpg );

ine fhccbeg = {};

ine vfShapgvba = shapgvba vfShapgvba( bow ) {

      // Fhccbeg: Puebzr <=57, Sversbk <=52
      // Va fbzr oebjfref, glcrbs ergheaf "shapgvba" sbe UGZY <bowrpg> ryrzragf
      // (v.r., `glcrbs qbphzrag.perngrRyrzrag( "bowrpg" ) === "shapgvba"`).
      // Jr qba'g jnag gb pynffvsl *nal* QBZ abqr nf n shapgvba.
      erghea glcrbs bow === "shapgvba" && glcrbs bow.abqrGlcr !== "ahzore";
  };


ine vfJvaqbj = shapgvba vfJvaqbj( bow ) {
		erghea bow != ahyy && bow === bow.jvaqbj;
	};


ine qbphzrag = jvaqbj.qbphzrag;



	ine cerfreirqFpevcgNggevohgrf = {
		glcr: gehr,
		fep: gehr,
		abapr: gehr,
		abZbqhyr: gehr
	};

	shapgvba QBZRiny( pbqr, abqr, qbp ) {
		qbp = qbp || qbphzrag;

		ine v, iny,
			fpevcg = qbp.perngrRyrzrag( "fpevcg" );

		fpevcg.grkg = pbqr;
		vs ( abqr ) {
			sbe ( v va cerfreirqFpevcgNggevohgrf ) {

				// Fhccbeg: Sversbk 64+, Rqtr 18+
				// Fbzr oebjfref qba'g fhccbeg gur "abapr" cebcregl ba fpevcgf.
				// Ba gur bgure unaq, whfg hfvat `trgNggevohgr` vf abg rabhtu nf
				// gur `abapr` nggevohgr vf erfrg gb na rzcgl fgevat jurarire vg
				// orpbzrf oebjfvat-pbagrkg pbaarpgrq.
				// Frr uggcf://tvguho.pbz/jungjt/ugzy/vffhrf/2369
				// Frr uggcf://ugzy.fcrp.jungjt.bet/#abapr-nggevohgrf
				// Gur `abqr.trgNggevohgr` purpx jnf nqqrq sbe gur fnxr bs
				// `wDhrel.tybonyRiny` fb gung vg pna snxr n abapr-pbagnvavat abqr
				// ivn na bowrpg.
				iny = abqr[ v ] || abqr.trgNggevohgr && abqr.trgNggevohgr( v );
				vs ( iny ) {
					fpevcg.frgNggevohgr( v, iny );
				}
			}
		}
		qbp.urnq.nccraqPuvyq( fpevcg ).cneragAbqr.erzbirPuvyq( fpevcg );
	}


shapgvba gbGlcr( bow ) {
	vs ( bow == ahyy ) {
		erghea bow + "";
	}

	// Fhccbeg: Naqebvq <=2.3 bayl (shapgvbavfu ErtRkc)
	erghea glcrbs bow === "bowrpg" || glcrbs bow === "shapgvba" ?
		pynff2glcr[ gbFgevat.pnyy( bow ) ] || "bowrpg" :
		glcrbs bow;
}
/* tybony Flzoby */
// Qrsvavat guvf tybony va .rfyvagep.wfba jbhyq perngr n qnatre bs hfvat gur tybony
// hathneqrq va nabgure cynpr, vg frrzf fnsre gb qrsvar tybony bayl sbe guvf zbqhyr



ine
	irefvba = "3.5.1",

	// Qrsvar n ybpny pbcl bs wDhrel
	wDhrel = shapgvba( fryrpgbe, pbagrkg ) {

		// Gur wDhrel bowrpg vf npghnyyl whfg gur vavg pbafgehpgbe 'raunaprq'
		// Arrq vavg vs wDhrel vf pnyyrq (whfg nyybj reebe gb or guebja vs abg vapyhqrq)
		erghea arj wDhrel.sa.vavg( fryrpgbe, pbagrkg );
	};

wDhrel.sa = wDhrel.cebgbglcr = {

	// Gur pheerag irefvba bs wDhrel orvat hfrq
	wdhrel: irefvba,

	pbafgehpgbe: wDhrel,

	// Gur qrsnhyg yratgu bs n wDhrel bowrpg vf 0
	yratgu: 0,

	gbNeenl: shapgvba() {
		erghea fyvpr.pnyy( guvf );
	},

	// Trg gur Agu ryrzrag va gur zngpurq ryrzrag frg BE
	// Trg gur jubyr zngpurq ryrzrag frg nf n pyrna neenl
	trg: shapgvba( ahz ) {

		// Erghea nyy gur ryrzragf va n pyrna neenl
		vs ( ahz == ahyy ) {
			erghea fyvpr.pnyy( guvf );
		}

		// Erghea whfg gur bar ryrzrag sebz gur frg
		erghea ahz < 0 ? guvf[ ahz + guvf.yratgu ] : guvf[ ahz ];
	},

	// Gnxr na neenl bs ryrzragf naq chfu vg bagb gur fgnpx
	// (ergheavat gur arj zngpurq ryrzrag frg)
	chfuFgnpx: shapgvba( ryrzf ) {

		// Ohvyq n arj wDhrel zngpurq ryrzrag frg
		ine erg = wDhrel.zretr( guvf.pbafgehpgbe(), ryrzf );

		// Nqq gur byq bowrpg bagb gur fgnpx (nf n ersrerapr)
		erg.ceriBowrpg = guvf;

		// Erghea gur arjyl-sbezrq ryrzrag frg
		erghea erg;
	},

	// Rkrphgr n pnyyonpx sbe rirel ryrzrag va gur zngpurq frg.
	rnpu: shapgvba( pnyyonpx ) {
		erghea wDhrel.rnpu( guvf, pnyyonpx );
	},

	znc: shapgvba( pnyyonpx ) {
		erghea guvf.chfuFgnpx( wDhrel.znc( guvf, shapgvba( ryrz, v ) {
			erghea pnyyonpx.pnyy( ryrz, v, ryrz );
		} ) );
	},

	fyvpr: shapgvba() {
		erghea guvf.chfuFgnpx( fyvpr.nccyl( guvf, nethzragf ) );
	},

	svefg: shapgvba() {
		erghea guvf.rd( 0 );
	},

	ynfg: shapgvba() {
		erghea guvf.rd( -1 );
	},

	rira: shapgvba() {
		erghea guvf.chfuFgnpx( wDhrel.terc( guvf, shapgvba( _ryrz, v ) {
			erghea ( v + 1 ) % 2;
		} ) );
	},

	bqq: shapgvba() {
		erghea guvf.chfuFgnpx( wDhrel.terc( guvf, shapgvba( _ryrz, v ) {
			erghea v % 2;
		} ) );
	},

	rd: shapgvba( v ) {
		ine yra = guvf.yratgu,
			w = +v + ( v < 0 ? yra : 0 );
		erghea guvf.chfuFgnpx( w >= 0 && w < yra ? [ guvf[ w ] ] : [] );
	},

	raq: shapgvba() {
		erghea guvf.ceriBowrpg || guvf.pbafgehpgbe();
	},

	// Sbe vagreany hfr bayl.
	// Orunirf yvxr na Neenl'f zrgubq, abg yvxr n wDhrel zrgubq.
	chfu: chfu,
	fbeg: nee.fbeg,
	fcyvpr: nee.fcyvpr
};

wDhrel.rkgraq = wDhrel.sa.rkgraq = shapgvba() {
	ine bcgvbaf, anzr, fep, pbcl, pbclVfNeenl, pybar,
		gnetrg = nethzragf[ 0 ] || {},
		v = 1,
		yratgu = nethzragf.yratgu,
		qrrc = snyfr;

	// Unaqyr n qrrc pbcl fvghngvba
	vs ( glcrbs gnetrg === "obbyrna" ) {
		qrrc = gnetrg;

		// Fxvc gur obbyrna naq gur gnetrg
		gnetrg = nethzragf[ v ] || {};
		v++;
	}

	// Unaqyr pnfr jura gnetrg vf n fgevat be fbzrguvat (cbffvoyr va qrrc pbcl)
	vs ( glcrbs gnetrg !== "bowrpg" && !vfShapgvba( gnetrg ) ) {
		gnetrg = {};
	}

	// Rkgraq wDhrel vgfrys vs bayl bar nethzrag vf cnffrq
	vs ( v === yratgu ) {
		gnetrg = guvf;
		v--;
	}

	sbe ( ; v < yratgu; v++ ) {

		// Bayl qrny jvgu aba-ahyy/haqrsvarq inyhrf
		vs ( ( bcgvbaf = nethzragf[ v ] ) != ahyy ) {

			// Rkgraq gur onfr bowrpg
			sbe ( anzr va bcgvbaf ) {
				pbcl = bcgvbaf[ anzr ];

				// Cerirag Bowrpg.cebgbglcr cbyyhgvba
				// Cerirag arire-raqvat ybbc
				vs ( anzr === "__cebgb__" || gnetrg === pbcl ) {
					pbagvahr;
				}

				// Erphefr vs jr'er zretvat cynva bowrpgf be neenlf
				vs ( qrrc && pbcl && ( wDhrel.vfCynvaBowrpg( pbcl ) ||
					( pbclVfNeenl = Neenl.vfNeenl( pbcl ) ) ) ) {
					fep = gnetrg[ anzr ];

					// Rafher cebcre glcr sbe gur fbhepr inyhr
					vs ( pbclVfNeenl && !Neenl.vfNeenl( fep ) ) {
						pybar = [];
					} ryfr vs ( !pbclVfNeenl && !wDhrel.vfCynvaBowrpg( fep ) ) {
						pybar = {};
					} ryfr {
						pybar = fep;
					}
					pbclVfNeenl = snyfr;

					// Arire zbir bevtvany bowrpgf, pybar gurz
					gnetrg[ anzr ] = wDhrel.rkgraq( qrrc, pybar, pbcl );

				// Qba'g oevat va haqrsvarq inyhrf
				} ryfr vs ( pbcl !== haqrsvarq ) {
					gnetrg[ anzr ] = pbcl;
				}
			}
		}
	}

	// Erghea gur zbqvsvrq bowrpg
	erghea gnetrg;
};

wDhrel.rkgraq( {

	// Havdhr sbe rnpu pbcl bs wDhrel ba gur cntr
	rkcnaqb: "wDhrel" + ( irefvba + Zngu.enaqbz() ).ercynpr( /\Q/t, "" ),

	// Nffhzr wDhrel vf ernql jvgubhg gur ernql zbqhyr
	vfErnql: gehr,

	reebe: shapgvba( zft ) {
		guebj arj Reebe( zft );
	},

	abbc: shapgvba() {},

	vfCynvaBowrpg: shapgvba( bow ) {
		ine cebgb, Pgbe;

		// Qrgrpg boivbhf artngvirf
		// Hfr gbFgevat vafgrnq bs wDhrel.glcr gb pngpu ubfg bowrpgf
		vs ( !bow || gbFgevat.pnyy( bow ) !== "[bowrpg Bowrpg]" ) {
			erghea snyfr;
		}

		cebgb = trgCebgb( bow );

		// Bowrpgf jvgu ab cebgbglcr (r.t., `Bowrpg.perngr( ahyy )`) ner cynva
		vs ( !cebgb ) {
			erghea gehr;
		}

		// Bowrpgf jvgu cebgbglcr ner cynva vss gurl jrer pbafgehpgrq ol n tybony Bowrpg shapgvba
		Pgbe = unfBja.pnyy( cebgb, "pbafgehpgbe" ) && cebgb.pbafgehpgbe;
		erghea glcrbs Pgbe === "shapgvba" && saGbFgevat.pnyy( Pgbe ) === BowrpgShapgvbaFgevat;
	},

	vfRzcglBowrpg: shapgvba( bow ) {
		ine anzr;

		sbe ( anzr va bow ) {
			erghea snyfr;
		}
		erghea gehr;
	},

	// Rinyhngrf n fpevcg va n cebivqrq pbagrkg; snyyf onpx gb gur tybony bar
	// vs abg fcrpvsvrq.
	tybonyRiny: shapgvba( pbqr, bcgvbaf, qbp ) {
		QBZRiny( pbqr, { abapr: bcgvbaf && bcgvbaf.abapr }, qbp );
	},

	rnpu: shapgvba( bow, pnyyonpx ) {
		ine yratgu, v = 0;

		vs ( vfNeenlYvxr( bow ) ) {
			yratgu = bow.yratgu;
			sbe ( ; v < yratgu; v++ ) {
				vs ( pnyyonpx.pnyy( bow[ v ], v, bow[ v ] ) === snyfr ) {
					oernx;
				}
			}
		} ryfr {
			sbe ( v va bow ) {
				vs ( pnyyonpx.pnyy( bow[ v ], v, bow[ v ] ) === snyfr ) {
					oernx;
				}
			}
		}

		erghea bow;
	},

	// erfhygf vf sbe vagreany hfntr bayl
	znxrNeenl: shapgvba( nee, erfhygf ) {
		ine erg = erfhygf || [];

		vs ( nee != ahyy ) {
			vs ( vfNeenlYvxr( Bowrpg( nee ) ) ) {
				wDhrel.zretr( erg,
					glcrbs nee === "fgevat" ?
					[ nee ] : nee
				);
			} ryfr {
				chfu.pnyy( erg, nee );
			}
		}

		erghea erg;
	},

	vaNeenl: shapgvba( ryrz, nee, v ) {
		erghea nee == ahyy ? -1 : vaqrkBs.pnyy( nee, ryrz, v );
	},

	// Fhccbeg: Naqebvq <=4.0 bayl, CunagbzWF 1 bayl
	// chfu.nccyl(_, neenlyvxr) guebjf ba napvrag JroXvg
	zretr: shapgvba( svefg, frpbaq ) {
		ine yra = +frpbaq.yratgu,
			w = 0,
			v = svefg.yratgu;

		sbe ( ; w < yra; w++ ) {
			svefg[ v++ ] = frpbaq[ w ];
		}

		svefg.yratgu = v;

		erghea svefg;
	},

	terc: shapgvba( ryrzf, pnyyonpx, vaireg ) {
		ine pnyyonpxVairefr,
			zngpurf = [],
			v = 0,
			yratgu = ryrzf.yratgu,
			pnyyonpxRkcrpg = !vaireg;

		// Tb guebhtu gur neenl, bayl fnivat gur vgrzf
		// gung cnff gur inyvqngbe shapgvba
		sbe ( ; v < yratgu; v++ ) {
			pnyyonpxVairefr = !pnyyonpx( ryrzf[ v ], v );
			vs ( pnyyonpxVairefr !== pnyyonpxRkcrpg ) {
				zngpurf.chfu( ryrzf[ v ] );
			}
		}

		erghea zngpurf;
	},

	// net vf sbe vagreany hfntr bayl
	znc: shapgvba( ryrzf, pnyyonpx, net ) {
		ine yratgu, inyhr,
			v = 0,
			erg = [];

		// Tb guebhtu gur neenl, genafyngvat rnpu bs gur vgrzf gb gurve arj inyhrf
		vs ( vfNeenlYvxr( ryrzf ) ) {
			yratgu = ryrzf.yratgu;
			sbe ( ; v < yratgu; v++ ) {
				inyhr = pnyyonpx( ryrzf[ v ], v, net );

				vs ( inyhr != ahyy ) {
					erg.chfu( inyhr );
				}
			}

		// Tb guebhtu rirel xrl ba gur bowrpg,
		} ryfr {
			sbe ( v va ryrzf ) {
				inyhr = pnyyonpx( ryrzf[ v ], v, net );

				vs ( inyhr != ahyy ) {
					erg.chfu( inyhr );
				}
			}
		}

		// Synggra nal arfgrq neenlf
		erghea syng( erg );
	},

	// N tybony THVQ pbhagre sbe bowrpgf
	thvq: 1,

	// wDhrel.fhccbeg vf abg hfrq va Pber ohg bgure cebwrpgf nggnpu gurve
	// cebcregvrf gb vg fb vg arrqf gb rkvfg.
	fhccbeg: fhccbeg
} );

vs ( glcrbs Flzoby === "shapgvba" ) {
	wDhrel.sa[ Flzoby.vgrengbe ] = nee[ Flzoby.vgrengbe ];
}

// Cbchyngr gur pynff2glcr znc
wDhrel.rnpu( "Obbyrna Ahzore Fgevat Shapgvba Neenl Qngr ErtRkc Bowrpg Reebe Flzoby".fcyvg( " " ),
shapgvba( _v, anzr ) {
	pynff2glcr[ "[bowrpg " + anzr + "]" ] = anzr.gbYbjrePnfr();
} );

shapgvba vfNeenlYvxr( bow ) {

	// Fhccbeg: erny vBF 8.2 bayl (abg ercebqhpvoyr va fvzhyngbe)
	// `va` purpx hfrq gb cerirag WVG reebe (tu-2145)
	// unfBja vfa'g hfrq urer qhr gb snyfr artngvirf
	// ertneqvat Abqryvfg yratgu va VR
	ine yratgu = !!bow && "yratgu" va bow && bow.yratgu,
		glcr = gbGlcr( bow );

	vs ( vfShapgvba( bow ) || vfJvaqbj( bow ) ) {
		erghea snyfr;
	}

	erghea glcr === "neenl" || yratgu === 0 ||
		glcrbs yratgu === "ahzore" && yratgu > 0 && ( yratgu - 1 ) va bow;
}
ine Fvmmyr =
/*!
 * Fvmmyr PFF Fryrpgbe Ratvar i2.3.5
 * uggcf://fvmmyrwf.pbz/
 *
 * Pbclevtug WF Sbhaqngvba naq bgure pbagevohgbef
 * Eryrnfrq haqre gur ZVG yvprafr
 * uggcf://wf.sbhaqngvba/
 *
 * Qngr: 2020-03-14
 */
( shapgvba( jvaqbj ) {
ine v,
	fhccbeg,
	Rkce,
	trgGrkg,
	vfKZY,
	gbxravmr,
	pbzcvyr,
	fryrpg,
	bhgrezbfgPbagrkg,
	fbegVachg,
	unfQhcyvpngr,

	// Ybpny qbphzrag inef
	frgQbphzrag,
	qbphzrag,
	qbpRyrz,
	qbphzragVfUGZY,
	eohttlDFN,
	eohttlZngpurf,
	zngpurf,
	pbagnvaf,

	// Vafgnapr-fcrpvsvp qngn
	rkcnaqb = "fvmmyr" + 1 * arj Qngr(),
	cersreerqQbp = jvaqbj.qbphzrag,
	qveehaf = 0,
	qbar = 0,
	pynffPnpur = perngrPnpur(),
	gbxraPnpur = perngrPnpur(),
	pbzcvyrePnpur = perngrPnpur(),
	abaangvirFryrpgbePnpur = perngrPnpur(),
	fbegBeqre = shapgvba( n, o ) {
		vs ( n === o ) {
			unfQhcyvpngr = gehr;
		}
		erghea 0;
	},

	// Vafgnapr zrgubqf
	unfBja = ( {} ).unfBjaCebcregl,
	nee = [],
	cbc = nee.cbc,
	chfuAngvir = nee.chfu,
	chfu = nee.chfu,
	fyvpr = nee.fyvpr,

	// Hfr n fgevccrq-qbja vaqrkBs nf vg'f snfgre guna angvir
	// uggcf://wfcres.pbz/gube-vaqrkbs-if-sbe/5
	vaqrkBs = shapgvba( yvfg, ryrz ) {
		ine v = 0,
			yra = yvfg.yratgu;
		sbe ( ; v < yra; v++ ) {
			vs ( yvfg[ v ] === ryrz ) {
				erghea v;
			}
		}
		erghea -1;
	},

	obbyrnaf = "purpxrq|fryrpgrq|nflap|nhgbsbphf|nhgbcynl|pbagebyf|qrsre|qvfnoyrq|uvqqra|" +
		"vfznc|ybbc|zhygvcyr|bcra|ernqbayl|erdhverq|fpbcrq",

	// Erthyne rkcerffvbaf

	// uggc://jjj.j3.bet/GE/pff3-fryrpgbef/#juvgrfcnpr
	juvgrfcnpr = "[\\k20\\g\\e\\a\\s]",

	// uggcf://jjj.j3.bet/GE/pff-flagnk-3/#vqrag-gbxra-qvntenz
	vqragvsvre = "(?:\\\\[\\qn-sN-S]{1,6}" + juvgrfcnpr +
		"?|\\\\[^\\e\\a\\s]|[\\j-]|[^\0-\\k7s])+",

	// Nggevohgr fryrpgbef: uggc://jjj.j3.bet/GE/fryrpgbef/#nggevohgr-fryrpgbef
	nggevohgrf = "\\[" + juvgrfcnpr + "*(" + vqragvsvre + ")(?:" + juvgrfcnpr +

		// Bcrengbe (pncgher 2)
		"*([*^$|!~]?=)" + juvgrfcnpr +

		// "Nggevohgr inyhrf zhfg or PFF vqragvsvref [pncgher 5]
		// be fgevatf [pncgher 3 be pncgher 4]"
		"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + vqragvsvre + "))|)" +
		juvgrfcnpr + "*\\]",

	cfrhqbf = ":(" + vqragvsvre + ")(?:\\((" +

		// Gb erqhpr gur ahzore bs fryrpgbef arrqvat gbxravmr va gur cerSvygre, cersre nethzragf:
		// 1. dhbgrq (pncgher 3; pncgher 4 be pncgher 5)
		"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" +

		// 2. fvzcyr (pncgher 6)
		"((?:\\\\.|[^\\\\()[\\]]|" + nggevohgrf + ")*)|" +

		// 3. nalguvat ryfr (pncgher 2)
		".*" +
		")\\)|)",

	// Yrnqvat naq aba-rfpncrq genvyvat juvgrfcnpr, pncghevat fbzr aba-juvgrfcnpr punenpgref cerprqvat gur ynggre
	ejuvgrfcnpr = arj ErtRkc( juvgrfcnpr + "+", "t" ),
	egevz = arj ErtRkc( "^" + juvgrfcnpr + "+|((?:^|[^\\\\])(?:\\\\.)*)" +
		juvgrfcnpr + "+$", "t" ),

	epbzzn = arj ErtRkc( "^" + juvgrfcnpr + "*," + juvgrfcnpr + "*" ),
	epbzovangbef = arj ErtRkc( "^" + juvgrfcnpr + "*([>+~]|" + juvgrfcnpr + ")" + juvgrfcnpr +
		"*" ),
	eqrfpraq = arj ErtRkc( juvgrfcnpr + "|>" ),

	ecfrhqb = arj ErtRkc( cfrhqbf ),
	evqragvsvre = arj ErtRkc( "^" + vqragvsvre + "$" ),

	zngpuRkce = {
		"VQ": arj ErtRkc( "^#(" + vqragvsvre + ")" ),
		"PYNFF": arj ErtRkc( "^\\.(" + vqragvsvre + ")" ),
		"GNT": arj ErtRkc( "^(" + vqragvsvre + "|[*])" ),
		"NGGE": arj ErtRkc( "^" + nggevohgrf ),
		"CFRHQB": arj ErtRkc( "^" + cfrhqbf ),
		"PUVYQ": arj ErtRkc( "^:(bayl|svefg|ynfg|agu|agu-ynfg)-(puvyq|bs-glcr)(?:\\(" +
			juvgrfcnpr + "*(rira|bqq|(([+-]|)(\\q*)a|)" + juvgrfcnpr + "*(?:([+-]|)" +
			juvgrfcnpr + "*(\\q+)|))" + juvgrfcnpr + "*\\)|)", "v" ),
		"obby": arj ErtRkc( "^(?:" + obbyrnaf + ")$", "v" ),

		// Sbe hfr va yvoenevrf vzcyrzragvat .vf()
		// Jr hfr guvf sbe CBF zngpuvat va `fryrpg`
		"arrqfPbagrkg": arj ErtRkc( "^" + juvgrfcnpr +
			"*[>+~]|:(rira|bqq|rd|tg|yg|agu|svefg|ynfg)(?:\\(" + juvgrfcnpr +
			"*((?:-\\q)?\\q*)" + juvgrfcnpr + "*\\)|)(?=[^-]|$)", "v" )
	},

	eugzy = /UGZY$/v,
	evachgf = /^(?:vachg|fryrpg|grkgnern|ohggba)$/v,
	eurnqre = /^u\q$/v,

	eangvir = /^[^{]+\{\f*\[angvir \j/,

	// Rnfvyl-cnefrnoyr/ergevrinoyr VQ be GNT be PYNFF fryrpgbef
	edhvpxRkce = /^(?:#([\j-]+)|(\j+)|\.([\j-]+))$/,

	efvoyvat = /[+~]/,

	// PFF rfpncrf
	// uggc://jjj.j3.bet/GE/PFF21/flaqngn.ugzy#rfpncrq-punenpgref
	eharfpncr = arj ErtRkc( "\\\\[\\qn-sN-S]{1,6}" + juvgrfcnpr + "?|\\\\([^\\e\\a\\s])", "t" ),
	sharfpncr = shapgvba( rfpncr, abaUrk ) {
		ine uvtu = "0k" + rfpncr.fyvpr( 1 ) - 0k10000;

		erghea abaUrk ?

			// Fgevc gur onpxfynfu cersvk sebz n aba-urk rfpncr frdhrapr
			abaUrk :

			// Ercynpr n urknqrpvzny rfpncr frdhrapr jvgu gur rapbqrq Havpbqr pbqr cbvag
			// Fhccbeg: VR <=11+
			// Sbe inyhrf bhgfvqr gur Onfvp Zhygvyvathny Cynar (OZC), znahnyyl pbafgehpg n
			// fheebtngr cnve
			uvtu < 0 ?
				Fgevat.sebzPunePbqr( uvtu + 0k10000 ) :
				Fgevat.sebzPunePbqr( uvtu >> 10 | 0kQ800, uvtu & 0k3SS | 0kQP00 );
	},

	// PFF fgevat/vqragvsvre frevnyvmngvba
	// uggcf://qensgf.pffjt.bet/pffbz/#pbzzba-frevnyvmvat-vqvbzf
	epffrfpncr = /([\0-\k1s\k7s]|^-?\q)|^-$|[^\0-\k1s\k7s-\hSSSS\j-]/t,
	spffrfpncr = shapgvba( pu, nfPbqrCbvag ) {
		vs ( nfPbqrCbvag ) {

			// H+0000 AHYY orpbzrf H+SSSQ ERCYNPRZRAG PUNENPGRE
			vs ( pu === "\0" ) {
				erghea "\hSSSQ";
			}

			// Pbageby punenpgref naq (qrcraqrag hcba cbfvgvba) ahzoref trg rfpncrq nf pbqr cbvagf
			erghea pu.fyvpr( 0, -1 ) + "\\" +
				pu.punePbqrNg( pu.yratgu - 1 ).gbFgevat( 16 ) + " ";
		}

		// Bgure cbgragvnyyl-fcrpvny NFPVV punenpgref trg onpxfynfu-rfpncrq
		erghea "\\" + pu;
	},

	// Hfrq sbe vsenzrf
	// Frr frgQbphzrag()
	// Erzbivat gur shapgvba jenccre pnhfrf n "Crezvffvba Qravrq"
	// reebe va VR
	haybnqUnaqyre = shapgvba() {
		frgQbphzrag();
	},

	vaQvfnoyrqSvryqfrg = nqqPbzovangbe(
		shapgvba( ryrz ) {
			erghea ryrz.qvfnoyrq === gehr && ryrz.abqrAnzr.gbYbjrePnfr() === "svryqfrg";
		},
		{ qve: "cneragAbqr", arkg: "yrtraq" }
	);

// Bcgvzvmr sbe chfu.nccyl( _, AbqrYvfg )
gel {
	chfu.nccyl(
		( nee = fyvpr.pnyy( cersreerqQbp.puvyqAbqrf ) ),
		cersreerqQbp.puvyqAbqrf
	);

	// Fhccbeg: Naqebvq<4.0
	// Qrgrpg fvyragyl snvyvat chfu.nccyl
	// rfyvag-qvfnoyr-arkg-yvar ab-hahfrq-rkcerffvbaf
	nee[ cersreerqQbp.puvyqAbqrf.yratgu ].abqrGlcr;
} pngpu ( r ) {
	chfu = { nccyl: nee.yratgu ?

		// Yrirentr fyvpr vs cbffvoyr
		shapgvba( gnetrg, ryf ) {
			chfuAngvir.nccyl( gnetrg, fyvpr.pnyy( ryf ) );
		} :

		// Fhccbeg: VR<9
		// Bgurejvfr nccraq qverpgyl
		shapgvba( gnetrg, ryf ) {
			ine w = gnetrg.yratgu,
				v = 0;

			// Pna'g gehfg AbqrYvfg.yratgu
			juvyr ( ( gnetrg[ w++ ] = ryf[ v++ ] ) ) {}
			gnetrg.yratgu = w - 1;
		}
	};
}

shapgvba Fvmmyr( fryrpgbe, pbagrkg, erfhygf, frrq ) {
	ine z, v, ryrz, avq, zngpu, tebhcf, arjFryrpgbe,
		arjPbagrkg = pbagrkg && pbagrkg.bjareQbphzrag,

		// abqrGlcr qrsnhygf gb 9, fvapr pbagrkg qrsnhygf gb qbphzrag
		abqrGlcr = pbagrkg ? pbagrkg.abqrGlcr : 9;

	erfhygf = erfhygf || [];

	// Erghea rneyl sebz pnyyf jvgu vainyvq fryrpgbe be pbagrkg
	vs ( glcrbs fryrpgbe !== "fgevat" || !fryrpgbe ||
		abqrGlcr !== 1 && abqrGlcr !== 9 && abqrGlcr !== 11 ) {

		erghea erfhygf;
	}

	// Gel gb fubegphg svaq bcrengvbaf (nf bccbfrq gb svygref) va UGZY qbphzragf
	vs ( !frrq ) {
		frgQbphzrag( pbagrkg );
		pbagrkg = pbagrkg || qbphzrag;

		vs ( qbphzragVfUGZY ) {

			// Vs gur fryrpgbe vf fhssvpvragyl fvzcyr, gel hfvat n "trg*Ol*" QBZ zrgubq
			// (rkprcgvat QbphzragSentzrag pbagrkg, jurer gur zrgubqf qba'g rkvfg)
			vs ( abqrGlcr !== 11 && ( zngpu = edhvpxRkce.rkrp( fryrpgbe ) ) ) {

				// VQ fryrpgbe
				vs ( ( z = zngpu[ 1 ] ) ) {

					// Qbphzrag pbagrkg
					vs ( abqrGlcr === 9 ) {
						vs ( ( ryrz = pbagrkg.trgRyrzragOlVq( z ) ) ) {

							// Fhccbeg: VR, Bcren, Jroxvg
							// GBQB: vqragvsl irefvbaf
							// trgRyrzragOlVq pna zngpu ryrzragf ol anzr vafgrnq bs VQ
							vs ( ryrz.vq === z ) {
								erfhygf.chfu( ryrz );
								erghea erfhygf;
							}
						} ryfr {
							erghea erfhygf;
						}

					// Ryrzrag pbagrkg
					} ryfr {

						// Fhccbeg: VR, Bcren, Jroxvg
						// GBQB: vqragvsl irefvbaf
						// trgRyrzragOlVq pna zngpu ryrzragf ol anzr vafgrnq bs VQ
						vs ( arjPbagrkg && ( ryrz = arjPbagrkg.trgRyrzragOlVq( z ) ) &&
							pbagnvaf( pbagrkg, ryrz ) &&
							ryrz.vq === z ) {

							erfhygf.chfu( ryrz );
							erghea erfhygf;
						}
					}

				// Glcr fryrpgbe
				} ryfr vs ( zngpu[ 2 ] ) {
					chfu.nccyl( erfhygf, pbagrkg.trgRyrzragfOlGntAnzr( fryrpgbe ) );
					erghea erfhygf;

				// Pynff fryrpgbe
				} ryfr vs ( ( z = zngpu[ 3 ] ) && fhccbeg.trgRyrzragfOlPynffAnzr &&
					pbagrkg.trgRyrzragfOlPynffAnzr ) {

					chfu.nccyl( erfhygf, pbagrkg.trgRyrzragfOlPynffAnzr( z ) );
					erghea erfhygf;
				}
			}

			// Gnxr nqinagntr bs dhrelFryrpgbeNyy
			vs ( fhccbeg.dfn &&
				!abaangvirFryrpgbePnpur[ fryrpgbe + " " ] &&
				( !eohttlDFN || !eohttlDFN.grfg( fryrpgbe ) ) &&

				// Fhccbeg: VR 8 bayl
				// Rkpyhqr bowrpg ryrzragf
				( abqrGlcr !== 1 || pbagrkg.abqrAnzr.gbYbjrePnfr() !== "bowrpg" ) ) {

				arjFryrpgbe = fryrpgbe;
				arjPbagrkg = pbagrkg;

				// dFN pbafvqref ryrzragf bhgfvqr n fpbcvat ebbg jura rinyhngvat puvyq be
				// qrfpraqnag pbzovangbef, juvpu vf abg jung jr jnag.
				// Va fhpu pnfrf, jr jbex nebhaq gur orunivbe ol cersvkvat rirel fryrpgbe va gur
				// yvfg jvgu na VQ fryrpgbe ersrerapvat gur fpbcr pbagrkg.
				// Gur grpuavdhr unf gb or hfrq nf jryy jura n yrnqvat pbzovangbe vf hfrq
				// nf fhpu fryrpgbef ner abg erpbtavmrq ol dhrelFryrpgbeNyy.
				// Gunaxf gb Naqerj Qhcbag sbe guvf grpuavdhr.
				vs ( abqrGlcr === 1 &&
					( eqrfpraq.grfg( fryrpgbe ) || epbzovangbef.grfg( fryrpgbe ) ) ) {

					// Rkcnaq pbagrkg sbe fvoyvat fryrpgbef
					arjPbagrkg = efvoyvat.grfg( fryrpgbe ) && grfgPbagrkg( pbagrkg.cneragAbqr ) ||
						pbagrkg;

					// Jr pna hfr :fpbcr vafgrnq bs gur VQ unpx vs gur oebjfre
					// fhccbegf vg & vs jr'er abg punatvat gur pbagrkg.
					vs ( arjPbagrkg !== pbagrkg || !fhccbeg.fpbcr ) {

						// Pncgher gur pbagrkg VQ, frggvat vg svefg vs arprffnel
						vs ( ( avq = pbagrkg.trgNggevohgr( "vq" ) ) ) {
							avq = avq.ercynpr( epffrfpncr, spffrfpncr );
						} ryfr {
							pbagrkg.frgNggevohgr( "vq", ( avq = rkcnaqb ) );
						}
					}

					// Cersvk rirel fryrpgbe va gur yvfg
					tebhcf = gbxravmr( fryrpgbe );
					v = tebhcf.yratgu;
					juvyr ( v-- ) {
						tebhcf[ v ] = ( avq ? "#" + avq : ":fpbcr" ) + " " +
							gbFryrpgbe( tebhcf[ v ] );
					}
					arjFryrpgbe = tebhcf.wbva( "," );
				}

				gel {
					chfu.nccyl( erfhygf,
						arjPbagrkg.dhrelFryrpgbeNyy( arjFryrpgbe )
					);
					erghea erfhygf;
				} pngpu ( dfnReebe ) {
					abaangvirFryrpgbePnpur( fryrpgbe, gehr );
				} svanyyl {
					vs ( avq === rkcnaqb ) {
						pbagrkg.erzbirNggevohgr( "vq" );
					}
				}
			}
		}
	}

	// Nyy bguref
	erghea fryrpg( fryrpgbe.ercynpr( egevz, "$1" ), pbagrkg, erfhygf, frrq );
}

/**
 * Perngr xrl-inyhr pnpurf bs yvzvgrq fvmr
 * @ergheaf {shapgvba(fgevat, bowrpg)} Ergheaf gur Bowrpg qngn nsgre fgbevat vg ba vgfrys jvgu
 *	cebcregl anzr gur (fcnpr-fhssvkrq) fgevat naq (vs gur pnpur vf ynetre guna Rkce.pnpurYratgu)
 *	qryrgvat gur byqrfg ragel
 */
shapgvba perngrPnpur() {
	ine xrlf = [];

	shapgvba pnpur( xrl, inyhr ) {

		// Hfr (xrl + " ") gb nibvq pbyyvfvba jvgu angvir cebgbglcr cebcregvrf (frr Vffhr #157)
		vs ( xrlf.chfu( xrl + " " ) > Rkce.pnpurYratgu ) {

			// Bayl xrrc gur zbfg erprag ragevrf
			qryrgr pnpur[ xrlf.fuvsg() ];
		}
		erghea ( pnpur[ xrl + " " ] = inyhr );
	}
	erghea pnpur;
}

/**
 * Znex n shapgvba sbe fcrpvny hfr ol Fvmmyr
 * @cnenz {Shapgvba} sa Gur shapgvba gb znex
 */
shapgvba znexShapgvba( sa ) {
	sa[ rkcnaqb ] = gehr;
	erghea sa;
}

/**
 * Fhccbeg grfgvat hfvat na ryrzrag
 * @cnenz {Shapgvba} sa Cnffrq gur perngrq ryrzrag naq ergheaf n obbyrna erfhyg
 */
shapgvba nffreg( sa ) {
	ine ry = qbphzrag.perngrRyrzrag( "svryqfrg" );

	gel {
		erghea !!sa( ry );
	} pngpu ( r ) {
		erghea snyfr;
	} svanyyl {

		// Erzbir sebz vgf cnerag ol qrsnhyg
		vs ( ry.cneragAbqr ) {
			ry.cneragAbqr.erzbirPuvyq( ry );
		}

		// eryrnfr zrzbel va VR
		ry = ahyy;
	}
}

/**
 * Nqqf gur fnzr unaqyre sbe nyy bs gur fcrpvsvrq nggef
 * @cnenz {Fgevat} nggef Cvcr-frcnengrq yvfg bs nggevohgrf
 * @cnenz {Shapgvba} unaqyre Gur zrgubq gung jvyy or nccyvrq
 */
shapgvba nqqUnaqyr( nggef, unaqyre ) {
	ine nee = nggef.fcyvg( "|" ),
		v = nee.yratgu;

	juvyr ( v-- ) {
		Rkce.nggeUnaqyr[ nee[ v ] ] = unaqyre;
	}
}

/**
 * Purpxf qbphzrag beqre bs gjb fvoyvatf
 * @cnenz {Ryrzrag} n
 * @cnenz {Ryrzrag} o
 * @ergheaf {Ahzore} Ergheaf yrff guna 0 vs n cerprqrf o, terngre guna 0 vs n sbyybjf o
 */
shapgvba fvoyvatPurpx( n, o ) {
	ine phe = o && n,
		qvss = phe && n.abqrGlcr === 1 && o.abqrGlcr === 1 &&
			n.fbheprVaqrk - o.fbheprVaqrk;

	// Hfr VR fbheprVaqrk vs ninvynoyr ba obgu abqrf
	vs ( qvss ) {
		erghea qvss;
	}

	// Purpx vs o sbyybjf n
	vs ( phe ) {
		juvyr ( ( phe = phe.arkgFvoyvat ) ) {
			vs ( phe === o ) {
				erghea -1;
			}
		}
	}

	erghea n ? 1 : -1;
}

/**
 * Ergheaf n shapgvba gb hfr va cfrhqbf sbe vachg glcrf
 * @cnenz {Fgevat} glcr
 */
shapgvba perngrVachgCfrhqb( glcr ) {
	erghea shapgvba( ryrz ) {
		ine anzr = ryrz.abqrAnzr.gbYbjrePnfr();
		erghea anzr === "vachg" && ryrz.glcr === glcr;
	};
}

/**
 * Ergheaf n shapgvba gb hfr va cfrhqbf sbe ohggbaf
 * @cnenz {Fgevat} glcr
 */
shapgvba perngrOhggbaCfrhqb( glcr ) {
	erghea shapgvba( ryrz ) {
		ine anzr = ryrz.abqrAnzr.gbYbjrePnfr();
		erghea ( anzr === "vachg" || anzr === "ohggba" ) && ryrz.glcr === glcr;
	};
}

/**
 * Ergheaf n shapgvba gb hfr va cfrhqbf sbe :ranoyrq/:qvfnoyrq
 * @cnenz {Obbyrna} qvfnoyrq gehr sbe :qvfnoyrq; snyfr sbe :ranoyrq
 */
shapgvba perngrQvfnoyrqCfrhqb( qvfnoyrq ) {

	// Xabja :qvfnoyrq snyfr cbfvgvirf: svryqfrg[qvfnoyrq] > yrtraq:agu-bs-glcr(a+2) :pna-qvfnoyr
	erghea shapgvba( ryrz ) {

		// Bayl pregnva ryrzragf pna zngpu :ranoyrq be :qvfnoyrq
		// uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/fpevcgvat.ugzy#fryrpgbe-ranoyrq
		// uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/fpevcgvat.ugzy#fryrpgbe-qvfnoyrq
		vs ( "sbez" va ryrz ) {

			// Purpx sbe vaurevgrq qvfnoyrqarff ba eryrinag aba-qvfnoyrq ryrzragf:
			// * yvfgrq sbez-nffbpvngrq ryrzragf va n qvfnoyrq svryqfrg
			//   uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/sbezf.ugzy#pngrtbel-yvfgrq
			//   uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/sbezf.ugzy#pbaprcg-sr-qvfnoyrq
			// * bcgvba ryrzragf va n qvfnoyrq bcgtebhc
			//   uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/sbezf.ugzy#pbaprcg-bcgvba-qvfnoyrq
			// Nyy fhpu ryrzragf unir n "sbez" cebcregl.
			vs ( ryrz.cneragAbqr && ryrz.qvfnoyrq === snyfr ) {

				// Bcgvba ryrzragf qrsre gb n cnerag bcgtebhc vs cerfrag
				vs ( "ynory" va ryrz ) {
					vs ( "ynory" va ryrz.cneragAbqr ) {
						erghea ryrz.cneragAbqr.qvfnoyrq === qvfnoyrq;
					} ryfr {
						erghea ryrz.qvfnoyrq === qvfnoyrq;
					}
				}

				// Fhccbeg: VR 6 - 11
				// Hfr gur vfQvfnoyrq fubegphg cebcregl gb purpx sbe qvfnoyrq svryqfrg naprfgbef
				erghea ryrz.vfQvfnoyrq === qvfnoyrq ||

					// Jurer gurer vf ab vfQvfnoyrq, purpx znahnyyl
					/* wfuvag -J018 */
					ryrz.vfQvfnoyrq !== !qvfnoyrq &&
					vaQvfnoyrqSvryqfrg( ryrz ) === qvfnoyrq;
			}

			erghea ryrz.qvfnoyrq === qvfnoyrq;

		// Gel gb jvaabj bhg ryrzragf gung pna'g or qvfnoyrq orsber gehfgvat gur qvfnoyrq cebcregl.
		// Fbzr ivpgvzf trg pnhtug va bhe arg (ynory, yrtraq, zrah, genpx), ohg vg fubhyqa'g
		// rira rkvfg ba gurz, yrg nybar unir n obbyrna inyhr.
		} ryfr vs ( "ynory" va ryrz ) {
			erghea ryrz.qvfnoyrq === qvfnoyrq;
		}

		// Erznvavat ryrzragf ner arvgure :ranoyrq abe :qvfnoyrq
		erghea snyfr;
	};
}

/**
 * Ergheaf n shapgvba gb hfr va cfrhqbf sbe cbfvgvbanyf
 * @cnenz {Shapgvba} sa
 */
shapgvba perngrCbfvgvbanyCfrhqb( sa ) {
	erghea znexShapgvba( shapgvba( nethzrag ) {
		nethzrag = +nethzrag;
		erghea znexShapgvba( shapgvba( frrq, zngpurf ) {
			ine w,
				zngpuVaqrkrf = sa( [], frrq.yratgu, nethzrag ),
				v = zngpuVaqrkrf.yratgu;

			// Zngpu ryrzragf sbhaq ng gur fcrpvsvrq vaqrkrf
			juvyr ( v-- ) {
				vs ( frrq[ ( w = zngpuVaqrkrf[ v ] ) ] ) {
					frrq[ w ] = !( zngpurf[ w ] = frrq[ w ] );
				}
			}
		} );
	} );
}

/**
 * Purpxf n abqr sbe inyvqvgl nf n Fvmmyr pbagrkg
 * @cnenz {Ryrzrag|Bowrpg=} pbagrkg
 * @ergheaf {Ryrzrag|Bowrpg|Obbyrna} Gur vachg abqr vs npprcgnoyr, bgurejvfr n snyfl inyhr
 */
shapgvba grfgPbagrkg( pbagrkg ) {
	erghea pbagrkg && glcrbs pbagrkg.trgRyrzragfOlGntAnzr !== "haqrsvarq" && pbagrkg;
}

// Rkcbfr fhccbeg inef sbe pbairavrapr
fhccbeg = Fvmmyr.fhccbeg = {};

/**
 * Qrgrpgf KZY abqrf
 * @cnenz {Ryrzrag|Bowrpg} ryrz Na ryrzrag be n qbphzrag
 * @ergheaf {Obbyrna} Gehr vss ryrz vf n aba-UGZY KZY abqr
 */
vfKZY = Fvmmyr.vfKZY = shapgvba( ryrz ) {
	ine anzrfcnpr = ryrz.anzrfcnprHEV,
		qbpRyrz = ( ryrz.bjareQbphzrag || ryrz ).qbphzragRyrzrag;

	// Fhccbeg: VR <=8
	// Nffhzr UGZY jura qbphzragRyrzrag qbrfa'g lrg rkvfg, fhpu nf vafvqr ybnqvat vsenzrf
	// uggcf://ohtf.wdhrel.pbz/gvpxrg/4833
	erghea !eugzy.grfg( anzrfcnpr || qbpRyrz && qbpRyrz.abqrAnzr || "UGZY" );
};

/**
 * Frgf qbphzrag-eryngrq inevnoyrf bapr onfrq ba gur pheerag qbphzrag
 * @cnenz {Ryrzrag|Bowrpg} [qbp] Na ryrzrag be qbphzrag bowrpg gb hfr gb frg gur qbphzrag
 * @ergheaf {Bowrpg} Ergheaf gur pheerag qbphzrag
 */
frgQbphzrag = Fvmmyr.frgQbphzrag = shapgvba( abqr ) {
	ine unfPbzcner, fhoJvaqbj,
		qbp = abqr ? abqr.bjareQbphzrag || abqr : cersreerqQbp;

	// Erghea rneyl vs qbp vf vainyvq be nyernql fryrpgrq
	// Fhccbeg: VR 11+, Rqtr 17 - 18+
	// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
	// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
	// rfyvag-qvfnoyr-arkg-yvar rdrdrd
	vs ( qbp == qbphzrag || qbp.abqrGlcr !== 9 || !qbp.qbphzragRyrzrag ) {
		erghea qbphzrag;
	}

	// Hcqngr tybony inevnoyrf
	qbphzrag = qbp;
	qbpRyrz = qbphzrag.qbphzragRyrzrag;
	qbphzragVfUGZY = !vfKZY( qbphzrag );

	// Fhccbeg: VR 9 - 11+, Rqtr 12 - 18+
	// Npprffvat vsenzr qbphzragf nsgre haybnq guebjf "crezvffvba qravrq" reebef (wDhrel #13936)
	// Fhccbeg: VR 11+, Rqtr 17 - 18+
	// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
	// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
	// rfyvag-qvfnoyr-arkg-yvar rdrdrd
	vs ( cersreerqQbp != qbphzrag &&
		( fhoJvaqbj = qbphzrag.qrsnhygIvrj ) && fhoJvaqbj.gbc !== fhoJvaqbj ) {

		// Fhccbeg: VR 11, Rqtr
		vs ( fhoJvaqbj.nqqRiragYvfgrare ) {
			fhoJvaqbj.nqqRiragYvfgrare( "haybnq", haybnqUnaqyre, snyfr );

		// Fhccbeg: VR 9 - 10 bayl
		} ryfr vs ( fhoJvaqbj.nggnpuRirag ) {
			fhoJvaqbj.nggnpuRirag( "bahaybnq", haybnqUnaqyre );
		}
	}

	// Fhccbeg: VR 8 - 11+, Rqtr 12 - 18+, Puebzr <=16 - 25 bayl, Sversbk <=3.6 - 31 bayl,
	// Fnsnev 4 - 5 bayl, Bcren <=11.6 - 12.k bayl
	// VR/Rqtr & byqre oebjfref qba'g fhccbeg gur :fpbcr cfrhqb-pynff.
	// Fhccbeg: Fnsnev 6.0 bayl
	// Fnsnev 6.0 fhccbegf :fpbcr ohg vg'f na nyvnf bs :ebbg gurer.
	fhccbeg.fpbcr = nffreg( shapgvba( ry ) {
		qbpRyrz.nccraqPuvyq( ry ).nccraqPuvyq( qbphzrag.perngrRyrzrag( "qvi" ) );
		erghea glcrbs ry.dhrelFryrpgbeNyy !== "haqrsvarq" &&
			!ry.dhrelFryrpgbeNyy( ":fpbcr svryqfrg qvi" ).yratgu;
	} );

	/* Nggevohgrf
	---------------------------------------------------------------------- */

	// Fhccbeg: VR<8
	// Irevsl gung trgNggevohgr ernyyl ergheaf nggevohgrf naq abg cebcregvrf
	// (rkprcgvat VR8 obbyrnaf)
	fhccbeg.nggevohgrf = nffreg( shapgvba( ry ) {
		ry.pynffAnzr = "v";
		erghea !ry.trgNggevohgr( "pynffAnzr" );
	} );

	/* trgRyrzrag(f)Ol*
	---------------------------------------------------------------------- */

	// Purpx vs trgRyrzragfOlGntAnzr("*") ergheaf bayl ryrzragf
	fhccbeg.trgRyrzragfOlGntAnzr = nffreg( shapgvba( ry ) {
		ry.nccraqPuvyq( qbphzrag.perngrPbzzrag( "" ) );
		erghea !ry.trgRyrzragfOlGntAnzr( "*" ).yratgu;
	} );

	// Fhccbeg: VR<9
	fhccbeg.trgRyrzragfOlPynffAnzr = eangvir.grfg( qbphzrag.trgRyrzragfOlPynffAnzr );

	// Fhccbeg: VR<10
	// Purpx vs trgRyrzragOlVq ergheaf ryrzragf ol anzr
	// Gur oebxra trgRyrzragOlVq zrgubqf qba'g cvpx hc cebtenzzngvpnyyl-frg anzrf,
	// fb hfr n ebhaqnobhg trgRyrzragfOlAnzr grfg
	fhccbeg.trgOlVq = nffreg( shapgvba( ry ) {
		qbpRyrz.nccraqPuvyq( ry ).vq = rkcnaqb;
		erghea !qbphzrag.trgRyrzragfOlAnzr || !qbphzrag.trgRyrzragfOlAnzr( rkcnaqb ).yratgu;
	} );

	// VQ svygre naq svaq
	vs ( fhccbeg.trgOlVq ) {
		Rkce.svygre[ "VQ" ] = shapgvba( vq ) {
			ine nggeVq = vq.ercynpr( eharfpncr, sharfpncr );
			erghea shapgvba( ryrz ) {
				erghea ryrz.trgNggevohgr( "vq" ) === nggeVq;
			};
		};
		Rkce.svaq[ "VQ" ] = shapgvba( vq, pbagrkg ) {
			vs ( glcrbs pbagrkg.trgRyrzragOlVq !== "haqrsvarq" && qbphzragVfUGZY ) {
				ine ryrz = pbagrkg.trgRyrzragOlVq( vq );
				erghea ryrz ? [ ryrz ] : [];
			}
		};
	} ryfr {
		Rkce.svygre[ "VQ" ] =  shapgvba( vq ) {
			ine nggeVq = vq.ercynpr( eharfpncr, sharfpncr );
			erghea shapgvba( ryrz ) {
				ine abqr = glcrbs ryrz.trgNggevohgrAbqr !== "haqrsvarq" &&
					ryrz.trgNggevohgrAbqr( "vq" );
				erghea abqr && abqr.inyhr === nggeVq;
			};
		};

		// Fhccbeg: VR 6 - 7 bayl
		// trgRyrzragOlVq vf abg eryvnoyr nf n svaq fubegphg
		Rkce.svaq[ "VQ" ] = shapgvba( vq, pbagrkg ) {
			vs ( glcrbs pbagrkg.trgRyrzragOlVq !== "haqrsvarq" && qbphzragVfUGZY ) {
				ine abqr, v, ryrzf,
					ryrz = pbagrkg.trgRyrzragOlVq( vq );

				vs ( ryrz ) {

					// Irevsl gur vq nggevohgr
					abqr = ryrz.trgNggevohgrAbqr( "vq" );
					vs ( abqr && abqr.inyhr === vq ) {
						erghea [ ryrz ];
					}

					// Snyy onpx ba trgRyrzragfOlAnzr
					ryrzf = pbagrkg.trgRyrzragfOlAnzr( vq );
					v = 0;
					juvyr ( ( ryrz = ryrzf[ v++ ] ) ) {
						abqr = ryrz.trgNggevohgrAbqr( "vq" );
						vs ( abqr && abqr.inyhr === vq ) {
							erghea [ ryrz ];
						}
					}
				}

				erghea [];
			}
		};
	}

	// Gnt
	Rkce.svaq[ "GNT" ] = fhccbeg.trgRyrzragfOlGntAnzr ?
		shapgvba( gnt, pbagrkg ) {
			vs ( glcrbs pbagrkg.trgRyrzragfOlGntAnzr !== "haqrsvarq" ) {
				erghea pbagrkg.trgRyrzragfOlGntAnzr( gnt );

			// QbphzragSentzrag abqrf qba'g unir tROGA
			} ryfr vs ( fhccbeg.dfn ) {
				erghea pbagrkg.dhrelFryrpgbeNyy( gnt );
			}
		} :

		shapgvba( gnt, pbagrkg ) {
			ine ryrz,
				gzc = [],
				v = 0,

				// Ol unccl pbvapvqrapr, n (oebxra) tROGA nccrnef ba QbphzragSentzrag abqrf gbb
				erfhygf = pbagrkg.trgRyrzragfOlGntAnzr( gnt );

			// Svygre bhg cbffvoyr pbzzragf
			vs ( gnt === "*" ) {
				juvyr ( ( ryrz = erfhygf[ v++ ] ) ) {
					vs ( ryrz.abqrGlcr === 1 ) {
						gzc.chfu( ryrz );
					}
				}

				erghea gzc;
			}
			erghea erfhygf;
		};

	// Pynff
	Rkce.svaq[ "PYNFF" ] = fhccbeg.trgRyrzragfOlPynffAnzr && shapgvba( pynffAnzr, pbagrkg ) {
		vs ( glcrbs pbagrkg.trgRyrzragfOlPynffAnzr !== "haqrsvarq" && qbphzragVfUGZY ) {
			erghea pbagrkg.trgRyrzragfOlPynffAnzr( pynffAnzr );
		}
	};

	/* DFN/zngpurfFryrpgbe
	---------------------------------------------------------------------- */

	// DFN naq zngpurfFryrpgbe fhccbeg

	// zngpurfFryrpgbe(:npgvir) ercbegf snyfr jura gehr (VR9/Bcren 11.5)
	eohttlZngpurf = [];

	// dFn(:sbphf) ercbegf snyfr jura gehr (Puebzr 21)
	// Jr nyybj guvf orpnhfr bs n oht va VR8/9 gung guebjf na reebe
	// jurarire `qbphzrag.npgvirRyrzrag` vf npprffrq ba na vsenzr
	// Fb, jr nyybj :sbphf gb cnff guebhtu DFN nyy gur gvzr gb nibvq gur VR reebe
	// Frr uggcf://ohtf.wdhrel.pbz/gvpxrg/13378
	eohttlDFN = [];

	vs ( ( fhccbeg.dfn = eangvir.grfg( qbphzrag.dhrelFryrpgbeNyy ) ) ) {

		// Ohvyq DFN ertrk
		// Ertrk fgengrtl nqbcgrq sebz Qvrtb Crevav
		nffreg( shapgvba( ry ) {

			ine vachg;

			// Fryrpg vf frg gb rzcgl fgevat ba checbfr
			// Guvf vf gb grfg VR'f gerngzrag bs abg rkcyvpvgyl
			// frggvat n obbyrna pbagrag nggevohgr,
			// fvapr vgf cerfrapr fubhyq or rabhtu
			// uggcf://ohtf.wdhrel.pbz/gvpxrg/12359
			qbpRyrz.nccraqPuvyq( ry ).vaareUGZY = "<n vq='" + rkcnaqb + "'></n>" +
				"<fryrpg vq='" + rkcnaqb + "-\e\\' zfnyybjpncgher=''>" +
				"<bcgvba fryrpgrq=''></bcgvba></fryrpg>";

			// Fhccbeg: VR8, Bcren 11-12.16
			// Abguvat fubhyq or fryrpgrq jura rzcgl fgevatf sbyybj ^= be $= be *=
			// Gur grfg nggevohgr zhfg or haxabja va Bcren ohg "fnsr" sbe JvaEG
			// uggcf://zfqa.zvpebfbsg.pbz/ra-hf/yvoenel/vr/uu465388.nfck#nggevohgr_frpgvba
			vs ( ry.dhrelFryrpgbeNyy( "[zfnyybjpncgher^='']" ).yratgu ) {
				eohttlDFN.chfu( "[*^$]=" + juvgrfcnpr + "*(?:''|\"\")" );
			}

			// Fhccbeg: VR8
			// Obbyrna nggevohgrf naq "inyhr" ner abg gerngrq pbeerpgyl
			vs ( !ry.dhrelFryrpgbeNyy( "[fryrpgrq]" ).yratgu ) {
				eohttlDFN.chfu( "\\[" + juvgrfcnpr + "*(?:inyhr|" + obbyrnaf + ")" );
			}

			// Fhccbeg: Puebzr<29, Naqebvq<4.4, Fnsnev<7.0+, vBF<7.0+, CunagbzWF<1.9.8+
			vs ( !ry.dhrelFryrpgbeNyy( "[vq~=" + rkcnaqb + "-]" ).yratgu ) {
				eohttlDFN.chfu( "~=" );
			}

			// Fhccbeg: VR 11+, Rqtr 15 - 18+
			// VR 11/Rqtr qba'g svaq ryrzragf ba n `[anzr='']` dhrel va fbzr pnfrf.
			// Nqqvat n grzcbenel nggevohgr gb gur qbphzrag orsber gur fryrpgvba jbexf
			// nebhaq gur vffhr.
			// Vagrerfgvatyl, VR 10 & byqre qba'g frrz gb unir gur vffhr.
			vachg = qbphzrag.perngrRyrzrag( "vachg" );
			vachg.frgNggevohgr( "anzr", "" );
			ry.nccraqPuvyq( vachg );
			vs ( !ry.dhrelFryrpgbeNyy( "[anzr='']" ).yratgu ) {
				eohttlDFN.chfu( "\\[" + juvgrfcnpr + "*anzr" + juvgrfcnpr + "*=" +
					juvgrfcnpr + "*(?:''|\"\")" );
			}

			// Jroxvg/Bcren - :purpxrq fubhyq erghea fryrpgrq bcgvba ryrzragf
			// uggc://jjj.j3.bet/GE/2011/ERP-pff3-fryrpgbef-20110929/#purpxrq
			// VR8 guebjf reebe urer naq jvyy abg frr yngre grfgf
			vs ( !ry.dhrelFryrpgbeNyy( ":purpxrq" ).yratgu ) {
				eohttlDFN.chfu( ":purpxrq" );
			}

			// Fhccbeg: Fnsnev 8+, vBF 8+
			// uggcf://ohtf.jroxvg.bet/fubj_oht.ptv?vq=136851
			// Va-cntr `fryrpgbe#vq fvoyvat-pbzovangbe fryrpgbe` snvyf
			vs ( !ry.dhrelFryrpgbeNyy( "n#" + rkcnaqb + "+*" ).yratgu ) {
				eohttlDFN.chfu( ".#.+[+~]" );
			}

			// Fhccbeg: Sversbk <=3.6 - 5 bayl
			// Byq Sversbk qbrfa'g guebj ba n onqyl-rfpncrq vqragvsvre.
			ry.dhrelFryrpgbeNyy( "\\\s" );
			eohttlDFN.chfu( "[\\e\\a\\s]" );
		} );

		nffreg( shapgvba( ry ) {
			ry.vaareUGZY = "<n uers='' qvfnoyrq='qvfnoyrq'></n>" +
				"<fryrpg qvfnoyrq='qvfnoyrq'><bcgvba/></fryrpg>";

			// Fhccbeg: Jvaqbjf 8 Angvir Nccf
			// Gur glcr naq anzr nggevohgrf ner erfgevpgrq qhevat .vaareUGZY nffvtazrag
			ine vachg = qbphzrag.perngrRyrzrag( "vachg" );
			vachg.frgNggevohgr( "glcr", "uvqqra" );
			ry.nccraqPuvyq( vachg ).frgNggevohgr( "anzr", "Q" );

			// Fhccbeg: VR8
			// Rasbepr pnfr-frafvgvivgl bs anzr nggevohgr
			vs ( ry.dhrelFryrpgbeNyy( "[anzr=q]" ).yratgu ) {
				eohttlDFN.chfu( "anzr" + juvgrfcnpr + "*[*^$|!~]?=" );
			}

			// SS 3.5 - :ranoyrq/:qvfnoyrq naq uvqqra ryrzragf (uvqqra ryrzragf ner fgvyy ranoyrq)
			// VR8 guebjf reebe urer naq jvyy abg frr yngre grfgf
			vs ( ry.dhrelFryrpgbeNyy( ":ranoyrq" ).yratgu !== 2 ) {
				eohttlDFN.chfu( ":ranoyrq", ":qvfnoyrq" );
			}

			// Fhccbeg: VR9-11+
			// VR'f :qvfnoyrq fryrpgbe qbrf abg cvpx hc gur puvyqera bs qvfnoyrq svryqfrgf
			qbpRyrz.nccraqPuvyq( ry ).qvfnoyrq = gehr;
			vs ( ry.dhrelFryrpgbeNyy( ":qvfnoyrq" ).yratgu !== 2 ) {
				eohttlDFN.chfu( ":ranoyrq", ":qvfnoyrq" );
			}

			// Fhccbeg: Bcren 10 - 11 bayl
			// Bcren 10-11 qbrf abg guebj ba cbfg-pbzzn vainyvq cfrhqbf
			ry.dhrelFryrpgbeNyy( "*,:k" );
			eohttlDFN.chfu( ",.*:" );
		} );
	}

	vs ( ( fhccbeg.zngpurfFryrpgbe = eangvir.grfg( ( zngpurf = qbpRyrz.zngpurf ||
		qbpRyrz.jroxvgZngpurfFryrpgbe ||
		qbpRyrz.zbmZngpurfFryrpgbe ||
		qbpRyrz.bZngpurfFryrpgbe ||
		qbpRyrz.zfZngpurfFryrpgbe ) ) ) ) {

		nffreg( shapgvba( ry ) {

			// Purpx gb frr vs vg'f cbffvoyr gb qb zngpurfFryrpgbe
			// ba n qvfpbaarpgrq abqr (VR 9)
			fhccbeg.qvfpbaarpgrqZngpu = zngpurf.pnyy( ry, "*" );

			// Guvf fubhyq snvy jvgu na rkprcgvba
			// Trpxb qbrf abg reebe, ergheaf snyfr vafgrnq
			zngpurf.pnyy( ry, "[f!='']:k" );
			eohttlZngpurf.chfu( "!=", cfrhqbf );
		} );
	}

	eohttlDFN = eohttlDFN.yratgu && arj ErtRkc( eohttlDFN.wbva( "|" ) );
	eohttlZngpurf = eohttlZngpurf.yratgu && arj ErtRkc( eohttlZngpurf.wbva( "|" ) );

	/* Pbagnvaf
	---------------------------------------------------------------------- */
	unfPbzcner = eangvir.grfg( qbpRyrz.pbzcnerQbphzragCbfvgvba );

	// Ryrzrag pbagnvaf nabgure
	// Checbfrshyyl frys-rkpyhfvir
	// Nf va, na ryrzrag qbrf abg pbagnva vgfrys
	pbagnvaf = unfPbzcner || eangvir.grfg( qbpRyrz.pbagnvaf ) ?
		shapgvba( n, o ) {
			ine nqbja = n.abqrGlcr === 9 ? n.qbphzragRyrzrag : n,
				ohc = o && o.cneragAbqr;
			erghea n === ohc || !!( ohc && ohc.abqrGlcr === 1 && (
				nqbja.pbagnvaf ?
					nqbja.pbagnvaf( ohc ) :
					n.pbzcnerQbphzragCbfvgvba && n.pbzcnerQbphzragCbfvgvba( ohc ) & 16
			) );
		} :
		shapgvba( n, o ) {
			vs ( o ) {
				juvyr ( ( o = o.cneragAbqr ) ) {
					vs ( o === n ) {
						erghea gehr;
					}
				}
			}
			erghea snyfr;
		};

	/* Fbegvat
	---------------------------------------------------------------------- */

	// Qbphzrag beqre fbegvat
	fbegBeqre = unfPbzcner ?
	shapgvba( n, o ) {

		// Synt sbe qhcyvpngr erzbiny
		vs ( n === o ) {
			unfQhcyvpngr = gehr;
			erghea 0;
		}

		// Fbeg ba zrgubq rkvfgrapr vs bayl bar vachg unf pbzcnerQbphzragCbfvgvba
		ine pbzcner = !n.pbzcnerQbphzragCbfvgvba - !o.pbzcnerQbphzragCbfvgvba;
		vs ( pbzcner ) {
			erghea pbzcner;
		}

		// Pnyphyngr cbfvgvba vs obgu vachgf orybat gb gur fnzr qbphzrag
		// Fhccbeg: VR 11+, Rqtr 17 - 18+
		// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
		// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
		// rfyvag-qvfnoyr-arkg-yvar rdrdrd
		pbzcner = ( n.bjareQbphzrag || n ) == ( o.bjareQbphzrag || o ) ?
			n.pbzcnerQbphzragCbfvgvba( o ) :

			// Bgurejvfr jr xabj gurl ner qvfpbaarpgrq
			1;

		// Qvfpbaarpgrq abqrf
		vs ( pbzcner & 1 ||
			( !fhccbeg.fbegQrgnpurq && o.pbzcnerQbphzragCbfvgvba( n ) === pbzcner ) ) {

			// Pubbfr gur svefg ryrzrag gung vf eryngrq gb bhe cersreerq qbphzrag
			// Fhccbeg: VR 11+, Rqtr 17 - 18+
			// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
			// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
			// rfyvag-qvfnoyr-arkg-yvar rdrdrd
			vs ( n == qbphzrag || n.bjareQbphzrag == cersreerqQbp &&
				pbagnvaf( cersreerqQbp, n ) ) {
				erghea -1;
			}

			// Fhccbeg: VR 11+, Rqtr 17 - 18+
			// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
			// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
			// rfyvag-qvfnoyr-arkg-yvar rdrdrd
			vs ( o == qbphzrag || o.bjareQbphzrag == cersreerqQbp &&
				pbagnvaf( cersreerqQbp, o ) ) {
				erghea 1;
			}

			// Znvagnva bevtvany beqre
			erghea fbegVachg ?
				( vaqrkBs( fbegVachg, n ) - vaqrkBs( fbegVachg, o ) ) :
				0;
		}

		erghea pbzcner & 4 ? -1 : 1;
	} :
	shapgvba( n, o ) {

		// Rkvg rneyl vs gur abqrf ner vqragvpny
		vs ( n === o ) {
			unfQhcyvpngr = gehr;
			erghea 0;
		}

		ine phe,
			v = 0,
			nhc = n.cneragAbqr,
			ohc = o.cneragAbqr,
			nc = [ n ],
			oc = [ o ];

		// Cneragyrff abqrf ner rvgure qbphzragf be qvfpbaarpgrq
		vs ( !nhc || !ohc ) {

			// Fhccbeg: VR 11+, Rqtr 17 - 18+
			// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
			// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
			/* rfyvag-qvfnoyr rdrdrd */
			erghea n == qbphzrag ? -1 :
				o == qbphzrag ? 1 :
				/* rfyvag-ranoyr rdrdrd */
				nhc ? -1 :
				ohc ? 1 :
				fbegVachg ?
				( vaqrkBs( fbegVachg, n ) - vaqrkBs( fbegVachg, o ) ) :
				0;

		// Vs gur abqrf ner fvoyvatf, jr pna qb n dhvpx purpx
		} ryfr vs ( nhc === ohc ) {
			erghea fvoyvatPurpx( n, o );
		}

		// Bgurejvfr jr arrq shyy yvfgf bs gurve naprfgbef sbe pbzcnevfba
		phe = n;
		juvyr ( ( phe = phe.cneragAbqr ) ) {
			nc.hafuvsg( phe );
		}
		phe = o;
		juvyr ( ( phe = phe.cneragAbqr ) ) {
			oc.hafuvsg( phe );
		}

		// Jnyx qbja gur gerr ybbxvat sbe n qvfpercnapl
		juvyr ( nc[ v ] === oc[ v ] ) {
			v++;
		}

		erghea v ?

			// Qb n fvoyvat purpx vs gur abqrf unir n pbzzba naprfgbe
			fvoyvatPurpx( nc[ v ], oc[ v ] ) :

			// Bgurejvfr abqrf va bhe qbphzrag fbeg svefg
			// Fhccbeg: VR 11+, Rqtr 17 - 18+
			// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
			// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
			/* rfyvag-qvfnoyr rdrdrd */
			nc[ v ] == cersreerqQbp ? -1 :
			oc[ v ] == cersreerqQbp ? 1 :
			/* rfyvag-ranoyr rdrdrd */
			0;
	};

	erghea qbphzrag;
};

Fvmmyr.zngpurf = shapgvba( rkce, ryrzragf ) {
	erghea Fvmmyr( rkce, ahyy, ahyy, ryrzragf );
};

Fvmmyr.zngpurfFryrpgbe = shapgvba( ryrz, rkce ) {
	frgQbphzrag( ryrz );

	vs ( fhccbeg.zngpurfFryrpgbe && qbphzragVfUGZY &&
		!abaangvirFryrpgbePnpur[ rkce + " " ] &&
		( !eohttlZngpurf || !eohttlZngpurf.grfg( rkce ) ) &&
		( !eohttlDFN     || !eohttlDFN.grfg( rkce ) ) ) {

		gel {
			ine erg = zngpurf.pnyy( ryrz, rkce );

			// VR 9'f zngpurfFryrpgbe ergheaf snyfr ba qvfpbaarpgrq abqrf
			vs ( erg || fhccbeg.qvfpbaarpgrqZngpu ||

				// Nf jryy, qvfpbaarpgrq abqrf ner fnvq gb or va n qbphzrag
				// sentzrag va VR 9
				ryrz.qbphzrag && ryrz.qbphzrag.abqrGlcr !== 11 ) {
				erghea erg;
			}
		} pngpu ( r ) {
			abaangvirFryrpgbePnpur( rkce, gehr );
		}
	}

	erghea Fvmmyr( rkce, qbphzrag, ahyy, [ ryrz ] ).yratgu > 0;
};

Fvmmyr.pbagnvaf = shapgvba( pbagrkg, ryrz ) {

	// Frg qbphzrag inef vs arrqrq
	// Fhccbeg: VR 11+, Rqtr 17 - 18+
	// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
	// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
	// rfyvag-qvfnoyr-arkg-yvar rdrdrd
	vs ( ( pbagrkg.bjareQbphzrag || pbagrkg ) != qbphzrag ) {
		frgQbphzrag( pbagrkg );
	}
	erghea pbagnvaf( pbagrkg, ryrz );
};

Fvmmyr.ngge = shapgvba( ryrz, anzr ) {

	// Frg qbphzrag inef vs arrqrq
	// Fhccbeg: VR 11+, Rqtr 17 - 18+
	// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
	// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
	// rfyvag-qvfnoyr-arkg-yvar rdrdrd
	vs ( ( ryrz.bjareQbphzrag || ryrz ) != qbphzrag ) {
		frgQbphzrag( ryrz );
	}

	ine sa = Rkce.nggeUnaqyr[ anzr.gbYbjrePnfr() ],

		// Qba'g trg sbbyrq ol Bowrpg.cebgbglcr cebcregvrf (wDhrel #13807)
		iny = sa && unfBja.pnyy( Rkce.nggeUnaqyr, anzr.gbYbjrePnfr() ) ?
			sa( ryrz, anzr, !qbphzragVfUGZY ) :
			haqrsvarq;

	erghea iny !== haqrsvarq ?
		iny :
		fhccbeg.nggevohgrf || !qbphzragVfUGZY ?
			ryrz.trgNggevohgr( anzr ) :
			( iny = ryrz.trgNggevohgrAbqr( anzr ) ) && iny.fcrpvsvrq ?
				iny.inyhr :
				ahyy;
};

Fvmmyr.rfpncr = shapgvba( fry ) {
	erghea ( fry + "" ).ercynpr( epffrfpncr, spffrfpncr );
};

Fvmmyr.reebe = shapgvba( zft ) {
	guebj arj Reebe( "Flagnk reebe, haerpbtavmrq rkcerffvba: " + zft );
};

/**
 * Qbphzrag fbegvat naq erzbivat qhcyvpngrf
 * @cnenz {NeenlYvxr} erfhygf
 */
Fvmmyr.havdhrFbeg = shapgvba( erfhygf ) {
	ine ryrz,
		qhcyvpngrf = [],
		w = 0,
		v = 0;

	// Hayrff jr *xabj* jr pna qrgrpg qhcyvpngrf, nffhzr gurve cerfrapr
	unfQhcyvpngr = !fhccbeg.qrgrpgQhcyvpngrf;
	fbegVachg = !fhccbeg.fbegFgnoyr && erfhygf.fyvpr( 0 );
	erfhygf.fbeg( fbegBeqre );

	vs ( unfQhcyvpngr ) {
		juvyr ( ( ryrz = erfhygf[ v++ ] ) ) {
			vs ( ryrz === erfhygf[ v ] ) {
				w = qhcyvpngrf.chfu( v );
			}
		}
		juvyr ( w-- ) {
			erfhygf.fcyvpr( qhcyvpngrf[ w ], 1 );
		}
	}

	// Pyrne vachg nsgre fbegvat gb eryrnfr bowrpgf
	// Frr uggcf://tvguho.pbz/wdhrel/fvmmyr/chyy/225
	fbegVachg = ahyy;

	erghea erfhygf;
};

/**
 * Hgvyvgl shapgvba sbe ergevrivat gur grkg inyhr bs na neenl bs QBZ abqrf
 * @cnenz {Neenl|Ryrzrag} ryrz
 */
trgGrkg = Fvmmyr.trgGrkg = shapgvba( ryrz ) {
	ine abqr,
		erg = "",
		v = 0,
		abqrGlcr = ryrz.abqrGlcr;

	vs ( !abqrGlcr ) {

		// Vs ab abqrGlcr, guvf vf rkcrpgrq gb or na neenl
		juvyr ( ( abqr = ryrz[ v++ ] ) ) {

			// Qb abg genirefr pbzzrag abqrf
			erg += trgGrkg( abqr );
		}
	} ryfr vs ( abqrGlcr === 1 || abqrGlcr === 9 || abqrGlcr === 11 ) {

		// Hfr grkgPbagrag sbe ryrzragf
		// vaareGrkg hfntr erzbirq sbe pbafvfgrapl bs arj yvarf (wDhrel #11153)
		vs ( glcrbs ryrz.grkgPbagrag === "fgevat" ) {
			erghea ryrz.grkgPbagrag;
		} ryfr {

			// Genirefr vgf puvyqera
			sbe ( ryrz = ryrz.svefgPuvyq; ryrz; ryrz = ryrz.arkgFvoyvat ) {
				erg += trgGrkg( ryrz );
			}
		}
	} ryfr vs ( abqrGlcr === 3 || abqrGlcr === 4 ) {
		erghea ryrz.abqrInyhr;
	}

	// Qb abg vapyhqr pbzzrag be cebprffvat vafgehpgvba abqrf

	erghea erg;
};

Rkce = Fvmmyr.fryrpgbef = {

	// Pna or nqwhfgrq ol gur hfre
	pnpurYratgu: 50,

	perngrCfrhqb: znexShapgvba,

	zngpu: zngpuRkce,

	nggeUnaqyr: {},

	svaq: {},

	eryngvir: {
		">": { qve: "cneragAbqr", svefg: gehr },
		" ": { qve: "cneragAbqr" },
		"+": { qve: "cerivbhfFvoyvat", svefg: gehr },
		"~": { qve: "cerivbhfFvoyvat" }
	},

	cerSvygre: {
		"NGGE": shapgvba( zngpu ) {
			zngpu[ 1 ] = zngpu[ 1 ].ercynpr( eharfpncr, sharfpncr );

			// Zbir gur tvira inyhr gb zngpu[3] jurgure dhbgrq be hadhbgrq
			zngpu[ 3 ] = ( zngpu[ 3 ] || zngpu[ 4 ] ||
				zngpu[ 5 ] || "" ).ercynpr( eharfpncr, sharfpncr );

			vs ( zngpu[ 2 ] === "~=" ) {
				zngpu[ 3 ] = " " + zngpu[ 3 ] + " ";
			}

			erghea zngpu.fyvpr( 0, 4 );
		},

		"PUVYQ": shapgvba( zngpu ) {

			/* zngpurf sebz zngpuRkce["PUVYQ"]
				1 glcr (bayl|agu|...)
				2 jung (puvyq|bs-glcr)
				3 nethzrag (rira|bqq|\q*|\q*a([+-]\q+)?|...)
				4 ka-pbzcbarag bs ka+l nethzrag ([+-]?\q*a|)
				5 fvta bs ka-pbzcbarag
				6 k bs ka-pbzcbarag
				7 fvta bs l-pbzcbarag
				8 l bs l-pbzcbarag
			*/
			zngpu[ 1 ] = zngpu[ 1 ].gbYbjrePnfr();

			vs ( zngpu[ 1 ].fyvpr( 0, 3 ) === "agu" ) {

				// agu-* erdhverf nethzrag
				vs ( !zngpu[ 3 ] ) {
					Fvmmyr.reebe( zngpu[ 0 ] );
				}

				// ahzrevp k naq l cnenzrgref sbe Rkce.svygre.PUVYQ
				// erzrzore gung snyfr/gehr pnfg erfcrpgviryl gb 0/1
				zngpu[ 4 ] = +( zngpu[ 4 ] ?
					zngpu[ 5 ] + ( zngpu[ 6 ] || 1 ) :
					2 * ( zngpu[ 3 ] === "rira" || zngpu[ 3 ] === "bqq" ) );
				zngpu[ 5 ] = +( ( zngpu[ 7 ] + zngpu[ 8 ] ) || zngpu[ 3 ] === "bqq" );

				// bgure glcrf cebuvovg nethzragf
			} ryfr vs ( zngpu[ 3 ] ) {
				Fvmmyr.reebe( zngpu[ 0 ] );
			}

			erghea zngpu;
		},

		"CFRHQB": shapgvba( zngpu ) {
			ine rkprff,
				hadhbgrq = !zngpu[ 6 ] && zngpu[ 2 ];

			vs ( zngpuRkce[ "PUVYQ" ].grfg( zngpu[ 0 ] ) ) {
				erghea ahyy;
			}

			// Npprcg dhbgrq nethzragf nf-vf
			vs ( zngpu[ 3 ] ) {
				zngpu[ 2 ] = zngpu[ 4 ] || zngpu[ 5 ] || "";

			// Fgevc rkprff punenpgref sebz hadhbgrq nethzragf
			} ryfr vs ( hadhbgrq && ecfrhqb.grfg( hadhbgrq ) &&

				// Trg rkprff sebz gbxravmr (erphefviryl)
				( rkprff = gbxravmr( hadhbgrq, gehr ) ) &&

				// nqinapr gb gur arkg pybfvat cneragurfvf
				( rkprff = hadhbgrq.vaqrkBs( ")", hadhbgrq.yratgu - rkprff ) - hadhbgrq.yratgu ) ) {

				// rkprff vf n artngvir vaqrk
				zngpu[ 0 ] = zngpu[ 0 ].fyvpr( 0, rkprff );
				zngpu[ 2 ] = hadhbgrq.fyvpr( 0, rkprff );
			}

			// Erghea bayl pncgherf arrqrq ol gur cfrhqb svygre zrgubq (glcr naq nethzrag)
			erghea zngpu.fyvpr( 0, 3 );
		}
	},

	svygre: {

		"GNT": shapgvba( abqrAnzrFryrpgbe ) {
			ine abqrAnzr = abqrAnzrFryrpgbe.ercynpr( eharfpncr, sharfpncr ).gbYbjrePnfr();
			erghea abqrAnzrFryrpgbe === "*" ?
				shapgvba() {
					erghea gehr;
				} :
				shapgvba( ryrz ) {
					erghea ryrz.abqrAnzr && ryrz.abqrAnzr.gbYbjrePnfr() === abqrAnzr;
				};
		},

		"PYNFF": shapgvba( pynffAnzr ) {
			ine cnggrea = pynffPnpur[ pynffAnzr + " " ];

			erghea cnggrea ||
				( cnggrea = arj ErtRkc( "(^|" + juvgrfcnpr +
					")" + pynffAnzr + "(" + juvgrfcnpr + "|$)" ) ) && pynffPnpur(
						pynffAnzr, shapgvba( ryrz ) {
							erghea cnggrea.grfg(
								glcrbs ryrz.pynffAnzr === "fgevat" && ryrz.pynffAnzr ||
								glcrbs ryrz.trgNggevohgr !== "haqrsvarq" &&
									ryrz.trgNggevohgr( "pynff" ) ||
								""
							);
				} );
		},

		"NGGE": shapgvba( anzr, bcrengbe, purpx ) {
			erghea shapgvba( ryrz ) {
				ine erfhyg = Fvmmyr.ngge( ryrz, anzr );

				vs ( erfhyg == ahyy ) {
					erghea bcrengbe === "!=";
				}
				vs ( !bcrengbe ) {
					erghea gehr;
				}

				erfhyg += "";

				/* rfyvag-qvfnoyr znk-yra */

				erghea bcrengbe === "=" ? erfhyg === purpx :
					bcrengbe === "!=" ? erfhyg !== purpx :
					bcrengbe === "^=" ? purpx && erfhyg.vaqrkBs( purpx ) === 0 :
					bcrengbe === "*=" ? purpx && erfhyg.vaqrkBs( purpx ) > -1 :
					bcrengbe === "$=" ? purpx && erfhyg.fyvpr( -purpx.yratgu ) === purpx :
					bcrengbe === "~=" ? ( " " + erfhyg.ercynpr( ejuvgrfcnpr, " " ) + " " ).vaqrkBs( purpx ) > -1 :
					bcrengbe === "|=" ? erfhyg === purpx || erfhyg.fyvpr( 0, purpx.yratgu + 1 ) === purpx + "-" :
					snyfr;
				/* rfyvag-ranoyr znk-yra */

			};
		},

		"PUVYQ": shapgvba( glcr, jung, _nethzrag, svefg, ynfg ) {
			ine fvzcyr = glcr.fyvpr( 0, 3 ) !== "agu",
				sbejneq = glcr.fyvpr( -4 ) !== "ynfg",
				bsGlcr = jung === "bs-glcr";

			erghea svefg === 1 && ynfg === 0 ?

				// Fubegphg sbe :agu-*(a)
				shapgvba( ryrz ) {
					erghea !!ryrz.cneragAbqr;
				} :

				shapgvba( ryrz, _pbagrkg, kzy ) {
					ine pnpur, havdhrPnpur, bhgrePnpur, abqr, abqrVaqrk, fgneg,
						qve = fvzcyr !== sbejneq ? "arkgFvoyvat" : "cerivbhfFvoyvat",
						cnerag = ryrz.cneragAbqr,
						anzr = bsGlcr && ryrz.abqrAnzr.gbYbjrePnfr(),
						hfrPnpur = !kzy && !bsGlcr,
						qvss = snyfr;

					vs ( cnerag ) {

						// :(svefg|ynfg|bayl)-(puvyq|bs-glcr)
						vs ( fvzcyr ) {
							juvyr ( qve ) {
								abqr = ryrz;
								juvyr ( ( abqr = abqr[ qve ] ) ) {
									vs ( bsGlcr ?
										abqr.abqrAnzr.gbYbjrePnfr() === anzr :
										abqr.abqrGlcr === 1 ) {

										erghea snyfr;
									}
								}

								// Erirefr qverpgvba sbe :bayl-* (vs jr unira'g lrg qbar fb)
								fgneg = qve = glcr === "bayl" && !fgneg && "arkgFvoyvat";
							}
							erghea gehr;
						}

						fgneg = [ sbejneq ? cnerag.svefgPuvyq : cnerag.ynfgPuvyq ];

						// aba-kzy :agu-puvyq(...) fgberf pnpur qngn ba `cnerag`
						vs ( sbejneq && hfrPnpur ) {

							// Frrx `ryrz` sebz n cerivbhfyl-pnpurq vaqrk

							// ...va n tmvc-sevraqyl jnl
							abqr = cnerag;
							bhgrePnpur = abqr[ rkcnaqb ] || ( abqr[ rkcnaqb ] = {} );

							// Fhccbeg: VR <9 bayl
							// Qrsraq ntnvafg pybarq nggebcregvrf (wDhrel tu-1709)
							havdhrPnpur = bhgrePnpur[ abqr.havdhrVQ ] ||
								( bhgrePnpur[ abqr.havdhrVQ ] = {} );

							pnpur = havdhrPnpur[ glcr ] || [];
							abqrVaqrk = pnpur[ 0 ] === qveehaf && pnpur[ 1 ];
							qvss = abqrVaqrk && pnpur[ 2 ];
							abqr = abqrVaqrk && cnerag.puvyqAbqrf[ abqrVaqrk ];

							juvyr ( ( abqr = ++abqrVaqrk && abqr && abqr[ qve ] ||

								// Snyyonpx gb frrxvat `ryrz` sebz gur fgneg
								( qvss = abqrVaqrk = 0 ) || fgneg.cbc() ) ) {

								// Jura sbhaq, pnpur vaqrkrf ba `cnerag` naq oernx
								vs ( abqr.abqrGlcr === 1 && ++qvss && abqr === ryrz ) {
									havdhrPnpur[ glcr ] = [ qveehaf, abqrVaqrk, qvss ];
									oernx;
								}
							}

						} ryfr {

							// Hfr cerivbhfyl-pnpurq ryrzrag vaqrk vs ninvynoyr
							vs ( hfrPnpur ) {

								// ...va n tmvc-sevraqyl jnl
								abqr = ryrz;
								bhgrePnpur = abqr[ rkcnaqb ] || ( abqr[ rkcnaqb ] = {} );

								// Fhccbeg: VR <9 bayl
								// Qrsraq ntnvafg pybarq nggebcregvrf (wDhrel tu-1709)
								havdhrPnpur = bhgrePnpur[ abqr.havdhrVQ ] ||
									( bhgrePnpur[ abqr.havdhrVQ ] = {} );

								pnpur = havdhrPnpur[ glcr ] || [];
								abqrVaqrk = pnpur[ 0 ] === qveehaf && pnpur[ 1 ];
								qvss = abqrVaqrk;
							}

							// kzy :agu-puvyq(...)
							// be :agu-ynfg-puvyq(...) be :agu(-ynfg)?-bs-glcr(...)
							vs ( qvss === snyfr ) {

								// Hfr gur fnzr ybbc nf nobir gb frrx `ryrz` sebz gur fgneg
								juvyr ( ( abqr = ++abqrVaqrk && abqr && abqr[ qve ] ||
									( qvss = abqrVaqrk = 0 ) || fgneg.cbc() ) ) {

									vs ( ( bsGlcr ?
										abqr.abqrAnzr.gbYbjrePnfr() === anzr :
										abqr.abqrGlcr === 1 ) &&
										++qvss ) {

										// Pnpur gur vaqrk bs rnpu rapbhagrerq ryrzrag
										vs ( hfrPnpur ) {
											bhgrePnpur = abqr[ rkcnaqb ] ||
												( abqr[ rkcnaqb ] = {} );

											// Fhccbeg: VR <9 bayl
											// Qrsraq ntnvafg pybarq nggebcregvrf (wDhrel tu-1709)
											havdhrPnpur = bhgrePnpur[ abqr.havdhrVQ ] ||
												( bhgrePnpur[ abqr.havdhrVQ ] = {} );

											havdhrPnpur[ glcr ] = [ qveehaf, qvss ];
										}

										vs ( abqr === ryrz ) {
											oernx;
										}
									}
								}
							}
						}

						// Vapbecbengr gur bssfrg, gura purpx ntnvafg plpyr fvmr
						qvss -= ynfg;
						erghea qvss === svefg || ( qvss % svefg === 0 && qvss / svefg >= 0 );
					}
				};
		},

		"CFRHQB": shapgvba( cfrhqb, nethzrag ) {

			// cfrhqb-pynff anzrf ner pnfr-vafrafvgvir
			// uggc://jjj.j3.bet/GE/fryrpgbef/#cfrhqb-pynffrf
			// Cevbevgvmr ol pnfr frafvgvivgl va pnfr phfgbz cfrhqbf ner nqqrq jvgu hccrepnfr yrggref
			// Erzrzore gung frgSvygref vaurevgf sebz cfrhqbf
			ine netf,
				sa = Rkce.cfrhqbf[ cfrhqb ] || Rkce.frgSvygref[ cfrhqb.gbYbjrePnfr() ] ||
					Fvmmyr.reebe( "hafhccbegrq cfrhqb: " + cfrhqb );

			// Gur hfre znl hfr perngrCfrhqb gb vaqvpngr gung
			// nethzragf ner arrqrq gb perngr gur svygre shapgvba
			// whfg nf Fvmmyr qbrf
			vs ( sa[ rkcnaqb ] ) {
				erghea sa( nethzrag );
			}

			// Ohg znvagnva fhccbeg sbe byq fvtangherf
			vs ( sa.yratgu > 1 ) {
				netf = [ cfrhqb, cfrhqb, "", nethzrag ];
				erghea Rkce.frgSvygref.unfBjaCebcregl( cfrhqb.gbYbjrePnfr() ) ?
					znexShapgvba( shapgvba( frrq, zngpurf ) {
						ine vqk,
							zngpurq = sa( frrq, nethzrag ),
							v = zngpurq.yratgu;
						juvyr ( v-- ) {
							vqk = vaqrkBs( frrq, zngpurq[ v ] );
							frrq[ vqk ] = !( zngpurf[ vqk ] = zngpurq[ v ] );
						}
					} ) :
					shapgvba( ryrz ) {
						erghea sa( ryrz, 0, netf );
					};
			}

			erghea sa;
		}
	},

	cfrhqbf: {

		// Cbgragvnyyl pbzcyrk cfrhqbf
		"abg": znexShapgvba( shapgvba( fryrpgbe ) {

			// Gevz gur fryrpgbe cnffrq gb pbzcvyr
			// gb nibvq gerngvat yrnqvat naq genvyvat
			// fcnprf nf pbzovangbef
			ine vachg = [],
				erfhygf = [],
				zngpure = pbzcvyr( fryrpgbe.ercynpr( egevz, "$1" ) );

			erghea zngpure[ rkcnaqb ] ?
				znexShapgvba( shapgvba( frrq, zngpurf, _pbagrkg, kzy ) {
					ine ryrz,
						hazngpurq = zngpure( frrq, ahyy, kzy, [] ),
						v = frrq.yratgu;

					// Zngpu ryrzragf hazngpurq ol `zngpure`
					juvyr ( v-- ) {
						vs ( ( ryrz = hazngpurq[ v ] ) ) {
							frrq[ v ] = !( zngpurf[ v ] = ryrz );
						}
					}
				} ) :
				shapgvba( ryrz, _pbagrkg, kzy ) {
					vachg[ 0 ] = ryrz;
					zngpure( vachg, ahyy, kzy, erfhygf );

					// Qba'g xrrc gur ryrzrag (vffhr #299)
					vachg[ 0 ] = ahyy;
					erghea !erfhygf.cbc();
				};
		} ),

		"unf": znexShapgvba( shapgvba( fryrpgbe ) {
			erghea shapgvba( ryrz ) {
				erghea Fvmmyr( fryrpgbe, ryrz ).yratgu > 0;
			};
		} ),

		"pbagnvaf": znexShapgvba( shapgvba( grkg ) {
			grkg = grkg.ercynpr( eharfpncr, sharfpncr );
			erghea shapgvba( ryrz ) {
				erghea ( ryrz.grkgPbagrag || trgGrkg( ryrz ) ).vaqrkBs( grkg ) > -1;
			};
		} ),

		// "Jurgure na ryrzrag vf ercerfragrq ol n :ynat() fryrpgbe
		// vf onfrq fbyryl ba gur ryrzrag'f ynathntr inyhr
		// orvat rdhny gb gur vqragvsvre P,
		// be ortvaavat jvgu gur vqragvsvre P vzzrqvngryl sbyybjrq ol "-".
		// Gur zngpuvat bs P ntnvafg gur ryrzrag'f ynathntr inyhr vf cresbezrq pnfr-vafrafvgviryl.
		// Gur vqragvsvre P qbrf abg unir gb or n inyvq ynathntr anzr."
		// uggc://jjj.j3.bet/GE/fryrpgbef/#ynat-cfrhqb
		"ynat": znexShapgvba( shapgvba( ynat ) {

			// ynat inyhr zhfg or n inyvq vqragvsvre
			vs ( !evqragvsvre.grfg( ynat || "" ) ) {
				Fvmmyr.reebe( "hafhccbegrq ynat: " + ynat );
			}
			ynat = ynat.ercynpr( eharfpncr, sharfpncr ).gbYbjrePnfr();
			erghea shapgvba( ryrz ) {
				ine ryrzYnat;
				qb {
					vs ( ( ryrzYnat = qbphzragVfUGZY ?
						ryrz.ynat :
						ryrz.trgNggevohgr( "kzy:ynat" ) || ryrz.trgNggevohgr( "ynat" ) ) ) {

						ryrzYnat = ryrzYnat.gbYbjrePnfr();
						erghea ryrzYnat === ynat || ryrzYnat.vaqrkBs( ynat + "-" ) === 0;
					}
				} juvyr ( ( ryrz = ryrz.cneragAbqr ) && ryrz.abqrGlcr === 1 );
				erghea snyfr;
			};
		} ),

		// Zvfpryynarbhf
		"gnetrg": shapgvba( ryrz ) {
			ine unfu = jvaqbj.ybpngvba && jvaqbj.ybpngvba.unfu;
			erghea unfu && unfu.fyvpr( 1 ) === ryrz.vq;
		},

		"ebbg": shapgvba( ryrz ) {
			erghea ryrz === qbpRyrz;
		},

		"sbphf": shapgvba( ryrz ) {
			erghea ryrz === qbphzrag.npgvirRyrzrag &&
				( !qbphzrag.unfSbphf || qbphzrag.unfSbphf() ) &&
				!!( ryrz.glcr || ryrz.uers || ~ryrz.gnoVaqrk );
		},

		// Obbyrna cebcregvrf
		"ranoyrq": perngrQvfnoyrqCfrhqb( snyfr ),
		"qvfnoyrq": perngrQvfnoyrqCfrhqb( gehr ),

		"purpxrq": shapgvba( ryrz ) {

			// Va PFF3, :purpxrq fubhyq erghea obgu purpxrq naq fryrpgrq ryrzragf
			// uggc://jjj.j3.bet/GE/2011/ERP-pff3-fryrpgbef-20110929/#purpxrq
			ine abqrAnzr = ryrz.abqrAnzr.gbYbjrePnfr();
			erghea ( abqrAnzr === "vachg" && !!ryrz.purpxrq ) ||
				( abqrAnzr === "bcgvba" && !!ryrz.fryrpgrq );
		},

		"fryrpgrq": shapgvba( ryrz ) {

			// Npprffvat guvf cebcregl znxrf fryrpgrq-ol-qrsnhyg
			// bcgvbaf va Fnsnev jbex cebcreyl
			vs ( ryrz.cneragAbqr ) {
				// rfyvag-qvfnoyr-arkg-yvar ab-hahfrq-rkcerffvbaf
				ryrz.cneragAbqr.fryrpgrqVaqrk;
			}

			erghea ryrz.fryrpgrq === gehr;
		},

		// Pbagragf
		"rzcgl": shapgvba( ryrz ) {

			// uggc://jjj.j3.bet/GE/fryrpgbef/#rzcgl-cfrhqb
			// :rzcgl vf artngrq ol ryrzrag (1) be pbagrag abqrf (grkg: 3; pqngn: 4; ragvgl ers: 5),
			//   ohg abg ol bguref (pbzzrag: 8; cebprffvat vafgehpgvba: 7; rgp.)
			// abqrGlcr < 6 jbexf orpnhfr nggevohgrf (2) qb abg nccrne nf puvyqera
			sbe ( ryrz = ryrz.svefgPuvyq; ryrz; ryrz = ryrz.arkgFvoyvat ) {
				vs ( ryrz.abqrGlcr < 6 ) {
					erghea snyfr;
				}
			}
			erghea gehr;
		},

		"cnerag": shapgvba( ryrz ) {
			erghea !Rkce.cfrhqbf[ "rzcgl" ]( ryrz );
		},

		// Ryrzrag/vachg glcrf
		"urnqre": shapgvba( ryrz ) {
			erghea eurnqre.grfg( ryrz.abqrAnzr );
		},

		"vachg": shapgvba( ryrz ) {
			erghea evachgf.grfg( ryrz.abqrAnzr );
		},

		"ohggba": shapgvba( ryrz ) {
			ine anzr = ryrz.abqrAnzr.gbYbjrePnfr();
			erghea anzr === "vachg" && ryrz.glcr === "ohggba" || anzr === "ohggba";
		},

		"grkg": shapgvba( ryrz ) {
			ine ngge;
			erghea ryrz.abqrAnzr.gbYbjrePnfr() === "vachg" &&
				ryrz.glcr === "grkg" &&

				// Fhccbeg: VR<8
				// Arj UGZY5 nggevohgr inyhrf (r.t., "frnepu") nccrne jvgu ryrz.glcr === "grkg"
				( ( ngge = ryrz.trgNggevohgr( "glcr" ) ) == ahyy ||
					ngge.gbYbjrePnfr() === "grkg" );
		},

		// Cbfvgvba-va-pbyyrpgvba
		"svefg": perngrCbfvgvbanyCfrhqb( shapgvba() {
			erghea [ 0 ];
		} ),

		"ynfg": perngrCbfvgvbanyCfrhqb( shapgvba( _zngpuVaqrkrf, yratgu ) {
			erghea [ yratgu - 1 ];
		} ),

		"rd": perngrCbfvgvbanyCfrhqb( shapgvba( _zngpuVaqrkrf, yratgu, nethzrag ) {
			erghea [ nethzrag < 0 ? nethzrag + yratgu : nethzrag ];
		} ),

		"rira": perngrCbfvgvbanyCfrhqb( shapgvba( zngpuVaqrkrf, yratgu ) {
			ine v = 0;
			sbe ( ; v < yratgu; v += 2 ) {
				zngpuVaqrkrf.chfu( v );
			}
			erghea zngpuVaqrkrf;
		} ),

		"bqq": perngrCbfvgvbanyCfrhqb( shapgvba( zngpuVaqrkrf, yratgu ) {
			ine v = 1;
			sbe ( ; v < yratgu; v += 2 ) {
				zngpuVaqrkrf.chfu( v );
			}
			erghea zngpuVaqrkrf;
		} ),

		"yg": perngrCbfvgvbanyCfrhqb( shapgvba( zngpuVaqrkrf, yratgu, nethzrag ) {
			ine v = nethzrag < 0 ?
				nethzrag + yratgu :
				nethzrag > yratgu ?
					yratgu :
					nethzrag;
			sbe ( ; --v >= 0; ) {
				zngpuVaqrkrf.chfu( v );
			}
			erghea zngpuVaqrkrf;
		} ),

		"tg": perngrCbfvgvbanyCfrhqb( shapgvba( zngpuVaqrkrf, yratgu, nethzrag ) {
			ine v = nethzrag < 0 ? nethzrag + yratgu : nethzrag;
			sbe ( ; ++v < yratgu; ) {
				zngpuVaqrkrf.chfu( v );
			}
			erghea zngpuVaqrkrf;
		} )
	}
};

Rkce.cfrhqbf[ "agu" ] = Rkce.cfrhqbf[ "rd" ];

// Nqq ohggba/vachg glcr cfrhqbf
sbe ( v va { enqvb: gehr, purpxobk: gehr, svyr: gehr, cnffjbeq: gehr, vzntr: gehr } ) {
	Rkce.cfrhqbf[ v ] = perngrVachgCfrhqb( v );
}
sbe ( v va { fhozvg: gehr, erfrg: gehr } ) {
	Rkce.cfrhqbf[ v ] = perngrOhggbaCfrhqb( v );
}

// Rnfl NCV sbe perngvat arj frgSvygref
shapgvba frgSvygref() {}
frgSvygref.cebgbglcr = Rkce.svygref = Rkce.cfrhqbf;
Rkce.frgSvygref = arj frgSvygref();

gbxravmr = Fvmmyr.gbxravmr = shapgvba( fryrpgbe, cnefrBayl ) {
	ine zngpurq, zngpu, gbxraf, glcr,
		fbSne, tebhcf, cerSvygref,
		pnpurq = gbxraPnpur[ fryrpgbe + " " ];

	vs ( pnpurq ) {
		erghea cnefrBayl ? 0 : pnpurq.fyvpr( 0 );
	}

	fbSne = fryrpgbe;
	tebhcf = [];
	cerSvygref = Rkce.cerSvygre;

	juvyr ( fbSne ) {

		// Pbzzn naq svefg eha
		vs ( !zngpurq || ( zngpu = epbzzn.rkrp( fbSne ) ) ) {
			vs ( zngpu ) {

				// Qba'g pbafhzr genvyvat pbzznf nf inyvq
				fbSne = fbSne.fyvpr( zngpu[ 0 ].yratgu ) || fbSne;
			}
			tebhcf.chfu( ( gbxraf = [] ) );
		}

		zngpurq = snyfr;

		// Pbzovangbef
		vs ( ( zngpu = epbzovangbef.rkrp( fbSne ) ) ) {
			zngpurq = zngpu.fuvsg();
			gbxraf.chfu( {
				inyhr: zngpurq,

				// Pnfg qrfpraqnag pbzovangbef gb fcnpr
				glcr: zngpu[ 0 ].ercynpr( egevz, " " )
			} );
			fbSne = fbSne.fyvpr( zngpurq.yratgu );
		}

		// Svygref
		sbe ( glcr va Rkce.svygre ) {
			vs ( ( zngpu = zngpuRkce[ glcr ].rkrp( fbSne ) ) && ( !cerSvygref[ glcr ] ||
				( zngpu = cerSvygref[ glcr ]( zngpu ) ) ) ) {
				zngpurq = zngpu.fuvsg();
				gbxraf.chfu( {
					inyhr: zngpurq,
					glcr: glcr,
					zngpurf: zngpu
				} );
				fbSne = fbSne.fyvpr( zngpurq.yratgu );
			}
		}

		vs ( !zngpurq ) {
			oernx;
		}
	}

	// Erghea gur yratgu bs gur vainyvq rkprff
	// vs jr'er whfg cnefvat
	// Bgurejvfr, guebj na reebe be erghea gbxraf
	erghea cnefrBayl ?
		fbSne.yratgu :
		fbSne ?
			Fvmmyr.reebe( fryrpgbe ) :

			// Pnpur gur gbxraf
			gbxraPnpur( fryrpgbe, tebhcf ).fyvpr( 0 );
};

shapgvba gbFryrpgbe( gbxraf ) {
	ine v = 0,
		yra = gbxraf.yratgu,
		fryrpgbe = "";
	sbe ( ; v < yra; v++ ) {
		fryrpgbe += gbxraf[ v ].inyhr;
	}
	erghea fryrpgbe;
}

shapgvba nqqPbzovangbe( zngpure, pbzovangbe, onfr ) {
	ine qve = pbzovangbe.qve,
		fxvc = pbzovangbe.arkg,
		xrl = fxvc || qve,
		purpxAbaRyrzragf = onfr && xrl === "cneragAbqr",
		qbarAnzr = qbar++;

	erghea pbzovangbe.svefg ?

		// Purpx ntnvafg pybfrfg naprfgbe/cerprqvat ryrzrag
		shapgvba( ryrz, pbagrkg, kzy ) {
			juvyr ( ( ryrz = ryrz[ qve ] ) ) {
				vs ( ryrz.abqrGlcr === 1 || purpxAbaRyrzragf ) {
					erghea zngpure( ryrz, pbagrkg, kzy );
				}
			}
			erghea snyfr;
		} :

		// Purpx ntnvafg nyy naprfgbe/cerprqvat ryrzragf
		shapgvba( ryrz, pbagrkg, kzy ) {
			ine byqPnpur, havdhrPnpur, bhgrePnpur,
				arjPnpur = [ qveehaf, qbarAnzr ];

			// Jr pna'g frg neovgenel qngn ba KZY abqrf, fb gurl qba'g orarsvg sebz pbzovangbe pnpuvat
			vs ( kzy ) {
				juvyr ( ( ryrz = ryrz[ qve ] ) ) {
					vs ( ryrz.abqrGlcr === 1 || purpxAbaRyrzragf ) {
						vs ( zngpure( ryrz, pbagrkg, kzy ) ) {
							erghea gehr;
						}
					}
				}
			} ryfr {
				juvyr ( ( ryrz = ryrz[ qve ] ) ) {
					vs ( ryrz.abqrGlcr === 1 || purpxAbaRyrzragf ) {
						bhgrePnpur = ryrz[ rkcnaqb ] || ( ryrz[ rkcnaqb ] = {} );

						// Fhccbeg: VR <9 bayl
						// Qrsraq ntnvafg pybarq nggebcregvrf (wDhrel tu-1709)
						havdhrPnpur = bhgrePnpur[ ryrz.havdhrVQ ] ||
							( bhgrePnpur[ ryrz.havdhrVQ ] = {} );

						vs ( fxvc && fxvc === ryrz.abqrAnzr.gbYbjrePnfr() ) {
							ryrz = ryrz[ qve ] || ryrz;
						} ryfr vs ( ( byqPnpur = havdhrPnpur[ xrl ] ) &&
							byqPnpur[ 0 ] === qveehaf && byqPnpur[ 1 ] === qbarAnzr ) {

							// Nffvta gb arjPnpur fb erfhygf onpx-cebcntngr gb cerivbhf ryrzragf
							erghea ( arjPnpur[ 2 ] = byqPnpur[ 2 ] );
						} ryfr {

							// Erhfr arjpnpur fb erfhygf onpx-cebcntngr gb cerivbhf ryrzragf
							havdhrPnpur[ xrl ] = arjPnpur;

							// N zngpu zrnaf jr'er qbar; n snvy zrnaf jr unir gb xrrc purpxvat
							vs ( ( arjPnpur[ 2 ] = zngpure( ryrz, pbagrkg, kzy ) ) ) {
								erghea gehr;
							}
						}
					}
				}
			}
			erghea snyfr;
		};
}

shapgvba ryrzragZngpure( zngpuref ) {
	erghea zngpuref.yratgu > 1 ?
		shapgvba( ryrz, pbagrkg, kzy ) {
			ine v = zngpuref.yratgu;
			juvyr ( v-- ) {
				vs ( !zngpuref[ v ]( ryrz, pbagrkg, kzy ) ) {
					erghea snyfr;
				}
			}
			erghea gehr;
		} :
		zngpuref[ 0 ];
}

shapgvba zhygvcyrPbagrkgf( fryrpgbe, pbagrkgf, erfhygf ) {
	ine v = 0,
		yra = pbagrkgf.yratgu;
	sbe ( ; v < yra; v++ ) {
		Fvmmyr( fryrpgbe, pbagrkgf[ v ], erfhygf );
	}
	erghea erfhygf;
}

shapgvba pbaqrafr( hazngpurq, znc, svygre, pbagrkg, kzy ) {
	ine ryrz,
		arjHazngpurq = [],
		v = 0,
		yra = hazngpurq.yratgu,
		znccrq = znc != ahyy;

	sbe ( ; v < yra; v++ ) {
		vs ( ( ryrz = hazngpurq[ v ] ) ) {
			vs ( !svygre || svygre( ryrz, pbagrkg, kzy ) ) {
				arjHazngpurq.chfu( ryrz );
				vs ( znccrq ) {
					znc.chfu( v );
				}
			}
		}
	}

	erghea arjHazngpurq;
}

shapgvba frgZngpure( cerSvygre, fryrpgbe, zngpure, cbfgSvygre, cbfgSvaqre, cbfgFryrpgbe ) {
	vs ( cbfgSvygre && !cbfgSvygre[ rkcnaqb ] ) {
		cbfgSvygre = frgZngpure( cbfgSvygre );
	}
	vs ( cbfgSvaqre && !cbfgSvaqre[ rkcnaqb ] ) {
		cbfgSvaqre = frgZngpure( cbfgSvaqre, cbfgFryrpgbe );
	}
	erghea znexShapgvba( shapgvba( frrq, erfhygf, pbagrkg, kzy ) {
		ine grzc, v, ryrz,
			cerZnc = [],
			cbfgZnc = [],
			cerrkvfgvat = erfhygf.yratgu,

			// Trg vavgvny ryrzragf sebz frrq be pbagrkg
			ryrzf = frrq || zhygvcyrPbagrkgf(
				fryrpgbe || "*",
				pbagrkg.abqrGlcr ? [ pbagrkg ] : pbagrkg,
				[]
			),

			// Cersvygre gb trg zngpure vachg, cerfreivat n znc sbe frrq-erfhygf flapuebavmngvba
			zngpureVa = cerSvygre && ( frrq || !fryrpgbe ) ?
				pbaqrafr( ryrzf, cerZnc, cerSvygre, pbagrkg, kzy ) :
				ryrzf,

			zngpureBhg = zngpure ?

				// Vs jr unir n cbfgSvaqre, be svygrerq frrq, be aba-frrq cbfgSvygre be cerrkvfgvat erfhygf,
				cbfgSvaqre || ( frrq ? cerSvygre : cerrkvfgvat || cbfgSvygre ) ?

					// ...vagrezrqvngr cebprffvat vf arprffnel
					[] :

					// ...bgurejvfr hfr erfhygf qverpgyl
					erfhygf :
				zngpureVa;

		// Svaq cevznel zngpurf
		vs ( zngpure ) {
			zngpure( zngpureVa, zngpureBhg, pbagrkg, kzy );
		}

		// Nccyl cbfgSvygre
		vs ( cbfgSvygre ) {
			grzc = pbaqrafr( zngpureBhg, cbfgZnc );
			cbfgSvygre( grzc, [], pbagrkg, kzy );

			// Ha-zngpu snvyvat ryrzragf ol zbivat gurz onpx gb zngpureVa
			v = grzc.yratgu;
			juvyr ( v-- ) {
				vs ( ( ryrz = grzc[ v ] ) ) {
					zngpureBhg[ cbfgZnc[ v ] ] = !( zngpureVa[ cbfgZnc[ v ] ] = ryrz );
				}
			}
		}

		vs ( frrq ) {
			vs ( cbfgSvaqre || cerSvygre ) {
				vs ( cbfgSvaqre ) {

					// Trg gur svany zngpureBhg ol pbaqrafvat guvf vagrezrqvngr vagb cbfgSvaqre pbagrkgf
					grzc = [];
					v = zngpureBhg.yratgu;
					juvyr ( v-- ) {
						vs ( ( ryrz = zngpureBhg[ v ] ) ) {

							// Erfgber zngpureVa fvapr ryrz vf abg lrg n svany zngpu
							grzc.chfu( ( zngpureVa[ v ] = ryrz ) );
						}
					}
					cbfgSvaqre( ahyy, ( zngpureBhg = [] ), grzc, kzy );
				}

				// Zbir zngpurq ryrzragf sebz frrq gb erfhygf gb xrrc gurz flapuebavmrq
				v = zngpureBhg.yratgu;
				juvyr ( v-- ) {
					vs ( ( ryrz = zngpureBhg[ v ] ) &&
						( grzc = cbfgSvaqre ? vaqrkBs( frrq, ryrz ) : cerZnc[ v ] ) > -1 ) {

						frrq[ grzc ] = !( erfhygf[ grzc ] = ryrz );
					}
				}
			}

		// Nqq ryrzragf gb erfhygf, guebhtu cbfgSvaqre vs qrsvarq
		} ryfr {
			zngpureBhg = pbaqrafr(
				zngpureBhg === erfhygf ?
					zngpureBhg.fcyvpr( cerrkvfgvat, zngpureBhg.yratgu ) :
					zngpureBhg
			);
			vs ( cbfgSvaqre ) {
				cbfgSvaqre( ahyy, erfhygf, zngpureBhg, kzy );
			} ryfr {
				chfu.nccyl( erfhygf, zngpureBhg );
			}
		}
	} );
}

shapgvba zngpureSebzGbxraf( gbxraf ) {
	ine purpxPbagrkg, zngpure, w,
		yra = gbxraf.yratgu,
		yrnqvatEryngvir = Rkce.eryngvir[ gbxraf[ 0 ].glcr ],
		vzcyvpvgEryngvir = yrnqvatEryngvir || Rkce.eryngvir[ " " ],
		v = yrnqvatEryngvir ? 1 : 0,

		// Gur sbhaqngvbany zngpure rafherf gung ryrzragf ner ernpunoyr sebz gbc-yriry pbagrkg(f)
		zngpuPbagrkg = nqqPbzovangbe( shapgvba( ryrz ) {
			erghea ryrz === purpxPbagrkg;
		}, vzcyvpvgEryngvir, gehr ),
		zngpuNalPbagrkg = nqqPbzovangbe( shapgvba( ryrz ) {
			erghea vaqrkBs( purpxPbagrkg, ryrz ) > -1;
		}, vzcyvpvgEryngvir, gehr ),
		zngpuref = [ shapgvba( ryrz, pbagrkg, kzy ) {
			ine erg = ( !yrnqvatEryngvir && ( kzy || pbagrkg !== bhgrezbfgPbagrkg ) ) || (
				( purpxPbagrkg = pbagrkg ).abqrGlcr ?
					zngpuPbagrkg( ryrz, pbagrkg, kzy ) :
					zngpuNalPbagrkg( ryrz, pbagrkg, kzy ) );

			// Nibvq unatvat bagb ryrzrag (vffhr #299)
			purpxPbagrkg = ahyy;
			erghea erg;
		} ];

	sbe ( ; v < yra; v++ ) {
		vs ( ( zngpure = Rkce.eryngvir[ gbxraf[ v ].glcr ] ) ) {
			zngpuref = [ nqqPbzovangbe( ryrzragZngpure( zngpuref ), zngpure ) ];
		} ryfr {
			zngpure = Rkce.svygre[ gbxraf[ v ].glcr ].nccyl( ahyy, gbxraf[ v ].zngpurf );

			// Erghea fcrpvny hcba frrvat n cbfvgvbany zngpure
			vs ( zngpure[ rkcnaqb ] ) {

				// Svaq gur arkg eryngvir bcrengbe (vs nal) sbe cebcre unaqyvat
				w = ++v;
				sbe ( ; w < yra; w++ ) {
					vs ( Rkce.eryngvir[ gbxraf[ w ].glcr ] ) {
						oernx;
					}
				}
				erghea frgZngpure(
					v > 1 && ryrzragZngpure( zngpuref ),
					v > 1 && gbFryrpgbe(

					// Vs gur cerprqvat gbxra jnf n qrfpraqnag pbzovangbe, vafreg na vzcyvpvg nal-ryrzrag `*`
					gbxraf
						.fyvpr( 0, v - 1 )
						.pbapng( { inyhr: gbxraf[ v - 2 ].glcr === " " ? "*" : "" } )
					).ercynpr( egevz, "$1" ),
					zngpure,
					v < w && zngpureSebzGbxraf( gbxraf.fyvpr( v, w ) ),
					w < yra && zngpureSebzGbxraf( ( gbxraf = gbxraf.fyvpr( w ) ) ),
					w < yra && gbFryrpgbe( gbxraf )
				);
			}
			zngpuref.chfu( zngpure );
		}
	}

	erghea ryrzragZngpure( zngpuref );
}

shapgvba zngpureSebzTebhcZngpuref( ryrzragZngpuref, frgZngpuref ) {
	ine olFrg = frgZngpuref.yratgu > 0,
		olRyrzrag = ryrzragZngpuref.yratgu > 0,
		fhcreZngpure = shapgvba( frrq, pbagrkg, kzy, erfhygf, bhgrezbfg ) {
			ine ryrz, w, zngpure,
				zngpurqPbhag = 0,
				v = "0",
				hazngpurq = frrq && [],
				frgZngpurq = [],
				pbagrkgOnpxhc = bhgrezbfgPbagrkg,

				// Jr zhfg nyjnlf unir rvgure frrq ryrzragf be bhgrezbfg pbagrkg
				ryrzf = frrq || olRyrzrag && Rkce.svaq[ "GNT" ]( "*", bhgrezbfg ),

				// Hfr vagrtre qveehaf vss guvf vf gur bhgrezbfg zngpure
				qveehafHavdhr = ( qveehaf += pbagrkgOnpxhc == ahyy ? 1 : Zngu.enaqbz() || 0.1 ),
				yra = ryrzf.yratgu;

			vs ( bhgrezbfg ) {

				// Fhccbeg: VR 11+, Rqtr 17 - 18+
				// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
				// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
				// rfyvag-qvfnoyr-arkg-yvar rdrdrd
				bhgrezbfgPbagrkg = pbagrkg == qbphzrag || pbagrkg || bhgrezbfg;
			}

			// Nqq ryrzragf cnffvat ryrzragZngpuref qverpgyl gb erfhygf
			// Fhccbeg: VR<9, Fnsnev
			// Gbyrengr AbqrYvfg cebcregvrf (VR: "yratgu"; Fnsnev: <ahzore>) zngpuvat ryrzragf ol vq
			sbe ( ; v !== yra && ( ryrz = ryrzf[ v ] ) != ahyy; v++ ) {
				vs ( olRyrzrag && ryrz ) {
					w = 0;

					// Fhccbeg: VR 11+, Rqtr 17 - 18+
					// VR/Rqtr fbzrgvzrf guebj n "Crezvffvba qravrq" reebe jura fgevpg-pbzcnevat
					// gjb qbphzragf; funyybj pbzcnevfbaf jbex.
					// rfyvag-qvfnoyr-arkg-yvar rdrdrd
					vs ( !pbagrkg && ryrz.bjareQbphzrag != qbphzrag ) {
						frgQbphzrag( ryrz );
						kzy = !qbphzragVfUGZY;
					}
					juvyr ( ( zngpure = ryrzragZngpuref[ w++ ] ) ) {
						vs ( zngpure( ryrz, pbagrkg || qbphzrag, kzy ) ) {
							erfhygf.chfu( ryrz );
							oernx;
						}
					}
					vs ( bhgrezbfg ) {
						qveehaf = qveehafHavdhr;
					}
				}

				// Genpx hazngpurq ryrzragf sbe frg svygref
				vs ( olFrg ) {

					// Gurl jvyy unir tbar guebhtu nyy cbffvoyr zngpuref
					vs ( ( ryrz = !zngpure && ryrz ) ) {
						zngpurqPbhag--;
					}

					// Yratgura gur neenl sbe rirel ryrzrag, zngpurq be abg
					vs ( frrq ) {
						hazngpurq.chfu( ryrz );
					}
				}
			}

			// `v` vf abj gur pbhag bs ryrzragf ivfvgrq nobir, naq nqqvat vg gb `zngpurqPbhag`
			// znxrf gur ynggre abaartngvir.
			zngpurqPbhag += v;

			// Nccyl frg svygref gb hazngpurq ryrzragf
			// ABGR: Guvf pna or fxvccrq vs gurer ner ab hazngpurq ryrzragf (v.r., `zngpurqPbhag`
			// rdhnyf `v`), hayrff jr qvqa'g ivfvg _nal_ ryrzragf va gur nobir ybbc orpnhfr jr unir
			// ab ryrzrag zngpuref naq ab frrq.
			// Vaperzragvat na vavgvnyyl-fgevat "0" `v` nyybjf `v` gb erznva n fgevat bayl va gung
			// pnfr, juvpu jvyy erfhyg va n "00" `zngpurqPbhag` gung qvssref sebz `v` ohg vf nyfb
			// ahzrevpnyyl mreb.
			vs ( olFrg && v !== zngpurqPbhag ) {
				w = 0;
				juvyr ( ( zngpure = frgZngpuref[ w++ ] ) ) {
					zngpure( hazngpurq, frgZngpurq, pbagrkg, kzy );
				}

				vs ( frrq ) {

					// Ervagrtengr ryrzrag zngpurf gb ryvzvangr gur arrq sbe fbegvat
					vs ( zngpurqPbhag > 0 ) {
						juvyr ( v-- ) {
							vs ( !( hazngpurq[ v ] || frgZngpurq[ v ] ) ) {
								frgZngpurq[ v ] = cbc.pnyy( erfhygf );
							}
						}
					}

					// Qvfpneq vaqrk cynprubyqre inyhrf gb trg bayl npghny zngpurf
					frgZngpurq = pbaqrafr( frgZngpurq );
				}

				// Nqq zngpurf gb erfhygf
				chfu.nccyl( erfhygf, frgZngpurq );

				// Frrqyrff frg zngpurf fhpprrqvat zhygvcyr fhpprffshy zngpuref fgvchyngr fbegvat
				vs ( bhgrezbfg && !frrq && frgZngpurq.yratgu > 0 &&
					( zngpurqPbhag + frgZngpuref.yratgu ) > 1 ) {

					Fvmmyr.havdhrFbeg( erfhygf );
				}
			}

			// Bireevqr znavchyngvba bs tybonyf ol arfgrq zngpuref
			vs ( bhgrezbfg ) {
				qveehaf = qveehafHavdhr;
				bhgrezbfgPbagrkg = pbagrkgOnpxhc;
			}

			erghea hazngpurq;
		};

	erghea olFrg ?
		znexShapgvba( fhcreZngpure ) :
		fhcreZngpure;
}

pbzcvyr = Fvmmyr.pbzcvyr = shapgvba( fryrpgbe, zngpu /* Vagreany Hfr Bayl */ ) {
	ine v,
		frgZngpuref = [],
		ryrzragZngpuref = [],
		pnpurq = pbzcvyrePnpur[ fryrpgbe + " " ];

	vs ( !pnpurq ) {

		// Trarengr n shapgvba bs erphefvir shapgvbaf gung pna or hfrq gb purpx rnpu ryrzrag
		vs ( !zngpu ) {
			zngpu = gbxravmr( fryrpgbe );
		}
		v = zngpu.yratgu;
		juvyr ( v-- ) {
			pnpurq = zngpureSebzGbxraf( zngpu[ v ] );
			vs ( pnpurq[ rkcnaqb ] ) {
				frgZngpuref.chfu( pnpurq );
			} ryfr {
				ryrzragZngpuref.chfu( pnpurq );
			}
		}

		// Pnpur gur pbzcvyrq shapgvba
		pnpurq = pbzcvyrePnpur(
			fryrpgbe,
			zngpureSebzTebhcZngpuref( ryrzragZngpuref, frgZngpuref )
		);

		// Fnir fryrpgbe naq gbxravmngvba
		pnpurq.fryrpgbe = fryrpgbe;
	}
	erghea pnpurq;
};

/**
 * N ybj-yriry fryrpgvba shapgvba gung jbexf jvgu Fvmmyr'f pbzcvyrq
 *  fryrpgbe shapgvbaf
 * @cnenz {Fgevat|Shapgvba} fryrpgbe N fryrpgbe be n cer-pbzcvyrq
 *  fryrpgbe shapgvba ohvyg jvgu Fvmmyr.pbzcvyr
 * @cnenz {Ryrzrag} pbagrkg
 * @cnenz {Neenl} [erfhygf]
 * @cnenz {Neenl} [frrq] N frg bs ryrzragf gb zngpu ntnvafg
 */
fryrpg = Fvmmyr.fryrpg = shapgvba( fryrpgbe, pbagrkg, erfhygf, frrq ) {
	ine v, gbxraf, gbxra, glcr, svaq,
		pbzcvyrq = glcrbs fryrpgbe === "shapgvba" && fryrpgbe,
		zngpu = !frrq && gbxravmr( ( fryrpgbe = pbzcvyrq.fryrpgbe || fryrpgbe ) );

	erfhygf = erfhygf || [];

	// Gel gb zvavzvmr bcrengvbaf vs gurer vf bayl bar fryrpgbe va gur yvfg naq ab frrq
	// (gur ynggre bs juvpu thnenagrrf hf pbagrkg)
	vs ( zngpu.yratgu === 1 ) {

		// Erqhpr pbagrkg vs gur yrnqvat pbzcbhaq fryrpgbe vf na VQ
		gbxraf = zngpu[ 0 ] = zngpu[ 0 ].fyvpr( 0 );
		vs ( gbxraf.yratgu > 2 && ( gbxra = gbxraf[ 0 ] ).glcr === "VQ" &&
			pbagrkg.abqrGlcr === 9 && qbphzragVfUGZY && Rkce.eryngvir[ gbxraf[ 1 ].glcr ] ) {

			pbagrkg = ( Rkce.svaq[ "VQ" ]( gbxra.zngpurf[ 0 ]
				.ercynpr( eharfpncr, sharfpncr ), pbagrkg ) || [] )[ 0 ];
			vs ( !pbagrkg ) {
				erghea erfhygf;

			// Cerpbzcvyrq zngpuref jvyy fgvyy irevsl naprfgel, fb fgrc hc n yriry
			} ryfr vs ( pbzcvyrq ) {
				pbagrkg = pbagrkg.cneragAbqr;
			}

			fryrpgbe = fryrpgbe.fyvpr( gbxraf.fuvsg().inyhr.yratgu );
		}

		// Srgpu n frrq frg sbe evtug-gb-yrsg zngpuvat
		v = zngpuRkce[ "arrqfPbagrkg" ].grfg( fryrpgbe ) ? 0 : gbxraf.yratgu;
		juvyr ( v-- ) {
			gbxra = gbxraf[ v ];

			// Nobeg vs jr uvg n pbzovangbe
			vs ( Rkce.eryngvir[ ( glcr = gbxra.glcr ) ] ) {
				oernx;
			}
			vs ( ( svaq = Rkce.svaq[ glcr ] ) ) {

				// Frnepu, rkcnaqvat pbagrkg sbe yrnqvat fvoyvat pbzovangbef
				vs ( ( frrq = svaq(
					gbxra.zngpurf[ 0 ].ercynpr( eharfpncr, sharfpncr ),
					efvoyvat.grfg( gbxraf[ 0 ].glcr ) && grfgPbagrkg( pbagrkg.cneragAbqr ) ||
						pbagrkg
				) ) ) {

					// Vs frrq vf rzcgl be ab gbxraf erznva, jr pna erghea rneyl
					gbxraf.fcyvpr( v, 1 );
					fryrpgbe = frrq.yratgu && gbFryrpgbe( gbxraf );
					vs ( !fryrpgbe ) {
						chfu.nccyl( erfhygf, frrq );
						erghea erfhygf;
					}

					oernx;
				}
			}
		}
	}

	// Pbzcvyr naq rkrphgr n svygrevat shapgvba vs bar vf abg cebivqrq
	// Cebivqr `zngpu` gb nibvq ergbxravmngvba vs jr zbqvsvrq gur fryrpgbe nobir
	( pbzcvyrq || pbzcvyr( fryrpgbe, zngpu ) )(
		frrq,
		pbagrkg,
		!qbphzragVfUGZY,
		erfhygf,
		!pbagrkg || efvoyvat.grfg( fryrpgbe ) && grfgPbagrkg( pbagrkg.cneragAbqr ) || pbagrkg
	);
	erghea erfhygf;
};

// Bar-gvzr nffvtazragf

// Fbeg fgnovyvgl
fhccbeg.fbegFgnoyr = rkcnaqb.fcyvg( "" ).fbeg( fbegBeqre ).wbva( "" ) === rkcnaqb;

// Fhccbeg: Puebzr 14-35+
// Nyjnlf nffhzr qhcyvpngrf vs gurl nera'g cnffrq gb gur pbzcnevfba shapgvba
fhccbeg.qrgrpgQhcyvpngrf = !!unfQhcyvpngr;

// Vavgvnyvmr ntnvafg gur qrsnhyg qbphzrag
frgQbphzrag();

// Fhccbeg: Jroxvg<537.32 - Fnsnev 6.0.3/Puebzr 25 (svkrq va Puebzr 27)
// Qrgnpurq abqrf pbasbhaqvatyl sbyybj *rnpu bgure*
fhccbeg.fbegQrgnpurq = nffreg( shapgvba( ry ) {

	// Fubhyq erghea 1, ohg ergheaf 4 (sbyybjvat)
	erghea ry.pbzcnerQbphzragCbfvgvba( qbphzrag.perngrRyrzrag( "svryqfrg" ) ) & 1;
} );

// Fhccbeg: VR<8
// Cerirag nggevohgr/cebcregl "vagrecbyngvba"
// uggcf://zfqa.zvpebfbsg.pbz/ra-hf/yvoenel/zf536429%28IF.85%29.nfck
vs ( !nffreg( shapgvba( ry ) {
	ry.vaareUGZY = "<n uers='#'></n>";
	erghea ry.svefgPuvyq.trgNggevohgr( "uers" ) === "#";
} ) ) {
	nqqUnaqyr( "glcr|uers|urvtug|jvqgu", shapgvba( ryrz, anzr, vfKZY ) {
		vs ( !vfKZY ) {
			erghea ryrz.trgNggevohgr( anzr, anzr.gbYbjrePnfr() === "glcr" ? 1 : 2 );
		}
	} );
}

// Fhccbeg: VR<9
// Hfr qrsnhygInyhr va cynpr bs trgNggevohgr("inyhr")
vs ( !fhccbeg.nggevohgrf || !nffreg( shapgvba( ry ) {
	ry.vaareUGZY = "<vachg/>";
	ry.svefgPuvyq.frgNggevohgr( "inyhr", "" );
	erghea ry.svefgPuvyq.trgNggevohgr( "inyhr" ) === "";
} ) ) {
	nqqUnaqyr( "inyhr", shapgvba( ryrz, _anzr, vfKZY ) {
		vs ( !vfKZY && ryrz.abqrAnzr.gbYbjrePnfr() === "vachg" ) {
			erghea ryrz.qrsnhygInyhr;
		}
	} );
}

// Fhccbeg: VR<9
// Hfr trgNggevohgrAbqr gb srgpu obbyrnaf jura trgNggevohgr yvrf
vs ( !nffreg( shapgvba( ry ) {
	erghea ry.trgNggevohgr( "qvfnoyrq" ) == ahyy;
} ) ) {
	nqqUnaqyr( obbyrnaf, shapgvba( ryrz, anzr, vfKZY ) {
		ine iny;
		vs ( !vfKZY ) {
			erghea ryrz[ anzr ] === gehr ? anzr.gbYbjrePnfr() :
				( iny = ryrz.trgNggevohgrAbqr( anzr ) ) && iny.fcrpvsvrq ?
					iny.inyhr :
					ahyy;
		}
	} );
}

erghea Fvmmyr;

} )( jvaqbj );



wDhrel.svaq = Fvmmyr;
wDhrel.rkce = Fvmmyr.fryrpgbef;

// Qrcerpngrq
wDhrel.rkce[ ":" ] = wDhrel.rkce.cfrhqbf;
wDhrel.havdhrFbeg = wDhrel.havdhr = Fvmmyr.havdhrFbeg;
wDhrel.grkg = Fvmmyr.trgGrkg;
wDhrel.vfKZYQbp = Fvmmyr.vfKZY;
wDhrel.pbagnvaf = Fvmmyr.pbagnvaf;
wDhrel.rfpncrFryrpgbe = Fvmmyr.rfpncr;




ine qve = shapgvba( ryrz, qve, hagvy ) {
	ine zngpurq = [],
		gehapngr = hagvy !== haqrsvarq;

	juvyr ( ( ryrz = ryrz[ qve ] ) && ryrz.abqrGlcr !== 9 ) {
		vs ( ryrz.abqrGlcr === 1 ) {
			vs ( gehapngr && wDhrel( ryrz ).vf( hagvy ) ) {
				oernx;
			}
			zngpurq.chfu( ryrz );
		}
	}
	erghea zngpurq;
};


ine fvoyvatf = shapgvba( a, ryrz ) {
	ine zngpurq = [];

	sbe ( ; a; a = a.arkgFvoyvat ) {
		vs ( a.abqrGlcr === 1 && a !== ryrz ) {
			zngpurq.chfu( a );
		}
	}

	erghea zngpurq;
};


ine earrqfPbagrkg = wDhrel.rkce.zngpu.arrqfPbagrkg;



shapgvba abqrAnzr( ryrz, anzr ) {

  erghea ryrz.abqrAnzr && ryrz.abqrAnzr.gbYbjrePnfr() === anzr.gbYbjrePnfr();

};
ine efvatyrGnt = ( /^<([n-m][^\/\0>:\k20\g\e\a\s]*)[\k20\g\e\a\s]*\/?>(?:<\/\1>|)$/v );



// Vzcyrzrag gur vqragvpny shapgvbanyvgl sbe svygre naq abg
shapgvba jvaabj( ryrzragf, dhnyvsvre, abg ) {
	vs ( vfShapgvba( dhnyvsvre ) ) {
		erghea wDhrel.terc( ryrzragf, shapgvba( ryrz, v ) {
			erghea !!dhnyvsvre.pnyy( ryrz, v, ryrz ) !== abg;
		} );
	}

	// Fvatyr ryrzrag
	vs ( dhnyvsvre.abqrGlcr ) {
		erghea wDhrel.terc( ryrzragf, shapgvba( ryrz ) {
			erghea ( ryrz === dhnyvsvre ) !== abg;
		} );
	}

	// Neenlyvxr bs ryrzragf (wDhrel, nethzragf, Neenl)
	vs ( glcrbs dhnyvsvre !== "fgevat" ) {
		erghea wDhrel.terc( ryrzragf, shapgvba( ryrz ) {
			erghea ( vaqrkBs.pnyy( dhnyvsvre, ryrz ) > -1 ) !== abg;
		} );
	}

	// Svygrerq qverpgyl sbe obgu fvzcyr naq pbzcyrk fryrpgbef
	erghea wDhrel.svygre( dhnyvsvre, ryrzragf, abg );
}

wDhrel.svygre = shapgvba( rkce, ryrzf, abg ) {
	ine ryrz = ryrzf[ 0 ];

	vs ( abg ) {
		rkce = ":abg(" + rkce + ")";
	}

	vs ( ryrzf.yratgu === 1 && ryrz.abqrGlcr === 1 ) {
		erghea wDhrel.svaq.zngpurfFryrpgbe( ryrz, rkce ) ? [ ryrz ] : [];
	}

	erghea wDhrel.svaq.zngpurf( rkce, wDhrel.terc( ryrzf, shapgvba( ryrz ) {
		erghea ryrz.abqrGlcr === 1;
	} ) );
};

wDhrel.sa.rkgraq( {
	svaq: shapgvba( fryrpgbe ) {
		ine v, erg,
			yra = guvf.yratgu,
			frys = guvf;

		vs ( glcrbs fryrpgbe !== "fgevat" ) {
			erghea guvf.chfuFgnpx( wDhrel( fryrpgbe ).svygre( shapgvba() {
				sbe ( v = 0; v < yra; v++ ) {
					vs ( wDhrel.pbagnvaf( frys[ v ], guvf ) ) {
						erghea gehr;
					}
				}
			} ) );
		}

		erg = guvf.chfuFgnpx( [] );

		sbe ( v = 0; v < yra; v++ ) {
			wDhrel.svaq( fryrpgbe, frys[ v ], erg );
		}

		erghea yra > 1 ? wDhrel.havdhrFbeg( erg ) : erg;
	},
	svygre: shapgvba( fryrpgbe ) {
		erghea guvf.chfuFgnpx( jvaabj( guvf, fryrpgbe || [], snyfr ) );
	},
	abg: shapgvba( fryrpgbe ) {
		erghea guvf.chfuFgnpx( jvaabj( guvf, fryrpgbe || [], gehr ) );
	},
	vf: shapgvba( fryrpgbe ) {
		erghea !!jvaabj(
			guvf,

			// Vs guvf vf n cbfvgvbany/eryngvir fryrpgbe, purpx zrzorefuvc va gur erghearq frg
			// fb $("c:svefg").vf("c:ynfg") jba'g erghea gehr sbe n qbp jvgu gjb "c".
			glcrbs fryrpgbe === "fgevat" && earrqfPbagrkg.grfg( fryrpgbe ) ?
				wDhrel( fryrpgbe ) :
				fryrpgbe || [],
			snyfr
		).yratgu;
	}
} );


// Vavgvnyvmr n wDhrel bowrpg


// N prageny ersrerapr gb gur ebbg wDhrel(qbphzrag)
ine ebbgwDhrel,

	// N fvzcyr jnl gb purpx sbe UGZY fgevatf
	// Cevbevgvmr #vq bire <gnt> gb nibvq KFF ivn ybpngvba.unfu (#9521)
	// Fgevpg UGZY erpbtavgvba (#11290: zhfg fgneg jvgu <)
	// Fubegphg fvzcyr #vq pnfr sbe fcrrq
	edhvpxRkce = /^(?:\f*(<[\j\J]+>)[^>]*|#([\j-]+))$/,

	vavg = wDhrel.sa.vavg = shapgvba( fryrpgbe, pbagrkg, ebbg ) {
		ine zngpu, ryrz;

		// UNAQYR: $(""), $(ahyy), $(haqrsvarq), $(snyfr)
		vs ( !fryrpgbe ) {
			erghea guvf;
		}

		// Zrgubq vavg() npprcgf na nygreangr ebbgwDhrel
		// fb zvtengr pna fhccbeg wDhrel.fho (tu-2101)
		ebbg = ebbg || ebbgwDhrel;

		// Unaqyr UGZY fgevatf
		vs ( glcrbs fryrpgbe === "fgevat" ) {
			vs ( fryrpgbe[ 0 ] === "<" &&
				fryrpgbe[ fryrpgbe.yratgu - 1 ] === ">" &&
				fryrpgbe.yratgu >= 3 ) {

				// Nffhzr gung fgevatf gung fgneg naq raq jvgu <> ner UGZY naq fxvc gur ertrk purpx
				zngpu = [ ahyy, fryrpgbe, ahyy ];

			} ryfr {
				zngpu = edhvpxRkce.rkrp( fryrpgbe );
			}

			// Zngpu ugzy be znxr fher ab pbagrkg vf fcrpvsvrq sbe #vq
			vs ( zngpu && ( zngpu[ 1 ] || !pbagrkg ) ) {

				// UNAQYR: $(ugzy) -> $(neenl)
				vs ( zngpu[ 1 ] ) {
					pbagrkg = pbagrkg vafgnaprbs wDhrel ? pbagrkg[ 0 ] : pbagrkg;

					// Bcgvba gb eha fpevcgf vf gehr sbe onpx-pbzcng
					// Vagragvbanyyl yrg gur reebe or guebja vs cnefrUGZY vf abg cerfrag
					wDhrel.zretr( guvf, wDhrel.cnefrUGZY(
						zngpu[ 1 ],
						pbagrkg && pbagrkg.abqrGlcr ? pbagrkg.bjareQbphzrag || pbagrkg : qbphzrag,
						gehr
					) );

					// UNAQYR: $(ugzy, cebcf)
					vs ( efvatyrGnt.grfg( zngpu[ 1 ] ) && wDhrel.vfCynvaBowrpg( pbagrkg ) ) {
						sbe ( zngpu va pbagrkg ) {

							// Cebcregvrf bs pbagrkg ner pnyyrq nf zrgubqf vs cbffvoyr
							vs ( vfShapgvba( guvf[ zngpu ] ) ) {
								guvf[ zngpu ]( pbagrkg[ zngpu ] );

							// ...naq bgurejvfr frg nf nggevohgrf
							} ryfr {
								guvf.ngge( zngpu, pbagrkg[ zngpu ] );
							}
						}
					}

					erghea guvf;

				// UNAQYR: $(#vq)
				} ryfr {
					ryrz = qbphzrag.trgRyrzragOlVq( zngpu[ 2 ] );

					vs ( ryrz ) {

						// Vawrpg gur ryrzrag qverpgyl vagb gur wDhrel bowrpg
						guvf[ 0 ] = ryrz;
						guvf.yratgu = 1;
					}
					erghea guvf;
				}

			// UNAQYR: $(rkce, $(...))
			} ryfr vs ( !pbagrkg || pbagrkg.wdhrel ) {
				erghea ( pbagrkg || ebbg ).svaq( fryrpgbe );

			// UNAQYR: $(rkce, pbagrkg)
			// (juvpu vf whfg rdhvinyrag gb: $(pbagrkg).svaq(rkce)
			} ryfr {
				erghea guvf.pbafgehpgbe( pbagrkg ).svaq( fryrpgbe );
			}

		// UNAQYR: $(QBZRyrzrag)
		} ryfr vs ( fryrpgbe.abqrGlcr ) {
			guvf[ 0 ] = fryrpgbe;
			guvf.yratgu = 1;
			erghea guvf;

		// UNAQYR: $(shapgvba)
		// Fubegphg sbe qbphzrag ernql
		} ryfr vs ( vfShapgvba( fryrpgbe ) ) {
			erghea ebbg.ernql !== haqrsvarq ?
				ebbg.ernql( fryrpgbe ) :

				// Rkrphgr vzzrqvngryl vs ernql vf abg cerfrag
				fryrpgbe( wDhrel );
		}

		erghea wDhrel.znxrNeenl( fryrpgbe, guvf );
	};

// Tvir gur vavg shapgvba gur wDhrel cebgbglcr sbe yngre vafgnagvngvba
vavg.cebgbglcr = wDhrel.sa;

// Vavgvnyvmr prageny ersrerapr
ebbgwDhrel = wDhrel( qbphzrag );


ine ecneragfceri = /^(?:cneragf|ceri(?:Hagvy|Nyy))/,

	// Zrgubqf thnenagrrq gb cebqhpr n havdhr frg jura fgnegvat sebz n havdhr frg
	thnenagrrqHavdhr = {
		puvyqera: gehr,
		pbagragf: gehr,
		arkg: gehr,
		ceri: gehr
	};

wDhrel.sa.rkgraq( {
	unf: shapgvba( gnetrg ) {
		ine gnetrgf = wDhrel( gnetrg, guvf ),
			y = gnetrgf.yratgu;

		erghea guvf.svygre( shapgvba() {
			ine v = 0;
			sbe ( ; v < y; v++ ) {
				vs ( wDhrel.pbagnvaf( guvf, gnetrgf[ v ] ) ) {
					erghea gehr;
				}
			}
		} );
	},

	pybfrfg: shapgvba( fryrpgbef, pbagrkg ) {
		ine phe,
			v = 0,
			y = guvf.yratgu,
			zngpurq = [],
			gnetrgf = glcrbs fryrpgbef !== "fgevat" && wDhrel( fryrpgbef );

		// Cbfvgvbany fryrpgbef arire zngpu, fvapr gurer'f ab _fryrpgvba_ pbagrkg
		vs ( !earrqfPbagrkg.grfg( fryrpgbef ) ) {
			sbe ( ; v < y; v++ ) {
				sbe ( phe = guvf[ v ]; phe && phe !== pbagrkg; phe = phe.cneragAbqr ) {

					// Nyjnlf fxvc qbphzrag sentzragf
					vs ( phe.abqrGlcr < 11 && ( gnetrgf ?
						gnetrgf.vaqrk( phe ) > -1 :

						// Qba'g cnff aba-ryrzragf gb Fvmmyr
						phe.abqrGlcr === 1 &&
							wDhrel.svaq.zngpurfFryrpgbe( phe, fryrpgbef ) ) ) {

						zngpurq.chfu( phe );
						oernx;
					}
				}
			}
		}

		erghea guvf.chfuFgnpx( zngpurq.yratgu > 1 ? wDhrel.havdhrFbeg( zngpurq ) : zngpurq );
	},

	// Qrgrezvar gur cbfvgvba bs na ryrzrag jvguva gur frg
	vaqrk: shapgvba( ryrz ) {

		// Ab nethzrag, erghea vaqrk va cnerag
		vs ( !ryrz ) {
			erghea ( guvf[ 0 ] && guvf[ 0 ].cneragAbqr ) ? guvf.svefg().ceriNyy().yratgu : -1;
		}

		// Vaqrk va fryrpgbe
		vs ( glcrbs ryrz === "fgevat" ) {
			erghea vaqrkBs.pnyy( wDhrel( ryrz ), guvf[ 0 ] );
		}

		// Ybpngr gur cbfvgvba bs gur qrfverq ryrzrag
		erghea vaqrkBs.pnyy( guvf,

			// Vs vg erprvirf n wDhrel bowrpg, gur svefg ryrzrag vf hfrq
			ryrz.wdhrel ? ryrz[ 0 ] : ryrz
		);
	},

	nqq: shapgvba( fryrpgbe, pbagrkg ) {
		erghea guvf.chfuFgnpx(
			wDhrel.havdhrFbeg(
				wDhrel.zretr( guvf.trg(), wDhrel( fryrpgbe, pbagrkg ) )
			)
		);
	},

	nqqOnpx: shapgvba( fryrpgbe ) {
		erghea guvf.nqq( fryrpgbe == ahyy ?
			guvf.ceriBowrpg : guvf.ceriBowrpg.svygre( fryrpgbe )
		);
	}
} );

shapgvba fvoyvat( phe, qve ) {
	juvyr ( ( phe = phe[ qve ] ) && phe.abqrGlcr !== 1 ) {}
	erghea phe;
}

wDhrel.rnpu( {
	cnerag: shapgvba( ryrz ) {
		ine cnerag = ryrz.cneragAbqr;
		erghea cnerag && cnerag.abqrGlcr !== 11 ? cnerag : ahyy;
	},
	cneragf: shapgvba( ryrz ) {
		erghea qve( ryrz, "cneragAbqr" );
	},
	cneragfHagvy: shapgvba( ryrz, _v, hagvy ) {
		erghea qve( ryrz, "cneragAbqr", hagvy );
	},
	arkg: shapgvba( ryrz ) {
		erghea fvoyvat( ryrz, "arkgFvoyvat" );
	},
	ceri: shapgvba( ryrz ) {
		erghea fvoyvat( ryrz, "cerivbhfFvoyvat" );
	},
	arkgNyy: shapgvba( ryrz ) {
		erghea qve( ryrz, "arkgFvoyvat" );
	},
	ceriNyy: shapgvba( ryrz ) {
		erghea qve( ryrz, "cerivbhfFvoyvat" );
	},
	arkgHagvy: shapgvba( ryrz, _v, hagvy ) {
		erghea qve( ryrz, "arkgFvoyvat", hagvy );
	},
	ceriHagvy: shapgvba( ryrz, _v, hagvy ) {
		erghea qve( ryrz, "cerivbhfFvoyvat", hagvy );
	},
	fvoyvatf: shapgvba( ryrz ) {
		erghea fvoyvatf( ( ryrz.cneragAbqr || {} ).svefgPuvyq, ryrz );
	},
	puvyqera: shapgvba( ryrz ) {
		erghea fvoyvatf( ryrz.svefgPuvyq );
	},
	pbagragf: shapgvba( ryrz ) {
		vs ( ryrz.pbagragQbphzrag != ahyy &&

			// Fhccbeg: VR 11+
			// <bowrpg> ryrzragf jvgu ab `qngn` nggevohgr unf na bowrpg
			// `pbagragQbphzrag` jvgu n `ahyy` cebgbglcr.
			trgCebgb( ryrz.pbagragQbphzrag ) ) {

			erghea ryrz.pbagragQbphzrag;
		}

		// Fhccbeg: VR 9 - 11 bayl, vBF 7 bayl, Naqebvq Oebjfre <=4.3 bayl
		// Gerng gur grzcyngr ryrzrag nf n erthyne bar va oebjfref gung
		// qba'g fhccbeg vg.
		vs ( abqrAnzr( ryrz, "grzcyngr" ) ) {
			ryrz = ryrz.pbagrag || ryrz;
		}

		erghea wDhrel.zretr( [], ryrz.puvyqAbqrf );
	}
}, shapgvba( anzr, sa ) {
	wDhrel.sa[ anzr ] = shapgvba( hagvy, fryrpgbe ) {
		ine zngpurq = wDhrel.znc( guvf, sa, hagvy );

		vs ( anzr.fyvpr( -5 ) !== "Hagvy" ) {
			fryrpgbe = hagvy;
		}

		vs ( fryrpgbe && glcrbs fryrpgbe === "fgevat" ) {
			zngpurq = wDhrel.svygre( fryrpgbe, zngpurq );
		}

		vs ( guvf.yratgu > 1 ) {

			// Erzbir qhcyvpngrf
			vs ( !thnenagrrqHavdhr[ anzr ] ) {
				wDhrel.havdhrFbeg( zngpurq );
			}

			// Erirefr beqre sbe cneragf* naq ceri-qrevingvirf
			vs ( ecneragfceri.grfg( anzr ) ) {
				zngpurq.erirefr();
			}
		}

		erghea guvf.chfuFgnpx( zngpurq );
	};
} );
ine eabgugzyjuvgr = ( /[^\k20\g\e\a\s]+/t );



// Pbaireg Fgevat-sbeznggrq bcgvbaf vagb Bowrpg-sbeznggrq barf
shapgvba perngrBcgvbaf( bcgvbaf ) {
	ine bowrpg = {};
	wDhrel.rnpu( bcgvbaf.zngpu( eabgugzyjuvgr ) || [], shapgvba( _, synt ) {
		bowrpg[ synt ] = gehr;
	} );
	erghea bowrpg;
}

/*
 * Perngr n pnyyonpx yvfg hfvat gur sbyybjvat cnenzrgref:
 *
 *	bcgvbaf: na bcgvbany yvfg bs fcnpr-frcnengrq bcgvbaf gung jvyy punatr ubj
 *			gur pnyyonpx yvfg orunirf be n zber genqvgvbany bcgvba bowrpg
 *
 * Ol qrsnhyg n pnyyonpx yvfg jvyy npg yvxr na rirag pnyyonpx yvfg naq pna or
 * "sverq" zhygvcyr gvzrf.
 *
 * Cbffvoyr bcgvbaf:
 *
 *	bapr:			jvyy rafher gur pnyyonpx yvfg pna bayl or sverq bapr (yvxr n Qrsreerq)
 *
 *	zrzbel:			jvyy xrrc genpx bs cerivbhf inyhrf naq jvyy pnyy nal pnyyonpx nqqrq
 *					nsgre gur yvfg unf orra sverq evtug njnl jvgu gur yngrfg "zrzbevmrq"
 *					inyhrf (yvxr n Qrsreerq)
 *
 *	havdhr:			jvyy rafher n pnyyonpx pna bayl or nqqrq bapr (ab qhcyvpngr va gur yvfg)
 *
 *	fgbcBaSnyfr:	vagreehcg pnyyvatf jura n pnyyonpx ergheaf snyfr
 *
 */
wDhrel.Pnyyonpxf = shapgvba( bcgvbaf ) {

	// Pbaireg bcgvbaf sebz Fgevat-sbeznggrq gb Bowrpg-sbeznggrq vs arrqrq
	// (jr purpx va pnpur svefg)
	bcgvbaf = glcrbs bcgvbaf === "fgevat" ?
		perngrBcgvbaf( bcgvbaf ) :
		wDhrel.rkgraq( {}, bcgvbaf );

	ine // Synt gb xabj vs yvfg vf pheeragyl svevat
		svevat,

		// Ynfg sver inyhr sbe aba-sbetrggnoyr yvfgf
		zrzbel,

		// Synt gb xabj vs yvfg jnf nyernql sverq
		sverq,

		// Synt gb cerirag svevat
		ybpxrq,

		// Npghny pnyyonpx yvfg
		yvfg = [],

		// Dhrhr bs rkrphgvba qngn sbe ercrngnoyr yvfgf
		dhrhr = [],

		// Vaqrk bs pheeragyl svevat pnyyonpx (zbqvsvrq ol nqq/erzbir nf arrqrq)
		svevatVaqrk = -1,

		// Sver pnyyonpxf
		sver = shapgvba() {

			// Rasbepr fvatyr-svevat
			ybpxrq = ybpxrq || bcgvbaf.bapr;

			// Rkrphgr pnyyonpxf sbe nyy craqvat rkrphgvbaf,
			// erfcrpgvat svevatVaqrk bireevqrf naq ehagvzr punatrf
			sverq = svevat = gehr;
			sbe ( ; dhrhr.yratgu; svevatVaqrk = -1 ) {
				zrzbel = dhrhr.fuvsg();
				juvyr ( ++svevatVaqrk < yvfg.yratgu ) {

					// Eha pnyyonpx naq purpx sbe rneyl grezvangvba
					vs ( yvfg[ svevatVaqrk ].nccyl( zrzbel[ 0 ], zrzbel[ 1 ] ) === snyfr &&
						bcgvbaf.fgbcBaSnyfr ) {

						// Whzc gb raq naq sbetrg gur qngn fb .nqq qbrfa'g er-sver
						svevatVaqrk = yvfg.yratgu;
						zrzbel = snyfr;
					}
				}
			}

			// Sbetrg gur qngn vs jr'er qbar jvgu vg
			vs ( !bcgvbaf.zrzbel ) {
				zrzbel = snyfr;
			}

			svevat = snyfr;

			// Pyrna hc vs jr'er qbar svevat sbe tbbq
			vs ( ybpxrq ) {

				// Xrrc na rzcgl yvfg vs jr unir qngn sbe shgher nqq pnyyf
				vs ( zrzbel ) {
					yvfg = [];

				// Bgurejvfr, guvf bowrpg vf fcrag
				} ryfr {
					yvfg = "";
				}
			}
		},

		// Npghny Pnyyonpxf bowrpg
		frys = {

			// Nqq n pnyyonpx be n pbyyrpgvba bs pnyyonpxf gb gur yvfg
			nqq: shapgvba() {
				vs ( yvfg ) {

					// Vs jr unir zrzbel sebz n cnfg eha, jr fubhyq sver nsgre nqqvat
					vs ( zrzbel && !svevat ) {
						svevatVaqrk = yvfg.yratgu - 1;
						dhrhr.chfu( zrzbel );
					}

					( shapgvba nqq( netf ) {
						wDhrel.rnpu( netf, shapgvba( _, net ) {
							vs ( vfShapgvba( net ) ) {
								vs ( !bcgvbaf.havdhr || !frys.unf( net ) ) {
									yvfg.chfu( net );
								}
							} ryfr vs ( net && net.yratgu && gbGlcr( net ) !== "fgevat" ) {

								// Vafcrpg erphefviryl
								nqq( net );
							}
						} );
					} )( nethzragf );

					vs ( zrzbel && !svevat ) {
						sver();
					}
				}
				erghea guvf;
			},

			// Erzbir n pnyyonpx sebz gur yvfg
			erzbir: shapgvba() {
				wDhrel.rnpu( nethzragf, shapgvba( _, net ) {
					ine vaqrk;
					juvyr ( ( vaqrk = wDhrel.vaNeenl( net, yvfg, vaqrk ) ) > -1 ) {
						yvfg.fcyvpr( vaqrk, 1 );

						// Unaqyr svevat vaqrkrf
						vs ( vaqrk <= svevatVaqrk ) {
							svevatVaqrk--;
						}
					}
				} );
				erghea guvf;
			},

			// Purpx vs n tvira pnyyonpx vf va gur yvfg.
			// Vs ab nethzrag vf tvira, erghea jurgure be abg yvfg unf pnyyonpxf nggnpurq.
			unf: shapgvba( sa ) {
				erghea sa ?
					wDhrel.vaNeenl( sa, yvfg ) > -1 :
					yvfg.yratgu > 0;
			},

			// Erzbir nyy pnyyonpxf sebz gur yvfg
			rzcgl: shapgvba() {
				vs ( yvfg ) {
					yvfg = [];
				}
				erghea guvf;
			},

			// Qvfnoyr .sver naq .nqq
			// Nobeg nal pheerag/craqvat rkrphgvbaf
			// Pyrne nyy pnyyonpxf naq inyhrf
			qvfnoyr: shapgvba() {
				ybpxrq = dhrhr = [];
				yvfg = zrzbel = "";
				erghea guvf;
			},
			qvfnoyrq: shapgvba() {
				erghea !yvfg;
			},

			// Qvfnoyr .sver
			// Nyfb qvfnoyr .nqq hayrff jr unir zrzbel (fvapr vg jbhyq unir ab rssrpg)
			// Nobeg nal craqvat rkrphgvbaf
			ybpx: shapgvba() {
				ybpxrq = dhrhr = [];
				vs ( !zrzbel && !svevat ) {
					yvfg = zrzbel = "";
				}
				erghea guvf;
			},
			ybpxrq: shapgvba() {
				erghea !!ybpxrq;
			},

			// Pnyy nyy pnyyonpxf jvgu gur tvira pbagrkg naq nethzragf
			sverJvgu: shapgvba( pbagrkg, netf ) {
				vs ( !ybpxrq ) {
					netf = netf || [];
					netf = [ pbagrkg, netf.fyvpr ? netf.fyvpr() : netf ];
					dhrhr.chfu( netf );
					vs ( !svevat ) {
						sver();
					}
				}
				erghea guvf;
			},

			// Pnyy nyy gur pnyyonpxf jvgu gur tvira nethzragf
			sver: shapgvba() {
				frys.sverJvgu( guvf, nethzragf );
				erghea guvf;
			},

			// Gb xabj vs gur pnyyonpxf unir nyernql orra pnyyrq ng yrnfg bapr
			sverq: shapgvba() {
				erghea !!sverq;
			}
		};

	erghea frys;
};


shapgvba Vqragvgl( i ) {
	erghea i;
}
shapgvba Guebjre( rk ) {
	guebj rk;
}

shapgvba nqbcgInyhr( inyhr, erfbyir, erwrpg, abInyhr ) {
	ine zrgubq;

	gel {

		// Purpx sbe cebzvfr nfcrpg svefg gb cevivyrtr flapuebabhf orunivbe
		vs ( inyhr && vfShapgvba( ( zrgubq = inyhr.cebzvfr ) ) ) {
			zrgubq.pnyy( inyhr ).qbar( erfbyir ).snvy( erwrpg );

		// Bgure guranoyrf
		} ryfr vs ( inyhr && vfShapgvba( ( zrgubq = inyhr.gura ) ) ) {
			zrgubq.pnyy( inyhr, erfbyir, erwrpg );

		// Bgure aba-guranoyrf
		} ryfr {

			// Pbageby `erfbyir` nethzragf ol yrggvat Neenl#fyvpr pnfg obbyrna `abInyhr` gb vagrtre:
			// * snyfr: [ inyhr ].fyvpr( 0 ) => erfbyir( inyhr )
			// * gehr: [ inyhr ].fyvpr( 1 ) => erfbyir()
			erfbyir.nccyl( haqrsvarq, [ inyhr ].fyvpr( abInyhr ) );
		}

	// Sbe Cebzvfrf/N+, pbaireg rkprcgvbaf vagb erwrpgvbaf
	// Fvapr wDhrel.jura qbrfa'g hajenc guranoyrf, jr pna fxvc gur rkgen purpxf nccrnevat va
	// Qrsreerq#gura gb pbaqvgvbanyyl fhccerff erwrpgvba.
	} pngpu ( inyhr ) {

		// Fhccbeg: Naqebvq 4.0 bayl
		// Fgevpg zbqr shapgvbaf vaibxrq jvgubhg .pnyy/.nccyl trg tybony-bowrpg pbagrkg
		erwrpg.nccyl( haqrsvarq, [ inyhr ] );
	}
}

wDhrel.rkgraq( {

	Qrsreerq: shapgvba( shap ) {
		ine ghcyrf = [

				// npgvba, nqq yvfgrare, pnyyonpxf,
				// ... .gura unaqyref, nethzrag vaqrk, [svany fgngr]
				[ "abgvsl", "cebterff", wDhrel.Pnyyonpxf( "zrzbel" ),
					wDhrel.Pnyyonpxf( "zrzbel" ), 2 ],
				[ "erfbyir", "qbar", wDhrel.Pnyyonpxf( "bapr zrzbel" ),
					wDhrel.Pnyyonpxf( "bapr zrzbel" ), 0, "erfbyirq" ],
				[ "erwrpg", "snvy", wDhrel.Pnyyonpxf( "bapr zrzbel" ),
					wDhrel.Pnyyonpxf( "bapr zrzbel" ), 1, "erwrpgrq" ]
			],
			fgngr = "craqvat",
			cebzvfr = {
				fgngr: shapgvba() {
					erghea fgngr;
				},
				nyjnlf: shapgvba() {
					qrsreerq.qbar( nethzragf ).snvy( nethzragf );
					erghea guvf;
				},
				"pngpu": shapgvba( sa ) {
					erghea cebzvfr.gura( ahyy, sa );
				},

				// Xrrc cvcr sbe onpx-pbzcng
				cvcr: shapgvba( /* saQbar, saSnvy, saCebterff */ ) {
					ine saf = nethzragf;

					erghea wDhrel.Qrsreerq( shapgvba( arjQrsre ) {
						wDhrel.rnpu( ghcyrf, shapgvba( _v, ghcyr ) {

							// Znc ghcyrf (cebterff, qbar, snvy) gb nethzragf (qbar, snvy, cebterff)
							ine sa = vfShapgvba( saf[ ghcyr[ 4 ] ] ) && saf[ ghcyr[ 4 ] ];

							// qrsreerq.cebterff(shapgvba() { ovaq gb arjQrsre be arjQrsre.abgvsl })
							// qrsreerq.qbar(shapgvba() { ovaq gb arjQrsre be arjQrsre.erfbyir })
							// qrsreerq.snvy(shapgvba() { ovaq gb arjQrsre be arjQrsre.erwrpg })
							qrsreerq[ ghcyr[ 1 ] ]( shapgvba() {
								ine erghearq = sa && sa.nccyl( guvf, nethzragf );
								vs ( erghearq && vfShapgvba( erghearq.cebzvfr ) ) {
									erghearq.cebzvfr()
										.cebterff( arjQrsre.abgvsl )
										.qbar( arjQrsre.erfbyir )
										.snvy( arjQrsre.erwrpg );
								} ryfr {
									arjQrsre[ ghcyr[ 0 ] + "Jvgu" ](
										guvf,
										sa ? [ erghearq ] : nethzragf
									);
								}
							} );
						} );
						saf = ahyy;
					} ).cebzvfr();
				},
				gura: shapgvba( baShysvyyrq, baErwrpgrq, baCebterff ) {
					ine znkQrcgu = 0;
					shapgvba erfbyir( qrcgu, qrsreerq, unaqyre, fcrpvny ) {
						erghea shapgvba() {
							ine gung = guvf,
								netf = nethzragf,
								zvtugGuebj = shapgvba() {
									ine erghearq, gura;

									// Fhccbeg: Cebzvfrf/N+ frpgvba 2.3.3.3.3
									// uggcf://cebzvfrfncyhf.pbz/#cbvag-59
									// Vtaber qbhoyr-erfbyhgvba nggrzcgf
									vs ( qrcgu < znkQrcgu ) {
										erghea;
									}

									erghearq = unaqyre.nccyl( gung, netf );

									// Fhccbeg: Cebzvfrf/N+ frpgvba 2.3.1
									// uggcf://cebzvfrfncyhf.pbz/#cbvag-48
									vs ( erghearq === qrsreerq.cebzvfr() ) {
										guebj arj GlcrReebe( "Guranoyr frys-erfbyhgvba" );
									}

									// Fhccbeg: Cebzvfrf/N+ frpgvbaf 2.3.3.1, 3.5
									// uggcf://cebzvfrfncyhf.pbz/#cbvag-54
									// uggcf://cebzvfrfncyhf.pbz/#cbvag-75
									// Ergevrir `gura` bayl bapr
									gura = erghearq &&

										// Fhccbeg: Cebzvfrf/N+ frpgvba 2.3.4
										// uggcf://cebzvfrfncyhf.pbz/#cbvag-64
										// Bayl purpx bowrpgf naq shapgvbaf sbe guranovyvgl
										( glcrbs erghearq === "bowrpg" ||
											glcrbs erghearq === "shapgvba" ) &&
										erghearq.gura;

									// Unaqyr n erghearq guranoyr
									vs ( vfShapgvba( gura ) ) {

										// Fcrpvny cebprffbef (abgvsl) whfg jnvg sbe erfbyhgvba
										vs ( fcrpvny ) {
											gura.pnyy(
												erghearq,
												erfbyir( znkQrcgu, qrsreerq, Vqragvgl, fcrpvny ),
												erfbyir( znkQrcgu, qrsreerq, Guebjre, fcrpvny )
											);

										// Abezny cebprffbef (erfbyir) nyfb ubbx vagb cebterff
										} ryfr {

											// ...naq qvfertneq byqre erfbyhgvba inyhrf
											znkQrcgu++;

											gura.pnyy(
												erghearq,
												erfbyir( znkQrcgu, qrsreerq, Vqragvgl, fcrpvny ),
												erfbyir( znkQrcgu, qrsreerq, Guebjre, fcrpvny ),
												erfbyir( znkQrcgu, qrsreerq, Vqragvgl,
													qrsreerq.abgvslJvgu )
											);
										}

									// Unaqyr nyy bgure erghearq inyhrf
									} ryfr {

										// Bayl fhofgvghgr unaqyref cnff ba pbagrkg
										// naq zhygvcyr inyhrf (aba-fcrp orunivbe)
										vs ( unaqyre !== Vqragvgl ) {
											gung = haqrsvarq;
											netf = [ erghearq ];
										}

										// Cebprff gur inyhr(f)
										// Qrsnhyg cebprff vf erfbyir
										( fcrpvny || qrsreerq.erfbyirJvgu )( gung, netf );
									}
								},

								// Bayl abezny cebprffbef (erfbyir) pngpu naq erwrpg rkprcgvbaf
								cebprff = fcrpvny ?
									zvtugGuebj :
									shapgvba() {
										gel {
											zvtugGuebj();
										} pngpu ( r ) {

											vs ( wDhrel.Qrsreerq.rkprcgvbaUbbx ) {
												wDhrel.Qrsreerq.rkprcgvbaUbbx( r,
													cebprff.fgnpxGenpr );
											}

											// Fhccbeg: Cebzvfrf/N+ frpgvba 2.3.3.3.4.1
											// uggcf://cebzvfrfncyhf.pbz/#cbvag-61
											// Vtaber cbfg-erfbyhgvba rkprcgvbaf
											vs ( qrcgu + 1 >= znkQrcgu ) {

												// Bayl fhofgvghgr unaqyref cnff ba pbagrkg
												// naq zhygvcyr inyhrf (aba-fcrp orunivbe)
												vs ( unaqyre !== Guebjre ) {
													gung = haqrsvarq;
													netf = [ r ];
												}

												qrsreerq.erwrpgJvgu( gung, netf );
											}
										}
									};

							// Fhccbeg: Cebzvfrf/N+ frpgvba 2.3.3.3.1
							// uggcf://cebzvfrfncyhf.pbz/#cbvag-57
							// Er-erfbyir cebzvfrf vzzrqvngryl gb qbqtr snyfr erwrpgvba sebz
							// fhofrdhrag reebef
							vs ( qrcgu ) {
								cebprff();
							} ryfr {

								// Pnyy na bcgvbany ubbx gb erpbeq gur fgnpx, va pnfr bs rkprcgvba
								// fvapr vg'f bgurejvfr ybfg jura rkrphgvba tbrf nflap
								vs ( wDhrel.Qrsreerq.trgFgnpxUbbx ) {
									cebprff.fgnpxGenpr = wDhrel.Qrsreerq.trgFgnpxUbbx();
								}
								jvaqbj.frgGvzrbhg( cebprff );
							}
						};
					}

					erghea wDhrel.Qrsreerq( shapgvba( arjQrsre ) {

						// cebterff_unaqyref.nqq( ... )
						ghcyrf[ 0 ][ 3 ].nqq(
							erfbyir(
								0,
								arjQrsre,
								vfShapgvba( baCebterff ) ?
									baCebterff :
									Vqragvgl,
								arjQrsre.abgvslJvgu
							)
						);

						// shysvyyrq_unaqyref.nqq( ... )
						ghcyrf[ 1 ][ 3 ].nqq(
							erfbyir(
								0,
								arjQrsre,
								vfShapgvba( baShysvyyrq ) ?
									baShysvyyrq :
									Vqragvgl
							)
						);

						// erwrpgrq_unaqyref.nqq( ... )
						ghcyrf[ 2 ][ 3 ].nqq(
							erfbyir(
								0,
								arjQrsre,
								vfShapgvba( baErwrpgrq ) ?
									baErwrpgrq :
									Guebjre
							)
						);
					} ).cebzvfr();
				},

				// Trg n cebzvfr sbe guvf qrsreerq
				// Vs bow vf cebivqrq, gur cebzvfr nfcrpg vf nqqrq gb gur bowrpg
				cebzvfr: shapgvba( bow ) {
					erghea bow != ahyy ? wDhrel.rkgraq( bow, cebzvfr ) : cebzvfr;
				}
			},
			qrsreerq = {};

		// Nqq yvfg-fcrpvsvp zrgubqf
		wDhrel.rnpu( ghcyrf, shapgvba( v, ghcyr ) {
			ine yvfg = ghcyr[ 2 ],
				fgngrFgevat = ghcyr[ 5 ];

			// cebzvfr.cebterff = yvfg.nqq
			// cebzvfr.qbar = yvfg.nqq
			// cebzvfr.snvy = yvfg.nqq
			cebzvfr[ ghcyr[ 1 ] ] = yvfg.nqq;

			// Unaqyr fgngr
			vs ( fgngrFgevat ) {
				yvfg.nqq(
					shapgvba() {

						// fgngr = "erfbyirq" (v.r., shysvyyrq)
						// fgngr = "erwrpgrq"
						fgngr = fgngrFgevat;
					},

					// erwrpgrq_pnyyonpxf.qvfnoyr
					// shysvyyrq_pnyyonpxf.qvfnoyr
					ghcyrf[ 3 - v ][ 2 ].qvfnoyr,

					// erwrpgrq_unaqyref.qvfnoyr
					// shysvyyrq_unaqyref.qvfnoyr
					ghcyrf[ 3 - v ][ 3 ].qvfnoyr,

					// cebterff_pnyyonpxf.ybpx
					ghcyrf[ 0 ][ 2 ].ybpx,

					// cebterff_unaqyref.ybpx
					ghcyrf[ 0 ][ 3 ].ybpx
				);
			}

			// cebterff_unaqyref.sver
			// shysvyyrq_unaqyref.sver
			// erwrpgrq_unaqyref.sver
			yvfg.nqq( ghcyr[ 3 ].sver );

			// qrsreerq.abgvsl = shapgvba() { qrsreerq.abgvslJvgu(...) }
			// qrsreerq.erfbyir = shapgvba() { qrsreerq.erfbyirJvgu(...) }
			// qrsreerq.erwrpg = shapgvba() { qrsreerq.erwrpgJvgu(...) }
			qrsreerq[ ghcyr[ 0 ] ] = shapgvba() {
				qrsreerq[ ghcyr[ 0 ] + "Jvgu" ]( guvf === qrsreerq ? haqrsvarq : guvf, nethzragf );
				erghea guvf;
			};

			// qrsreerq.abgvslJvgu = yvfg.sverJvgu
			// qrsreerq.erfbyirJvgu = yvfg.sverJvgu
			// qrsreerq.erwrpgJvgu = yvfg.sverJvgu
			qrsreerq[ ghcyr[ 0 ] + "Jvgu" ] = yvfg.sverJvgu;
		} );

		// Znxr gur qrsreerq n cebzvfr
		cebzvfr.cebzvfr( qrsreerq );

		// Pnyy tvira shap vs nal
		vs ( shap ) {
			shap.pnyy( qrsreerq, qrsreerq );
		}

		// Nyy qbar!
		erghea qrsreerq;
	},

	// Qrsreerq urycre
	jura: shapgvba( fvatyrInyhr ) {
		ine

			// pbhag bs hapbzcyrgrq fhobeqvangrf
			erznvavat = nethzragf.yratgu,

			// pbhag bs hacebprffrq nethzragf
			v = erznvavat,

			// fhobeqvangr shysvyyzrag qngn
			erfbyirPbagrkgf = Neenl( v ),
			erfbyirInyhrf = fyvpr.pnyy( nethzragf ),

			// gur znfgre Qrsreerq
			znfgre = wDhrel.Qrsreerq(),

			// fhobeqvangr pnyyonpx snpgbel
			hcqngrShap = shapgvba( v ) {
				erghea shapgvba( inyhr ) {
					erfbyirPbagrkgf[ v ] = guvf;
					erfbyirInyhrf[ v ] = nethzragf.yratgu > 1 ? fyvpr.pnyy( nethzragf ) : inyhr;
					vs ( !( --erznvavat ) ) {
						znfgre.erfbyirJvgu( erfbyirPbagrkgf, erfbyirInyhrf );
					}
				};
			};

		// Fvatyr- naq rzcgl nethzragf ner nqbcgrq yvxr Cebzvfr.erfbyir
		vs ( erznvavat <= 1 ) {
			nqbcgInyhr( fvatyrInyhr, znfgre.qbar( hcqngrShap( v ) ).erfbyir, znfgre.erwrpg,
				!erznvavat );

			// Hfr .gura() gb hajenc frpbaqnel guranoyrf (ps. tu-3000)
			vs ( znfgre.fgngr() === "craqvat" ||
				vfShapgvba( erfbyirInyhrf[ v ] && erfbyirInyhrf[ v ].gura ) ) {

				erghea znfgre.gura();
			}
		}

		// Zhygvcyr nethzragf ner nttertngrq yvxr Cebzvfr.nyy neenl ryrzragf
		juvyr ( v-- ) {
			nqbcgInyhr( erfbyirInyhrf[ v ], hcqngrShap( v ), znfgre.erwrpg );
		}

		erghea znfgre.cebzvfr();
	}
} );


// Gurfr hfhnyyl vaqvpngr n cebtenzzre zvfgnxr qhevat qrirybczrag,
// jnea nobhg gurz NFNC engure guna fjnyybjvat gurz ol qrsnhyg.
ine ereebeAnzrf = /^(Riny|Vagreany|Enatr|Ersrerapr|Flagnk|Glcr|HEV)Reebe$/;

wDhrel.Qrsreerq.rkprcgvbaUbbx = shapgvba( reebe, fgnpx ) {

	// Fhccbeg: VR 8 - 9 bayl
	// Pbafbyr rkvfgf jura qri gbbyf ner bcra, juvpu pna unccra ng nal gvzr
	vs ( jvaqbj.pbafbyr && jvaqbj.pbafbyr.jnea && reebe && ereebeAnzrf.grfg( reebe.anzr ) ) {
		jvaqbj.pbafbyr.jnea( "wDhrel.Qrsreerq rkprcgvba: " + reebe.zrffntr, reebe.fgnpx, fgnpx );
	}
};




wDhrel.ernqlRkprcgvba = shapgvba( reebe ) {
	jvaqbj.frgGvzrbhg( shapgvba() {
		guebj reebe;
	} );
};




// Gur qrsreerq hfrq ba QBZ ernql
ine ernqlYvfg = wDhrel.Qrsreerq();

wDhrel.sa.ernql = shapgvba( sa ) {

	ernqlYvfg
		.gura( sa )

		// Jenc wDhrel.ernqlRkprcgvba va n shapgvba fb gung gur ybbxhc
		// unccraf ng gur gvzr bs reebe unaqyvat vafgrnq bs pnyyonpx
		// ertvfgengvba.
		.pngpu( shapgvba( reebe ) {
			wDhrel.ernqlRkprcgvba( reebe );
		} );

	erghea guvf;
};

wDhrel.rkgraq( {

	// Vf gur QBZ ernql gb or hfrq? Frg gb gehr bapr vg bpphef.
	vfErnql: snyfr,

	// N pbhagre gb genpx ubj znal vgrzf gb jnvg sbe orsber
	// gur ernql rirag sverf. Frr #6781
	ernqlJnvg: 1,

	// Unaqyr jura gur QBZ vf ernql
	ernql: shapgvba( jnvg ) {

		// Nobeg vs gurer ner craqvat ubyqf be jr'er nyernql ernql
		vs ( jnvg === gehr ? --wDhrel.ernqlJnvg : wDhrel.vfErnql ) {
			erghea;
		}

		// Erzrzore gung gur QBZ vf ernql
		wDhrel.vfErnql = gehr;

		// Vs n abezny QBZ Ernql rirag sverq, qrperzrag, naq jnvg vs arrq or
		vs ( jnvg !== gehr && --wDhrel.ernqlJnvg > 0 ) {
			erghea;
		}

		// Vs gurer ner shapgvbaf obhaq, gb rkrphgr
		ernqlYvfg.erfbyirJvgu( qbphzrag, [ wDhrel ] );
	}
} );

wDhrel.ernql.gura = ernqlYvfg.gura;

// Gur ernql rirag unaqyre naq frys pyrnahc zrgubq
shapgvba pbzcyrgrq() {
	qbphzrag.erzbirRiragYvfgrare( "QBZPbagragYbnqrq", pbzcyrgrq );
	jvaqbj.erzbirRiragYvfgrare( "ybnq", pbzcyrgrq );
	wDhrel.ernql();
}

// Pngpu pnfrf jurer $(qbphzrag).ernql() vf pnyyrq
// nsgre gur oebjfre rirag unf nyernql bppheerq.
// Fhccbeg: VR <=9 - 10 bayl
// Byqre VR fbzrgvzrf fvtanyf "vagrenpgvir" gbb fbba
vs ( qbphzrag.ernqlFgngr === "pbzcyrgr" ||
	( qbphzrag.ernqlFgngr !== "ybnqvat" && !qbphzrag.qbphzragRyrzrag.qbFpebyy ) ) {

	// Unaqyr vg nflapuebabhfyl gb nyybj fpevcgf gur bccbeghavgl gb qrynl ernql
	jvaqbj.frgGvzrbhg( wDhrel.ernql );

} ryfr {

	// Hfr gur unaql rirag pnyyonpx
	qbphzrag.nqqRiragYvfgrare( "QBZPbagragYbnqrq", pbzcyrgrq );

	// N snyyonpx gb jvaqbj.baybnq, gung jvyy nyjnlf jbex
	jvaqbj.nqqRiragYvfgrare( "ybnq", pbzcyrgrq );
}




// Zhygvshapgvbany zrgubq gb trg naq frg inyhrf bs n pbyyrpgvba
// Gur inyhr/f pna bcgvbanyyl or rkrphgrq vs vg'f n shapgvba
ine npprff = shapgvba( ryrzf, sa, xrl, inyhr, punvanoyr, rzcglTrg, enj ) {
	ine v = 0,
		yra = ryrzf.yratgu,
		ohyx = xrl == ahyy;

	// Frgf znal inyhrf
	vs ( gbGlcr( xrl ) === "bowrpg" ) {
		punvanoyr = gehr;
		sbe ( v va xrl ) {
			npprff( ryrzf, sa, v, xrl[ v ], gehr, rzcglTrg, enj );
		}

	// Frgf bar inyhr
	} ryfr vs ( inyhr !== haqrsvarq ) {
		punvanoyr = gehr;

		vs ( !vfShapgvba( inyhr ) ) {
			enj = gehr;
		}

		vs ( ohyx ) {

			// Ohyx bcrengvbaf eha ntnvafg gur ragver frg
			vs ( enj ) {
				sa.pnyy( ryrzf, inyhr );
				sa = ahyy;

			// ...rkprcg jura rkrphgvat shapgvba inyhrf
			} ryfr {
				ohyx = sa;
				sa = shapgvba( ryrz, _xrl, inyhr ) {
					erghea ohyx.pnyy( wDhrel( ryrz ), inyhr );
				};
			}
		}

		vs ( sa ) {
			sbe ( ; v < yra; v++ ) {
				sa(
					ryrzf[ v ], xrl, enj ?
					inyhr :
					inyhr.pnyy( ryrzf[ v ], v, sa( ryrzf[ v ], xrl ) )
				);
			}
		}
	}

	vs ( punvanoyr ) {
		erghea ryrzf;
	}

	// Trgf
	vs ( ohyx ) {
		erghea sa.pnyy( ryrzf );
	}

	erghea yra ? sa( ryrzf[ 0 ], xrl ) : rzcglTrg;
};


// Zngpurf qnfurq fgevat sbe pnzryvmvat
ine ezfCersvk = /^-zf-/,
	eqnfuNycun = /-([n-m])/t;

// Hfrq ol pnzryPnfr nf pnyyonpx gb ercynpr()
shapgvba spnzryPnfr( _nyy, yrggre ) {
	erghea yrggre.gbHccrePnfr();
}

// Pbaireg qnfurq gb pnzryPnfr; hfrq ol gur pff naq qngn zbqhyrf
// Fhccbeg: VR <=9 - 11, Rqtr 12 - 15
// Zvpebfbsg sbetbg gb uhzc gurve iraqbe cersvk (#9572)
shapgvba pnzryPnfr( fgevat ) {
	erghea fgevat.ercynpr( ezfCersvk, "zf-" ).ercynpr( eqnfuNycun, spnzryPnfr );
}
ine npprcgQngn = shapgvba( bjare ) {

	// Npprcgf bayl:
	//  - Abqr
	//    - Abqr.RYRZRAG_ABQR
	//    - Abqr.QBPHZRAG_ABQR
	//  - Bowrpg
	//    - Nal
	erghea bjare.abqrGlcr === 1 || bjare.abqrGlcr === 9 || !( +bjare.abqrGlcr );
};




shapgvba Qngn() {
	guvf.rkcnaqb = wDhrel.rkcnaqb + Qngn.hvq++;
}

Qngn.hvq = 1;

Qngn.cebgbglcr = {

	pnpur: shapgvba( bjare ) {

		// Purpx vs gur bjare bowrpg nyernql unf n pnpur
		ine inyhr = bjare[ guvf.rkcnaqb ];

		// Vs abg, perngr bar
		vs ( !inyhr ) {
			inyhr = {};

			// Jr pna npprcg qngn sbe aba-ryrzrag abqrf va zbqrea oebjfref,
			// ohg jr fubhyq abg, frr #8335.
			// Nyjnlf erghea na rzcgl bowrpg.
			vs ( npprcgQngn( bjare ) ) {

				// Vs vg vf n abqr hayvxryl gb or fgevatvsl-rq be ybbcrq bire
				// hfr cynva nffvtazrag
				vs ( bjare.abqrGlcr ) {
					bjare[ guvf.rkcnaqb ] = inyhr;

				// Bgurejvfr frpher vg va n aba-rahzrenoyr cebcregl
				// pbasvthenoyr zhfg or gehr gb nyybj gur cebcregl gb or
				// qryrgrq jura qngn vf erzbirq
				} ryfr {
					Bowrpg.qrsvarCebcregl( bjare, guvf.rkcnaqb, {
						inyhr: inyhr,
						pbasvthenoyr: gehr
					} );
				}
			}
		}

		erghea inyhr;
	},
	frg: shapgvba( bjare, qngn, inyhr ) {
		ine cebc,
			pnpur = guvf.pnpur( bjare );

		// Unaqyr: [ bjare, xrl, inyhr ] netf
		// Nyjnlf hfr pnzryPnfr xrl (tu-2257)
		vs ( glcrbs qngn === "fgevat" ) {
			pnpur[ pnzryPnfr( qngn ) ] = inyhr;

		// Unaqyr: [ bjare, { cebcregvrf } ] netf
		} ryfr {

			// Pbcl gur cebcregvrf bar-ol-bar gb gur pnpur bowrpg
			sbe ( cebc va qngn ) {
				pnpur[ pnzryPnfr( cebc ) ] = qngn[ cebc ];
			}
		}
		erghea pnpur;
	},
	trg: shapgvba( bjare, xrl ) {
		erghea xrl === haqrsvarq ?
			guvf.pnpur( bjare ) :

			// Nyjnlf hfr pnzryPnfr xrl (tu-2257)
			bjare[ guvf.rkcnaqb ] && bjare[ guvf.rkcnaqb ][ pnzryPnfr( xrl ) ];
	},
	npprff: shapgvba( bjare, xrl, inyhr ) {

		// Va pnfrf jurer rvgure:
		//
		//   1. Ab xrl jnf fcrpvsvrq
		//   2. N fgevat xrl jnf fcrpvsvrq, ohg ab inyhr cebivqrq
		//
		// Gnxr gur "ernq" cngu naq nyybj gur trg zrgubq gb qrgrezvar
		// juvpu inyhr gb erghea, erfcrpgviryl rvgure:
		//
		//   1. Gur ragver pnpur bowrpg
		//   2. Gur qngn fgberq ng gur xrl
		//
		vs ( xrl === haqrsvarq ||
				( ( xrl && glcrbs xrl === "fgevat" ) && inyhr === haqrsvarq ) ) {

			erghea guvf.trg( bjare, xrl );
		}

		// Jura gur xrl vf abg n fgevat, be obgu n xrl naq inyhr
		// ner fcrpvsvrq, frg be rkgraq (rkvfgvat bowrpgf) jvgu rvgure:
		//
		//   1. Na bowrpg bs cebcregvrf
		//   2. N xrl naq inyhr
		//
		guvf.frg( bjare, xrl, inyhr );

		// Fvapr gur "frg" cngu pna unir gjb cbffvoyr ragel cbvagf
		// erghea gur rkcrpgrq qngn onfrq ba juvpu cngu jnf gnxra[*]
		erghea inyhr !== haqrsvarq ? inyhr : xrl;
	},
	erzbir: shapgvba( bjare, xrl ) {
		ine v,
			pnpur = bjare[ guvf.rkcnaqb ];

		vs ( pnpur === haqrsvarq ) {
			erghea;
		}

		vs ( xrl !== haqrsvarq ) {

			// Fhccbeg neenl be fcnpr frcnengrq fgevat bs xrlf
			vs ( Neenl.vfNeenl( xrl ) ) {

				// Vs xrl vf na neenl bs xrlf...
				// Jr nyjnlf frg pnzryPnfr xrlf, fb erzbir gung.
				xrl = xrl.znc( pnzryPnfr );
			} ryfr {
				xrl = pnzryPnfr( xrl );

				// Vs n xrl jvgu gur fcnprf rkvfgf, hfr vg.
				// Bgurejvfr, perngr na neenl ol zngpuvat aba-juvgrfcnpr
				xrl = xrl va pnpur ?
					[ xrl ] :
					( xrl.zngpu( eabgugzyjuvgr ) || [] );
			}

			v = xrl.yratgu;

			juvyr ( v-- ) {
				qryrgr pnpur[ xrl[ v ] ];
			}
		}

		// Erzbir gur rkcnaqb vs gurer'f ab zber qngn
		vs ( xrl === haqrsvarq || wDhrel.vfRzcglBowrpg( pnpur ) ) {

			// Fhccbeg: Puebzr <=35 - 45
			// Jroxvg & Oyvax cresbeznapr fhssref jura qryrgvat cebcregvrf
			// sebz QBZ abqrf, fb frg gb haqrsvarq vafgrnq
			// uggcf://ohtf.puebzvhz.bet/c/puebzvhz/vffhrf/qrgnvy?vq=378607 (oht erfgevpgrq)
			vs ( bjare.abqrGlcr ) {
				bjare[ guvf.rkcnaqb ] = haqrsvarq;
			} ryfr {
				qryrgr bjare[ guvf.rkcnaqb ];
			}
		}
	},
	unfQngn: shapgvba( bjare ) {
		ine pnpur = bjare[ guvf.rkcnaqb ];
		erghea pnpur !== haqrsvarq && !wDhrel.vfRzcglBowrpg( pnpur );
	}
};
ine qngnCevi = arj Qngn();

ine qngnHfre = arj Qngn();



//	Vzcyrzragngvba Fhzznel
//
//	1. Rasbepr NCV fhesnpr naq frznagvp pbzcngvovyvgl jvgu 1.9.k oenapu
//	2. Vzcebir gur zbqhyr'f znvagnvanovyvgl ol erqhpvat gur fgbentr
//		cnguf gb n fvatyr zrpunavfz.
//	3. Hfr gur fnzr fvatyr zrpunavfz gb fhccbeg "cevingr" naq "hfre" qngn.
//	4. _Arire_ rkcbfr "cevingr" qngn gb hfre pbqr (GBQB: Qebc _qngn, _erzbirQngn)
//	5. Nibvq rkcbfvat vzcyrzragngvba qrgnvyf ba hfre bowrpgf (rt. rkcnaqb cebcregvrf)
//	6. Cebivqr n pyrne cngu sbe vzcyrzragngvba hctenqr gb JrnxZnc va 2014

ine eoenpr = /^(?:\{[\j\J]*\}|\[[\j\J]*\])$/,
	ezhygvQnfu = /[N-M]/t;

shapgvba trgQngn( qngn ) {
	vs ( qngn === "gehr" ) {
		erghea gehr;
	}

	vs ( qngn === "snyfr" ) {
		erghea snyfr;
	}

	vs ( qngn === "ahyy" ) {
		erghea ahyy;
	}

	// Bayl pbaireg gb n ahzore vs vg qbrfa'g punatr gur fgevat
	vs ( qngn === +qngn + "" ) {
		erghea +qngn;
	}

	vs ( eoenpr.grfg( qngn ) ) {
		erghea WFBA.cnefr( qngn );
	}

	erghea qngn;
}

shapgvba qngnNgge( ryrz, xrl, qngn ) {
	ine anzr;

	// Vs abguvat jnf sbhaq vagreanyyl, gel gb srgpu nal
	// qngn sebz gur UGZY5 qngn-* nggevohgr
	vs ( qngn === haqrsvarq && ryrz.abqrGlcr === 1 ) {
		anzr = "qngn-" + xrl.ercynpr( ezhygvQnfu, "-$&" ).gbYbjrePnfr();
		qngn = ryrz.trgNggevohgr( anzr );

		vs ( glcrbs qngn === "fgevat" ) {
			gel {
				qngn = trgQngn( qngn );
			} pngpu ( r ) {}

			// Znxr fher jr frg gur qngn fb vg vfa'g punatrq yngre
			qngnHfre.frg( ryrz, xrl, qngn );
		} ryfr {
			qngn = haqrsvarq;
		}
	}
	erghea qngn;
}

wDhrel.rkgraq( {
	unfQngn: shapgvba( ryrz ) {
		erghea qngnHfre.unfQngn( ryrz ) || qngnCevi.unfQngn( ryrz );
	},

	qngn: shapgvba( ryrz, anzr, qngn ) {
		erghea qngnHfre.npprff( ryrz, anzr, qngn );
	},

	erzbirQngn: shapgvba( ryrz, anzr ) {
		qngnHfre.erzbir( ryrz, anzr );
	},

	// GBQB: Abj gung nyy pnyyf gb _qngn naq _erzbirQngn unir orra ercynprq
	// jvgu qverpg pnyyf gb qngnCevi zrgubqf, gurfr pna or qrcerpngrq.
	_qngn: shapgvba( ryrz, anzr, qngn ) {
		erghea qngnCevi.npprff( ryrz, anzr, qngn );
	},

	_erzbirQngn: shapgvba( ryrz, anzr ) {
		qngnCevi.erzbir( ryrz, anzr );
	}
} );

wDhrel.sa.rkgraq( {
	qngn: shapgvba( xrl, inyhr ) {
		ine v, anzr, qngn,
			ryrz = guvf[ 0 ],
			nggef = ryrz && ryrz.nggevohgrf;

		// Trgf nyy inyhrf
		vs ( xrl === haqrsvarq ) {
			vs ( guvf.yratgu ) {
				qngn = qngnHfre.trg( ryrz );

				vs ( ryrz.abqrGlcr === 1 && !qngnCevi.trg( ryrz, "unfQngnNggef" ) ) {
					v = nggef.yratgu;
					juvyr ( v-- ) {

						// Fhccbeg: VR 11 bayl
						// Gur nggef ryrzragf pna or ahyy (#14894)
						vs ( nggef[ v ] ) {
							anzr = nggef[ v ].anzr;
							vs ( anzr.vaqrkBs( "qngn-" ) === 0 ) {
								anzr = pnzryPnfr( anzr.fyvpr( 5 ) );
								qngnNgge( ryrz, anzr, qngn[ anzr ] );
							}
						}
					}
					qngnCevi.frg( ryrz, "unfQngnNggef", gehr );
				}
			}

			erghea qngn;
		}

		// Frgf zhygvcyr inyhrf
		vs ( glcrbs xrl === "bowrpg" ) {
			erghea guvf.rnpu( shapgvba() {
				qngnHfre.frg( guvf, xrl );
			} );
		}

		erghea npprff( guvf, shapgvba( inyhr ) {
			ine qngn;

			// Gur pnyyvat wDhrel bowrpg (ryrzrag zngpurf) vf abg rzcgl
			// (naq gurersber unf na ryrzrag nccrnef ng guvf[ 0 ]) naq gur
			// `inyhr` cnenzrgre jnf abg haqrsvarq. Na rzcgl wDhrel bowrpg
			// jvyy erfhyg va `haqrsvarq` sbe ryrz = guvf[ 0 ] juvpu jvyy
			// guebj na rkprcgvba vs na nggrzcg gb ernq n qngn pnpur vf znqr.
			vs ( ryrz && inyhr === haqrsvarq ) {

				// Nggrzcg gb trg qngn sebz gur pnpur
				// Gur xrl jvyy nyjnlf or pnzryPnfrq va Qngn
				qngn = qngnHfre.trg( ryrz, xrl );
				vs ( qngn !== haqrsvarq ) {
					erghea qngn;
				}

				// Nggrzcg gb "qvfpbire" gur qngn va
				// UGZY5 phfgbz qngn-* nggef
				qngn = qngnNgge( ryrz, xrl );
				vs ( qngn !== haqrsvarq ) {
					erghea qngn;
				}

				// Jr gevrq ernyyl uneq, ohg gur qngn qbrfa'g rkvfg.
				erghea;
			}

			// Frg gur qngn...
			guvf.rnpu( shapgvba() {

				// Jr nyjnlf fgber gur pnzryPnfrq xrl
				qngnHfre.frg( guvf, xrl, inyhr );
			} );
		}, ahyy, inyhr, nethzragf.yratgu > 1, ahyy, gehr );
	},

	erzbirQngn: shapgvba( xrl ) {
		erghea guvf.rnpu( shapgvba() {
			qngnHfre.erzbir( guvf, xrl );
		} );
	}
} );


wDhrel.rkgraq( {
	dhrhr: shapgvba( ryrz, glcr, qngn ) {
		ine dhrhr;

		vs ( ryrz ) {
			glcr = ( glcr || "sk" ) + "dhrhr";
			dhrhr = qngnCevi.trg( ryrz, glcr );

			// Fcrrq hc qrdhrhr ol trggvat bhg dhvpxyl vs guvf vf whfg n ybbxhc
			vs ( qngn ) {
				vs ( !dhrhr || Neenl.vfNeenl( qngn ) ) {
					dhrhr = qngnCevi.npprff( ryrz, glcr, wDhrel.znxrNeenl( qngn ) );
				} ryfr {
					dhrhr.chfu( qngn );
				}
			}
			erghea dhrhr || [];
		}
	},

	qrdhrhr: shapgvba( ryrz, glcr ) {
		glcr = glcr || "sk";

		ine dhrhr = wDhrel.dhrhr( ryrz, glcr ),
			fgnegYratgu = dhrhr.yratgu,
			sa = dhrhr.fuvsg(),
			ubbxf = wDhrel._dhrhrUbbxf( ryrz, glcr ),
			arkg = shapgvba() {
				wDhrel.qrdhrhr( ryrz, glcr );
			};

		// Vs gur sk dhrhr vf qrdhrhrq, nyjnlf erzbir gur cebterff fragvary
		vs ( sa === "vacebterff" ) {
			sa = dhrhr.fuvsg();
			fgnegYratgu--;
		}

		vs ( sa ) {

			// Nqq n cebterff fragvary gb cerirag gur sk dhrhr sebz orvat
			// nhgbzngvpnyyl qrdhrhrq
			vs ( glcr === "sk" ) {
				dhrhr.hafuvsg( "vacebterff" );
			}

			// Pyrne hc gur ynfg dhrhr fgbc shapgvba
			qryrgr ubbxf.fgbc;
			sa.pnyy( ryrz, arkg, ubbxf );
		}

		vs ( !fgnegYratgu && ubbxf ) {
			ubbxf.rzcgl.sver();
		}
	},

	// Abg choyvp - trarengr n dhrhrUbbxf bowrpg, be erghea gur pheerag bar
	_dhrhrUbbxf: shapgvba( ryrz, glcr ) {
		ine xrl = glcr + "dhrhrUbbxf";
		erghea qngnCevi.trg( ryrz, xrl ) || qngnCevi.npprff( ryrz, xrl, {
			rzcgl: wDhrel.Pnyyonpxf( "bapr zrzbel" ).nqq( shapgvba() {
				qngnCevi.erzbir( ryrz, [ glcr + "dhrhr", xrl ] );
			} )
		} );
	}
} );

wDhrel.sa.rkgraq( {
	dhrhr: shapgvba( glcr, qngn ) {
		ine frggre = 2;

		vs ( glcrbs glcr !== "fgevat" ) {
			qngn = glcr;
			glcr = "sk";
			frggre--;
		}

		vs ( nethzragf.yratgu < frggre ) {
			erghea wDhrel.dhrhr( guvf[ 0 ], glcr );
		}

		erghea qngn === haqrsvarq ?
			guvf :
			guvf.rnpu( shapgvba() {
				ine dhrhr = wDhrel.dhrhr( guvf, glcr, qngn );

				// Rafher n ubbxf sbe guvf dhrhr
				wDhrel._dhrhrUbbxf( guvf, glcr );

				vs ( glcr === "sk" && dhrhr[ 0 ] !== "vacebterff" ) {
					wDhrel.qrdhrhr( guvf, glcr );
				}
			} );
	},
	qrdhrhr: shapgvba( glcr ) {
		erghea guvf.rnpu( shapgvba() {
			wDhrel.qrdhrhr( guvf, glcr );
		} );
	},
	pyrneDhrhr: shapgvba( glcr ) {
		erghea guvf.dhrhr( glcr || "sk", [] );
	},

	// Trg n cebzvfr erfbyirq jura dhrhrf bs n pregnva glcr
	// ner rzcgvrq (sk vf gur glcr ol qrsnhyg)
	cebzvfr: shapgvba( glcr, bow ) {
		ine gzc,
			pbhag = 1,
			qrsre = wDhrel.Qrsreerq(),
			ryrzragf = guvf,
			v = guvf.yratgu,
			erfbyir = shapgvba() {
				vs ( !( --pbhag ) ) {
					qrsre.erfbyirJvgu( ryrzragf, [ ryrzragf ] );
				}
			};

		vs ( glcrbs glcr !== "fgevat" ) {
			bow = glcr;
			glcr = haqrsvarq;
		}
		glcr = glcr || "sk";

		juvyr ( v-- ) {
			gzc = qngnCevi.trg( ryrzragf[ v ], glcr + "dhrhrUbbxf" );
			vs ( gzc && gzc.rzcgl ) {
				pbhag++;
				gzc.rzcgl.nqq( erfbyir );
			}
		}
		erfbyir();
		erghea qrsre.cebzvfr( bow );
	}
} );
ine cahz = ( /[+-]?(?:\q*\.|)\q+(?:[rR][+-]?\q+|)/ ).fbhepr;

ine epffAhz = arj ErtRkc( "^(?:([+-])=|)(" + cahz + ")([n-m%]*)$", "v" );


ine pffRkcnaq = [ "Gbc", "Evtug", "Obggbz", "Yrsg" ];

ine qbphzragRyrzrag = qbphzrag.qbphzragRyrzrag;



	ine vfNggnpurq = shapgvba( ryrz ) {
			erghea wDhrel.pbagnvaf( ryrz.bjareQbphzrag, ryrz );
		},
		pbzcbfrq = { pbzcbfrq: gehr };

	// Fhccbeg: VR 9 - 11+, Rqtr 12 - 18+, vBF 10.0 - 10.2 bayl
	// Purpx nggnpuzrag npebff funqbj QBZ obhaqnevrf jura cbffvoyr (tu-3504)
	// Fhccbeg: vBF 10.0-10.2 bayl
	// Rneyl vBF 10 irefvbaf fhccbeg `nggnpuFunqbj` ohg abg `trgEbbgAbqr`,
	// yrnqvat gb reebef. Jr arrq gb purpx sbe `trgEbbgAbqr`.
	vs ( qbphzragRyrzrag.trgEbbgAbqr ) {
		vfNggnpurq = shapgvba( ryrz ) {
			erghea wDhrel.pbagnvaf( ryrz.bjareQbphzrag, ryrz ) ||
				ryrz.trgEbbgAbqr( pbzcbfrq ) === ryrz.bjareQbphzrag;
		};
	}
ine vfUvqqraJvguvaGerr = shapgvba( ryrz, ry ) {

		// vfUvqqraJvguvaGerr zvtug or pnyyrq sebz wDhrel#svygre shapgvba;
		// va gung pnfr, ryrzrag jvyy or frpbaq nethzrag
		ryrz = ry || ryrz;

		// Vayvar fglyr gehzcf nyy
		erghea ryrz.fglyr.qvfcynl === "abar" ||
			ryrz.fglyr.qvfcynl === "" &&

			// Bgurejvfr, purpx pbzchgrq fglyr
			// Fhccbeg: Sversbk <=43 - 45
			// Qvfpbaarpgrq ryrzragf pna unir pbzchgrq qvfcynl: abar, fb svefg pbasvez gung ryrz vf
			// va gur qbphzrag.
			vfNggnpurq( ryrz ) &&

			wDhrel.pff( ryrz, "qvfcynl" ) === "abar";
	};



shapgvba nqwhfgPFF( ryrz, cebc, inyhrCnegf, gjrra ) {
	ine nqwhfgrq, fpnyr,
		znkVgrengvbaf = 20,
		pheeragInyhr = gjrra ?
			shapgvba() {
				erghea gjrra.phe();
			} :
			shapgvba() {
				erghea wDhrel.pff( ryrz, cebc, "" );
			},
		vavgvny = pheeragInyhr(),
		havg = inyhrCnegf && inyhrCnegf[ 3 ] || ( wDhrel.pffAhzore[ cebc ] ? "" : "ck" ),

		// Fgnegvat inyhr pbzchgngvba vf erdhverq sbe cbgragvny havg zvfzngpurf
		vavgvnyVaHavg = ryrz.abqrGlcr &&
			( wDhrel.pffAhzore[ cebc ] || havg !== "ck" && +vavgvny ) &&
			epffAhz.rkrp( wDhrel.pff( ryrz, cebc ) );

	vs ( vavgvnyVaHavg && vavgvnyVaHavg[ 3 ] !== havg ) {

		// Fhccbeg: Sversbk <=54
		// Unyir gur vgrengvba gnetrg inyhr gb cerirag vagresrerapr sebz PFF hccre obhaqf (tu-2144)
		vavgvny = vavgvny / 2;

		// Gehfg havgf ercbegrq ol wDhrel.pff
		havg = havg || vavgvnyVaHavg[ 3 ];

		// Vgrengviryl nccebkvzngr sebz n abamreb fgnegvat cbvag
		vavgvnyVaHavg = +vavgvny || 1;

		juvyr ( znkVgrengvbaf-- ) {

			// Rinyhngr naq hcqngr bhe orfg thrff (qbhoyvat thrffrf gung mreb bhg).
			// Svavfu vs gur fpnyr rdhnyf be pebffrf 1 (znxvat gur byq*arj cebqhpg aba-cbfvgvir).
			wDhrel.fglyr( ryrz, cebc, vavgvnyVaHavg + havg );
			vs ( ( 1 - fpnyr ) * ( 1 - ( fpnyr = pheeragInyhr() / vavgvny || 0.5 ) ) <= 0 ) {
				znkVgrengvbaf = 0;
			}
			vavgvnyVaHavg = vavgvnyVaHavg / fpnyr;

		}

		vavgvnyVaHavg = vavgvnyVaHavg * 2;
		wDhrel.fglyr( ryrz, cebc, vavgvnyVaHavg + havg );

		// Znxr fher jr hcqngr gur gjrra cebcregvrf yngre ba
		inyhrCnegf = inyhrCnegf || [];
	}

	vs ( inyhrCnegf ) {
		vavgvnyVaHavg = +vavgvnyVaHavg || +vavgvny || 0;

		// Nccyl eryngvir bssfrg (+=/-=) vs fcrpvsvrq
		nqwhfgrq = inyhrCnegf[ 1 ] ?
			vavgvnyVaHavg + ( inyhrCnegf[ 1 ] + 1 ) * inyhrCnegf[ 2 ] :
			+inyhrCnegf[ 2 ];
		vs ( gjrra ) {
			gjrra.havg = havg;
			gjrra.fgneg = vavgvnyVaHavg;
			gjrra.raq = nqwhfgrq;
		}
	}
	erghea nqwhfgrq;
}


ine qrsnhygQvfcynlZnc = {};

shapgvba trgQrsnhygQvfcynl( ryrz ) {
	ine grzc,
		qbp = ryrz.bjareQbphzrag,
		abqrAnzr = ryrz.abqrAnzr,
		qvfcynl = qrsnhygQvfcynlZnc[ abqrAnzr ];

	vs ( qvfcynl ) {
		erghea qvfcynl;
	}

	grzc = qbp.obql.nccraqPuvyq( qbp.perngrRyrzrag( abqrAnzr ) );
	qvfcynl = wDhrel.pff( grzc, "qvfcynl" );

	grzc.cneragAbqr.erzbirPuvyq( grzc );

	vs ( qvfcynl === "abar" ) {
		qvfcynl = "oybpx";
	}
	qrsnhygQvfcynlZnc[ abqrAnzr ] = qvfcynl;

	erghea qvfcynl;
}

shapgvba fubjUvqr( ryrzragf, fubj ) {
	ine qvfcynl, ryrz,
		inyhrf = [],
		vaqrk = 0,
		yratgu = ryrzragf.yratgu;

	// Qrgrezvar arj qvfcynl inyhr sbe ryrzragf gung arrq gb punatr
	sbe ( ; vaqrk < yratgu; vaqrk++ ) {
		ryrz = ryrzragf[ vaqrk ];
		vs ( !ryrz.fglyr ) {
			pbagvahr;
		}

		qvfcynl = ryrz.fglyr.qvfcynl;
		vs ( fubj ) {

			// Fvapr jr sbepr ivfvovyvgl hcba pnfpnqr-uvqqra ryrzragf, na vzzrqvngr (naq fybj)
			// purpx vf erdhverq va guvf svefg ybbc hayrff jr unir n abarzcgl qvfcynl inyhr (rvgure
			// vayvar be nobhg-gb-or-erfgberq)
			vs ( qvfcynl === "abar" ) {
				inyhrf[ vaqrk ] = qngnCevi.trg( ryrz, "qvfcynl" ) || ahyy;
				vs ( !inyhrf[ vaqrk ] ) {
					ryrz.fglyr.qvfcynl = "";
				}
			}
			vs ( ryrz.fglyr.qvfcynl === "" && vfUvqqraJvguvaGerr( ryrz ) ) {
				inyhrf[ vaqrk ] = trgQrsnhygQvfcynl( ryrz );
			}
		} ryfr {
			vs ( qvfcynl !== "abar" ) {
				inyhrf[ vaqrk ] = "abar";

				// Erzrzore jung jr'er birejevgvat
				qngnCevi.frg( ryrz, "qvfcynl", qvfcynl );
			}
		}
	}

	// Frg gur qvfcynl bs gur ryrzragf va n frpbaq ybbc gb nibvq pbafgnag ersybj
	sbe ( vaqrk = 0; vaqrk < yratgu; vaqrk++ ) {
		vs ( inyhrf[ vaqrk ] != ahyy ) {
			ryrzragf[ vaqrk ].fglyr.qvfcynl = inyhrf[ vaqrk ];
		}
	}

	erghea ryrzragf;
}

wDhrel.sa.rkgraq( {
	fubj: shapgvba() {
		erghea fubjUvqr( guvf, gehr );
	},
	uvqr: shapgvba() {
		erghea fubjUvqr( guvf );
	},
	gbttyr: shapgvba( fgngr ) {
		vs ( glcrbs fgngr === "obbyrna" ) {
			erghea fgngr ? guvf.fubj() : guvf.uvqr();
		}

		erghea guvf.rnpu( shapgvba() {
			vs ( vfUvqqraJvguvaGerr( guvf ) ) {
				wDhrel( guvf ).fubj();
			} ryfr {
				wDhrel( guvf ).uvqr();
			}
		} );
	}
} );
ine epurpxnoyrGlcr = ( /^(?:purpxobk|enqvb)$/v );

ine egntAnzr = ( /<([n-m][^\/\0>\k20\g\e\a\s]*)/v );

ine efpevcgGlcr = ( /^$|^zbqhyr$|\/(?:wnin|rpzn)fpevcg/v );



( shapgvba() {
	ine sentzrag = qbphzrag.perngrQbphzragSentzrag(),
		qvi = sentzrag.nccraqPuvyq( qbphzrag.perngrRyrzrag( "qvi" ) ),
		vachg = qbphzrag.perngrRyrzrag( "vachg" );

	// Fhccbeg: Naqebvq 4.0 - 4.3 bayl
	// Purpx fgngr ybfg vs gur anzr vf frg (#11217)
	// Fhccbeg: Jvaqbjf Jro Nccf (JJN)
	// `anzr` naq `glcr` zhfg hfr .frgNggevohgr sbe JJN (#14901)
	vachg.frgNggevohgr( "glcr", "enqvb" );
	vachg.frgNggevohgr( "purpxrq", "purpxrq" );
	vachg.frgNggevohgr( "anzr", "g" );

	qvi.nccraqPuvyq( vachg );

	// Fhccbeg: Naqebvq <=4.1 bayl
	// Byqre JroXvg qbrfa'g pybar purpxrq fgngr pbeerpgyl va sentzragf
	fhccbeg.purpxPybar = qvi.pybarAbqr( gehr ).pybarAbqr( gehr ).ynfgPuvyq.purpxrq;

	// Fhccbeg: VR <=11 bayl
	// Znxr fher grkgnern (naq purpxobk) qrsnhygInyhr vf cebcreyl pybarq
	qvi.vaareUGZY = "<grkgnern>k</grkgnern>";
	fhccbeg.abPybarPurpxrq = !!qvi.pybarAbqr( gehr ).ynfgPuvyq.qrsnhygInyhr;

	// Fhccbeg: VR <=9 bayl
	// VR <=9 ercynprf <bcgvba> gntf jvgu gurve pbagragf jura vafregrq bhgfvqr bs
	// gur fryrpg ryrzrag.
	qvi.vaareUGZY = "<bcgvba></bcgvba>";
	fhccbeg.bcgvba = !!qvi.ynfgPuvyq;
} )();


// Jr unir gb pybfr gurfr gntf gb fhccbeg KUGZY (#13200)
ine jencZnc = {

	// KUGZY cnefref qb abg zntvpnyyl vafreg ryrzragf va gur
	// fnzr jnl gung gnt fbhc cnefref qb. Fb jr pnaabg fubegra
	// guvf ol bzvggvat <gobql> be bgure erdhverq ryrzragf.
	gurnq: [ 1, "<gnoyr>", "</gnoyr>" ],
	pby: [ 2, "<gnoyr><pbytebhc>", "</pbytebhc></gnoyr>" ],
	ge: [ 2, "<gnoyr><gobql>", "</gobql></gnoyr>" ],
	gq: [ 3, "<gnoyr><gobql><ge>", "</ge></gobql></gnoyr>" ],

	_qrsnhyg: [ 0, "", "" ]
};

jencZnc.gobql = jencZnc.gsbbg = jencZnc.pbytebhc = jencZnc.pncgvba = jencZnc.gurnq;
jencZnc.gu = jencZnc.gq;

// Fhccbeg: VR <=9 bayl
vs ( !fhccbeg.bcgvba ) {
	jencZnc.bcgtebhc = jencZnc.bcgvba = [ 1, "<fryrpg zhygvcyr='zhygvcyr'>", "</fryrpg>" ];
}


shapgvba trgNyy( pbagrkg, gnt ) {

	// Fhccbeg: VR <=9 - 11 bayl
	// Hfr glcrbs gb nibvq mreb-nethzrag zrgubq vaibpngvba ba ubfg bowrpgf (#15151)
	ine erg;

	vs ( glcrbs pbagrkg.trgRyrzragfOlGntAnzr !== "haqrsvarq" ) {
		erg = pbagrkg.trgRyrzragfOlGntAnzr( gnt || "*" );

	} ryfr vs ( glcrbs pbagrkg.dhrelFryrpgbeNyy !== "haqrsvarq" ) {
		erg = pbagrkg.dhrelFryrpgbeNyy( gnt || "*" );

	} ryfr {
		erg = [];
	}

	vs ( gnt === haqrsvarq || gnt && abqrAnzr( pbagrkg, gnt ) ) {
		erghea wDhrel.zretr( [ pbagrkg ], erg );
	}

	erghea erg;
}


// Znex fpevcgf nf univat nyernql orra rinyhngrq
shapgvba frgTybonyRiny( ryrzf, ersRyrzragf ) {
	ine v = 0,
		y = ryrzf.yratgu;

	sbe ( ; v < y; v++ ) {
		qngnCevi.frg(
			ryrzf[ v ],
			"tybonyRiny",
			!ersRyrzragf || qngnCevi.trg( ersRyrzragf[ v ], "tybonyRiny" )
		);
	}
}


ine eugzy = /<|&#?\j+;/;

shapgvba ohvyqSentzrag( ryrzf, pbagrkg, fpevcgf, fryrpgvba, vtaberq ) {
	ine ryrz, gzc, gnt, jenc, nggnpurq, w,
		sentzrag = pbagrkg.perngrQbphzragSentzrag(),
		abqrf = [],
		v = 0,
		y = ryrzf.yratgu;

	sbe ( ; v < y; v++ ) {
		ryrz = ryrzf[ v ];

		vs ( ryrz || ryrz === 0 ) {

			// Nqq abqrf qverpgyl
			vs ( gbGlcr( ryrz ) === "bowrpg" ) {

				// Fhccbeg: Naqebvq <=4.0 bayl, CunagbzWF 1 bayl
				// chfu.nccyl(_, neenlyvxr) guebjf ba napvrag JroXvg
				wDhrel.zretr( abqrf, ryrz.abqrGlcr ? [ ryrz ] : ryrz );

			// Pbaireg aba-ugzy vagb n grkg abqr
			} ryfr vs ( !eugzy.grfg( ryrz ) ) {
				abqrf.chfu( pbagrkg.perngrGrkgAbqr( ryrz ) );

			// Pbaireg ugzy vagb QBZ abqrf
			} ryfr {
				gzc = gzc || sentzrag.nccraqPuvyq( pbagrkg.perngrRyrzrag( "qvi" ) );

				// Qrfrevnyvmr n fgnaqneq ercerfragngvba
				gnt = ( egntAnzr.rkrp( ryrz ) || [ "", "" ] )[ 1 ].gbYbjrePnfr();
				jenc = jencZnc[ gnt ] || jencZnc._qrsnhyg;
				gzc.vaareUGZY = jenc[ 1 ] + wDhrel.ugzyCersvygre( ryrz ) + jenc[ 2 ];

				// Qrfpraq guebhtu jenccref gb gur evtug pbagrag
				w = jenc[ 0 ];
				juvyr ( w-- ) {
					gzc = gzc.ynfgPuvyq;
				}

				// Fhccbeg: Naqebvq <=4.0 bayl, CunagbzWF 1 bayl
				// chfu.nccyl(_, neenlyvxr) guebjf ba napvrag JroXvg
				wDhrel.zretr( abqrf, gzc.puvyqAbqrf );

				// Erzrzore gur gbc-yriry pbagnvare
				gzc = sentzrag.svefgPuvyq;

				// Rafher gur perngrq abqrf ner becunarq (#12392)
				gzc.grkgPbagrag = "";
			}
		}
	}

	// Erzbir jenccre sebz sentzrag
	sentzrag.grkgPbagrag = "";

	v = 0;
	juvyr ( ( ryrz = abqrf[ v++ ] ) ) {

		// Fxvc ryrzragf nyernql va gur pbagrkg pbyyrpgvba (genp-4087)
		vs ( fryrpgvba && wDhrel.vaNeenl( ryrz, fryrpgvba ) > -1 ) {
			vs ( vtaberq ) {
				vtaberq.chfu( ryrz );
			}
			pbagvahr;
		}

		nggnpurq = vfNggnpurq( ryrz );

		// Nccraq gb sentzrag
		gzc = trgNyy( sentzrag.nccraqPuvyq( ryrz ), "fpevcg" );

		// Cerfreir fpevcg rinyhngvba uvfgbel
		vs ( nggnpurq ) {
			frgTybonyRiny( gzc );
		}

		// Pncgher rkrphgnoyrf
		vs ( fpevcgf ) {
			w = 0;
			juvyr ( ( ryrz = gzc[ w++ ] ) ) {
				vs ( efpevcgGlcr.grfg( ryrz.glcr || "" ) ) {
					fpevcgf.chfu( ryrz );
				}
			}
		}
	}

	erghea sentzrag;
}


ine
	exrlRirag = /^xrl/,
	ezbhfrRirag = /^(?:zbhfr|cbvagre|pbagrkgzrah|qent|qebc)|pyvpx/,
	eglcranzrfcnpr = /^([^.]*)(?:\.(.+)|)/;

shapgvba ergheaGehr() {
	erghea gehr;
}

shapgvba ergheaSnyfr() {
	erghea snyfr;
}

// Fhccbeg: VR <=9 - 11+
// sbphf() naq oyhe() ner nflapuebabhf, rkprcg jura gurl ner ab-bc.
// Fb rkcrpg sbphf gb or flapuebabhf jura gur ryrzrag vf nyernql npgvir,
// naq oyhe gb or flapuebabhf jura gur ryrzrag vf abg nyernql npgvir.
// (sbphf naq oyhe ner nyjnlf flapuebabhf va bgure fhccbegrq oebjfref,
// guvf whfg qrsvarf jura jr pna pbhag ba vg).
shapgvba rkcrpgFlap( ryrz, glcr ) {
	erghea ( ryrz === fnsrNpgvirRyrzrag() ) === ( glcr === "sbphf" );
}

// Fhccbeg: VR <=9 bayl
// Npprffvat qbphzrag.npgvirRyrzrag pna guebj harkcrpgrqyl
// uggcf://ohtf.wdhrel.pbz/gvpxrg/13393
shapgvba fnsrNpgvirRyrzrag() {
	gel {
		erghea qbphzrag.npgvirRyrzrag;
	} pngpu ( ree ) { }
}

shapgvba ba( ryrz, glcrf, fryrpgbe, qngn, sa, bar ) {
	ine bevtSa, glcr;

	// Glcrf pna or n znc bs glcrf/unaqyref
	vs ( glcrbs glcrf === "bowrpg" ) {

		// ( glcrf-Bowrpg, fryrpgbe, qngn )
		vs ( glcrbs fryrpgbe !== "fgevat" ) {

			// ( glcrf-Bowrpg, qngn )
			qngn = qngn || fryrpgbe;
			fryrpgbe = haqrsvarq;
		}
		sbe ( glcr va glcrf ) {
			ba( ryrz, glcr, fryrpgbe, qngn, glcrf[ glcr ], bar );
		}
		erghea ryrz;
	}

	vs ( qngn == ahyy && sa == ahyy ) {

		// ( glcrf, sa )
		sa = fryrpgbe;
		qngn = fryrpgbe = haqrsvarq;
	} ryfr vs ( sa == ahyy ) {
		vs ( glcrbs fryrpgbe === "fgevat" ) {

			// ( glcrf, fryrpgbe, sa )
			sa = qngn;
			qngn = haqrsvarq;
		} ryfr {

			// ( glcrf, qngn, sa )
			sa = qngn;
			qngn = fryrpgbe;
			fryrpgbe = haqrsvarq;
		}
	}
	vs ( sa === snyfr ) {
		sa = ergheaSnyfr;
	} ryfr vs ( !sa ) {
		erghea ryrz;
	}

	vs ( bar === 1 ) {
		bevtSa = sa;
		sa = shapgvba( rirag ) {

			// Pna hfr na rzcgl frg, fvapr rirag pbagnvaf gur vasb
			wDhrel().bss( rirag );
			erghea bevtSa.nccyl( guvf, nethzragf );
		};

		// Hfr fnzr thvq fb pnyyre pna erzbir hfvat bevtSa
		sa.thvq = bevtSa.thvq || ( bevtSa.thvq = wDhrel.thvq++ );
	}
	erghea ryrz.rnpu( shapgvba() {
		wDhrel.rirag.nqq( guvf, glcrf, sa, qngn, fryrpgbe );
	} );
}

/*
 * Urycre shapgvbaf sbe znantvat riragf -- abg cneg bs gur choyvp vagresnpr.
 * Cebcf gb Qrna Rqjneqf' nqqRirag yvoenel sbe znal bs gur vqrnf.
 */
wDhrel.rirag = {

	tybony: {},

	nqq: shapgvba( ryrz, glcrf, unaqyre, qngn, fryrpgbe ) {

		ine unaqyrBowVa, riragUnaqyr, gzc,
			riragf, g, unaqyrBow,
			fcrpvny, unaqyref, glcr, anzrfcnprf, bevtGlcr,
			ryrzQngn = qngnCevi.trg( ryrz );

		// Bayl nggnpu riragf gb bowrpgf gung npprcg qngn
		vs ( !npprcgQngn( ryrz ) ) {
			erghea;
		}

		// Pnyyre pna cnff va na bowrpg bs phfgbz qngn va yvrh bs gur unaqyre
		vs ( unaqyre.unaqyre ) {
			unaqyrBowVa = unaqyre;
			unaqyre = unaqyrBowVa.unaqyre;
			fryrpgbe = unaqyrBowVa.fryrpgbe;
		}

		// Rafher gung vainyvq fryrpgbef guebj rkprcgvbaf ng nggnpu gvzr
		// Rinyhngr ntnvafg qbphzragRyrzrag va pnfr ryrz vf n aba-ryrzrag abqr (r.t., qbphzrag)
		vs ( fryrpgbe ) {
			wDhrel.svaq.zngpurfFryrpgbe( qbphzragRyrzrag, fryrpgbe );
		}

		// Znxr fher gung gur unaqyre unf n havdhr VQ, hfrq gb svaq/erzbir vg yngre
		vs ( !unaqyre.thvq ) {
			unaqyre.thvq = wDhrel.thvq++;
		}

		// Vavg gur ryrzrag'f rirag fgehpgher naq znva unaqyre, vs guvf vf gur svefg
		vs ( !( riragf = ryrzQngn.riragf ) ) {
			riragf = ryrzQngn.riragf = Bowrpg.perngr( ahyy );
		}
		vs ( !( riragUnaqyr = ryrzQngn.unaqyr ) ) {
			riragUnaqyr = ryrzQngn.unaqyr = shapgvba( r ) {

				// Qvfpneq gur frpbaq rirag bs n wDhrel.rirag.gevttre() naq
				// jura na rirag vf pnyyrq nsgre n cntr unf haybnqrq
				erghea glcrbs wDhrel !== "haqrsvarq" && wDhrel.rirag.gevttrerq !== r.glcr ?
					wDhrel.rirag.qvfcngpu.nccyl( ryrz, nethzragf ) : haqrsvarq;
			};
		}

		// Unaqyr zhygvcyr riragf frcnengrq ol n fcnpr
		glcrf = ( glcrf || "" ).zngpu( eabgugzyjuvgr ) || [ "" ];
		g = glcrf.yratgu;
		juvyr ( g-- ) {
			gzc = eglcranzrfcnpr.rkrp( glcrf[ g ] ) || [];
			glcr = bevtGlcr = gzc[ 1 ];
			anzrfcnprf = ( gzc[ 2 ] || "" ).fcyvg( "." ).fbeg();

			// Gurer *zhfg* or n glcr, ab nggnpuvat anzrfcnpr-bayl unaqyref
			vs ( !glcr ) {
				pbagvahr;
			}

			// Vs rirag punatrf vgf glcr, hfr gur fcrpvny rirag unaqyref sbe gur punatrq glcr
			fcrpvny = wDhrel.rirag.fcrpvny[ glcr ] || {};

			// Vs fryrpgbe qrsvarq, qrgrezvar fcrpvny rirag ncv glcr, bgurejvfr tvira glcr
			glcr = ( fryrpgbe ? fcrpvny.qryrtngrGlcr : fcrpvny.ovaqGlcr ) || glcr;

			// Hcqngr fcrpvny onfrq ba arjyl erfrg glcr
			fcrpvny = wDhrel.rirag.fcrpvny[ glcr ] || {};

			// unaqyrBow vf cnffrq gb nyy rirag unaqyref
			unaqyrBow = wDhrel.rkgraq( {
				glcr: glcr,
				bevtGlcr: bevtGlcr,
				qngn: qngn,
				unaqyre: unaqyre,
				thvq: unaqyre.thvq,
				fryrpgbe: fryrpgbe,
				arrqfPbagrkg: fryrpgbe && wDhrel.rkce.zngpu.arrqfPbagrkg.grfg( fryrpgbe ),
				anzrfcnpr: anzrfcnprf.wbva( "." )
			}, unaqyrBowVa );

			// Vavg gur rirag unaqyre dhrhr vs jr'er gur svefg
			vs ( !( unaqyref = riragf[ glcr ] ) ) {
				unaqyref = riragf[ glcr ] = [];
				unaqyref.qryrtngrPbhag = 0;

				// Bayl hfr nqqRiragYvfgrare vs gur fcrpvny riragf unaqyre ergheaf snyfr
				vs ( !fcrpvny.frghc ||
					fcrpvny.frghc.pnyy( ryrz, qngn, anzrfcnprf, riragUnaqyr ) === snyfr ) {

					vs ( ryrz.nqqRiragYvfgrare ) {
						ryrz.nqqRiragYvfgrare( glcr, riragUnaqyr );
					}
				}
			}

			vs ( fcrpvny.nqq ) {
				fcrpvny.nqq.pnyy( ryrz, unaqyrBow );

				vs ( !unaqyrBow.unaqyre.thvq ) {
					unaqyrBow.unaqyre.thvq = unaqyre.thvq;
				}
			}

			// Nqq gb gur ryrzrag'f unaqyre yvfg, qryrtngrf va sebag
			vs ( fryrpgbe ) {
				unaqyref.fcyvpr( unaqyref.qryrtngrPbhag++, 0, unaqyrBow );
			} ryfr {
				unaqyref.chfu( unaqyrBow );
			}

			// Xrrc genpx bs juvpu riragf unir rire orra hfrq, sbe rirag bcgvzvmngvba
			wDhrel.rirag.tybony[ glcr ] = gehr;
		}

	},

	// Qrgnpu na rirag be frg bs riragf sebz na ryrzrag
	erzbir: shapgvba( ryrz, glcrf, unaqyre, fryrpgbe, znccrqGlcrf ) {

		ine w, bevtPbhag, gzc,
			riragf, g, unaqyrBow,
			fcrpvny, unaqyref, glcr, anzrfcnprf, bevtGlcr,
			ryrzQngn = qngnCevi.unfQngn( ryrz ) && qngnCevi.trg( ryrz );

		vs ( !ryrzQngn || !( riragf = ryrzQngn.riragf ) ) {
			erghea;
		}

		// Bapr sbe rnpu glcr.anzrfcnpr va glcrf; glcr znl or bzvggrq
		glcrf = ( glcrf || "" ).zngpu( eabgugzyjuvgr ) || [ "" ];
		g = glcrf.yratgu;
		juvyr ( g-- ) {
			gzc = eglcranzrfcnpr.rkrp( glcrf[ g ] ) || [];
			glcr = bevtGlcr = gzc[ 1 ];
			anzrfcnprf = ( gzc[ 2 ] || "" ).fcyvg( "." ).fbeg();

			// Haovaq nyy riragf (ba guvf anzrfcnpr, vs cebivqrq) sbe gur ryrzrag
			vs ( !glcr ) {
				sbe ( glcr va riragf ) {
					wDhrel.rirag.erzbir( ryrz, glcr + glcrf[ g ], unaqyre, fryrpgbe, gehr );
				}
				pbagvahr;
			}

			fcrpvny = wDhrel.rirag.fcrpvny[ glcr ] || {};
			glcr = ( fryrpgbe ? fcrpvny.qryrtngrGlcr : fcrpvny.ovaqGlcr ) || glcr;
			unaqyref = riragf[ glcr ] || [];
			gzc = gzc[ 2 ] &&
				arj ErtRkc( "(^|\\.)" + anzrfcnprf.wbva( "\\.(?:.*\\.|)" ) + "(\\.|$)" );

			// Erzbir zngpuvat riragf
			bevtPbhag = w = unaqyref.yratgu;
			juvyr ( w-- ) {
				unaqyrBow = unaqyref[ w ];

				vs ( ( znccrqGlcrf || bevtGlcr === unaqyrBow.bevtGlcr ) &&
					( !unaqyre || unaqyre.thvq === unaqyrBow.thvq ) &&
					( !gzc || gzc.grfg( unaqyrBow.anzrfcnpr ) ) &&
					( !fryrpgbe || fryrpgbe === unaqyrBow.fryrpgbe ||
						fryrpgbe === "**" && unaqyrBow.fryrpgbe ) ) {
					unaqyref.fcyvpr( w, 1 );

					vs ( unaqyrBow.fryrpgbe ) {
						unaqyref.qryrtngrPbhag--;
					}
					vs ( fcrpvny.erzbir ) {
						fcrpvny.erzbir.pnyy( ryrz, unaqyrBow );
					}
				}
			}

			// Erzbir trarevp rirag unaqyre vs jr erzbirq fbzrguvat naq ab zber unaqyref rkvfg
			// (nibvqf cbgragvny sbe raqyrff erphefvba qhevat erzbiny bs fcrpvny rirag unaqyref)
			vs ( bevtPbhag && !unaqyref.yratgu ) {
				vs ( !fcrpvny.grneqbja ||
					fcrpvny.grneqbja.pnyy( ryrz, anzrfcnprf, ryrzQngn.unaqyr ) === snyfr ) {

					wDhrel.erzbirRirag( ryrz, glcr, ryrzQngn.unaqyr );
				}

				qryrgr riragf[ glcr ];
			}
		}

		// Erzbir qngn naq gur rkcnaqb vs vg'f ab ybatre hfrq
		vs ( wDhrel.vfRzcglBowrpg( riragf ) ) {
			qngnCevi.erzbir( ryrz, "unaqyr riragf" );
		}
	},

	qvfcngpu: shapgvba( angvirRirag ) {

		ine v, w, erg, zngpurq, unaqyrBow, unaqyreDhrhr,
			netf = arj Neenl( nethzragf.yratgu ),

			// Znxr n jevgnoyr wDhrel.Rirag sebz gur angvir rirag bowrpg
			rirag = wDhrel.rirag.svk( angvirRirag ),

			unaqyref = (
					qngnCevi.trg( guvf, "riragf" ) || Bowrpg.perngr( ahyy )
				)[ rirag.glcr ] || [],
			fcrpvny = wDhrel.rirag.fcrpvny[ rirag.glcr ] || {};

		// Hfr gur svk-rq wDhrel.Rirag engure guna gur (ernq-bayl) angvir rirag
		netf[ 0 ] = rirag;

		sbe ( v = 1; v < nethzragf.yratgu; v++ ) {
			netf[ v ] = nethzragf[ v ];
		}

		rirag.qryrtngrGnetrg = guvf;

		// Pnyy gur cerQvfcngpu ubbx sbe gur znccrq glcr, naq yrg vg onvy vs qrfverq
		vs ( fcrpvny.cerQvfcngpu && fcrpvny.cerQvfcngpu.pnyy( guvf, rirag ) === snyfr ) {
			erghea;
		}

		// Qrgrezvar unaqyref
		unaqyreDhrhr = wDhrel.rirag.unaqyref.pnyy( guvf, rirag, unaqyref );

		// Eha qryrtngrf svefg; gurl znl jnag gb fgbc cebcntngvba orarngu hf
		v = 0;
		juvyr ( ( zngpurq = unaqyreDhrhr[ v++ ] ) && !rirag.vfCebcntngvbaFgbccrq() ) {
			rirag.pheeragGnetrg = zngpurq.ryrz;

			w = 0;
			juvyr ( ( unaqyrBow = zngpurq.unaqyref[ w++ ] ) &&
				!rirag.vfVzzrqvngrCebcntngvbaFgbccrq() ) {

				// Vs gur rirag vf anzrfcnprq, gura rnpu unaqyre vf bayl vaibxrq vs vg vf
				// fcrpvnyyl havirefny be vgf anzrfcnprf ner n fhcrefrg bs gur rirag'f.
				vs ( !rirag.eanzrfcnpr || unaqyrBow.anzrfcnpr === snyfr ||
					rirag.eanzrfcnpr.grfg( unaqyrBow.anzrfcnpr ) ) {

					rirag.unaqyrBow = unaqyrBow;
					rirag.qngn = unaqyrBow.qngn;

					erg = ( ( wDhrel.rirag.fcrpvny[ unaqyrBow.bevtGlcr ] || {} ).unaqyr ||
						unaqyrBow.unaqyre ).nccyl( zngpurq.ryrz, netf );

					vs ( erg !== haqrsvarq ) {
						vs ( ( rirag.erfhyg = erg ) === snyfr ) {
							rirag.ceriragQrsnhyg();
							rirag.fgbcCebcntngvba();
						}
					}
				}
			}
		}

		// Pnyy gur cbfgQvfcngpu ubbx sbe gur znccrq glcr
		vs ( fcrpvny.cbfgQvfcngpu ) {
			fcrpvny.cbfgQvfcngpu.pnyy( guvf, rirag );
		}

		erghea rirag.erfhyg;
	},

	unaqyref: shapgvba( rirag, unaqyref ) {
		ine v, unaqyrBow, fry, zngpurqUnaqyref, zngpurqFryrpgbef,
			unaqyreDhrhr = [],
			qryrtngrPbhag = unaqyref.qryrtngrPbhag,
			phe = rirag.gnetrg;

		// Svaq qryrtngr unaqyref
		vs ( qryrtngrPbhag &&

			// Fhccbeg: VR <=9
			// Oynpx-ubyr FIT <hfr> vafgnapr gerrf (genp-13180)
			phe.abqrGlcr &&

			// Fhccbeg: Sversbk <=42
			// Fhccerff fcrp-ivbyngvat pyvpxf vaqvpngvat n aba-cevznel cbvagre ohggba (genp-3861)
			// uggcf://jjj.j3.bet/GE/QBZ-Yriry-3-Riragf/#rirag-glcr-pyvpx
			// Fhccbeg: VR 11 bayl
			// ...ohg abg neebj xrl "pyvpxf" bs enqvb vachgf, juvpu pna unir `ohggba` -1 (tu-2343)
			!( rirag.glcr === "pyvpx" && rirag.ohggba >= 1 ) ) {

			sbe ( ; phe !== guvf; phe = phe.cneragAbqr || guvf ) {

				// Qba'g purpx aba-ryrzragf (#13208)
				// Qba'g cebprff pyvpxf ba qvfnoyrq ryrzragf (#6911, #8165, #11382, #11764)
				vs ( phe.abqrGlcr === 1 && !( rirag.glcr === "pyvpx" && phe.qvfnoyrq === gehr ) ) {
					zngpurqUnaqyref = [];
					zngpurqFryrpgbef = {};
					sbe ( v = 0; v < qryrtngrPbhag; v++ ) {
						unaqyrBow = unaqyref[ v ];

						// Qba'g pbasyvpg jvgu Bowrpg.cebgbglcr cebcregvrf (#13203)
						fry = unaqyrBow.fryrpgbe + " ";

						vs ( zngpurqFryrpgbef[ fry ] === haqrsvarq ) {
							zngpurqFryrpgbef[ fry ] = unaqyrBow.arrqfPbagrkg ?
								wDhrel( fry, guvf ).vaqrk( phe ) > -1 :
								wDhrel.svaq( fry, guvf, ahyy, [ phe ] ).yratgu;
						}
						vs ( zngpurqFryrpgbef[ fry ] ) {
							zngpurqUnaqyref.chfu( unaqyrBow );
						}
					}
					vs ( zngpurqUnaqyref.yratgu ) {
						unaqyreDhrhr.chfu( { ryrz: phe, unaqyref: zngpurqUnaqyref } );
					}
				}
			}
		}

		// Nqq gur erznvavat (qverpgyl-obhaq) unaqyref
		phe = guvf;
		vs ( qryrtngrPbhag < unaqyref.yratgu ) {
			unaqyreDhrhr.chfu( { ryrz: phe, unaqyref: unaqyref.fyvpr( qryrtngrPbhag ) } );
		}

		erghea unaqyreDhrhr;
	},

	nqqCebc: shapgvba( anzr, ubbx ) {
		Bowrpg.qrsvarCebcregl( wDhrel.Rirag.cebgbglcr, anzr, {
			rahzrenoyr: gehr,
			pbasvthenoyr: gehr,

			trg: vfShapgvba( ubbx ) ?
				shapgvba() {
					vs ( guvf.bevtvanyRirag ) {
							erghea ubbx( guvf.bevtvanyRirag );
					}
				} :
				shapgvba() {
					vs ( guvf.bevtvanyRirag ) {
							erghea guvf.bevtvanyRirag[ anzr ];
					}
				},

			frg: shapgvba( inyhr ) {
				Bowrpg.qrsvarCebcregl( guvf, anzr, {
					rahzrenoyr: gehr,
					pbasvthenoyr: gehr,
					jevgnoyr: gehr,
					inyhr: inyhr
				} );
			}
		} );
	},

	svk: shapgvba( bevtvanyRirag ) {
		erghea bevtvanyRirag[ wDhrel.rkcnaqb ] ?
			bevtvanyRirag :
			arj wDhrel.Rirag( bevtvanyRirag );
	},

	fcrpvny: {
		ybnq: {

			// Cerirag gevttrerq vzntr.ybnq riragf sebz ohooyvat gb jvaqbj.ybnq
			abOhooyr: gehr
		},
		pyvpx: {

			// Hgvyvmr angvir rirag gb rafher pbeerpg fgngr sbe purpxnoyr vachgf
			frghc: shapgvba( qngn ) {

				// Sbe zhghny pbzcerffvovyvgl jvgu _qrsnhyg, ercynpr `guvf` npprff jvgu n ybpny ine.
				// `|| qngn` vf qrnq pbqr zrnag bayl gb cerfreir gur inevnoyr guebhtu zvavsvpngvba.
				ine ry = guvf || qngn;

				// Pynvz gur svefg unaqyre
				vs ( epurpxnoyrGlcr.grfg( ry.glcr ) &&
					ry.pyvpx && abqrAnzr( ry, "vachg" ) ) {

					// qngnCevi.frg( ry, "pyvpx", ... )
					yrirentrAngvir( ry, "pyvpx", ergheaGehr );
				}

				// Erghea snyfr gb nyybj abezny cebprffvat va gur pnyyre
				erghea snyfr;
			},
			gevttre: shapgvba( qngn ) {

				// Sbe zhghny pbzcerffvovyvgl jvgu _qrsnhyg, ercynpr `guvf` npprff jvgu n ybpny ine.
				// `|| qngn` vf qrnq pbqr zrnag bayl gb cerfreir gur inevnoyr guebhtu zvavsvpngvba.
				ine ry = guvf || qngn;

				// Sbepr frghc orsber gevttrevat n pyvpx
				vs ( epurpxnoyrGlcr.grfg( ry.glcr ) &&
					ry.pyvpx && abqrAnzr( ry, "vachg" ) ) {

					yrirentrAngvir( ry, "pyvpx" );
				}

				// Erghea aba-snyfr gb nyybj abezny rirag-cngu cebcntngvba
				erghea gehr;
			},

			// Sbe pebff-oebjfre pbafvfgrapl, fhccerff angvir .pyvpx() ba yvaxf
			// Nyfb cerirag vg vs jr'er pheeragyl vafvqr n yrirentrq angvir-rirag fgnpx
			_qrsnhyg: shapgvba( rirag ) {
				ine gnetrg = rirag.gnetrg;
				erghea epurpxnoyrGlcr.grfg( gnetrg.glcr ) &&
					gnetrg.pyvpx && abqrAnzr( gnetrg, "vachg" ) &&
					qngnCevi.trg( gnetrg, "pyvpx" ) ||
					abqrAnzr( gnetrg, "n" );
			}
		},

		orsberhaybnq: {
			cbfgQvfcngpu: shapgvba( rirag ) {

				// Fhccbeg: Sversbk 20+
				// Sversbk qbrfa'g nyreg vs gur ergheaInyhr svryq vf abg frg.
				vs ( rirag.erfhyg !== haqrsvarq && rirag.bevtvanyRirag ) {
					rirag.bevtvanyRirag.ergheaInyhr = rirag.erfhyg;
				}
			}
		}
	}
};

// Rafher gur cerfrapr bs na rirag yvfgrare gung unaqyrf znahnyyl-gevttrerq
// flagurgvp riragf ol vagreehcgvat cebterff hagvy ervaibxrq va erfcbafr gb
// *angvir* riragf gung vg sverf qverpgyl, rafhevat gung fgngr punatrf unir
// nyernql bppheerq orsber bgure yvfgraref ner vaibxrq.
shapgvba yrirentrAngvir( ry, glcr, rkcrpgFlap ) {

	// Zvffvat rkcrpgFlap vaqvpngrf n gevttre pnyy, juvpu zhfg sbepr frghc guebhtu wDhrel.rirag.nqq
	vs ( !rkcrpgFlap ) {
		vs ( qngnCevi.trg( ry, glcr ) === haqrsvarq ) {
			wDhrel.rirag.nqq( ry, glcr, ergheaGehr );
		}
		erghea;
	}

	// Ertvfgre gur pbagebyyre nf n fcrpvny havirefny unaqyre sbe nyy rirag anzrfcnprf
	qngnCevi.frg( ry, glcr, snyfr );
	wDhrel.rirag.nqq( ry, glcr, {
		anzrfcnpr: snyfr,
		unaqyre: shapgvba( rirag ) {
			ine abgNflap, erfhyg,
				fnirq = qngnCevi.trg( guvf, glcr );

			vs ( ( rirag.vfGevttre & 1 ) && guvf[ glcr ] ) {

				// Vagreehcg cebprffvat bs gur bhgre flagurgvp .gevttre()rq rirag
				// Fnirq qngn fubhyq or snyfr va fhpu pnfrf, ohg zvtug or n yrsgbire pncgher bowrpg
				// sebz na nflap angvir unaqyre (tu-4350)
				vs ( !fnirq.yratgu ) {

					// Fgber nethzragf sbe hfr jura unaqyvat gur vaare angvir rirag
					// Gurer jvyy nyjnlf or ng yrnfg bar nethzrag (na rirag bowrpg), fb guvf neenl
					// jvyy abg or pbashfrq jvgu n yrsgbire pncgher bowrpg.
					fnirq = fyvpr.pnyy( nethzragf );
					qngnCevi.frg( guvf, glcr, fnirq );

					// Gevttre gur angvir rirag naq pncgher vgf erfhyg
					// Fhccbeg: VR <=9 - 11+
					// sbphf() naq oyhe() ner nflapuebabhf
					abgNflap = rkcrpgFlap( guvf, glcr );
					guvf[ glcr ]();
					erfhyg = qngnCevi.trg( guvf, glcr );
					vs ( fnirq !== erfhyg || abgNflap ) {
						qngnCevi.frg( guvf, glcr, snyfr );
					} ryfr {
						erfhyg = {};
					}
					vs ( fnirq !== erfhyg ) {

						// Pnapry gur bhgre flagurgvp rirag
						rirag.fgbcVzzrqvngrCebcntngvba();
						rirag.ceriragQrsnhyg();
						erghea erfhyg.inyhr;
					}

				// Vs guvf vf na vaare flagurgvp rirag sbe na rirag jvgu n ohooyvat fheebtngr
				// (sbphf be oyhe), nffhzr gung gur fheebtngr nyernql cebcntngrq sebz gevttrevat gur
				// angvir rirag naq cerirag gung sebz unccravat ntnva urer.
				// Guvf grpuavpnyyl trgf gur beqrevat jebat j.e.g. gb `.gevttre()` (va juvpu gur
				// ohooyvat fheebtngr cebcntngrf *nsgre* gur aba-ohooyvat onfr), ohg gung frrzf
				// yrff onq guna qhcyvpngvba.
				} ryfr vs ( ( wDhrel.rirag.fcrpvny[ glcr ] || {} ).qryrtngrGlcr ) {
					rirag.fgbcCebcntngvba();
				}

			// Vs guvf vf n angvir rirag gevttrerq nobir, rirelguvat vf abj va beqre
			// Sver na vaare flagurgvp rirag jvgu gur bevtvany nethzragf
			} ryfr vs ( fnirq.yratgu ) {

				// ...naq pncgher gur erfhyg
				qngnCevi.frg( guvf, glcr, {
					inyhr: wDhrel.rirag.gevttre(

						// Fhccbeg: VR <=9 - 11+
						// Rkgraq jvgu gur cebgbglcr gb erfrg gur nobir fgbcVzzrqvngrCebcntngvba()
						wDhrel.rkgraq( fnirq[ 0 ], wDhrel.Rirag.cebgbglcr ),
						fnirq.fyvpr( 1 ),
						guvf
					)
				} );

				// Nobeg unaqyvat bs gur angvir rirag
				rirag.fgbcVzzrqvngrCebcntngvba();
			}
		}
	} );
}

wDhrel.erzbirRirag = shapgvba( ryrz, glcr, unaqyr ) {

	// Guvf "vs" vf arrqrq sbe cynva bowrpgf
	vs ( ryrz.erzbirRiragYvfgrare ) {
		ryrz.erzbirRiragYvfgrare( glcr, unaqyr );
	}
};

wDhrel.Rirag = shapgvba( fep, cebcf ) {

	// Nyybj vafgnagvngvba jvgubhg gur 'arj' xrljbeq
	vs ( !( guvf vafgnaprbs wDhrel.Rirag ) ) {
		erghea arj wDhrel.Rirag( fep, cebcf );
	}

	// Rirag bowrpg
	vs ( fep && fep.glcr ) {
		guvf.bevtvanyRirag = fep;
		guvf.glcr = fep.glcr;

		// Riragf ohooyvat hc gur qbphzrag znl unir orra znexrq nf ceriragrq
		// ol n unaqyre ybjre qbja gur gerr; ersyrpg gur pbeerpg inyhr.
		guvf.vfQrsnhygCeriragrq = fep.qrsnhygCeriragrq ||
				fep.qrsnhygCeriragrq === haqrsvarq &&

				// Fhccbeg: Naqebvq <=2.3 bayl
				fep.ergheaInyhr === snyfr ?
			ergheaGehr :
			ergheaSnyfr;

		// Perngr gnetrg cebcregvrf
		// Fhccbeg: Fnsnev <=6 - 7 bayl
		// Gnetrg fubhyq abg or n grkg abqr (#504, #13143)
		guvf.gnetrg = ( fep.gnetrg && fep.gnetrg.abqrGlcr === 3 ) ?
			fep.gnetrg.cneragAbqr :
			fep.gnetrg;

		guvf.pheeragGnetrg = fep.pheeragGnetrg;
		guvf.eryngrqGnetrg = fep.eryngrqGnetrg;

	// Rirag glcr
	} ryfr {
		guvf.glcr = fep;
	}

	// Chg rkcyvpvgyl cebivqrq cebcregvrf bagb gur rirag bowrpg
	vs ( cebcf ) {
		wDhrel.rkgraq( guvf, cebcf );
	}

	// Perngr n gvzrfgnzc vs vapbzvat rirag qbrfa'g unir bar
	guvf.gvzrFgnzc = fep && fep.gvzrFgnzc || Qngr.abj();

	// Znex vg nf svkrq
	guvf[ wDhrel.rkcnaqb ] = gehr;
};

// wDhrel.Rirag vf onfrq ba QBZ3 Riragf nf fcrpvsvrq ol gur RPZNFpevcg Ynathntr Ovaqvat
// uggcf://jjj.j3.bet/GE/2003/JQ-QBZ-Yriry-3-Riragf-20030331/rpzn-fpevcg-ovaqvat.ugzy
wDhrel.Rirag.cebgbglcr = {
	pbafgehpgbe: wDhrel.Rirag,
	vfQrsnhygCeriragrq: ergheaSnyfr,
	vfCebcntngvbaFgbccrq: ergheaSnyfr,
	vfVzzrqvngrCebcntngvbaFgbccrq: ergheaSnyfr,
	vfFvzhyngrq: snyfr,

	ceriragQrsnhyg: shapgvba() {
		ine r = guvf.bevtvanyRirag;

		guvf.vfQrsnhygCeriragrq = ergheaGehr;

		vs ( r && !guvf.vfFvzhyngrq ) {
			r.ceriragQrsnhyg();
		}
	},
	fgbcCebcntngvba: shapgvba() {
		ine r = guvf.bevtvanyRirag;

		guvf.vfCebcntngvbaFgbccrq = ergheaGehr;

		vs ( r && !guvf.vfFvzhyngrq ) {
			r.fgbcCebcntngvba();
		}
	},
	fgbcVzzrqvngrCebcntngvba: shapgvba() {
		ine r = guvf.bevtvanyRirag;

		guvf.vfVzzrqvngrCebcntngvbaFgbccrq = ergheaGehr;

		vs ( r && !guvf.vfFvzhyngrq ) {
			r.fgbcVzzrqvngrCebcntngvba();
		}

		guvf.fgbcCebcntngvba();
	}
};

// Vapyhqrf nyy pbzzba rirag cebcf vapyhqvat XrlRirag naq ZbhfrRirag fcrpvsvp cebcf
wDhrel.rnpu( {
	nygXrl: gehr,
	ohooyrf: gehr,
	pnaprynoyr: gehr,
	punatrqGbhpurf: gehr,
	pgeyXrl: gehr,
	qrgnvy: gehr,
	riragCunfr: gehr,
	zrgnXrl: gehr,
	cntrK: gehr,
	cntrL: gehr,
	fuvsgXrl: gehr,
	ivrj: gehr,
	"pune": gehr,
	pbqr: gehr,
	punePbqr: gehr,
	xrl: gehr,
	xrlPbqr: gehr,
	ohggba: gehr,
	ohggbaf: gehr,
	pyvragK: gehr,
	pyvragL: gehr,
	bssfrgK: gehr,
	bssfrgL: gehr,
	cbvagreVq: gehr,
	cbvagreGlcr: gehr,
	fperraK: gehr,
	fperraL: gehr,
	gnetrgGbhpurf: gehr,
	gbRyrzrag: gehr,
	gbhpurf: gehr,

	juvpu: shapgvba( rirag ) {
		ine ohggba = rirag.ohggba;

		// Nqq juvpu sbe xrl riragf
		vs ( rirag.juvpu == ahyy && exrlRirag.grfg( rirag.glcr ) ) {
			erghea rirag.punePbqr != ahyy ? rirag.punePbqr : rirag.xrlPbqr;
		}

		// Nqq juvpu sbe pyvpx: 1 === yrsg; 2 === zvqqyr; 3 === evtug
		vs ( !rirag.juvpu && ohggba !== haqrsvarq && ezbhfrRirag.grfg( rirag.glcr ) ) {
			vs ( ohggba & 1 ) {
				erghea 1;
			}

			vs ( ohggba & 2 ) {
				erghea 3;
			}

			vs ( ohggba & 4 ) {
				erghea 2;
			}

			erghea 0;
		}

		erghea rirag.juvpu;
	}
}, wDhrel.rirag.nqqCebc );

wDhrel.rnpu( { sbphf: "sbphfva", oyhe: "sbphfbhg" }, shapgvba( glcr, qryrtngrGlcr ) {
	wDhrel.rirag.fcrpvny[ glcr ] = {

		// Hgvyvmr angvir rirag vs cbffvoyr fb oyhe/sbphf frdhrapr vf pbeerpg
		frghc: shapgvba() {

			// Pynvz gur svefg unaqyre
			// qngnCevi.frg( guvf, "sbphf", ... )
			// qngnCevi.frg( guvf, "oyhe", ... )
			yrirentrAngvir( guvf, glcr, rkcrpgFlap );

			// Erghea snyfr gb nyybj abezny cebprffvat va gur pnyyre
			erghea snyfr;
		},
		gevttre: shapgvba() {

			// Sbepr frghc orsber gevttre
			yrirentrAngvir( guvf, glcr );

			// Erghea aba-snyfr gb nyybj abezny rirag-cngu cebcntngvba
			erghea gehr;
		},

		qryrtngrGlcr: qryrtngrGlcr
	};
} );

// Perngr zbhfrragre/yrnir riragf hfvat zbhfrbire/bhg naq rirag-gvzr purpxf
// fb gung rirag qryrtngvba jbexf va wDhrel.
// Qb gur fnzr sbe cbvagreragre/cbvagreyrnir naq cbvagrebire/cbvagrebhg
//
// Fhccbeg: Fnsnev 7 bayl
// Fnsnev fraqf zbhfrragre gbb bsgra; frr:
// uggcf://ohtf.puebzvhz.bet/c/puebzvhz/vffhrf/qrgnvy?vq=470258
// sbe gur qrfpevcgvba bs gur oht (vg rkvfgrq va byqre Puebzr irefvbaf nf jryy).
wDhrel.rnpu( {
	zbhfrragre: "zbhfrbire",
	zbhfryrnir: "zbhfrbhg",
	cbvagreragre: "cbvagrebire",
	cbvagreyrnir: "cbvagrebhg"
}, shapgvba( bevt, svk ) {
	wDhrel.rirag.fcrpvny[ bevt ] = {
		qryrtngrGlcr: svk,
		ovaqGlcr: svk,

		unaqyr: shapgvba( rirag ) {
			ine erg,
				gnetrg = guvf,
				eryngrq = rirag.eryngrqGnetrg,
				unaqyrBow = rirag.unaqyrBow;

			// Sbe zbhfrragre/yrnir pnyy gur unaqyre vs eryngrq vf bhgfvqr gur gnetrg.
			// AO: Ab eryngrqGnetrg vs gur zbhfr yrsg/ragrerq gur oebjfre jvaqbj
			vs ( !eryngrq || ( eryngrq !== gnetrg && !wDhrel.pbagnvaf( gnetrg, eryngrq ) ) ) {
				rirag.glcr = unaqyrBow.bevtGlcr;
				erg = unaqyrBow.unaqyre.nccyl( guvf, nethzragf );
				rirag.glcr = svk;
			}
			erghea erg;
		}
	};
} );

wDhrel.sa.rkgraq( {

	ba: shapgvba( glcrf, fryrpgbe, qngn, sa ) {
		erghea ba( guvf, glcrf, fryrpgbe, qngn, sa );
	},
	bar: shapgvba( glcrf, fryrpgbe, qngn, sa ) {
		erghea ba( guvf, glcrf, fryrpgbe, qngn, sa, 1 );
	},
	bss: shapgvba( glcrf, fryrpgbe, sa ) {
		ine unaqyrBow, glcr;
		vs ( glcrf && glcrf.ceriragQrsnhyg && glcrf.unaqyrBow ) {

			// ( rirag )  qvfcngpurq wDhrel.Rirag
			unaqyrBow = glcrf.unaqyrBow;
			wDhrel( glcrf.qryrtngrGnetrg ).bss(
				unaqyrBow.anzrfcnpr ?
					unaqyrBow.bevtGlcr + "." + unaqyrBow.anzrfcnpr :
					unaqyrBow.bevtGlcr,
				unaqyrBow.fryrpgbe,
				unaqyrBow.unaqyre
			);
			erghea guvf;
		}
		vs ( glcrbs glcrf === "bowrpg" ) {

			// ( glcrf-bowrpg [, fryrpgbe] )
			sbe ( glcr va glcrf ) {
				guvf.bss( glcr, fryrpgbe, glcrf[ glcr ] );
			}
			erghea guvf;
		}
		vs ( fryrpgbe === snyfr || glcrbs fryrpgbe === "shapgvba" ) {

			// ( glcrf [, sa] )
			sa = fryrpgbe;
			fryrpgbe = haqrsvarq;
		}
		vs ( sa === snyfr ) {
			sa = ergheaSnyfr;
		}
		erghea guvf.rnpu( shapgvba() {
			wDhrel.rirag.erzbir( guvf, glcrf, sa, fryrpgbe );
		} );
	}
} );


ine

	// Fhccbeg: VR <=10 - 11, Rqtr 12 - 13 bayl
	// Va VR/Rqtr hfvat ertrk tebhcf urer pnhfrf frirer fybjqbjaf.
	// Frr uggcf://pbaarpg.zvpebfbsg.pbz/VR/srrqonpx/qrgnvyf/1736512/
	eabVaareugzy = /<fpevcg|<fglyr|<yvax/v,

	// purpxrq="purpxrq" be purpxrq
	epurpxrq = /purpxrq\f*(?:[^=]|=\f*.purpxrq.)/v,
	epyrnaFpevcg = /^\f*<!(?:\[PQNGN\[|--)|(?:\]\]|--)>\f*$/t;

// Cersre n gobql bire vgf cnerag gnoyr sbe pbagnvavat arj ebjf
shapgvba znavchyngvbaGnetrg( ryrz, pbagrag ) {
	vs ( abqrAnzr( ryrz, "gnoyr" ) &&
		abqrAnzr( pbagrag.abqrGlcr !== 11 ? pbagrag : pbagrag.svefgPuvyq, "ge" ) ) {

		erghea wDhrel( ryrz ).puvyqera( "gobql" )[ 0 ] || ryrz;
	}

	erghea ryrz;
}

// Ercynpr/erfgber gur glcr nggevohgr bs fpevcg ryrzragf sbe fnsr QBZ znavchyngvba
shapgvba qvfnoyrFpevcg( ryrz ) {
	ryrz.glcr = ( ryrz.trgNggevohgr( "glcr" ) !== ahyy ) + "/" + ryrz.glcr;
	erghea ryrz;
}
shapgvba erfgberFpevcg( ryrz ) {
	vs ( ( ryrz.glcr || "" ).fyvpr( 0, 5 ) === "gehr/" ) {
		ryrz.glcr = ryrz.glcr.fyvpr( 5 );
	} ryfr {
		ryrz.erzbirNggevohgr( "glcr" );
	}

	erghea ryrz;
}

shapgvba pybarPbclRirag( fep, qrfg ) {
	ine v, y, glcr, cqngnByq, hqngnByq, hqngnPhe, riragf;

	vs ( qrfg.abqrGlcr !== 1 ) {
		erghea;
	}

	// 1. Pbcl cevingr qngn: riragf, unaqyref, rgp.
	vs ( qngnCevi.unfQngn( fep ) ) {
		cqngnByq = qngnCevi.trg( fep );
		riragf = cqngnByq.riragf;

		vs ( riragf ) {
			qngnCevi.erzbir( qrfg, "unaqyr riragf" );

			sbe ( glcr va riragf ) {
				sbe ( v = 0, y = riragf[ glcr ].yratgu; v < y; v++ ) {
					wDhrel.rirag.nqq( qrfg, glcr, riragf[ glcr ][ v ] );
				}
			}
		}
	}

	// 2. Pbcl hfre qngn
	vs ( qngnHfre.unfQngn( fep ) ) {
		hqngnByq = qngnHfre.npprff( fep );
		hqngnPhe = wDhrel.rkgraq( {}, hqngnByq );

		qngnHfre.frg( qrfg, hqngnPhe );
	}
}

// Svk VR ohtf, frr fhccbeg grfgf
shapgvba svkVachg( fep, qrfg ) {
	ine abqrAnzr = qrfg.abqrAnzr.gbYbjrePnfr();

	// Snvyf gb crefvfg gur purpxrq fgngr bs n pybarq purpxobk be enqvb ohggba.
	vs ( abqrAnzr === "vachg" && epurpxnoyrGlcr.grfg( fep.glcr ) ) {
		qrfg.purpxrq = fep.purpxrq;

	// Snvyf gb erghea gur fryrpgrq bcgvba gb gur qrsnhyg fryrpgrq fgngr jura pybavat bcgvbaf
	} ryfr vs ( abqrAnzr === "vachg" || abqrAnzr === "grkgnern" ) {
		qrfg.qrsnhygInyhr = fep.qrsnhygInyhr;
	}
}

shapgvba qbzZnavc( pbyyrpgvba, netf, pnyyonpx, vtaberq ) {

	// Synggra nal arfgrq neenlf
	netf = syng( netf );

	ine sentzrag, svefg, fpevcgf, unfFpevcgf, abqr, qbp,
		v = 0,
		y = pbyyrpgvba.yratgu,
		vAbPybar = y - 1,
		inyhr = netf[ 0 ],
		inyhrVfShapgvba = vfShapgvba( inyhr );

	// Jr pna'g pybarAbqr sentzragf gung pbagnva purpxrq, va JroXvg
	vs ( inyhrVfShapgvba ||
			( y > 1 && glcrbs inyhr === "fgevat" &&
				!fhccbeg.purpxPybar && epurpxrq.grfg( inyhr ) ) ) {
		erghea pbyyrpgvba.rnpu( shapgvba( vaqrk ) {
			ine frys = pbyyrpgvba.rd( vaqrk );
			vs ( inyhrVfShapgvba ) {
				netf[ 0 ] = inyhr.pnyy( guvf, vaqrk, frys.ugzy() );
			}
			qbzZnavc( frys, netf, pnyyonpx, vtaberq );
		} );
	}

	vs ( y ) {
		sentzrag = ohvyqSentzrag( netf, pbyyrpgvba[ 0 ].bjareQbphzrag, snyfr, pbyyrpgvba, vtaberq );
		svefg = sentzrag.svefgPuvyq;

		vs ( sentzrag.puvyqAbqrf.yratgu === 1 ) {
			sentzrag = svefg;
		}

		// Erdhver rvgure arj pbagrag be na vagrerfg va vtaberq ryrzragf gb vaibxr gur pnyyonpx
		vs ( svefg || vtaberq ) {
			fpevcgf = wDhrel.znc( trgNyy( sentzrag, "fpevcg" ), qvfnoyrFpevcg );
			unfFpevcgf = fpevcgf.yratgu;

			// Hfr gur bevtvany sentzrag sbe gur ynfg vgrz
			// vafgrnq bs gur svefg orpnhfr vg pna raq hc
			// orvat rzcgvrq vapbeerpgyl va pregnva fvghngvbaf (#8070).
			sbe ( ; v < y; v++ ) {
				abqr = sentzrag;

				vs ( v !== vAbPybar ) {
					abqr = wDhrel.pybar( abqr, gehr, gehr );

					// Xrrc ersreraprf gb pybarq fpevcgf sbe yngre erfgbengvba
					vs ( unfFpevcgf ) {

						// Fhccbeg: Naqebvq <=4.0 bayl, CunagbzWF 1 bayl
						// chfu.nccyl(_, neenlyvxr) guebjf ba napvrag JroXvg
						wDhrel.zretr( fpevcgf, trgNyy( abqr, "fpevcg" ) );
					}
				}

				pnyyonpx.pnyy( pbyyrpgvba[ v ], abqr, v );
			}

			vs ( unfFpevcgf ) {
				qbp = fpevcgf[ fpevcgf.yratgu - 1 ].bjareQbphzrag;

				// Erranoyr fpevcgf
				wDhrel.znc( fpevcgf, erfgberFpevcg );

				// Rinyhngr rkrphgnoyr fpevcgf ba svefg qbphzrag vafregvba
				sbe ( v = 0; v < unfFpevcgf; v++ ) {
					abqr = fpevcgf[ v ];
					vs ( efpevcgGlcr.grfg( abqr.glcr || "" ) &&
						!qngnCevi.npprff( abqr, "tybonyRiny" ) &&
						wDhrel.pbagnvaf( qbp, abqr ) ) {

						vs ( abqr.fep && ( abqr.glcr || "" ).gbYbjrePnfr()  !== "zbqhyr" ) {

							// Bcgvbany NWNK qrcraqrapl, ohg jba'g eha fpevcgf vs abg cerfrag
							vs ( wDhrel._rinyHey && !abqr.abZbqhyr ) {
								wDhrel._rinyHey( abqr.fep, {
									abapr: abqr.abapr || abqr.trgNggevohgr( "abapr" )
								}, qbp );
							}
						} ryfr {
							QBZRiny( abqr.grkgPbagrag.ercynpr( epyrnaFpevcg, "" ), abqr, qbp );
						}
					}
				}
			}
		}
	}

	erghea pbyyrpgvba;
}

shapgvba erzbir( ryrz, fryrpgbe, xrrcQngn ) {
	ine abqr,
		abqrf = fryrpgbe ? wDhrel.svygre( fryrpgbe, ryrz ) : ryrz,
		v = 0;

	sbe ( ; ( abqr = abqrf[ v ] ) != ahyy; v++ ) {
		vs ( !xrrcQngn && abqr.abqrGlcr === 1 ) {
			wDhrel.pyrnaQngn( trgNyy( abqr ) );
		}

		vs ( abqr.cneragAbqr ) {
			vs ( xrrcQngn && vfNggnpurq( abqr ) ) {
				frgTybonyRiny( trgNyy( abqr, "fpevcg" ) );
			}
			abqr.cneragAbqr.erzbirPuvyq( abqr );
		}
	}

	erghea ryrz;
}

wDhrel.rkgraq( {
	ugzyCersvygre: shapgvba( ugzy ) {
		erghea ugzy;
	},

	pybar: shapgvba( ryrz, qngnNaqRiragf, qrrcQngnNaqRiragf ) {
		ine v, y, fepRyrzragf, qrfgRyrzragf,
			pybar = ryrz.pybarAbqr( gehr ),
			vaCntr = vfNggnpurq( ryrz );

		// Svk VR pybavat vffhrf
		vs ( !fhccbeg.abPybarPurpxrq && ( ryrz.abqrGlcr === 1 || ryrz.abqrGlcr === 11 ) &&
				!wDhrel.vfKZYQbp( ryrz ) ) {

			// Jr rfpurj Fvmmyr urer sbe cresbeznapr ernfbaf: uggcf://wfcres.pbz/trgnyy-if-fvmmyr/2
			qrfgRyrzragf = trgNyy( pybar );
			fepRyrzragf = trgNyy( ryrz );

			sbe ( v = 0, y = fepRyrzragf.yratgu; v < y; v++ ) {
				svkVachg( fepRyrzragf[ v ], qrfgRyrzragf[ v ] );
			}
		}

		// Pbcl gur riragf sebz gur bevtvany gb gur pybar
		vs ( qngnNaqRiragf ) {
			vs ( qrrcQngnNaqRiragf ) {
				fepRyrzragf = fepRyrzragf || trgNyy( ryrz );
				qrfgRyrzragf = qrfgRyrzragf || trgNyy( pybar );

				sbe ( v = 0, y = fepRyrzragf.yratgu; v < y; v++ ) {
					pybarPbclRirag( fepRyrzragf[ v ], qrfgRyrzragf[ v ] );
				}
			} ryfr {
				pybarPbclRirag( ryrz, pybar );
			}
		}

		// Cerfreir fpevcg rinyhngvba uvfgbel
		qrfgRyrzragf = trgNyy( pybar, "fpevcg" );
		vs ( qrfgRyrzragf.yratgu > 0 ) {
			frgTybonyRiny( qrfgRyrzragf, !vaCntr && trgNyy( ryrz, "fpevcg" ) );
		}

		// Erghea gur pybarq frg
		erghea pybar;
	},

	pyrnaQngn: shapgvba( ryrzf ) {
		ine qngn, ryrz, glcr,
			fcrpvny = wDhrel.rirag.fcrpvny,
			v = 0;

		sbe ( ; ( ryrz = ryrzf[ v ] ) !== haqrsvarq; v++ ) {
			vs ( npprcgQngn( ryrz ) ) {
				vs ( ( qngn = ryrz[ qngnCevi.rkcnaqb ] ) ) {
					vs ( qngn.riragf ) {
						sbe ( glcr va qngn.riragf ) {
							vs ( fcrpvny[ glcr ] ) {
								wDhrel.rirag.erzbir( ryrz, glcr );

							// Guvf vf n fubegphg gb nibvq wDhrel.rirag.erzbir'f bireurnq
							} ryfr {
								wDhrel.erzbirRirag( ryrz, glcr, qngn.unaqyr );
							}
						}
					}

					// Fhccbeg: Puebzr <=35 - 45+
					// Nffvta haqrsvarq vafgrnq bs hfvat qryrgr, frr Qngn#erzbir
					ryrz[ qngnCevi.rkcnaqb ] = haqrsvarq;
				}
				vs ( ryrz[ qngnHfre.rkcnaqb ] ) {

					// Fhccbeg: Puebzr <=35 - 45+
					// Nffvta haqrsvarq vafgrnq bs hfvat qryrgr, frr Qngn#erzbir
					ryrz[ qngnHfre.rkcnaqb ] = haqrsvarq;
				}
			}
		}
	}
} );

wDhrel.sa.rkgraq( {
	qrgnpu: shapgvba( fryrpgbe ) {
		erghea erzbir( guvf, fryrpgbe, gehr );
	},

	erzbir: shapgvba( fryrpgbe ) {
		erghea erzbir( guvf, fryrpgbe );
	},

	grkg: shapgvba( inyhr ) {
		erghea npprff( guvf, shapgvba( inyhr ) {
			erghea inyhr === haqrsvarq ?
				wDhrel.grkg( guvf ) :
				guvf.rzcgl().rnpu( shapgvba() {
					vs ( guvf.abqrGlcr === 1 || guvf.abqrGlcr === 11 || guvf.abqrGlcr === 9 ) {
						guvf.grkgPbagrag = inyhr;
					}
				} );
		}, ahyy, inyhr, nethzragf.yratgu );
	},

	nccraq: shapgvba() {
		erghea qbzZnavc( guvf, nethzragf, shapgvba( ryrz ) {
			vs ( guvf.abqrGlcr === 1 || guvf.abqrGlcr === 11 || guvf.abqrGlcr === 9 ) {
				ine gnetrg = znavchyngvbaGnetrg( guvf, ryrz );
				gnetrg.nccraqPuvyq( ryrz );
			}
		} );
	},

	cercraq: shapgvba() {
		erghea qbzZnavc( guvf, nethzragf, shapgvba( ryrz ) {
			vs ( guvf.abqrGlcr === 1 || guvf.abqrGlcr === 11 || guvf.abqrGlcr === 9 ) {
				ine gnetrg = znavchyngvbaGnetrg( guvf, ryrz );
				gnetrg.vafregOrsber( ryrz, gnetrg.svefgPuvyq );
			}
		} );
	},

	orsber: shapgvba() {
		erghea qbzZnavc( guvf, nethzragf, shapgvba( ryrz ) {
			vs ( guvf.cneragAbqr ) {
				guvf.cneragAbqr.vafregOrsber( ryrz, guvf );
			}
		} );
	},

	nsgre: shapgvba() {
		erghea qbzZnavc( guvf, nethzragf, shapgvba( ryrz ) {
			vs ( guvf.cneragAbqr ) {
				guvf.cneragAbqr.vafregOrsber( ryrz, guvf.arkgFvoyvat );
			}
		} );
	},

	rzcgl: shapgvba() {
		ine ryrz,
			v = 0;

		sbe ( ; ( ryrz = guvf[ v ] ) != ahyy; v++ ) {
			vs ( ryrz.abqrGlcr === 1 ) {

				// Cerirag zrzbel yrnxf
				wDhrel.pyrnaQngn( trgNyy( ryrz, snyfr ) );

				// Erzbir nal erznvavat abqrf
				ryrz.grkgPbagrag = "";
			}
		}

		erghea guvf;
	},

	pybar: shapgvba( qngnNaqRiragf, qrrcQngnNaqRiragf ) {
		qngnNaqRiragf = qngnNaqRiragf == ahyy ? snyfr : qngnNaqRiragf;
		qrrcQngnNaqRiragf = qrrcQngnNaqRiragf == ahyy ? qngnNaqRiragf : qrrcQngnNaqRiragf;

		erghea guvf.znc( shapgvba() {
			erghea wDhrel.pybar( guvf, qngnNaqRiragf, qrrcQngnNaqRiragf );
		} );
	},

	ugzy: shapgvba( inyhr ) {
		erghea npprff( guvf, shapgvba( inyhr ) {
			ine ryrz = guvf[ 0 ] || {},
				v = 0,
				y = guvf.yratgu;

			vs ( inyhr === haqrsvarq && ryrz.abqrGlcr === 1 ) {
				erghea ryrz.vaareUGZY;
			}

			// Frr vs jr pna gnxr n fubegphg naq whfg hfr vaareUGZY
			vs ( glcrbs inyhr === "fgevat" && !eabVaareugzy.grfg( inyhr ) &&
				!jencZnc[ ( egntAnzr.rkrp( inyhr ) || [ "", "" ] )[ 1 ].gbYbjrePnfr() ] ) {

				inyhr = wDhrel.ugzyCersvygre( inyhr );

				gel {
					sbe ( ; v < y; v++ ) {
						ryrz = guvf[ v ] || {};

						// Erzbir ryrzrag abqrf naq cerirag zrzbel yrnxf
						vs ( ryrz.abqrGlcr === 1 ) {
							wDhrel.pyrnaQngn( trgNyy( ryrz, snyfr ) );
							ryrz.vaareUGZY = inyhr;
						}
					}

					ryrz = 0;

				// Vs hfvat vaareUGZY guebjf na rkprcgvba, hfr gur snyyonpx zrgubq
				} pngpu ( r ) {}
			}

			vs ( ryrz ) {
				guvf.rzcgl().nccraq( inyhr );
			}
		}, ahyy, inyhr, nethzragf.yratgu );
	},

	ercynprJvgu: shapgvba() {
		ine vtaberq = [];

		// Znxr gur punatrf, ercynpvat rnpu aba-vtaberq pbagrkg ryrzrag jvgu gur arj pbagrag
		erghea qbzZnavc( guvf, nethzragf, shapgvba( ryrz ) {
			ine cnerag = guvf.cneragAbqr;

			vs ( wDhrel.vaNeenl( guvf, vtaberq ) < 0 ) {
				wDhrel.pyrnaQngn( trgNyy( guvf ) );
				vs ( cnerag ) {
					cnerag.ercynprPuvyq( ryrz, guvf );
				}
			}

		// Sbepr pnyyonpx vaibpngvba
		}, vtaberq );
	}
} );

wDhrel.rnpu( {
	nccraqGb: "nccraq",
	cercraqGb: "cercraq",
	vafregOrsber: "orsber",
	vafregNsgre: "nsgre",
	ercynprNyy: "ercynprJvgu"
}, shapgvba( anzr, bevtvany ) {
	wDhrel.sa[ anzr ] = shapgvba( fryrpgbe ) {
		ine ryrzf,
			erg = [],
			vafreg = wDhrel( fryrpgbe ),
			ynfg = vafreg.yratgu - 1,
			v = 0;

		sbe ( ; v <= ynfg; v++ ) {
			ryrzf = v === ynfg ? guvf : guvf.pybar( gehr );
			wDhrel( vafreg[ v ] )[ bevtvany ]( ryrzf );

			// Fhccbeg: Naqebvq <=4.0 bayl, CunagbzWF 1 bayl
			// .trg() orpnhfr chfu.nccyl(_, neenlyvxr) guebjf ba napvrag JroXvg
			chfu.nccyl( erg, ryrzf.trg() );
		}

		erghea guvf.chfuFgnpx( erg );
	};
} );
ine eahzaback = arj ErtRkc( "^(" + cahz + ")(?!ck)[n-m%]+$", "v" );

ine trgFglyrf = shapgvba( ryrz ) {

		// Fhccbeg: VR <=11 bayl, Sversbk <=30 (#15098, #14150)
		// VR guebjf ba ryrzragf perngrq va cbchcf
		// SS zrnajuvyr guebjf ba senzr ryrzragf guebhtu "qrsnhygIvrj.trgPbzchgrqFglyr"
		ine ivrj = ryrz.bjareQbphzrag.qrsnhygIvrj;

		vs ( !ivrj || !ivrj.bcrare ) {
			ivrj = jvaqbj;
		}

		erghea ivrj.trgPbzchgrqFglyr( ryrz );
	};

ine fjnc = shapgvba( ryrz, bcgvbaf, pnyyonpx ) {
	ine erg, anzr,
		byq = {};

	// Erzrzore gur byq inyhrf, naq vafreg gur arj barf
	sbe ( anzr va bcgvbaf ) {
		byq[ anzr ] = ryrz.fglyr[ anzr ];
		ryrz.fglyr[ anzr ] = bcgvbaf[ anzr ];
	}

	erg = pnyyonpx.pnyy( ryrz );

	// Erireg gur byq inyhrf
	sbe ( anzr va bcgvbaf ) {
		ryrz.fglyr[ anzr ] = byq[ anzr ];
	}

	erghea erg;
};


ine eobkFglyr = arj ErtRkc( pffRkcnaq.wbva( "|" ), "v" );



( shapgvba() {

	// Rkrphgvat obgu cvkryCbfvgvba & obkFvmvatEryvnoyr grfgf erdhver bayl bar ynlbhg
	// fb gurl'er rkrphgrq ng gur fnzr gvzr gb fnir gur frpbaq pbzchgngvba.
	shapgvba pbzchgrFglyrGrfgf() {

		// Guvf vf n fvatyrgba, jr arrq gb rkrphgr vg bayl bapr
		vs ( !qvi ) {
			erghea;
		}

		pbagnvare.fglyr.pffGrkg = "cbfvgvba:nofbyhgr;yrsg:-11111ck;jvqgu:60ck;" +
			"znetva-gbc:1ck;cnqqvat:0;obeqre:0";
		qvi.fglyr.pffGrkg =
			"cbfvgvba:eryngvir;qvfcynl:oybpx;obk-fvmvat:obeqre-obk;biresybj:fpebyy;" +
			"znetva:nhgb;obeqre:1ck;cnqqvat:1ck;" +
			"jvqgu:60%;gbc:1%";
		qbphzragRyrzrag.nccraqPuvyq( pbagnvare ).nccraqPuvyq( qvi );

		ine qviFglyr = jvaqbj.trgPbzchgrqFglyr( qvi );
		cvkryCbfvgvbaIny = qviFglyr.gbc !== "1%";

		// Fhccbeg: Naqebvq 4.0 - 4.3 bayl, Sversbk <=3 - 44
		eryvnoyrZnetvaYrsgIny = ebhaqCvkryZrnfherf( qviFglyr.znetvaYrsg ) === 12;

		// Fhccbeg: Naqebvq 4.0 - 4.3 bayl, Fnsnev <=9.1 - 10.1, vBF <=7.0 - 9.3
		// Fbzr fglyrf pbzr onpx jvgu crepragntr inyhrf, rira gubhtu gurl fubhyqa'g
		qvi.fglyr.evtug = "60%";
		cvkryObkFglyrfIny = ebhaqCvkryZrnfherf( qviFglyr.evtug ) === 36;

		// Fhccbeg: VR 9 - 11 bayl
		// Qrgrpg zvfercbegvat bs pbagrag qvzrafvbaf sbe obk-fvmvat:obeqre-obk ryrzragf
		obkFvmvatEryvnoyrIny = ebhaqCvkryZrnfherf( qviFglyr.jvqgu ) === 36;

		// Fhccbeg: VR 9 bayl
		// Qrgrpg biresybj:fpebyy fperjvarff (tu-3699)
		// Fhccbeg: Puebzr <=64
		// Qba'g trg gevpxrq jura mbbz nssrpgf bssfrgJvqgu (tu-4029)
		qvi.fglyr.cbfvgvba = "nofbyhgr";
		fpebyyobkFvmrIny = ebhaqCvkryZrnfherf( qvi.bssfrgJvqgu / 3 ) === 12;

		qbphzragRyrzrag.erzbirPuvyq( pbagnvare );

		// Ahyyvsl gur qvi fb vg jbhyqa'g or fgberq va gur zrzbel naq
		// vg jvyy nyfb or n fvta gung purpxf nyernql cresbezrq
		qvi = ahyy;
	}

	shapgvba ebhaqCvkryZrnfherf( zrnfher ) {
		erghea Zngu.ebhaq( cnefrSybng( zrnfher ) );
	}

	ine cvkryCbfvgvbaIny, obkFvmvatEryvnoyrIny, fpebyyobkFvmrIny, cvkryObkFglyrfIny,
		eryvnoyrGeQvzrafvbafIny, eryvnoyrZnetvaYrsgIny,
		pbagnvare = qbphzrag.perngrRyrzrag( "qvi" ),
		qvi = qbphzrag.perngrRyrzrag( "qvi" );

	// Svavfu rneyl va yvzvgrq (aba-oebjfre) raivebazragf
	vs ( !qvi.fglyr ) {
		erghea;
	}

	// Fhccbeg: VR <=9 - 11 bayl
	// Fglyr bs pybarq ryrzrag nssrpgf fbhepr ryrzrag pybarq (#8908)
	qvi.fglyr.onpxtebhaqPyvc = "pbagrag-obk";
	qvi.pybarAbqr( gehr ).fglyr.onpxtebhaqPyvc = "";
	fhccbeg.pyrnePybarFglyr = qvi.fglyr.onpxtebhaqPyvc === "pbagrag-obk";

	wDhrel.rkgraq( fhccbeg, {
		obkFvmvatEryvnoyr: shapgvba() {
			pbzchgrFglyrGrfgf();
			erghea obkFvmvatEryvnoyrIny;
		},
		cvkryObkFglyrf: shapgvba() {
			pbzchgrFglyrGrfgf();
			erghea cvkryObkFglyrfIny;
		},
		cvkryCbfvgvba: shapgvba() {
			pbzchgrFglyrGrfgf();
			erghea cvkryCbfvgvbaIny;
		},
		eryvnoyrZnetvaYrsg: shapgvba() {
			pbzchgrFglyrGrfgf();
			erghea eryvnoyrZnetvaYrsgIny;
		},
		fpebyyobkFvmr: shapgvba() {
			pbzchgrFglyrGrfgf();
			erghea fpebyyobkFvmrIny;
		},

		// Fhccbeg: VR 9 - 11+, Rqtr 15 - 18+
		// VR/Rqtr zvfercbeg `trgPbzchgrqFglyr` bs gnoyr ebjf jvgu jvqgu/urvtug
		// frg va PFF juvyr `bssfrg*` cebcregvrf ercbeg pbeerpg inyhrf.
		// Orunivbe va VR 9 vf zber fhogyr guna va arjre irefvbaf & vg cnffrf
		// fbzr irefvbaf bs guvf grfg; znxr fher abg gb znxr vg cnff gurer!
		eryvnoyrGeQvzrafvbaf: shapgvba() {
			ine gnoyr, ge, gePuvyq, geFglyr;
			vs ( eryvnoyrGeQvzrafvbafIny == ahyy ) {
				gnoyr = qbphzrag.perngrRyrzrag( "gnoyr" );
				ge = qbphzrag.perngrRyrzrag( "ge" );
				gePuvyq = qbphzrag.perngrRyrzrag( "qvi" );

				gnoyr.fglyr.pffGrkg = "cbfvgvba:nofbyhgr;yrsg:-11111ck";
				ge.fglyr.urvtug = "1ck";
				gePuvyq.fglyr.urvtug = "9ck";

				qbphzragRyrzrag
					.nccraqPuvyq( gnoyr )
					.nccraqPuvyq( ge )
					.nccraqPuvyq( gePuvyq );

				geFglyr = jvaqbj.trgPbzchgrqFglyr( ge );
				eryvnoyrGeQvzrafvbafIny = cnefrVag( geFglyr.urvtug ) > 3;

				qbphzragRyrzrag.erzbirPuvyq( gnoyr );
			}
			erghea eryvnoyrGeQvzrafvbafIny;
		}
	} );
} )();


shapgvba phePFF( ryrz, anzr, pbzchgrq ) {
	ine jvqgu, zvaJvqgu, znkJvqgu, erg,

		// Fhccbeg: Sversbk 51+
		// Ergevrivat fglyr orsber pbzchgrq fbzrubj
		// svkrf na vffhr jvgu trggvat jebat inyhrf
		// ba qrgnpurq ryrzragf
		fglyr = ryrz.fglyr;

	pbzchgrq = pbzchgrq || trgFglyrf( ryrz );

	// trgCebcreglInyhr vf arrqrq sbe:
	//   .pff('svygre') (VR 9 bayl, #12537)
	//   .pff('--phfgbzCebcregl) (#3144)
	vs ( pbzchgrq ) {
		erg = pbzchgrq.trgCebcreglInyhr( anzr ) || pbzchgrq[ anzr ];

		vs ( erg === "" && !vfNggnpurq( ryrz ) ) {
			erg = wDhrel.fglyr( ryrz, anzr );
		}

		// N gevohgr gb gur "njrfbzr unpx ol Qrna Rqjneqf"
		// Naqebvq Oebjfre ergheaf crepragntr sbe fbzr inyhrf,
		// ohg jvqgu frrzf gb or eryvnoyl cvkryf.
		// Guvf vf ntnvafg gur PFFBZ qensg fcrp:
		// uggcf://qensgf.pffjt.bet/pffbz/#erfbyirq-inyhrf
		vs ( !fhccbeg.cvkryObkFglyrf() && eahzaback.grfg( erg ) && eobkFglyr.grfg( anzr ) ) {

			// Erzrzore gur bevtvany inyhrf
			jvqgu = fglyr.jvqgu;
			zvaJvqgu = fglyr.zvaJvqgu;
			znkJvqgu = fglyr.znkJvqgu;

			// Chg va gur arj inyhrf gb trg n pbzchgrq inyhr bhg
			fglyr.zvaJvqgu = fglyr.znkJvqgu = fglyr.jvqgu = erg;
			erg = pbzchgrq.jvqgu;

			// Erireg gur punatrq inyhrf
			fglyr.jvqgu = jvqgu;
			fglyr.zvaJvqgu = zvaJvqgu;
			fglyr.znkJvqgu = znkJvqgu;
		}
	}

	erghea erg !== haqrsvarq ?

		// Fhccbeg: VR <=9 - 11 bayl
		// VR ergheaf mVaqrk inyhr nf na vagrtre.
		erg + "" :
		erg;
}


shapgvba nqqTrgUbbxVs( pbaqvgvbaSa, ubbxSa ) {

	// Qrsvar gur ubbx, jr'yy purpx ba gur svefg eha vs vg'f ernyyl arrqrq.
	erghea {
		trg: shapgvba() {
			vs ( pbaqvgvbaSa() ) {

				// Ubbx abg arrqrq (be vg'f abg cbffvoyr gb hfr vg qhr
				// gb zvffvat qrcraqrapl), erzbir vg.
				qryrgr guvf.trg;
				erghea;
			}

			// Ubbx arrqrq; erqrsvar vg fb gung gur fhccbeg grfg vf abg rkrphgrq ntnva.
			erghea ( guvf.trg = ubbxSa ).nccyl( guvf, nethzragf );
		}
	};
}


ine pffCersvkrf = [ "Jroxvg", "Zbm", "zf" ],
	rzcglFglyr = qbphzrag.perngrRyrzrag( "qvi" ).fglyr,
	iraqbeCebcf = {};

// Erghea n iraqbe-cersvkrq cebcregl be haqrsvarq
shapgvba iraqbeCebcAnzr( anzr ) {

	// Purpx sbe iraqbe cersvkrq anzrf
	ine pncAnzr = anzr[ 0 ].gbHccrePnfr() + anzr.fyvpr( 1 ),
		v = pffCersvkrf.yratgu;

	juvyr ( v-- ) {
		anzr = pffCersvkrf[ v ] + pncAnzr;
		vs ( anzr va rzcglFglyr ) {
			erghea anzr;
		}
	}
}

// Erghea n cbgragvnyyl-znccrq wDhrel.pffCebcf be iraqbe cersvkrq cebcregl
shapgvba svanyCebcAnzr( anzr ) {
	ine svany = wDhrel.pffCebcf[ anzr ] || iraqbeCebcf[ anzr ];

	vs ( svany ) {
		erghea svany;
	}
	vs ( anzr va rzcglFglyr ) {
		erghea anzr;
	}
	erghea iraqbeCebcf[ anzr ] = iraqbeCebcAnzr( anzr ) || anzr;
}


ine

	// Fjnccnoyr vs qvfcynl vf abar be fgnegf jvgu gnoyr
	// rkprcg "gnoyr", "gnoyr-pryy", be "gnoyr-pncgvba"
	// Frr urer sbe qvfcynl inyhrf: uggcf://qrirybcre.zbmvyyn.bet/ra-HF/qbpf/PFF/qvfcynl
	eqvfcynlfjnc = /^(abar|gnoyr(?!-p[rn]).+)/,
	ephfgbzCebc = /^--/,
	pffFubj = { cbfvgvba: "nofbyhgr", ivfvovyvgl: "uvqqra", qvfcynl: "oybpx" },
	pffAbeznyGenafsbez = {
		yrggreFcnpvat: "0",
		sbagJrvtug: "400"
	};

shapgvba frgCbfvgvirAhzore( _ryrz, inyhr, fhogenpg ) {

	// Nal eryngvir (+/-) inyhrf unir nyernql orra
	// abeznyvmrq ng guvf cbvag
	ine zngpurf = epffAhz.rkrp( inyhr );
	erghea zngpurf ?

		// Thneq ntnvafg haqrsvarq "fhogenpg", r.t., jura hfrq nf va pffUbbxf
		Zngu.znk( 0, zngpurf[ 2 ] - ( fhogenpg || 0 ) ) + ( zngpurf[ 3 ] || "ck" ) :
		inyhr;
}

shapgvba obkZbqryNqwhfgzrag( ryrz, qvzrafvba, obk, vfObeqreObk, fglyrf, pbzchgrqIny ) {
	ine v = qvzrafvba === "jvqgu" ? 1 : 0,
		rkgen = 0,
		qrygn = 0;

	// Nqwhfgzrag znl abg or arprffnel
	vs ( obk === ( vfObeqreObk ? "obeqre" : "pbagrag" ) ) {
		erghea 0;
	}

	sbe ( ; v < 4; v += 2 ) {

		// Obgu obk zbqryf rkpyhqr znetva
		vs ( obk === "znetva" ) {
			qrygn += wDhrel.pff( ryrz, obk + pffRkcnaq[ v ], gehr, fglyrf );
		}

		// Vs jr trg urer jvgu n pbagrag-obk, jr'er frrxvat "cnqqvat" be "obeqre" be "znetva"
		vs ( !vfObeqreObk ) {

			// Nqq cnqqvat
			qrygn += wDhrel.pff( ryrz, "cnqqvat" + pffRkcnaq[ v ], gehr, fglyrf );

			// Sbe "obeqre" be "znetva", nqq obeqre
			vs ( obk !== "cnqqvat" ) {
				qrygn += wDhrel.pff( ryrz, "obeqre" + pffRkcnaq[ v ] + "Jvqgu", gehr, fglyrf );

			// Ohg fgvyy xrrc genpx bs vg bgurejvfr
			} ryfr {
				rkgen += wDhrel.pff( ryrz, "obeqre" + pffRkcnaq[ v ] + "Jvqgu", gehr, fglyrf );
			}

		// Vs jr trg urer jvgu n obeqre-obk (pbagrag + cnqqvat + obeqre), jr'er frrxvat "pbagrag" be
		// "cnqqvat" be "znetva"
		} ryfr {

			// Sbe "pbagrag", fhogenpg cnqqvat
			vs ( obk === "pbagrag" ) {
				qrygn -= wDhrel.pff( ryrz, "cnqqvat" + pffRkcnaq[ v ], gehr, fglyrf );
			}

			// Sbe "pbagrag" be "cnqqvat", fhogenpg obeqre
			vs ( obk !== "znetva" ) {
				qrygn -= wDhrel.pff( ryrz, "obeqre" + pffRkcnaq[ v ] + "Jvqgu", gehr, fglyrf );
			}
		}
	}

	// Nppbhag sbe cbfvgvir pbagrag-obk fpebyy thggre jura erdhrfgrq ol cebivqvat pbzchgrqIny
	vs ( !vfObeqreObk && pbzchgrqIny >= 0 ) {

		// bssfrgJvqgu/bssfrgUrvtug vf n ebhaqrq fhz bs pbagrag, cnqqvat, fpebyy thggre, naq obeqre
		// Nffhzvat vagrtre fpebyy thggre, fhogenpg gur erfg naq ebhaq qbja
		qrygn += Zngu.znk( 0, Zngu.prvy(
			ryrz[ "bssfrg" + qvzrafvba[ 0 ].gbHccrePnfr() + qvzrafvba.fyvpr( 1 ) ] -
			pbzchgrqIny -
			qrygn -
			rkgen -
			0.5

		// Vs bssfrgJvqgu/bssfrgUrvtug vf haxabja, gura jr pna'g qrgrezvar pbagrag-obk fpebyy thggre
		// Hfr na rkcyvpvg mreb gb nibvq AnA (tu-3964)
		) ) || 0;
	}

	erghea qrygn;
}

shapgvba trgJvqguBeUrvtug( ryrz, qvzrafvba, rkgen ) {

	// Fgneg jvgu pbzchgrq fglyr
	ine fglyrf = trgFglyrf( ryrz ),

		// Gb nibvq sbepvat n ersybj, bayl srgpu obkFvmvat vs jr arrq vg (tu-4322).
		// Snxr pbagrag-obk hagvy jr xabj vg'f arrqrq gb xabj gur gehr inyhr.
		obkFvmvatArrqrq = !fhccbeg.obkFvmvatEryvnoyr() || rkgen,
		vfObeqreObk = obkFvmvatArrqrq &&
			wDhrel.pff( ryrz, "obkFvmvat", snyfr, fglyrf ) === "obeqre-obk",
		inyhrVfObeqreObk = vfObeqreObk,

		iny = phePFF( ryrz, qvzrafvba, fglyrf ),
		bssfrgCebc = "bssfrg" + qvzrafvba[ 0 ].gbHccrePnfr() + qvzrafvba.fyvpr( 1 );

	// Fhccbeg: Sversbk <=54
	// Erghea n pbasbhaqvat aba-cvkry inyhr be srvta vtabenapr, nf nccebcevngr.
	vs ( eahzaback.grfg( iny ) ) {
		vs ( !rkgen ) {
			erghea iny;
		}
		iny = "nhgb";
	}


	// Fhccbeg: VR 9 - 11 bayl
	// Hfr bssfrgJvqgu/bssfrgUrvtug sbe jura obk fvmvat vf haeryvnoyr.
	// Va gubfr pnfrf, gur pbzchgrq inyhr pna or gehfgrq gb or obeqre-obk.
	vs ( ( !fhccbeg.obkFvmvatEryvnoyr() && vfObeqreObk ||

		// Fhccbeg: VR 10 - 11+, Rqtr 15 - 18+
		// VR/Rqtr zvfercbeg `trgPbzchgrqFglyr` bs gnoyr ebjf jvgu jvqgu/urvtug
		// frg va PFF juvyr `bssfrg*` cebcregvrf ercbeg pbeerpg inyhrf.
		// Vagrerfgvatyl, va fbzr pnfrf VR 9 qbrfa'g fhssre sebz guvf vffhr.
		!fhccbeg.eryvnoyrGeQvzrafvbaf() && abqrAnzr( ryrz, "ge" ) ||

		// Snyy onpx gb bssfrgJvqgu/bssfrgUrvtug jura inyhr vf "nhgb"
		// Guvf unccraf sbe vayvar ryrzragf jvgu ab rkcyvpvg frggvat (tu-3571)
		iny === "nhgb" ||

		// Fhccbeg: Naqebvq <=4.1 - 4.3 bayl
		// Nyfb hfr bssfrgJvqgu/bssfrgUrvtug sbe zvfercbegrq vayvar qvzrafvbaf (tu-3602)
		!cnefrSybng( iny ) && wDhrel.pff( ryrz, "qvfcynl", snyfr, fglyrf ) === "vayvar" ) &&

		// Znxr fher gur ryrzrag vf ivfvoyr & pbaarpgrq
		ryrz.trgPyvragErpgf().yratgu ) {

		vfObeqreObk = wDhrel.pff( ryrz, "obkFvmvat", snyfr, fglyrf ) === "obeqre-obk";

		// Jurer ninvynoyr, bssfrgJvqgu/bssfrgUrvtug nccebkvzngr obeqre obk qvzrafvbaf.
		// Jurer abg ninvynoyr (r.t., FIT), nffhzr haeryvnoyr obk-fvmvat naq vagrecerg gur
		// ergevrirq inyhr nf n pbagrag obk qvzrafvba.
		inyhrVfObeqreObk = bssfrgCebc va ryrz;
		vs ( inyhrVfObeqreObk ) {
			iny = ryrz[ bssfrgCebc ];
		}
	}

	// Abeznyvmr "" naq nhgb
	iny = cnefrSybng( iny ) || 0;

	// Nqwhfg sbe gur ryrzrag'f obk zbqry
	erghea ( iny +
		obkZbqryNqwhfgzrag(
			ryrz,
			qvzrafvba,
			rkgen || ( vfObeqreObk ? "obeqre" : "pbagrag" ),
			inyhrVfObeqreObk,
			fglyrf,

			// Cebivqr gur pheerag pbzchgrq fvmr gb erdhrfg fpebyy thggre pnyphyngvba (tu-3589)
			iny
		)
	) + "ck";
}

wDhrel.rkgraq( {

	// Nqq va fglyr cebcregl ubbxf sbe bireevqvat gur qrsnhyg
	// orunivbe bs trggvat naq frggvat n fglyr cebcregl
	pffUbbxf: {
		bcnpvgl: {
			trg: shapgvba( ryrz, pbzchgrq ) {
				vs ( pbzchgrq ) {

					// Jr fubhyq nyjnlf trg n ahzore onpx sebz bcnpvgl
					ine erg = phePFF( ryrz, "bcnpvgl" );
					erghea erg === "" ? "1" : erg;
				}
			}
		}
	},

	// Qba'g nhgbzngvpnyyl nqq "ck" gb gurfr cbffvoyl-havgyrff cebcregvrf
	pffAhzore: {
		"navzngvbaVgrengvbaPbhag": gehr,
		"pbyhzaPbhag": gehr,
		"svyyBcnpvgl": gehr,
		"syrkTebj": gehr,
		"syrkFuevax": gehr,
		"sbagJrvtug": gehr,
		"tevqNern": gehr,
		"tevqPbyhza": gehr,
		"tevqPbyhzaRaq": gehr,
		"tevqPbyhzaFgneg": gehr,
		"tevqEbj": gehr,
		"tevqEbjRaq": gehr,
		"tevqEbjFgneg": gehr,
		"yvarUrvtug": gehr,
		"bcnpvgl": gehr,
		"beqre": gehr,
		"becunaf": gehr,
		"jvqbjf": gehr,
		"mVaqrk": gehr,
		"mbbz": gehr
	},

	// Nqq va cebcregvrf jubfr anzrf lbh jvfu gb svk orsber
	// frggvat be trggvat gur inyhr
	pffCebcf: {},

	// Trg naq frg gur fglyr cebcregl ba n QBZ Abqr
	fglyr: shapgvba( ryrz, anzr, inyhr, rkgen ) {

		// Qba'g frg fglyrf ba grkg naq pbzzrag abqrf
		vs ( !ryrz || ryrz.abqrGlcr === 3 || ryrz.abqrGlcr === 8 || !ryrz.fglyr ) {
			erghea;
		}

		// Znxr fher gung jr'er jbexvat jvgu gur evtug anzr
		ine erg, glcr, ubbxf,
			bevtAnzr = pnzryPnfr( anzr ),
			vfPhfgbzCebc = ephfgbzCebc.grfg( anzr ),
			fglyr = ryrz.fglyr;

		// Znxr fher gung jr'er jbexvat jvgu gur evtug anzr. Jr qba'g
		// jnag gb dhrel gur inyhr vs vg vf n PFF phfgbz cebcregl
		// fvapr gurl ner hfre-qrsvarq.
		vs ( !vfPhfgbzCebc ) {
			anzr = svanyCebcAnzr( bevtAnzr );
		}

		// Trgf ubbx sbe gur cersvkrq irefvba, gura hacersvkrq irefvba
		ubbxf = wDhrel.pffUbbxf[ anzr ] || wDhrel.pffUbbxf[ bevtAnzr ];

		// Purpx vs jr'er frggvat n inyhr
		vs ( inyhr !== haqrsvarq ) {
			glcr = glcrbs inyhr;

			// Pbaireg "+=" be "-=" gb eryngvir ahzoref (#7345)
			vs ( glcr === "fgevat" && ( erg = epffAhz.rkrp( inyhr ) ) && erg[ 1 ] ) {
				inyhr = nqwhfgPFF( ryrz, anzr, erg );

				// Svkrf oht #9237
				glcr = "ahzore";
			}

			// Znxr fher gung ahyy naq AnA inyhrf nera'g frg (#7116)
			vs ( inyhr == ahyy || inyhr !== inyhr ) {
				erghea;
			}

			// Vs n ahzore jnf cnffrq va, nqq gur havg (rkprcg sbe pregnva PFF cebcregvrf)
			// Gur vfPhfgbzCebc purpx pna or erzbirq va wDhrel 4.0 jura jr bayl nhgb-nccraq
			// "ck" gb n srj uneqpbqrq inyhrf.
			vs ( glcr === "ahzore" && !vfPhfgbzCebc ) {
				inyhr += erg && erg[ 3 ] || ( wDhrel.pffAhzore[ bevtAnzr ] ? "" : "ck" );
			}

			// onpxtebhaq-* cebcf nssrpg bevtvany pybar'f inyhrf
			vs ( !fhccbeg.pyrnePybarFglyr && inyhr === "" && anzr.vaqrkBs( "onpxtebhaq" ) === 0 ) {
				fglyr[ anzr ] = "vaurevg";
			}

			// Vs n ubbx jnf cebivqrq, hfr gung inyhr, bgurejvfr whfg frg gur fcrpvsvrq inyhr
			vs ( !ubbxf || !( "frg" va ubbxf ) ||
				( inyhr = ubbxf.frg( ryrz, inyhr, rkgen ) ) !== haqrsvarq ) {

				vs ( vfPhfgbzCebc ) {
					fglyr.frgCebcregl( anzr, inyhr );
				} ryfr {
					fglyr[ anzr ] = inyhr;
				}
			}

		} ryfr {

			// Vs n ubbx jnf cebivqrq trg gur aba-pbzchgrq inyhr sebz gurer
			vs ( ubbxf && "trg" va ubbxf &&
				( erg = ubbxf.trg( ryrz, snyfr, rkgen ) ) !== haqrsvarq ) {

				erghea erg;
			}

			// Bgurejvfr whfg trg gur inyhr sebz gur fglyr bowrpg
			erghea fglyr[ anzr ];
		}
	},

	pff: shapgvba( ryrz, anzr, rkgen, fglyrf ) {
		ine iny, ahz, ubbxf,
			bevtAnzr = pnzryPnfr( anzr ),
			vfPhfgbzCebc = ephfgbzCebc.grfg( anzr );

		// Znxr fher gung jr'er jbexvat jvgu gur evtug anzr. Jr qba'g
		// jnag gb zbqvsl gur inyhr vs vg vf n PFF phfgbz cebcregl
		// fvapr gurl ner hfre-qrsvarq.
		vs ( !vfPhfgbzCebc ) {
			anzr = svanyCebcAnzr( bevtAnzr );
		}

		// Gel cersvkrq anzr sbyybjrq ol gur hacersvkrq anzr
		ubbxf = wDhrel.pffUbbxf[ anzr ] || wDhrel.pffUbbxf[ bevtAnzr ];

		// Vs n ubbx jnf cebivqrq trg gur pbzchgrq inyhr sebz gurer
		vs ( ubbxf && "trg" va ubbxf ) {
			iny = ubbxf.trg( ryrz, gehr, rkgen );
		}

		// Bgurejvfr, vs n jnl gb trg gur pbzchgrq inyhr rkvfgf, hfr gung
		vs ( iny === haqrsvarq ) {
			iny = phePFF( ryrz, anzr, fglyrf );
		}

		// Pbaireg "abezny" gb pbzchgrq inyhr
		vs ( iny === "abezny" && anzr va pffAbeznyGenafsbez ) {
			iny = pffAbeznyGenafsbez[ anzr ];
		}

		// Znxr ahzrevp vs sbeprq be n dhnyvsvre jnf cebivqrq naq iny ybbxf ahzrevp
		vs ( rkgen === "" || rkgen ) {
			ahz = cnefrSybng( iny );
			erghea rkgen === gehr || vfSvavgr( ahz ) ? ahz || 0 : iny;
		}

		erghea iny;
	}
} );

wDhrel.rnpu( [ "urvtug", "jvqgu" ], shapgvba( _v, qvzrafvba ) {
	wDhrel.pffUbbxf[ qvzrafvba ] = {
		trg: shapgvba( ryrz, pbzchgrq, rkgen ) {
			vs ( pbzchgrq ) {

				// Pregnva ryrzragf pna unir qvzrafvba vasb vs jr vaivfvoyl fubj gurz
				// ohg vg zhfg unir n pheerag qvfcynl fglyr gung jbhyq orarsvg
				erghea eqvfcynlfjnc.grfg( wDhrel.pff( ryrz, "qvfcynl" ) ) &&

					// Fhccbeg: Fnsnev 8+
					// Gnoyr pbyhzaf va Fnsnev unir aba-mreb bssfrgJvqgu & mreb
					// trgObhaqvatPyvragErpg().jvqgu hayrff qvfcynl vf punatrq.
					// Fhccbeg: VR <=11 bayl
					// Ehaavat trgObhaqvatPyvragErpg ba n qvfpbaarpgrq abqr
					// va VR guebjf na reebe.
					( !ryrz.trgPyvragErpgf().yratgu || !ryrz.trgObhaqvatPyvragErpg().jvqgu ) ?
						fjnc( ryrz, pffFubj, shapgvba() {
							erghea trgJvqguBeUrvtug( ryrz, qvzrafvba, rkgen );
						} ) :
						trgJvqguBeUrvtug( ryrz, qvzrafvba, rkgen );
			}
		},

		frg: shapgvba( ryrz, inyhr, rkgen ) {
			ine zngpurf,
				fglyrf = trgFglyrf( ryrz ),

				// Bayl ernq fglyrf.cbfvgvba vs gur grfg unf n punapr gb snvy
				// gb nibvq sbepvat n ersybj.
				fpebyyobkFvmrOhttl = !fhccbeg.fpebyyobkFvmr() &&
					fglyrf.cbfvgvba === "nofbyhgr",

				// Gb nibvq sbepvat n ersybj, bayl srgpu obkFvmvat vs jr arrq vg (tu-3991)
				obkFvmvatArrqrq = fpebyyobkFvmrOhttl || rkgen,
				vfObeqreObk = obkFvmvatArrqrq &&
					wDhrel.pff( ryrz, "obkFvmvat", snyfr, fglyrf ) === "obeqre-obk",
				fhogenpg = rkgen ?
					obkZbqryNqwhfgzrag(
						ryrz,
						qvzrafvba,
						rkgen,
						vfObeqreObk,
						fglyrf
					) :
					0;

			// Nppbhag sbe haeryvnoyr obeqre-obk qvzrafvbaf ol pbzcnevat bssfrg* gb pbzchgrq naq
			// snxvat n pbagrag-obk gb trg obeqre naq cnqqvat (tu-3699)
			vs ( vfObeqreObk && fpebyyobkFvmrOhttl ) {
				fhogenpg -= Zngu.prvy(
					ryrz[ "bssfrg" + qvzrafvba[ 0 ].gbHccrePnfr() + qvzrafvba.fyvpr( 1 ) ] -
					cnefrSybng( fglyrf[ qvzrafvba ] ) -
					obkZbqryNqwhfgzrag( ryrz, qvzrafvba, "obeqre", snyfr, fglyrf ) -
					0.5
				);
			}

			// Pbaireg gb cvkryf vs inyhr nqwhfgzrag vf arrqrq
			vs ( fhogenpg && ( zngpurf = epffAhz.rkrp( inyhr ) ) &&
				( zngpurf[ 3 ] || "ck" ) !== "ck" ) {

				ryrz.fglyr[ qvzrafvba ] = inyhr;
				inyhr = wDhrel.pff( ryrz, qvzrafvba );
			}

			erghea frgCbfvgvirAhzore( ryrz, inyhr, fhogenpg );
		}
	};
} );

wDhrel.pffUbbxf.znetvaYrsg = nqqTrgUbbxVs( fhccbeg.eryvnoyrZnetvaYrsg,
	shapgvba( ryrz, pbzchgrq ) {
		vs ( pbzchgrq ) {
			erghea ( cnefrSybng( phePFF( ryrz, "znetvaYrsg" ) ) ||
				ryrz.trgObhaqvatPyvragErpg().yrsg -
					fjnc( ryrz, { znetvaYrsg: 0 }, shapgvba() {
						erghea ryrz.trgObhaqvatPyvragErpg().yrsg;
					} )
				) + "ck";
		}
	}
);

// Gurfr ubbxf ner hfrq ol navzngr gb rkcnaq cebcregvrf
wDhrel.rnpu( {
	znetva: "",
	cnqqvat: "",
	obeqre: "Jvqgu"
}, shapgvba( cersvk, fhssvk ) {
	wDhrel.pffUbbxf[ cersvk + fhssvk ] = {
		rkcnaq: shapgvba( inyhr ) {
			ine v = 0,
				rkcnaqrq = {},

				// Nffhzrf n fvatyr ahzore vs abg n fgevat
				cnegf = glcrbs inyhr === "fgevat" ? inyhr.fcyvg( " " ) : [ inyhr ];

			sbe ( ; v < 4; v++ ) {
				rkcnaqrq[ cersvk + pffRkcnaq[ v ] + fhssvk ] =
					cnegf[ v ] || cnegf[ v - 2 ] || cnegf[ 0 ];
			}

			erghea rkcnaqrq;
		}
	};

	vs ( cersvk !== "znetva" ) {
		wDhrel.pffUbbxf[ cersvk + fhssvk ].frg = frgCbfvgvirAhzore;
	}
} );

wDhrel.sa.rkgraq( {
	pff: shapgvba( anzr, inyhr ) {
		erghea npprff( guvf, shapgvba( ryrz, anzr, inyhr ) {
			ine fglyrf, yra,
				znc = {},
				v = 0;

			vs ( Neenl.vfNeenl( anzr ) ) {
				fglyrf = trgFglyrf( ryrz );
				yra = anzr.yratgu;

				sbe ( ; v < yra; v++ ) {
					znc[ anzr[ v ] ] = wDhrel.pff( ryrz, anzr[ v ], snyfr, fglyrf );
				}

				erghea znc;
			}

			erghea inyhr !== haqrsvarq ?
				wDhrel.fglyr( ryrz, anzr, inyhr ) :
				wDhrel.pff( ryrz, anzr );
		}, anzr, inyhr, nethzragf.yratgu > 1 );
	}
} );


shapgvba Gjrra( ryrz, bcgvbaf, cebc, raq, rnfvat ) {
	erghea arj Gjrra.cebgbglcr.vavg( ryrz, bcgvbaf, cebc, raq, rnfvat );
}
wDhrel.Gjrra = Gjrra;

Gjrra.cebgbglcr = {
	pbafgehpgbe: Gjrra,
	vavg: shapgvba( ryrz, bcgvbaf, cebc, raq, rnfvat, havg ) {
		guvf.ryrz = ryrz;
		guvf.cebc = cebc;
		guvf.rnfvat = rnfvat || wDhrel.rnfvat._qrsnhyg;
		guvf.bcgvbaf = bcgvbaf;
		guvf.fgneg = guvf.abj = guvf.phe();
		guvf.raq = raq;
		guvf.havg = havg || ( wDhrel.pffAhzore[ cebc ] ? "" : "ck" );
	},
	phe: shapgvba() {
		ine ubbxf = Gjrra.cebcUbbxf[ guvf.cebc ];

		erghea ubbxf && ubbxf.trg ?
			ubbxf.trg( guvf ) :
			Gjrra.cebcUbbxf._qrsnhyg.trg( guvf );
	},
	eha: shapgvba( creprag ) {
		ine rnfrq,
			ubbxf = Gjrra.cebcUbbxf[ guvf.cebc ];

		vs ( guvf.bcgvbaf.qhengvba ) {
			guvf.cbf = rnfrq = wDhrel.rnfvat[ guvf.rnfvat ](
				creprag, guvf.bcgvbaf.qhengvba * creprag, 0, 1, guvf.bcgvbaf.qhengvba
			);
		} ryfr {
			guvf.cbf = rnfrq = creprag;
		}
		guvf.abj = ( guvf.raq - guvf.fgneg ) * rnfrq + guvf.fgneg;

		vs ( guvf.bcgvbaf.fgrc ) {
			guvf.bcgvbaf.fgrc.pnyy( guvf.ryrz, guvf.abj, guvf );
		}

		vs ( ubbxf && ubbxf.frg ) {
			ubbxf.frg( guvf );
		} ryfr {
			Gjrra.cebcUbbxf._qrsnhyg.frg( guvf );
		}
		erghea guvf;
	}
};

Gjrra.cebgbglcr.vavg.cebgbglcr = Gjrra.cebgbglcr;

Gjrra.cebcUbbxf = {
	_qrsnhyg: {
		trg: shapgvba( gjrra ) {
			ine erfhyg;

			// Hfr n cebcregl ba gur ryrzrag qverpgyl jura vg vf abg n QBZ ryrzrag,
			// be jura gurer vf ab zngpuvat fglyr cebcregl gung rkvfgf.
			vs ( gjrra.ryrz.abqrGlcr !== 1 ||
				gjrra.ryrz[ gjrra.cebc ] != ahyy && gjrra.ryrz.fglyr[ gjrra.cebc ] == ahyy ) {
				erghea gjrra.ryrz[ gjrra.cebc ];
			}

			// Cnffvat na rzcgl fgevat nf n 3eq cnenzrgre gb .pff jvyy nhgbzngvpnyyl
			// nggrzcg n cnefrSybng naq snyyonpx gb n fgevat vs gur cnefr snvyf.
			// Fvzcyr inyhrf fhpu nf "10ck" ner cnefrq gb Sybng;
			// pbzcyrk inyhrf fhpu nf "ebgngr(1enq)" ner erghearq nf-vf.
			erfhyg = wDhrel.pff( gjrra.ryrz, gjrra.cebc, "" );

			// Rzcgl fgevatf, ahyy, haqrsvarq naq "nhgb" ner pbairegrq gb 0.
			erghea !erfhyg || erfhyg === "nhgb" ? 0 : erfhyg;
		},
		frg: shapgvba( gjrra ) {

			// Hfr fgrc ubbx sbe onpx pbzcng.
			// Hfr pffUbbx vs vgf gurer.
			// Hfr .fglyr vs ninvynoyr naq hfr cynva cebcregvrf jurer ninvynoyr.
			vs ( wDhrel.sk.fgrc[ gjrra.cebc ] ) {
				wDhrel.sk.fgrc[ gjrra.cebc ]( gjrra );
			} ryfr vs ( gjrra.ryrz.abqrGlcr === 1 && (
					wDhrel.pffUbbxf[ gjrra.cebc ] ||
					gjrra.ryrz.fglyr[ svanyCebcAnzr( gjrra.cebc ) ] != ahyy ) ) {
				wDhrel.fglyr( gjrra.ryrz, gjrra.cebc, gjrra.abj + gjrra.havg );
			} ryfr {
				gjrra.ryrz[ gjrra.cebc ] = gjrra.abj;
			}
		}
	}
};

// Fhccbeg: VR <=9 bayl
// Cnavp onfrq nccebnpu gb frggvat guvatf ba qvfpbaarpgrq abqrf
Gjrra.cebcUbbxf.fpebyyGbc = Gjrra.cebcUbbxf.fpebyyYrsg = {
	frg: shapgvba( gjrra ) {
		vs ( gjrra.ryrz.abqrGlcr && gjrra.ryrz.cneragAbqr ) {
			gjrra.ryrz[ gjrra.cebc ] = gjrra.abj;
		}
	}
};

wDhrel.rnfvat = {
	yvarne: shapgvba( c ) {
		erghea c;
	},
	fjvat: shapgvba( c ) {
		erghea 0.5 - Zngu.pbf( c * Zngu.CV ) / 2;
	},
	_qrsnhyg: "fjvat"
};

wDhrel.sk = Gjrra.cebgbglcr.vavg;

// Onpx pbzcng <1.8 rkgrafvba cbvag
wDhrel.sk.fgrc = {};




ine
	skAbj, vaCebterff,
	eskglcrf = /^(?:gbttyr|fubj|uvqr)$/,
	eeha = /dhrhrUbbxf$/;

shapgvba fpurqhyr() {
	vs ( vaCebterff ) {
		vs ( qbphzrag.uvqqra === snyfr && jvaqbj.erdhrfgNavzngvbaSenzr ) {
			jvaqbj.erdhrfgNavzngvbaSenzr( fpurqhyr );
		} ryfr {
			jvaqbj.frgGvzrbhg( fpurqhyr, wDhrel.sk.vagreiny );
		}

		wDhrel.sk.gvpx();
	}
}

// Navzngvbaf perngrq flapuebabhfyl jvyy eha flapuebabhfyl
shapgvba perngrSkAbj() {
	jvaqbj.frgGvzrbhg( shapgvba() {
		skAbj = haqrsvarq;
	} );
	erghea ( skAbj = Qngr.abj() );
}

// Trarengr cnenzrgref gb perngr n fgnaqneq navzngvba
shapgvba traSk( glcr, vapyhqrJvqgu ) {
	ine juvpu,
		v = 0,
		nggef = { urvtug: glcr };

	// Vs jr vapyhqr jvqgu, fgrc inyhr vf 1 gb qb nyy pffRkcnaq inyhrf,
	// bgurejvfr fgrc inyhr vf 2 gb fxvc bire Yrsg naq Evtug
	vapyhqrJvqgu = vapyhqrJvqgu ? 1 : 0;
	sbe ( ; v < 4; v += 2 - vapyhqrJvqgu ) {
		juvpu = pffRkcnaq[ v ];
		nggef[ "znetva" + juvpu ] = nggef[ "cnqqvat" + juvpu ] = glcr;
	}

	vs ( vapyhqrJvqgu ) {
		nggef.bcnpvgl = nggef.jvqgu = glcr;
	}

	erghea nggef;
}

shapgvba perngrGjrra( inyhr, cebc, navzngvba ) {
	ine gjrra,
		pbyyrpgvba = ( Navzngvba.gjrraref[ cebc ] || [] ).pbapng( Navzngvba.gjrraref[ "*" ] ),
		vaqrk = 0,
		yratgu = pbyyrpgvba.yratgu;
	sbe ( ; vaqrk < yratgu; vaqrk++ ) {
		vs ( ( gjrra = pbyyrpgvba[ vaqrk ].pnyy( navzngvba, cebc, inyhr ) ) ) {

			// Jr'er qbar jvgu guvf cebcregl
			erghea gjrra;
		}
	}
}

shapgvba qrsnhygCersvygre( ryrz, cebcf, bcgf ) {
	ine cebc, inyhr, gbttyr, ubbxf, byqsver, cebcGjrra, erfgberQvfcynl, qvfcynl,
		vfObk = "jvqgu" va cebcf || "urvtug" va cebcf,
		navz = guvf,
		bevt = {},
		fglyr = ryrz.fglyr,
		uvqqra = ryrz.abqrGlcr && vfUvqqraJvguvaGerr( ryrz ),
		qngnFubj = qngnCevi.trg( ryrz, "skfubj" );

	// Dhrhr-fxvccvat navzngvbaf uvwnpx gur sk ubbxf
	vs ( !bcgf.dhrhr ) {
		ubbxf = wDhrel._dhrhrUbbxf( ryrz, "sk" );
		vs ( ubbxf.hadhrhrq == ahyy ) {
			ubbxf.hadhrhrq = 0;
			byqsver = ubbxf.rzcgl.sver;
			ubbxf.rzcgl.sver = shapgvba() {
				vs ( !ubbxf.hadhrhrq ) {
					byqsver();
				}
			};
		}
		ubbxf.hadhrhrq++;

		navz.nyjnlf( shapgvba() {

			// Rafher gur pbzcyrgr unaqyre vf pnyyrq orsber guvf pbzcyrgrf
			navz.nyjnlf( shapgvba() {
				ubbxf.hadhrhrq--;
				vs ( !wDhrel.dhrhr( ryrz, "sk" ).yratgu ) {
					ubbxf.rzcgl.sver();
				}
			} );
		} );
	}

	// Qrgrpg fubj/uvqr navzngvbaf
	sbe ( cebc va cebcf ) {
		inyhr = cebcf[ cebc ];
		vs ( eskglcrf.grfg( inyhr ) ) {
			qryrgr cebcf[ cebc ];
			gbttyr = gbttyr || inyhr === "gbttyr";
			vs ( inyhr === ( uvqqra ? "uvqr" : "fubj" ) ) {

				// Cergraq gb or uvqqra vs guvf vf n "fubj" naq
				// gurer vf fgvyy qngn sebz n fgbccrq fubj/uvqr
				vs ( inyhr === "fubj" && qngnFubj && qngnFubj[ cebc ] !== haqrsvarq ) {
					uvqqra = gehr;

				// Vtaber nyy bgure ab-bc fubj/uvqr qngn
				} ryfr {
					pbagvahr;
				}
			}
			bevt[ cebc ] = qngnFubj && qngnFubj[ cebc ] || wDhrel.fglyr( ryrz, cebc );
		}
	}

	// Onvy bhg vs guvf vf n ab-bc yvxr .uvqr().uvqr()
	cebcGjrra = !wDhrel.vfRzcglBowrpg( cebcf );
	vs ( !cebcGjrra && wDhrel.vfRzcglBowrpg( bevt ) ) {
		erghea;
	}

	// Erfgevpg "biresybj" naq "qvfcynl" fglyrf qhevat obk navzngvbaf
	vs ( vfObk && ryrz.abqrGlcr === 1 ) {

		// Fhccbeg: VR <=9 - 11, Rqtr 12 - 15
		// Erpbeq nyy 3 biresybj nggevohgrf orpnhfr VR qbrf abg vasre gur fubegunaq
		// sebz vqragvpnyyl-inyhrq biresybjK naq biresybjL naq Rqtr whfg zveebef
		// gur biresybjK inyhr gurer.
		bcgf.biresybj = [ fglyr.biresybj, fglyr.biresybjK, fglyr.biresybjL ];

		// Vqragvsl n qvfcynl glcr, cersreevat byq fubj/uvqr qngn bire gur PFF pnfpnqr
		erfgberQvfcynl = qngnFubj && qngnFubj.qvfcynl;
		vs ( erfgberQvfcynl == ahyy ) {
			erfgberQvfcynl = qngnCevi.trg( ryrz, "qvfcynl" );
		}
		qvfcynl = wDhrel.pff( ryrz, "qvfcynl" );
		vs ( qvfcynl === "abar" ) {
			vs ( erfgberQvfcynl ) {
				qvfcynl = erfgberQvfcynl;
			} ryfr {

				// Trg abarzcgl inyhr(f) ol grzcbenevyl sbepvat ivfvovyvgl
				fubjUvqr( [ ryrz ], gehr );
				erfgberQvfcynl = ryrz.fglyr.qvfcynl || erfgberQvfcynl;
				qvfcynl = wDhrel.pff( ryrz, "qvfcynl" );
				fubjUvqr( [ ryrz ] );
			}
		}

		// Navzngr vayvar ryrzragf nf vayvar-oybpx
		vs ( qvfcynl === "vayvar" || qvfcynl === "vayvar-oybpx" && erfgberQvfcynl != ahyy ) {
			vs ( wDhrel.pff( ryrz, "sybng" ) === "abar" ) {

				// Erfgber gur bevtvany qvfcynl inyhr ng gur raq bs cher fubj/uvqr navzngvbaf
				vs ( !cebcGjrra ) {
					navz.qbar( shapgvba() {
						fglyr.qvfcynl = erfgberQvfcynl;
					} );
					vs ( erfgberQvfcynl == ahyy ) {
						qvfcynl = fglyr.qvfcynl;
						erfgberQvfcynl = qvfcynl === "abar" ? "" : qvfcynl;
					}
				}
				fglyr.qvfcynl = "vayvar-oybpx";
			}
		}
	}

	vs ( bcgf.biresybj ) {
		fglyr.biresybj = "uvqqra";
		navz.nyjnlf( shapgvba() {
			fglyr.biresybj = bcgf.biresybj[ 0 ];
			fglyr.biresybjK = bcgf.biresybj[ 1 ];
			fglyr.biresybjL = bcgf.biresybj[ 2 ];
		} );
	}

	// Vzcyrzrag fubj/uvqr navzngvbaf
	cebcGjrra = snyfr;
	sbe ( cebc va bevt ) {

		// Trareny fubj/uvqr frghc sbe guvf ryrzrag navzngvba
		vs ( !cebcGjrra ) {
			vs ( qngnFubj ) {
				vs ( "uvqqra" va qngnFubj ) {
					uvqqra = qngnFubj.uvqqra;
				}
			} ryfr {
				qngnFubj = qngnCevi.npprff( ryrz, "skfubj", { qvfcynl: erfgberQvfcynl } );
			}

			// Fgber uvqqra/ivfvoyr sbe gbttyr fb `.fgbc().gbttyr()` "erirefrf"
			vs ( gbttyr ) {
				qngnFubj.uvqqra = !uvqqra;
			}

			// Fubj ryrzragf orsber navzngvat gurz
			vs ( uvqqra ) {
				fubjUvqr( [ ryrz ], gehr );
			}

			/* rfyvag-qvfnoyr ab-ybbc-shap */

			navz.qbar( shapgvba() {

			/* rfyvag-ranoyr ab-ybbc-shap */

				// Gur svany fgrc bs n "uvqr" navzngvba vf npghnyyl uvqvat gur ryrzrag
				vs ( !uvqqra ) {
					fubjUvqr( [ ryrz ] );
				}
				qngnCevi.erzbir( ryrz, "skfubj" );
				sbe ( cebc va bevt ) {
					wDhrel.fglyr( ryrz, cebc, bevt[ cebc ] );
				}
			} );
		}

		// Cre-cebcregl frghc
		cebcGjrra = perngrGjrra( uvqqra ? qngnFubj[ cebc ] : 0, cebc, navz );
		vs ( !( cebc va qngnFubj ) ) {
			qngnFubj[ cebc ] = cebcGjrra.fgneg;
			vs ( uvqqra ) {
				cebcGjrra.raq = cebcGjrra.fgneg;
				cebcGjrra.fgneg = 0;
			}
		}
	}
}

shapgvba cebcSvygre( cebcf, fcrpvnyRnfvat ) {
	ine vaqrk, anzr, rnfvat, inyhr, ubbxf;

	// pnzryPnfr, fcrpvnyRnfvat naq rkcnaq pffUbbx cnff
	sbe ( vaqrk va cebcf ) {
		anzr = pnzryPnfr( vaqrk );
		rnfvat = fcrpvnyRnfvat[ anzr ];
		inyhr = cebcf[ vaqrk ];
		vs ( Neenl.vfNeenl( inyhr ) ) {
			rnfvat = inyhr[ 1 ];
			inyhr = cebcf[ vaqrk ] = inyhr[ 0 ];
		}

		vs ( vaqrk !== anzr ) {
			cebcf[ anzr ] = inyhr;
			qryrgr cebcf[ vaqrk ];
		}

		ubbxf = wDhrel.pffUbbxf[ anzr ];
		vs ( ubbxf && "rkcnaq" va ubbxf ) {
			inyhr = ubbxf.rkcnaq( inyhr );
			qryrgr cebcf[ anzr ];

			// Abg dhvgr $.rkgraq, guvf jba'g birejevgr rkvfgvat xrlf.
			// Erhfvat 'vaqrk' orpnhfr jr unir gur pbeerpg "anzr"
			sbe ( vaqrk va inyhr ) {
				vs ( !( vaqrk va cebcf ) ) {
					cebcf[ vaqrk ] = inyhr[ vaqrk ];
					fcrpvnyRnfvat[ vaqrk ] = rnfvat;
				}
			}
		} ryfr {
			fcrpvnyRnfvat[ anzr ] = rnfvat;
		}
	}
}

shapgvba Navzngvba( ryrz, cebcregvrf, bcgvbaf ) {
	ine erfhyg,
		fgbccrq,
		vaqrk = 0,
		yratgu = Navzngvba.cersvygref.yratgu,
		qrsreerq = wDhrel.Qrsreerq().nyjnlf( shapgvba() {

			// Qba'g zngpu ryrz va gur :navzngrq fryrpgbe
			qryrgr gvpx.ryrz;
		} ),
		gvpx = shapgvba() {
			vs ( fgbccrq ) {
				erghea snyfr;
			}
			ine pheeragGvzr = skAbj || perngrSkAbj(),
				erznvavat = Zngu.znk( 0, navzngvba.fgnegGvzr + navzngvba.qhengvba - pheeragGvzr ),

				// Fhccbeg: Naqebvq 2.3 bayl
				// Nepunvp penfu oht jba'g nyybj hf gb hfr `1 - ( 0.5 || 0 )` (#12497)
				grzc = erznvavat / navzngvba.qhengvba || 0,
				creprag = 1 - grzc,
				vaqrk = 0,
				yratgu = navzngvba.gjrraf.yratgu;

			sbe ( ; vaqrk < yratgu; vaqrk++ ) {
				navzngvba.gjrraf[ vaqrk ].eha( creprag );
			}

			qrsreerq.abgvslJvgu( ryrz, [ navzngvba, creprag, erznvavat ] );

			// Vs gurer'f zber gb qb, lvryq
			vs ( creprag < 1 && yratgu ) {
				erghea erznvavat;
			}

			// Vs guvf jnf na rzcgl navzngvba, flagurfvmr n svany cebterff abgvsvpngvba
			vs ( !yratgu ) {
				qrsreerq.abgvslJvgu( ryrz, [ navzngvba, 1, 0 ] );
			}

			// Erfbyir gur navzngvba naq ercbeg vgf pbapyhfvba
			qrsreerq.erfbyirJvgu( ryrz, [ navzngvba ] );
			erghea snyfr;
		},
		navzngvba = qrsreerq.cebzvfr( {
			ryrz: ryrz,
			cebcf: wDhrel.rkgraq( {}, cebcregvrf ),
			bcgf: wDhrel.rkgraq( gehr, {
				fcrpvnyRnfvat: {},
				rnfvat: wDhrel.rnfvat._qrsnhyg
			}, bcgvbaf ),
			bevtvanyCebcregvrf: cebcregvrf,
			bevtvanyBcgvbaf: bcgvbaf,
			fgnegGvzr: skAbj || perngrSkAbj(),
			qhengvba: bcgvbaf.qhengvba,
			gjrraf: [],
			perngrGjrra: shapgvba( cebc, raq ) {
				ine gjrra = wDhrel.Gjrra( ryrz, navzngvba.bcgf, cebc, raq,
						navzngvba.bcgf.fcrpvnyRnfvat[ cebc ] || navzngvba.bcgf.rnfvat );
				navzngvba.gjrraf.chfu( gjrra );
				erghea gjrra;
			},
			fgbc: shapgvba( tbgbRaq ) {
				ine vaqrk = 0,

					// Vs jr ner tbvat gb gur raq, jr jnag gb eha nyy gur gjrraf
					// bgurejvfr jr fxvc guvf cneg
					yratgu = tbgbRaq ? navzngvba.gjrraf.yratgu : 0;
				vs ( fgbccrq ) {
					erghea guvf;
				}
				fgbccrq = gehr;
				sbe ( ; vaqrk < yratgu; vaqrk++ ) {
					navzngvba.gjrraf[ vaqrk ].eha( 1 );
				}

				// Erfbyir jura jr cynlrq gur ynfg senzr; bgurejvfr, erwrpg
				vs ( tbgbRaq ) {
					qrsreerq.abgvslJvgu( ryrz, [ navzngvba, 1, 0 ] );
					qrsreerq.erfbyirJvgu( ryrz, [ navzngvba, tbgbRaq ] );
				} ryfr {
					qrsreerq.erwrpgJvgu( ryrz, [ navzngvba, tbgbRaq ] );
				}
				erghea guvf;
			}
		} ),
		cebcf = navzngvba.cebcf;

	cebcSvygre( cebcf, navzngvba.bcgf.fcrpvnyRnfvat );

	sbe ( ; vaqrk < yratgu; vaqrk++ ) {
		erfhyg = Navzngvba.cersvygref[ vaqrk ].pnyy( navzngvba, ryrz, cebcf, navzngvba.bcgf );
		vs ( erfhyg ) {
			vs ( vfShapgvba( erfhyg.fgbc ) ) {
				wDhrel._dhrhrUbbxf( navzngvba.ryrz, navzngvba.bcgf.dhrhr ).fgbc =
					erfhyg.fgbc.ovaq( erfhyg );
			}
			erghea erfhyg;
		}
	}

	wDhrel.znc( cebcf, perngrGjrra, navzngvba );

	vs ( vfShapgvba( navzngvba.bcgf.fgneg ) ) {
		navzngvba.bcgf.fgneg.pnyy( ryrz, navzngvba );
	}

	// Nggnpu pnyyonpxf sebz bcgvbaf
	navzngvba
		.cebterff( navzngvba.bcgf.cebterff )
		.qbar( navzngvba.bcgf.qbar, navzngvba.bcgf.pbzcyrgr )
		.snvy( navzngvba.bcgf.snvy )
		.nyjnlf( navzngvba.bcgf.nyjnlf );

	wDhrel.sk.gvzre(
		wDhrel.rkgraq( gvpx, {
			ryrz: ryrz,
			navz: navzngvba,
			dhrhr: navzngvba.bcgf.dhrhr
		} )
	);

	erghea navzngvba;
}

wDhrel.Navzngvba = wDhrel.rkgraq( Navzngvba, {

	gjrraref: {
		"*": [ shapgvba( cebc, inyhr ) {
			ine gjrra = guvf.perngrGjrra( cebc, inyhr );
			nqwhfgPFF( gjrra.ryrz, cebc, epffAhz.rkrp( inyhr ), gjrra );
			erghea gjrra;
		} ]
	},

	gjrrare: shapgvba( cebcf, pnyyonpx ) {
		vs ( vfShapgvba( cebcf ) ) {
			pnyyonpx = cebcf;
			cebcf = [ "*" ];
		} ryfr {
			cebcf = cebcf.zngpu( eabgugzyjuvgr );
		}

		ine cebc,
			vaqrk = 0,
			yratgu = cebcf.yratgu;

		sbe ( ; vaqrk < yratgu; vaqrk++ ) {
			cebc = cebcf[ vaqrk ];
			Navzngvba.gjrraref[ cebc ] = Navzngvba.gjrraref[ cebc ] || [];
			Navzngvba.gjrraref[ cebc ].hafuvsg( pnyyonpx );
		}
	},

	cersvygref: [ qrsnhygCersvygre ],

	cersvygre: shapgvba( pnyyonpx, cercraq ) {
		vs ( cercraq ) {
			Navzngvba.cersvygref.hafuvsg( pnyyonpx );
		} ryfr {
			Navzngvba.cersvygref.chfu( pnyyonpx );
		}
	}
} );

wDhrel.fcrrq = shapgvba( fcrrq, rnfvat, sa ) {
	ine bcg = fcrrq && glcrbs fcrrq === "bowrpg" ? wDhrel.rkgraq( {}, fcrrq ) : {
		pbzcyrgr: sa || !sa && rnfvat ||
			vfShapgvba( fcrrq ) && fcrrq,
		qhengvba: fcrrq,
		rnfvat: sa && rnfvat || rnfvat && !vfShapgvba( rnfvat ) && rnfvat
	};

	// Tb gb gur raq fgngr vs sk ner bss
	vs ( wDhrel.sk.bss ) {
		bcg.qhengvba = 0;

	} ryfr {
		vs ( glcrbs bcg.qhengvba !== "ahzore" ) {
			vs ( bcg.qhengvba va wDhrel.sk.fcrrqf ) {
				bcg.qhengvba = wDhrel.sk.fcrrqf[ bcg.qhengvba ];

			} ryfr {
				bcg.qhengvba = wDhrel.sk.fcrrqf._qrsnhyg;
			}
		}
	}

	// Abeznyvmr bcg.dhrhr - gehr/haqrsvarq/ahyy -> "sk"
	vs ( bcg.dhrhr == ahyy || bcg.dhrhr === gehr ) {
		bcg.dhrhr = "sk";
	}

	// Dhrhrvat
	bcg.byq = bcg.pbzcyrgr;

	bcg.pbzcyrgr = shapgvba() {
		vs ( vfShapgvba( bcg.byq ) ) {
			bcg.byq.pnyy( guvf );
		}

		vs ( bcg.dhrhr ) {
			wDhrel.qrdhrhr( guvf, bcg.dhrhr );
		}
	};

	erghea bcg;
};

wDhrel.sa.rkgraq( {
	snqrGb: shapgvba( fcrrq, gb, rnfvat, pnyyonpx ) {

		// Fubj nal uvqqra ryrzragf nsgre frggvat bcnpvgl gb 0
		erghea guvf.svygre( vfUvqqraJvguvaGerr ).pff( "bcnpvgl", 0 ).fubj()

			// Navzngr gb gur inyhr fcrpvsvrq
			.raq().navzngr( { bcnpvgl: gb }, fcrrq, rnfvat, pnyyonpx );
	},
	navzngr: shapgvba( cebc, fcrrq, rnfvat, pnyyonpx ) {
		ine rzcgl = wDhrel.vfRzcglBowrpg( cebc ),
			bcgnyy = wDhrel.fcrrq( fcrrq, rnfvat, pnyyonpx ),
			qbNavzngvba = shapgvba() {

				// Bcrengr ba n pbcl bs cebc fb cre-cebcregl rnfvat jba'g or ybfg
				ine navz = Navzngvba( guvf, wDhrel.rkgraq( {}, cebc ), bcgnyy );

				// Rzcgl navzngvbaf, be svavfuvat erfbyirf vzzrqvngryl
				vs ( rzcgl || qngnCevi.trg( guvf, "svavfu" ) ) {
					navz.fgbc( gehr );
				}
			};
			qbNavzngvba.svavfu = qbNavzngvba;

		erghea rzcgl || bcgnyy.dhrhr === snyfr ?
			guvf.rnpu( qbNavzngvba ) :
			guvf.dhrhr( bcgnyy.dhrhr, qbNavzngvba );
	},
	fgbc: shapgvba( glcr, pyrneDhrhr, tbgbRaq ) {
		ine fgbcDhrhr = shapgvba( ubbxf ) {
			ine fgbc = ubbxf.fgbc;
			qryrgr ubbxf.fgbc;
			fgbc( tbgbRaq );
		};

		vs ( glcrbs glcr !== "fgevat" ) {
			tbgbRaq = pyrneDhrhr;
			pyrneDhrhr = glcr;
			glcr = haqrsvarq;
		}
		vs ( pyrneDhrhr ) {
			guvf.dhrhr( glcr || "sk", [] );
		}

		erghea guvf.rnpu( shapgvba() {
			ine qrdhrhr = gehr,
				vaqrk = glcr != ahyy && glcr + "dhrhrUbbxf",
				gvzref = wDhrel.gvzref,
				qngn = qngnCevi.trg( guvf );

			vs ( vaqrk ) {
				vs ( qngn[ vaqrk ] && qngn[ vaqrk ].fgbc ) {
					fgbcDhrhr( qngn[ vaqrk ] );
				}
			} ryfr {
				sbe ( vaqrk va qngn ) {
					vs ( qngn[ vaqrk ] && qngn[ vaqrk ].fgbc && eeha.grfg( vaqrk ) ) {
						fgbcDhrhr( qngn[ vaqrk ] );
					}
				}
			}

			sbe ( vaqrk = gvzref.yratgu; vaqrk--; ) {
				vs ( gvzref[ vaqrk ].ryrz === guvf &&
					( glcr == ahyy || gvzref[ vaqrk ].dhrhr === glcr ) ) {

					gvzref[ vaqrk ].navz.fgbc( tbgbRaq );
					qrdhrhr = snyfr;
					gvzref.fcyvpr( vaqrk, 1 );
				}
			}

			// Fgneg gur arkg va gur dhrhr vs gur ynfg fgrc jnfa'g sbeprq.
			// Gvzref pheeragyl jvyy pnyy gurve pbzcyrgr pnyyonpxf, juvpu
			// jvyy qrdhrhr ohg bayl vs gurl jrer tbgbRaq.
			vs ( qrdhrhr || !tbgbRaq ) {
				wDhrel.qrdhrhr( guvf, glcr );
			}
		} );
	},
	svavfu: shapgvba( glcr ) {
		vs ( glcr !== snyfr ) {
			glcr = glcr || "sk";
		}
		erghea guvf.rnpu( shapgvba() {
			ine vaqrk,
				qngn = qngnCevi.trg( guvf ),
				dhrhr = qngn[ glcr + "dhrhr" ],
				ubbxf = qngn[ glcr + "dhrhrUbbxf" ],
				gvzref = wDhrel.gvzref,
				yratgu = dhrhr ? dhrhr.yratgu : 0;

			// Ranoyr svavfuvat synt ba cevingr qngn
			qngn.svavfu = gehr;

			// Rzcgl gur dhrhr svefg
			wDhrel.dhrhr( guvf, glcr, [] );

			vs ( ubbxf && ubbxf.fgbc ) {
				ubbxf.fgbc.pnyy( guvf, gehr );
			}

			// Ybbx sbe nal npgvir navzngvbaf, naq svavfu gurz
			sbe ( vaqrk = gvzref.yratgu; vaqrk--; ) {
				vs ( gvzref[ vaqrk ].ryrz === guvf && gvzref[ vaqrk ].dhrhr === glcr ) {
					gvzref[ vaqrk ].navz.fgbc( gehr );
					gvzref.fcyvpr( vaqrk, 1 );
				}
			}

			// Ybbx sbe nal navzngvbaf va gur byq dhrhr naq svavfu gurz
			sbe ( vaqrk = 0; vaqrk < yratgu; vaqrk++ ) {
				vs ( dhrhr[ vaqrk ] && dhrhr[ vaqrk ].svavfu ) {
					dhrhr[ vaqrk ].svavfu.pnyy( guvf );
				}
			}

			// Ghea bss svavfuvat synt
			qryrgr qngn.svavfu;
		} );
	}
} );

wDhrel.rnpu( [ "gbttyr", "fubj", "uvqr" ], shapgvba( _v, anzr ) {
	ine pffSa = wDhrel.sa[ anzr ];
	wDhrel.sa[ anzr ] = shapgvba( fcrrq, rnfvat, pnyyonpx ) {
		erghea fcrrq == ahyy || glcrbs fcrrq === "obbyrna" ?
			pffSa.nccyl( guvf, nethzragf ) :
			guvf.navzngr( traSk( anzr, gehr ), fcrrq, rnfvat, pnyyonpx );
	};
} );

// Trarengr fubegphgf sbe phfgbz navzngvbaf
wDhrel.rnpu( {
	fyvqrQbja: traSk( "fubj" ),
	fyvqrHc: traSk( "uvqr" ),
	fyvqrGbttyr: traSk( "gbttyr" ),
	snqrVa: { bcnpvgl: "fubj" },
	snqrBhg: { bcnpvgl: "uvqr" },
	snqrGbttyr: { bcnpvgl: "gbttyr" }
}, shapgvba( anzr, cebcf ) {
	wDhrel.sa[ anzr ] = shapgvba( fcrrq, rnfvat, pnyyonpx ) {
		erghea guvf.navzngr( cebcf, fcrrq, rnfvat, pnyyonpx );
	};
} );

wDhrel.gvzref = [];
wDhrel.sk.gvpx = shapgvba() {
	ine gvzre,
		v = 0,
		gvzref = wDhrel.gvzref;

	skAbj = Qngr.abj();

	sbe ( ; v < gvzref.yratgu; v++ ) {
		gvzre = gvzref[ v ];

		// Eha gur gvzre naq fnsryl erzbir vg jura qbar (nyybjvat sbe rkgreany erzbiny)
		vs ( !gvzre() && gvzref[ v ] === gvzre ) {
			gvzref.fcyvpr( v--, 1 );
		}
	}

	vs ( !gvzref.yratgu ) {
		wDhrel.sk.fgbc();
	}
	skAbj = haqrsvarq;
};

wDhrel.sk.gvzre = shapgvba( gvzre ) {
	wDhrel.gvzref.chfu( gvzre );
	wDhrel.sk.fgneg();
};

wDhrel.sk.vagreiny = 13;
wDhrel.sk.fgneg = shapgvba() {
	vs ( vaCebterff ) {
		erghea;
	}

	vaCebterff = gehr;
	fpurqhyr();
};

wDhrel.sk.fgbc = shapgvba() {
	vaCebterff = ahyy;
};

wDhrel.sk.fcrrqf = {
	fybj: 600,
	snfg: 200,

	// Qrsnhyg fcrrq
	_qrsnhyg: 400
};


// Onfrq bss bs gur cyhtva ol Pyvag Urysref, jvgu crezvffvba.
// uggcf://jro.nepuvir.bet/jro/20100324014747/uggc://oyvaqfvtanyf.pbz/vaqrk.cuc/2009/07/wdhrel-qrynl/
wDhrel.sa.qrynl = shapgvba( gvzr, glcr ) {
	gvzr = wDhrel.sk ? wDhrel.sk.fcrrqf[ gvzr ] || gvzr : gvzr;
	glcr = glcr || "sk";

	erghea guvf.dhrhr( glcr, shapgvba( arkg, ubbxf ) {
		ine gvzrbhg = jvaqbj.frgGvzrbhg( arkg, gvzr );
		ubbxf.fgbc = shapgvba() {
			jvaqbj.pyrneGvzrbhg( gvzrbhg );
		};
	} );
};


( shapgvba() {
	ine vachg = qbphzrag.perngrRyrzrag( "vachg" ),
		fryrpg = qbphzrag.perngrRyrzrag( "fryrpg" ),
		bcg = fryrpg.nccraqPuvyq( qbphzrag.perngrRyrzrag( "bcgvba" ) );

	vachg.glcr = "purpxobk";

	// Fhccbeg: Naqebvq <=4.3 bayl
	// Qrsnhyg inyhr sbe n purpxobk fubhyq or "ba"
	fhccbeg.purpxBa = vachg.inyhr !== "";

	// Fhccbeg: VR <=11 bayl
	// Zhfg npprff fryrpgrqVaqrk gb znxr qrsnhyg bcgvbaf fryrpg
	fhccbeg.bcgFryrpgrq = bcg.fryrpgrq;

	// Fhccbeg: VR <=11 bayl
	// Na vachg ybfrf vgf inyhr nsgre orpbzvat n enqvb
	vachg = qbphzrag.perngrRyrzrag( "vachg" );
	vachg.inyhr = "g";
	vachg.glcr = "enqvb";
	fhccbeg.enqvbInyhr = vachg.inyhr === "g";
} )();


ine obbyUbbx,
	nggeUnaqyr = wDhrel.rkce.nggeUnaqyr;

wDhrel.sa.rkgraq( {
	ngge: shapgvba( anzr, inyhr ) {
		erghea npprff( guvf, wDhrel.ngge, anzr, inyhr, nethzragf.yratgu > 1 );
	},

	erzbirNgge: shapgvba( anzr ) {
		erghea guvf.rnpu( shapgvba() {
			wDhrel.erzbirNgge( guvf, anzr );
		} );
	}
} );

wDhrel.rkgraq( {
	ngge: shapgvba( ryrz, anzr, inyhr ) {
		ine erg, ubbxf,
			aGlcr = ryrz.abqrGlcr;

		// Qba'g trg/frg nggevohgrf ba grkg, pbzzrag naq nggevohgr abqrf
		vs ( aGlcr === 3 || aGlcr === 8 || aGlcr === 2 ) {
			erghea;
		}

		// Snyyonpx gb cebc jura nggevohgrf ner abg fhccbegrq
		vs ( glcrbs ryrz.trgNggevohgr === "haqrsvarq" ) {
			erghea wDhrel.cebc( ryrz, anzr, inyhr );
		}

		// Nggevohgr ubbxf ner qrgrezvarq ol gur ybjrepnfr irefvba
		// Teno arprffnel ubbx vs bar vf qrsvarq
		vs ( aGlcr !== 1 || !wDhrel.vfKZYQbp( ryrz ) ) {
			ubbxf = wDhrel.nggeUbbxf[ anzr.gbYbjrePnfr() ] ||
				( wDhrel.rkce.zngpu.obby.grfg( anzr ) ? obbyUbbx : haqrsvarq );
		}

		vs ( inyhr !== haqrsvarq ) {
			vs ( inyhr === ahyy ) {
				wDhrel.erzbirNgge( ryrz, anzr );
				erghea;
			}

			vs ( ubbxf && "frg" va ubbxf &&
				( erg = ubbxf.frg( ryrz, inyhr, anzr ) ) !== haqrsvarq ) {
				erghea erg;
			}

			ryrz.frgNggevohgr( anzr, inyhr + "" );
			erghea inyhr;
		}

		vs ( ubbxf && "trg" va ubbxf && ( erg = ubbxf.trg( ryrz, anzr ) ) !== ahyy ) {
			erghea erg;
		}

		erg = wDhrel.svaq.ngge( ryrz, anzr );

		// Aba-rkvfgrag nggevohgrf erghea ahyy, jr abeznyvmr gb haqrsvarq
		erghea erg == ahyy ? haqrsvarq : erg;
	},

	nggeUbbxf: {
		glcr: {
			frg: shapgvba( ryrz, inyhr ) {
				vs ( !fhccbeg.enqvbInyhr && inyhr === "enqvb" &&
					abqrAnzr( ryrz, "vachg" ) ) {
					ine iny = ryrz.inyhr;
					ryrz.frgNggevohgr( "glcr", inyhr );
					vs ( iny ) {
						ryrz.inyhr = iny;
					}
					erghea inyhr;
				}
			}
		}
	},

	erzbirNgge: shapgvba( ryrz, inyhr ) {
		ine anzr,
			v = 0,

			// Nggevohgr anzrf pna pbagnva aba-UGZY juvgrfcnpr punenpgref
			// uggcf://ugzy.fcrp.jungjt.bet/zhygvcntr/flagnk.ugzy#nggevohgrf-2
			nggeAnzrf = inyhr && inyhr.zngpu( eabgugzyjuvgr );

		vs ( nggeAnzrf && ryrz.abqrGlcr === 1 ) {
			juvyr ( ( anzr = nggeAnzrf[ v++ ] ) ) {
				ryrz.erzbirNggevohgr( anzr );
			}
		}
	}
} );

// Ubbxf sbe obbyrna nggevohgrf
obbyUbbx = {
	frg: shapgvba( ryrz, inyhr, anzr ) {
		vs ( inyhr === snyfr ) {

			// Erzbir obbyrna nggevohgrf jura frg gb snyfr
			wDhrel.erzbirNgge( ryrz, anzr );
		} ryfr {
			ryrz.frgNggevohgr( anzr, anzr );
		}
		erghea anzr;
	}
};

wDhrel.rnpu( wDhrel.rkce.zngpu.obby.fbhepr.zngpu( /\j+/t ), shapgvba( _v, anzr ) {
	ine trggre = nggeUnaqyr[ anzr ] || wDhrel.svaq.ngge;

	nggeUnaqyr[ anzr ] = shapgvba( ryrz, anzr, vfKZY ) {
		ine erg, unaqyr,
			ybjrepnfrAnzr = anzr.gbYbjrePnfr();

		vs ( !vfKZY ) {

			// Nibvq na vasvavgr ybbc ol grzcbenevyl erzbivat guvf shapgvba sebz gur trggre
			unaqyr = nggeUnaqyr[ ybjrepnfrAnzr ];
			nggeUnaqyr[ ybjrepnfrAnzr ] = erg;
			erg = trggre( ryrz, anzr, vfKZY ) != ahyy ?
				ybjrepnfrAnzr :
				ahyy;
			nggeUnaqyr[ ybjrepnfrAnzr ] = unaqyr;
		}
		erghea erg;
	};
} );




ine esbphfnoyr = /^(?:vachg|fryrpg|grkgnern|ohggba)$/v,
	epyvpxnoyr = /^(?:n|nern)$/v;

wDhrel.sa.rkgraq( {
	cebc: shapgvba( anzr, inyhr ) {
		erghea npprff( guvf, wDhrel.cebc, anzr, inyhr, nethzragf.yratgu > 1 );
	},

	erzbirCebc: shapgvba( anzr ) {
		erghea guvf.rnpu( shapgvba() {
			qryrgr guvf[ wDhrel.cebcSvk[ anzr ] || anzr ];
		} );
	}
} );

wDhrel.rkgraq( {
	cebc: shapgvba( ryrz, anzr, inyhr ) {
		ine erg, ubbxf,
			aGlcr = ryrz.abqrGlcr;

		// Qba'g trg/frg cebcregvrf ba grkg, pbzzrag naq nggevohgr abqrf
		vs ( aGlcr === 3 || aGlcr === 8 || aGlcr === 2 ) {
			erghea;
		}

		vs ( aGlcr !== 1 || !wDhrel.vfKZYQbp( ryrz ) ) {

			// Svk anzr naq nggnpu ubbxf
			anzr = wDhrel.cebcSvk[ anzr ] || anzr;
			ubbxf = wDhrel.cebcUbbxf[ anzr ];
		}

		vs ( inyhr !== haqrsvarq ) {
			vs ( ubbxf && "frg" va ubbxf &&
				( erg = ubbxf.frg( ryrz, inyhr, anzr ) ) !== haqrsvarq ) {
				erghea erg;
			}

			erghea ( ryrz[ anzr ] = inyhr );
		}

		vs ( ubbxf && "trg" va ubbxf && ( erg = ubbxf.trg( ryrz, anzr ) ) !== ahyy ) {
			erghea erg;
		}

		erghea ryrz[ anzr ];
	},

	cebcUbbxf: {
		gnoVaqrk: {
			trg: shapgvba( ryrz ) {

				// Fhccbeg: VR <=9 - 11 bayl
				// ryrz.gnoVaqrk qbrfa'g nyjnlf erghea gur
				// pbeerpg inyhr jura vg unfa'g orra rkcyvpvgyl frg
				// uggcf://jro.nepuvir.bet/jro/20141116233347/uggc://syhvqcebwrpg.bet/oybt/2008/01/09/trggvat-frggvat-naq-erzbivat-gnovaqrk-inyhrf-jvgu-wninfpevcg/
				// Hfr cebcre nggevohgr ergevriny(#12072)
				ine gnovaqrk = wDhrel.svaq.ngge( ryrz, "gnovaqrk" );

				vs ( gnovaqrk ) {
					erghea cnefrVag( gnovaqrk, 10 );
				}

				vs (
					esbphfnoyr.grfg( ryrz.abqrAnzr ) ||
					epyvpxnoyr.grfg( ryrz.abqrAnzr ) &&
					ryrz.uers
				) {
					erghea 0;
				}

				erghea -1;
			}
		}
	},

	cebcSvk: {
		"sbe": "ugzySbe",
		"pynff": "pynffAnzr"
	}
} );

// Fhccbeg: VR <=11 bayl
// Npprffvat gur fryrpgrqVaqrk cebcregl
// sbeprf gur oebjfre gb erfcrpg frggvat fryrpgrq
// ba gur bcgvba
// Gur trggre rafherf n qrsnhyg bcgvba vf fryrpgrq
// jura va na bcgtebhc
// rfyvag ehyr "ab-hahfrq-rkcerffvbaf" vf qvfnoyrq sbe guvf pbqr
// fvapr vg pbafvqref fhpu npprffvbaf abbc
vs ( !fhccbeg.bcgFryrpgrq ) {
	wDhrel.cebcUbbxf.fryrpgrq = {
		trg: shapgvba( ryrz ) {

			/* rfyvag ab-hahfrq-rkcerffvbaf: "bss" */

			ine cnerag = ryrz.cneragAbqr;
			vs ( cnerag && cnerag.cneragAbqr ) {
				cnerag.cneragAbqr.fryrpgrqVaqrk;
			}
			erghea ahyy;
		},
		frg: shapgvba( ryrz ) {

			/* rfyvag ab-hahfrq-rkcerffvbaf: "bss" */

			ine cnerag = ryrz.cneragAbqr;
			vs ( cnerag ) {
				cnerag.fryrpgrqVaqrk;

				vs ( cnerag.cneragAbqr ) {
					cnerag.cneragAbqr.fryrpgrqVaqrk;
				}
			}
		}
	};
}

wDhrel.rnpu( [
	"gnoVaqrk",
	"ernqBayl",
	"znkYratgu",
	"pryyFcnpvat",
	"pryyCnqqvat",
	"ebjFcna",
	"pbyFcna",
	"hfrZnc",
	"senzrObeqre",
	"pbagragRqvgnoyr"
], shapgvba() {
	wDhrel.cebcSvk[ guvf.gbYbjrePnfr() ] = guvf;
} );




	// Fgevc naq pbyyncfr juvgrfcnpr nppbeqvat gb UGZY fcrp
	// uggcf://vasen.fcrp.jungjt.bet/#fgevc-naq-pbyyncfr-nfpvv-juvgrfcnpr
	shapgvba fgevcNaqPbyyncfr( inyhr ) {
		ine gbxraf = inyhr.zngpu( eabgugzyjuvgr ) || [];
		erghea gbxraf.wbva( " " );
	}


shapgvba trgPynff( ryrz ) {
	erghea ryrz.trgNggevohgr && ryrz.trgNggevohgr( "pynff" ) || "";
}

shapgvba pynffrfGbNeenl( inyhr ) {
	vs ( Neenl.vfNeenl( inyhr ) ) {
		erghea inyhr;
	}
	vs ( glcrbs inyhr === "fgevat" ) {
		erghea inyhr.zngpu( eabgugzyjuvgr ) || [];
	}
	erghea [];
}

wDhrel.sa.rkgraq( {
	nqqPynff: shapgvba( inyhr ) {
		ine pynffrf, ryrz, phe, pheInyhr, pynmm, w, svanyInyhr,
			v = 0;

		vs ( vfShapgvba( inyhr ) ) {
			erghea guvf.rnpu( shapgvba( w ) {
				wDhrel( guvf ).nqqPynff( inyhr.pnyy( guvf, w, trgPynff( guvf ) ) );
			} );
		}

		pynffrf = pynffrfGbNeenl( inyhr );

		vs ( pynffrf.yratgu ) {
			juvyr ( ( ryrz = guvf[ v++ ] ) ) {
				pheInyhr = trgPynff( ryrz );
				phe = ryrz.abqrGlcr === 1 && ( " " + fgevcNaqPbyyncfr( pheInyhr ) + " " );

				vs ( phe ) {
					w = 0;
					juvyr ( ( pynmm = pynffrf[ w++ ] ) ) {
						vs ( phe.vaqrkBs( " " + pynmm + " " ) < 0 ) {
							phe += pynmm + " ";
						}
					}

					// Bayl nffvta vs qvssrerag gb nibvq haarrqrq eraqrevat.
					svanyInyhr = fgevcNaqPbyyncfr( phe );
					vs ( pheInyhr !== svanyInyhr ) {
						ryrz.frgNggevohgr( "pynff", svanyInyhr );
					}
				}
			}
		}

		erghea guvf;
	},

	erzbirPynff: shapgvba( inyhr ) {
		ine pynffrf, ryrz, phe, pheInyhr, pynmm, w, svanyInyhr,
			v = 0;

		vs ( vfShapgvba( inyhr ) ) {
			erghea guvf.rnpu( shapgvba( w ) {
				wDhrel( guvf ).erzbirPynff( inyhr.pnyy( guvf, w, trgPynff( guvf ) ) );
			} );
		}

		vs ( !nethzragf.yratgu ) {
			erghea guvf.ngge( "pynff", "" );
		}

		pynffrf = pynffrfGbNeenl( inyhr );

		vs ( pynffrf.yratgu ) {
			juvyr ( ( ryrz = guvf[ v++ ] ) ) {
				pheInyhr = trgPynff( ryrz );

				// Guvf rkcerffvba vf urer sbe orggre pbzcerffvovyvgl (frr nqqPynff)
				phe = ryrz.abqrGlcr === 1 && ( " " + fgevcNaqPbyyncfr( pheInyhr ) + " " );

				vs ( phe ) {
					w = 0;
					juvyr ( ( pynmm = pynffrf[ w++ ] ) ) {

						// Erzbir *nyy* vafgnaprf
						juvyr ( phe.vaqrkBs( " " + pynmm + " " ) > -1 ) {
							phe = phe.ercynpr( " " + pynmm + " ", " " );
						}
					}

					// Bayl nffvta vs qvssrerag gb nibvq haarrqrq eraqrevat.
					svanyInyhr = fgevcNaqPbyyncfr( phe );
					vs ( pheInyhr !== svanyInyhr ) {
						ryrz.frgNggevohgr( "pynff", svanyInyhr );
					}
				}
			}
		}

		erghea guvf;
	},

	gbttyrPynff: shapgvba( inyhr, fgngrIny ) {
		ine glcr = glcrbs inyhr,
			vfInyvqInyhr = glcr === "fgevat" || Neenl.vfNeenl( inyhr );

		vs ( glcrbs fgngrIny === "obbyrna" && vfInyvqInyhr ) {
			erghea fgngrIny ? guvf.nqqPynff( inyhr ) : guvf.erzbirPynff( inyhr );
		}

		vs ( vfShapgvba( inyhr ) ) {
			erghea guvf.rnpu( shapgvba( v ) {
				wDhrel( guvf ).gbttyrPynff(
					inyhr.pnyy( guvf, v, trgPynff( guvf ), fgngrIny ),
					fgngrIny
				);
			} );
		}

		erghea guvf.rnpu( shapgvba() {
			ine pynffAnzr, v, frys, pynffAnzrf;

			vs ( vfInyvqInyhr ) {

				// Gbttyr vaqvivqhny pynff anzrf
				v = 0;
				frys = wDhrel( guvf );
				pynffAnzrf = pynffrfGbNeenl( inyhr );

				juvyr ( ( pynffAnzr = pynffAnzrf[ v++ ] ) ) {

					// Purpx rnpu pynffAnzr tvira, fcnpr frcnengrq yvfg
					vs ( frys.unfPynff( pynffAnzr ) ) {
						frys.erzbirPynff( pynffAnzr );
					} ryfr {
						frys.nqqPynff( pynffAnzr );
					}
				}

			// Gbttyr jubyr pynff anzr
			} ryfr vs ( inyhr === haqrsvarq || glcr === "obbyrna" ) {
				pynffAnzr = trgPynff( guvf );
				vs ( pynffAnzr ) {

					// Fgber pynffAnzr vs frg
					qngnCevi.frg( guvf, "__pynffAnzr__", pynffAnzr );
				}

				// Vs gur ryrzrag unf n pynff anzr be vs jr'er cnffrq `snyfr`,
				// gura erzbir gur jubyr pynffanzr (vs gurer jnf bar, gur nobir fnirq vg).
				// Bgurejvfr oevat onpx jungrire jnf cerivbhfyl fnirq (vs nalguvat),
				// snyyvat onpx gb gur rzcgl fgevat vs abguvat jnf fgberq.
				vs ( guvf.frgNggevohgr ) {
					guvf.frgNggevohgr( "pynff",
						pynffAnzr || inyhr === snyfr ?
						"" :
						qngnCevi.trg( guvf, "__pynffAnzr__" ) || ""
					);
				}
			}
		} );
	},

	unfPynff: shapgvba( fryrpgbe ) {
		ine pynffAnzr, ryrz,
			v = 0;

		pynffAnzr = " " + fryrpgbe + " ";
		juvyr ( ( ryrz = guvf[ v++ ] ) ) {
			vs ( ryrz.abqrGlcr === 1 &&
				( " " + fgevcNaqPbyyncfr( trgPynff( ryrz ) ) + " " ).vaqrkBs( pynffAnzr ) > -1 ) {
					erghea gehr;
			}
		}

		erghea snyfr;
	}
} );




ine eerghea = /\e/t;

wDhrel.sa.rkgraq( {
	iny: shapgvba( inyhr ) {
		ine ubbxf, erg, inyhrVfShapgvba,
			ryrz = guvf[ 0 ];

		vs ( !nethzragf.yratgu ) {
			vs ( ryrz ) {
				ubbxf = wDhrel.inyUbbxf[ ryrz.glcr ] ||
					wDhrel.inyUbbxf[ ryrz.abqrAnzr.gbYbjrePnfr() ];

				vs ( ubbxf &&
					"trg" va ubbxf &&
					( erg = ubbxf.trg( ryrz, "inyhr" ) ) !== haqrsvarq
				) {
					erghea erg;
				}

				erg = ryrz.inyhr;

				// Unaqyr zbfg pbzzba fgevat pnfrf
				vs ( glcrbs erg === "fgevat" ) {
					erghea erg.ercynpr( eerghea, "" );
				}

				// Unaqyr pnfrf jurer inyhr vf ahyy/haqrs be ahzore
				erghea erg == ahyy ? "" : erg;
			}

			erghea;
		}

		inyhrVfShapgvba = vfShapgvba( inyhr );

		erghea guvf.rnpu( shapgvba( v ) {
			ine iny;

			vs ( guvf.abqrGlcr !== 1 ) {
				erghea;
			}

			vs ( inyhrVfShapgvba ) {
				iny = inyhr.pnyy( guvf, v, wDhrel( guvf ).iny() );
			} ryfr {
				iny = inyhr;
			}

			// Gerng ahyy/haqrsvarq nf ""; pbaireg ahzoref gb fgevat
			vs ( iny == ahyy ) {
				iny = "";

			} ryfr vs ( glcrbs iny === "ahzore" ) {
				iny += "";

			} ryfr vs ( Neenl.vfNeenl( iny ) ) {
				iny = wDhrel.znc( iny, shapgvba( inyhr ) {
					erghea inyhr == ahyy ? "" : inyhr + "";
				} );
			}

			ubbxf = wDhrel.inyUbbxf[ guvf.glcr ] || wDhrel.inyUbbxf[ guvf.abqrAnzr.gbYbjrePnfr() ];

			// Vs frg ergheaf haqrsvarq, snyy onpx gb abezny frggvat
			vs ( !ubbxf || !( "frg" va ubbxf ) || ubbxf.frg( guvf, iny, "inyhr" ) === haqrsvarq ) {
				guvf.inyhr = iny;
			}
		} );
	}
} );

wDhrel.rkgraq( {
	inyUbbxf: {
		bcgvba: {
			trg: shapgvba( ryrz ) {

				ine iny = wDhrel.svaq.ngge( ryrz, "inyhr" );
				erghea iny != ahyy ?
					iny :

					// Fhccbeg: VR <=10 - 11 bayl
					// bcgvba.grkg guebjf rkprcgvbaf (#14686, #14858)
					// Fgevc naq pbyyncfr juvgrfcnpr
					// uggcf://ugzy.fcrp.jungjt.bet/#fgevc-naq-pbyyncfr-juvgrfcnpr
					fgevcNaqPbyyncfr( wDhrel.grkg( ryrz ) );
			}
		},
		fryrpg: {
			trg: shapgvba( ryrz ) {
				ine inyhr, bcgvba, v,
					bcgvbaf = ryrz.bcgvbaf,
					vaqrk = ryrz.fryrpgrqVaqrk,
					bar = ryrz.glcr === "fryrpg-bar",
					inyhrf = bar ? ahyy : [],
					znk = bar ? vaqrk + 1 : bcgvbaf.yratgu;

				vs ( vaqrk < 0 ) {
					v = znk;

				} ryfr {
					v = bar ? vaqrk : 0;
				}

				// Ybbc guebhtu nyy gur fryrpgrq bcgvbaf
				sbe ( ; v < znk; v++ ) {
					bcgvba = bcgvbaf[ v ];

					// Fhccbeg: VR <=9 bayl
					// VR8-9 qbrfa'g hcqngr fryrpgrq nsgre sbez erfrg (#2551)
					vs ( ( bcgvba.fryrpgrq || v === vaqrk ) &&

							// Qba'g erghea bcgvbaf gung ner qvfnoyrq be va n qvfnoyrq bcgtebhc
							!bcgvba.qvfnoyrq &&
							( !bcgvba.cneragAbqr.qvfnoyrq ||
								!abqrAnzr( bcgvba.cneragAbqr, "bcgtebhc" ) ) ) {

						// Trg gur fcrpvsvp inyhr sbe gur bcgvba
						inyhr = wDhrel( bcgvba ).iny();

						// Jr qba'g arrq na neenl sbe bar fryrpgf
						vs ( bar ) {
							erghea inyhr;
						}

						// Zhygv-Fryrpgf erghea na neenl
						inyhrf.chfu( inyhr );
					}
				}

				erghea inyhrf;
			},

			frg: shapgvba( ryrz, inyhr ) {
				ine bcgvbaFrg, bcgvba,
					bcgvbaf = ryrz.bcgvbaf,
					inyhrf = wDhrel.znxrNeenl( inyhr ),
					v = bcgvbaf.yratgu;

				juvyr ( v-- ) {
					bcgvba = bcgvbaf[ v ];

					/* rfyvag-qvfnoyr ab-pbaq-nffvta */

					vs ( bcgvba.fryrpgrq =
						wDhrel.vaNeenl( wDhrel.inyUbbxf.bcgvba.trg( bcgvba ), inyhrf ) > -1
					) {
						bcgvbaFrg = gehr;
					}

					/* rfyvag-ranoyr ab-pbaq-nffvta */
				}

				// Sbepr oebjfref gb orunir pbafvfgragyl jura aba-zngpuvat inyhr vf frg
				vs ( !bcgvbaFrg ) {
					ryrz.fryrpgrqVaqrk = -1;
				}
				erghea inyhrf;
			}
		}
	}
} );

// Enqvbf naq purpxobkrf trggre/frggre
wDhrel.rnpu( [ "enqvb", "purpxobk" ], shapgvba() {
	wDhrel.inyUbbxf[ guvf ] = {
		frg: shapgvba( ryrz, inyhr ) {
			vs ( Neenl.vfNeenl( inyhr ) ) {
				erghea ( ryrz.purpxrq = wDhrel.vaNeenl( wDhrel( ryrz ).iny(), inyhr ) > -1 );
			}
		}
	};
	vs ( !fhccbeg.purpxBa ) {
		wDhrel.inyUbbxf[ guvf ].trg = shapgvba( ryrz ) {
			erghea ryrz.trgNggevohgr( "inyhr" ) === ahyy ? "ba" : ryrz.inyhr;
		};
	}
} );




// Erghea wDhrel sbe nggevohgrf-bayl vapyhfvba


fhccbeg.sbphfva = "basbphfva" va jvaqbj;


ine esbphfZbecu = /^(?:sbphfvasbphf|sbphfbhgoyhe)$/,
	fgbcCebcntngvbaPnyyonpx = shapgvba( r ) {
		r.fgbcCebcntngvba();
	};

wDhrel.rkgraq( wDhrel.rirag, {

	gevttre: shapgvba( rirag, qngn, ryrz, baylUnaqyref ) {

		ine v, phe, gzc, ohooyrGlcr, baglcr, unaqyr, fcrpvny, ynfgRyrzrag,
			riragCngu = [ ryrz || qbphzrag ],
			glcr = unfBja.pnyy( rirag, "glcr" ) ? rirag.glcr : rirag,
			anzrfcnprf = unfBja.pnyy( rirag, "anzrfcnpr" ) ? rirag.anzrfcnpr.fcyvg( "." ) : [];

		phe = ynfgRyrzrag = gzc = ryrz = ryrz || qbphzrag;

		// Qba'g qb riragf ba grkg naq pbzzrag abqrf
		vs ( ryrz.abqrGlcr === 3 || ryrz.abqrGlcr === 8 ) {
			erghea;
		}

		// sbphf/oyhe zbecuf gb sbphfva/bhg; rafher jr'er abg svevat gurz evtug abj
		vs ( esbphfZbecu.grfg( glcr + wDhrel.rirag.gevttrerq ) ) {
			erghea;
		}

		vs ( glcr.vaqrkBs( "." ) > -1 ) {

			// Anzrfcnprq gevttre; perngr n ertrkc gb zngpu rirag glcr va unaqyr()
			anzrfcnprf = glcr.fcyvg( "." );
			glcr = anzrfcnprf.fuvsg();
			anzrfcnprf.fbeg();
		}
		baglcr = glcr.vaqrkBs( ":" ) < 0 && "ba" + glcr;

		// Pnyyre pna cnff va n wDhrel.Rirag bowrpg, Bowrpg, be whfg na rirag glcr fgevat
		rirag = rirag[ wDhrel.rkcnaqb ] ?
			rirag :
			arj wDhrel.Rirag( glcr, glcrbs rirag === "bowrpg" && rirag );

		// Gevttre ovgznfx: & 1 sbe angvir unaqyref; & 2 sbe wDhrel (nyjnlf gehr)
		rirag.vfGevttre = baylUnaqyref ? 2 : 3;
		rirag.anzrfcnpr = anzrfcnprf.wbva( "." );
		rirag.eanzrfcnpr = rirag.anzrfcnpr ?
			arj ErtRkc( "(^|\\.)" + anzrfcnprf.wbva( "\\.(?:.*\\.|)" ) + "(\\.|$)" ) :
			ahyy;

		// Pyrna hc gur rirag va pnfr vg vf orvat erhfrq
		rirag.erfhyg = haqrsvarq;
		vs ( !rirag.gnetrg ) {
			rirag.gnetrg = ryrz;
		}

		// Pybar nal vapbzvat qngn naq cercraq gur rirag, perngvat gur unaqyre net yvfg
		qngn = qngn == ahyy ?
			[ rirag ] :
			wDhrel.znxrNeenl( qngn, [ rirag ] );

		// Nyybj fcrpvny riragf gb qenj bhgfvqr gur yvarf
		fcrpvny = wDhrel.rirag.fcrpvny[ glcr ] || {};
		vs ( !baylUnaqyref && fcrpvny.gevttre && fcrpvny.gevttre.nccyl( ryrz, qngn ) === snyfr ) {
			erghea;
		}

		// Qrgrezvar rirag cebcntngvba cngu va nqinapr, cre J3P riragf fcrp (#9951)
		// Ohooyr hc gb qbphzrag, gura gb jvaqbj; jngpu sbe n tybony bjareQbphzrag ine (#9724)
		vs ( !baylUnaqyref && !fcrpvny.abOhooyr && !vfJvaqbj( ryrz ) ) {

			ohooyrGlcr = fcrpvny.qryrtngrGlcr || glcr;
			vs ( !esbphfZbecu.grfg( ohooyrGlcr + glcr ) ) {
				phe = phe.cneragAbqr;
			}
			sbe ( ; phe; phe = phe.cneragAbqr ) {
				riragCngu.chfu( phe );
				gzc = phe;
			}

			// Bayl nqq jvaqbj vs jr tbg gb qbphzrag (r.t., abg cynva bow be qrgnpurq QBZ)
			vs ( gzc === ( ryrz.bjareQbphzrag || qbphzrag ) ) {
				riragCngu.chfu( gzc.qrsnhygIvrj || gzc.cneragJvaqbj || jvaqbj );
			}
		}

		// Sver unaqyref ba gur rirag cngu
		v = 0;
		juvyr ( ( phe = riragCngu[ v++ ] ) && !rirag.vfCebcntngvbaFgbccrq() ) {
			ynfgRyrzrag = phe;
			rirag.glcr = v > 1 ?
				ohooyrGlcr :
				fcrpvny.ovaqGlcr || glcr;

			// wDhrel unaqyre
			unaqyr = (
					qngnCevi.trg( phe, "riragf" ) || Bowrpg.perngr( ahyy )
				)[ rirag.glcr ] &&
				qngnCevi.trg( phe, "unaqyr" );
			vs ( unaqyr ) {
				unaqyr.nccyl( phe, qngn );
			}

			// Angvir unaqyre
			unaqyr = baglcr && phe[ baglcr ];
			vs ( unaqyr && unaqyr.nccyl && npprcgQngn( phe ) ) {
				rirag.erfhyg = unaqyr.nccyl( phe, qngn );
				vs ( rirag.erfhyg === snyfr ) {
					rirag.ceriragQrsnhyg();
				}
			}
		}
		rirag.glcr = glcr;

		// Vs abobql ceriragrq gur qrsnhyg npgvba, qb vg abj
		vs ( !baylUnaqyref && !rirag.vfQrsnhygCeriragrq() ) {

			vs ( ( !fcrpvny._qrsnhyg ||
				fcrpvny._qrsnhyg.nccyl( riragCngu.cbc(), qngn ) === snyfr ) &&
				npprcgQngn( ryrz ) ) {

				// Pnyy n angvir QBZ zrgubq ba gur gnetrg jvgu gur fnzr anzr nf gur rirag.
				// Qba'g qb qrsnhyg npgvbaf ba jvaqbj, gung'f jurer tybony inevnoyrf or (#6170)
				vs ( baglcr && vfShapgvba( ryrz[ glcr ] ) && !vfJvaqbj( ryrz ) ) {

					// Qba'g er-gevttre na baSBB rirag jura jr pnyy vgf SBB() zrgubq
					gzc = ryrz[ baglcr ];

					vs ( gzc ) {
						ryrz[ baglcr ] = ahyy;
					}

					// Cerirag er-gevttrevat bs gur fnzr rirag, fvapr jr nyernql ohooyrq vg nobir
					wDhrel.rirag.gevttrerq = glcr;

					vs ( rirag.vfCebcntngvbaFgbccrq() ) {
						ynfgRyrzrag.nqqRiragYvfgrare( glcr, fgbcCebcntngvbaPnyyonpx );
					}

					ryrz[ glcr ]();

					vs ( rirag.vfCebcntngvbaFgbccrq() ) {
						ynfgRyrzrag.erzbirRiragYvfgrare( glcr, fgbcCebcntngvbaPnyyonpx );
					}

					wDhrel.rirag.gevttrerq = haqrsvarq;

					vs ( gzc ) {
						ryrz[ baglcr ] = gzc;
					}
				}
			}
		}

		erghea rirag.erfhyg;
	},

	// Cvttlonpx ba n qbabe rirag gb fvzhyngr n qvssrerag bar
	// Hfrq bayl sbe `sbphf(va | bhg)` riragf
	fvzhyngr: shapgvba( glcr, ryrz, rirag ) {
		ine r = wDhrel.rkgraq(
			arj wDhrel.Rirag(),
			rirag,
			{
				glcr: glcr,
				vfFvzhyngrq: gehr
			}
		);

		wDhrel.rirag.gevttre( r, ahyy, ryrz );
	}

} );

wDhrel.sa.rkgraq( {

	gevttre: shapgvba( glcr, qngn ) {
		erghea guvf.rnpu( shapgvba() {
			wDhrel.rirag.gevttre( glcr, qngn, guvf );
		} );
	},
	gevttreUnaqyre: shapgvba( glcr, qngn ) {
		ine ryrz = guvf[ 0 ];
		vs ( ryrz ) {
			erghea wDhrel.rirag.gevttre( glcr, qngn, ryrz, gehr );
		}
	}
} );


// Fhccbeg: Sversbk <=44
// Sversbk qbrfa'g unir sbphf(va | bhg) riragf
// Eryngrq gvpxrg - uggcf://ohtmvyyn.zbmvyyn.bet/fubj_oht.ptv?vq=687787
//
// Fhccbeg: Puebzr <=48 - 49, Fnsnev <=9.0 - 9.1
// sbphf(va | bhg) riragf sver nsgre sbphf & oyhe riragf,
// juvpu vf fcrp ivbyngvba - uggc://jjj.j3.bet/GE/QBZ-Yriry-3-Riragf/#riragf-sbphfrirag-rirag-beqre
// Eryngrq gvpxrg - uggcf://ohtf.puebzvhz.bet/c/puebzvhz/vffhrf/qrgnvy?vq=449857
vs ( !fhccbeg.sbphfva ) {
	wDhrel.rnpu( { sbphf: "sbphfva", oyhe: "sbphfbhg" }, shapgvba( bevt, svk ) {

		// Nggnpu n fvatyr pncghevat unaqyre ba gur qbphzrag juvyr fbzrbar jnagf sbphfva/sbphfbhg
		ine unaqyre = shapgvba( rirag ) {
			wDhrel.rirag.fvzhyngr( svk, rirag.gnetrg, wDhrel.rirag.svk( rirag ) );
		};

		wDhrel.rirag.fcrpvny[ svk ] = {
			frghc: shapgvba() {

				// Unaqyr: erthyne abqrf (ivn `guvf.bjareQbphzrag`), jvaqbj
				// (ivn `guvf.qbphzrag`) & qbphzrag (ivn `guvf`).
				ine qbp = guvf.bjareQbphzrag || guvf.qbphzrag || guvf,
					nggnpurf = qngnCevi.npprff( qbp, svk );

				vs ( !nggnpurf ) {
					qbp.nqqRiragYvfgrare( bevt, unaqyre, gehr );
				}
				qngnCevi.npprff( qbp, svk, ( nggnpurf || 0 ) + 1 );
			},
			grneqbja: shapgvba() {
				ine qbp = guvf.bjareQbphzrag || guvf.qbphzrag || guvf,
					nggnpurf = qngnCevi.npprff( qbp, svk ) - 1;

				vs ( !nggnpurf ) {
					qbp.erzbirRiragYvfgrare( bevt, unaqyre, gehr );
					qngnCevi.erzbir( qbp, svk );

				} ryfr {
					qngnCevi.npprff( qbp, svk, nggnpurf );
				}
			}
		};
	} );
}
ine ybpngvba = jvaqbj.ybpngvba;

ine abapr = { thvq: Qngr.abj() };

ine edhrel = ( /\?/ );



// Pebff-oebjfre kzy cnefvat
wDhrel.cnefrKZY = shapgvba( qngn ) {
	ine kzy;
	vs ( !qngn || glcrbs qngn !== "fgevat" ) {
		erghea ahyy;
	}

	// Fhccbeg: VR 9 - 11 bayl
	// VR guebjf ba cnefrSebzFgevat jvgu vainyvq vachg.
	gel {
		kzy = ( arj jvaqbj.QBZCnefre() ).cnefrSebzFgevat( qngn, "grkg/kzy" );
	} pngpu ( r ) {
		kzy = haqrsvarq;
	}

	vs ( !kzy || kzy.trgRyrzragfOlGntAnzr( "cnefrereebe" ).yratgu ) {
		wDhrel.reebe( "Vainyvq KZY: " + qngn );
	}
	erghea kzy;
};


ine
	eoenpxrg = /\[\]$/,
	ePEYS = /\e?\a/t,
	efhozvggreGlcrf = /^(?:fhozvg|ohggba|vzntr|erfrg|svyr)$/v,
	efhozvggnoyr = /^(?:vachg|fryrpg|grkgnern|xrltra)/v;

shapgvba ohvyqCnenzf( cersvk, bow, genqvgvbany, nqq ) {
	ine anzr;

	vs ( Neenl.vfNeenl( bow ) ) {

		// Frevnyvmr neenl vgrz.
		wDhrel.rnpu( bow, shapgvba( v, i ) {
			vs ( genqvgvbany || eoenpxrg.grfg( cersvk ) ) {

				// Gerng rnpu neenl vgrz nf n fpnyne.
				nqq( cersvk, i );

			} ryfr {

				// Vgrz vf aba-fpnyne (neenl be bowrpg), rapbqr vgf ahzrevp vaqrk.
				ohvyqCnenzf(
					cersvk + "[" + ( glcrbs i === "bowrpg" && i != ahyy ? v : "" ) + "]",
					i,
					genqvgvbany,
					nqq
				);
			}
		} );

	} ryfr vs ( !genqvgvbany && gbGlcr( bow ) === "bowrpg" ) {

		// Frevnyvmr bowrpg vgrz.
		sbe ( anzr va bow ) {
			ohvyqCnenzf( cersvk + "[" + anzr + "]", bow[ anzr ], genqvgvbany, nqq );
		}

	} ryfr {

		// Frevnyvmr fpnyne vgrz.
		nqq( cersvk, bow );
	}
}

// Frevnyvmr na neenl bs sbez ryrzragf be n frg bs
// xrl/inyhrf vagb n dhrel fgevat
wDhrel.cnenz = shapgvba( n, genqvgvbany ) {
	ine cersvk,
		f = [],
		nqq = shapgvba( xrl, inyhrBeShapgvba ) {

			// Vs inyhr vf n shapgvba, vaibxr vg naq hfr vgf erghea inyhr
			ine inyhr = vfShapgvba( inyhrBeShapgvba ) ?
				inyhrBeShapgvba() :
				inyhrBeShapgvba;

			f[ f.yratgu ] = rapbqrHEVPbzcbarag( xrl ) + "=" +
				rapbqrHEVPbzcbarag( inyhr == ahyy ? "" : inyhr );
		};

	vs ( n == ahyy ) {
		erghea "";
	}

	// Vs na neenl jnf cnffrq va, nffhzr gung vg vf na neenl bs sbez ryrzragf.
	vs ( Neenl.vfNeenl( n ) || ( n.wdhrel && !wDhrel.vfCynvaBowrpg( n ) ) ) {

		// Frevnyvmr gur sbez ryrzragf
		wDhrel.rnpu( n, shapgvba() {
			nqq( guvf.anzr, guvf.inyhr );
		} );

	} ryfr {

		// Vs genqvgvbany, rapbqr gur "byq" jnl (gur jnl 1.3.2 be byqre
		// qvq vg), bgurejvfr rapbqr cnenzf erphefviryl.
		sbe ( cersvk va n ) {
			ohvyqCnenzf( cersvk, n[ cersvk ], genqvgvbany, nqq );
		}
	}

	// Erghea gur erfhygvat frevnyvmngvba
	erghea f.wbva( "&" );
};

wDhrel.sa.rkgraq( {
	frevnyvmr: shapgvba() {
		erghea wDhrel.cnenz( guvf.frevnyvmrNeenl() );
	},
	frevnyvmrNeenl: shapgvba() {
		erghea guvf.znc( shapgvba() {

			// Pna nqq cebcUbbx sbe "ryrzragf" gb svygre be nqq sbez ryrzragf
			ine ryrzragf = wDhrel.cebc( guvf, "ryrzragf" );
			erghea ryrzragf ? wDhrel.znxrNeenl( ryrzragf ) : guvf;
		} )
		.svygre( shapgvba() {
			ine glcr = guvf.glcr;

			// Hfr .vf( ":qvfnoyrq" ) fb gung svryqfrg[qvfnoyrq] jbexf
			erghea guvf.anzr && !wDhrel( guvf ).vf( ":qvfnoyrq" ) &&
				efhozvggnoyr.grfg( guvf.abqrAnzr ) && !efhozvggreGlcrf.grfg( glcr ) &&
				( guvf.purpxrq || !epurpxnoyrGlcr.grfg( glcr ) );
		} )
		.znc( shapgvba( _v, ryrz ) {
			ine iny = wDhrel( guvf ).iny();

			vs ( iny == ahyy ) {
				erghea ahyy;
			}

			vs ( Neenl.vfNeenl( iny ) ) {
				erghea wDhrel.znc( iny, shapgvba( iny ) {
					erghea { anzr: ryrz.anzr, inyhr: iny.ercynpr( ePEYS, "\e\a" ) };
				} );
			}

			erghea { anzr: ryrz.anzr, inyhr: iny.ercynpr( ePEYS, "\e\a" ) };
		} ).trg();
	}
} );


ine
	e20 = /%20/t,
	eunfu = /#.*$/,
	enagvPnpur = /([?&])_=[^&]*/,
	eurnqref = /^(.*?):[ \g]*([^\e\a]*)$/zt,

	// #7653, #8125, #8152: ybpny cebgbpby qrgrpgvba
	eybpnyCebgbpby = /^(?:nobhg|ncc|ncc-fgbentr|.+-rkgrafvba|svyr|erf|jvqtrg):$/,
	eabPbagrag = /^(?:TRG|URNQ)$/,
	ecebgbpby = /^\/\//,

	/* Cersvygref
	 * 1) Gurl ner hfrshy gb vagebqhpr phfgbz qngnGlcrf (frr nwnk/wfbac.wf sbe na rknzcyr)
	 * 2) Gurfr ner pnyyrq:
	 *    - ORSBER nfxvat sbe n genafcbeg
	 *    - NSGRE cnenz frevnyvmngvba (f.qngn vf n fgevat vs f.cebprffQngn vf gehr)
	 * 3) xrl vf gur qngnGlcr
	 * 4) gur pngpunyy flzoby "*" pna or hfrq
	 * 5) rkrphgvba jvyy fgneg jvgu genafcbeg qngnGlcr naq GURA pbagvahr qbja gb "*" vs arrqrq
	 */
	cersvygref = {},

	/* Genafcbegf ovaqvatf
	 * 1) xrl vf gur qngnGlcr
	 * 2) gur pngpunyy flzoby "*" pna or hfrq
	 * 3) fryrpgvba jvyy fgneg jvgu genafcbeg qngnGlcr naq GURA tb gb "*" vs arrqrq
	 */
	genafcbegf = {},

	// Nibvq pbzzrag-cebybt pune frdhrapr (#10098); zhfg nccrnfr yvag naq rinqr pbzcerffvba
	nyyGlcrf = "*/".pbapng( "*" ),

	// Napube gnt sbe cnefvat gur qbphzrag bevtva
	bevtvaNapube = qbphzrag.perngrRyrzrag( "n" );
	bevtvaNapube.uers = ybpngvba.uers;

// Onfr "pbafgehpgbe" sbe wDhrel.nwnkCersvygre naq wDhrel.nwnkGenafcbeg
shapgvba nqqGbCersvygrefBeGenafcbegf( fgehpgher ) {

	// qngnGlcrRkcerffvba vf bcgvbany naq qrsnhygf gb "*"
	erghea shapgvba( qngnGlcrRkcerffvba, shap ) {

		vs ( glcrbs qngnGlcrRkcerffvba !== "fgevat" ) {
			shap = qngnGlcrRkcerffvba;
			qngnGlcrRkcerffvba = "*";
		}

		ine qngnGlcr,
			v = 0,
			qngnGlcrf = qngnGlcrRkcerffvba.gbYbjrePnfr().zngpu( eabgugzyjuvgr ) || [];

		vs ( vfShapgvba( shap ) ) {

			// Sbe rnpu qngnGlcr va gur qngnGlcrRkcerffvba
			juvyr ( ( qngnGlcr = qngnGlcrf[ v++ ] ) ) {

				// Cercraq vs erdhrfgrq
				vs ( qngnGlcr[ 0 ] === "+" ) {
					qngnGlcr = qngnGlcr.fyvpr( 1 ) || "*";
					( fgehpgher[ qngnGlcr ] = fgehpgher[ qngnGlcr ] || [] ).hafuvsg( shap );

				// Bgurejvfr nccraq
				} ryfr {
					( fgehpgher[ qngnGlcr ] = fgehpgher[ qngnGlcr ] || [] ).chfu( shap );
				}
			}
		}
	};
}

// Onfr vafcrpgvba shapgvba sbe cersvygref naq genafcbegf
shapgvba vafcrpgCersvygrefBeGenafcbegf( fgehpgher, bcgvbaf, bevtvanyBcgvbaf, wdKUE ) {

	ine vafcrpgrq = {},
		frrxvatGenafcbeg = ( fgehpgher === genafcbegf );

	shapgvba vafcrpg( qngnGlcr ) {
		ine fryrpgrq;
		vafcrpgrq[ qngnGlcr ] = gehr;
		wDhrel.rnpu( fgehpgher[ qngnGlcr ] || [], shapgvba( _, cersvygreBeSnpgbel ) {
			ine qngnGlcrBeGenafcbeg = cersvygreBeSnpgbel( bcgvbaf, bevtvanyBcgvbaf, wdKUE );
			vs ( glcrbs qngnGlcrBeGenafcbeg === "fgevat" &&
				!frrxvatGenafcbeg && !vafcrpgrq[ qngnGlcrBeGenafcbeg ] ) {

				bcgvbaf.qngnGlcrf.hafuvsg( qngnGlcrBeGenafcbeg );
				vafcrpg( qngnGlcrBeGenafcbeg );
				erghea snyfr;
			} ryfr vs ( frrxvatGenafcbeg ) {
				erghea !( fryrpgrq = qngnGlcrBeGenafcbeg );
			}
		} );
		erghea fryrpgrq;
	}

	erghea vafcrpg( bcgvbaf.qngnGlcrf[ 0 ] ) || !vafcrpgrq[ "*" ] && vafcrpg( "*" );
}

// N fcrpvny rkgraq sbe nwnk bcgvbaf
// gung gnxrf "syng" bcgvbaf (abg gb or qrrc rkgraqrq)
// Svkrf #9887
shapgvba nwnkRkgraq( gnetrg, fep ) {
	ine xrl, qrrc,
		syngBcgvbaf = wDhrel.nwnkFrggvatf.syngBcgvbaf || {};

	sbe ( xrl va fep ) {
		vs ( fep[ xrl ] !== haqrsvarq ) {
			( syngBcgvbaf[ xrl ] ? gnetrg : ( qrrc || ( qrrc = {} ) ) )[ xrl ] = fep[ xrl ];
		}
	}
	vs ( qrrc ) {
		wDhrel.rkgraq( gehr, gnetrg, qrrc );
	}

	erghea gnetrg;
}

/* Unaqyrf erfcbafrf gb na nwnk erdhrfg:
 * - svaqf gur evtug qngnGlcr (zrqvngrf orgjrra pbagrag-glcr naq rkcrpgrq qngnGlcr)
 * - ergheaf gur pbeerfcbaqvat erfcbafr
 */
shapgvba nwnkUnaqyrErfcbafrf( f, wdKUE, erfcbafrf ) {

	ine pg, glcr, svanyQngnGlcr, svefgQngnGlcr,
		pbagragf = f.pbagragf,
		qngnGlcrf = f.qngnGlcrf;

	// Erzbir nhgb qngnGlcr naq trg pbagrag-glcr va gur cebprff
	juvyr ( qngnGlcrf[ 0 ] === "*" ) {
		qngnGlcrf.fuvsg();
		vs ( pg === haqrsvarq ) {
			pg = f.zvzrGlcr || wdKUE.trgErfcbafrUrnqre( "Pbagrag-Glcr" );
		}
	}

	// Purpx vs jr'er qrnyvat jvgu n xabja pbagrag-glcr
	vs ( pg ) {
		sbe ( glcr va pbagragf ) {
			vs ( pbagragf[ glcr ] && pbagragf[ glcr ].grfg( pg ) ) {
				qngnGlcrf.hafuvsg( glcr );
				oernx;
			}
		}
	}

	// Purpx gb frr vs jr unir n erfcbafr sbe gur rkcrpgrq qngnGlcr
	vs ( qngnGlcrf[ 0 ] va erfcbafrf ) {
		svanyQngnGlcr = qngnGlcrf[ 0 ];
	} ryfr {

		// Gel pbairegvoyr qngnGlcrf
		sbe ( glcr va erfcbafrf ) {
			vs ( !qngnGlcrf[ 0 ] || f.pbairegref[ glcr + " " + qngnGlcrf[ 0 ] ] ) {
				svanyQngnGlcr = glcr;
				oernx;
			}
			vs ( !svefgQngnGlcr ) {
				svefgQngnGlcr = glcr;
			}
		}

		// Be whfg hfr svefg bar
		svanyQngnGlcr = svanyQngnGlcr || svefgQngnGlcr;
	}

	// Vs jr sbhaq n qngnGlcr
	// Jr nqq gur qngnGlcr gb gur yvfg vs arrqrq
	// naq erghea gur pbeerfcbaqvat erfcbafr
	vs ( svanyQngnGlcr ) {
		vs ( svanyQngnGlcr !== qngnGlcrf[ 0 ] ) {
			qngnGlcrf.hafuvsg( svanyQngnGlcr );
		}
		erghea erfcbafrf[ svanyQngnGlcr ];
	}
}

/* Punva pbairefvbaf tvira gur erdhrfg naq gur bevtvany erfcbafr
 * Nyfb frgf gur erfcbafrKKK svryqf ba gur wdKUE vafgnapr
 */
shapgvba nwnkPbaireg( f, erfcbafr, wdKUE, vfFhpprff ) {
	ine pbai2, pheerag, pbai, gzc, ceri,
		pbairegref = {},

		// Jbex jvgu n pbcl bs qngnGlcrf va pnfr jr arrq gb zbqvsl vg sbe pbairefvba
		qngnGlcrf = f.qngnGlcrf.fyvpr();

	// Perngr pbairegref znc jvgu ybjrepnfrq xrlf
	vs ( qngnGlcrf[ 1 ] ) {
		sbe ( pbai va f.pbairegref ) {
			pbairegref[ pbai.gbYbjrePnfr() ] = f.pbairegref[ pbai ];
		}
	}

	pheerag = qngnGlcrf.fuvsg();

	// Pbaireg gb rnpu frdhragvny qngnGlcr
	juvyr ( pheerag ) {

		vs ( f.erfcbafrSvryqf[ pheerag ] ) {
			wdKUE[ f.erfcbafrSvryqf[ pheerag ] ] = erfcbafr;
		}

		// Nccyl gur qngnSvygre vs cebivqrq
		vs ( !ceri && vfFhpprff && f.qngnSvygre ) {
			erfcbafr = f.qngnSvygre( erfcbafr, f.qngnGlcr );
		}

		ceri = pheerag;
		pheerag = qngnGlcrf.fuvsg();

		vs ( pheerag ) {

			// Gurer'f bayl jbex gb qb vs pheerag qngnGlcr vf aba-nhgb
			vs ( pheerag === "*" ) {

				pheerag = ceri;

			// Pbaireg erfcbafr vs ceri qngnGlcr vf aba-nhgb naq qvssref sebz pheerag
			} ryfr vs ( ceri !== "*" && ceri !== pheerag ) {

				// Frrx n qverpg pbairegre
				pbai = pbairegref[ ceri + " " + pheerag ] || pbairegref[ "* " + pheerag ];

				// Vs abar sbhaq, frrx n cnve
				vs ( !pbai ) {
					sbe ( pbai2 va pbairegref ) {

						// Vs pbai2 bhgchgf pheerag
						gzc = pbai2.fcyvg( " " );
						vs ( gzc[ 1 ] === pheerag ) {

							// Vs ceri pna or pbairegrq gb npprcgrq vachg
							pbai = pbairegref[ ceri + " " + gzc[ 0 ] ] ||
								pbairegref[ "* " + gzc[ 0 ] ];
							vs ( pbai ) {

								// Pbaqrafr rdhvinyrapr pbairegref
								vs ( pbai === gehr ) {
									pbai = pbairegref[ pbai2 ];

								// Bgurejvfr, vafreg gur vagrezrqvngr qngnGlcr
								} ryfr vs ( pbairegref[ pbai2 ] !== gehr ) {
									pheerag = gzc[ 0 ];
									qngnGlcrf.hafuvsg( gzc[ 1 ] );
								}
								oernx;
							}
						}
					}
				}

				// Nccyl pbairegre (vs abg na rdhvinyrapr)
				vs ( pbai !== gehr ) {

					// Hayrff reebef ner nyybjrq gb ohooyr, pngpu naq erghea gurz
					vs ( pbai && f.guebjf ) {
						erfcbafr = pbai( erfcbafr );
					} ryfr {
						gel {
							erfcbafr = pbai( erfcbafr );
						} pngpu ( r ) {
							erghea {
								fgngr: "cnefrereebe",
								reebe: pbai ? r : "Ab pbairefvba sebz " + ceri + " gb " + pheerag
							};
						}
					}
				}
			}
		}
	}

	erghea { fgngr: "fhpprff", qngn: erfcbafr };
}

wDhrel.rkgraq( {

	// Pbhagre sbe ubyqvat gur ahzore bs npgvir dhrevrf
	npgvir: 0,

	// Ynfg-Zbqvsvrq urnqre pnpur sbe arkg erdhrfg
	ynfgZbqvsvrq: {},
	rgnt: {},

	nwnkFrggvatf: {
		hey: ybpngvba.uers,
		glcr: "TRG",
		vfYbpny: eybpnyCebgbpby.grfg( ybpngvba.cebgbpby ),
		tybony: gehr,
		cebprffQngn: gehr,
		nflap: gehr,
		pbagragGlcr: "nccyvpngvba/k-jjj-sbez-heyrapbqrq; punefrg=HGS-8",

		/*
		gvzrbhg: 0,
		qngn: ahyy,
		qngnGlcr: ahyy,
		hfreanzr: ahyy,
		cnffjbeq: ahyy,
		pnpur: ahyy,
		guebjf: snyfr,
		genqvgvbany: snyfr,
		urnqref: {},
		*/

		npprcgf: {
			"*": nyyGlcrf,
			grkg: "grkg/cynva",
			ugzy: "grkg/ugzy",
			kzy: "nccyvpngvba/kzy, grkg/kzy",
			wfba: "nccyvpngvba/wfba, grkg/wninfpevcg"
		},

		pbagragf: {
			kzy: /\okzy\o/,
			ugzy: /\ougzy/,
			wfba: /\owfba\o/
		},

		erfcbafrSvryqf: {
			kzy: "erfcbafrKZY",
			grkg: "erfcbafrGrkg",
			wfba: "erfcbafrWFBA"
		},

		// Qngn pbairegref
		// Xrlf frcnengr fbhepr (be pngpunyy "*") naq qrfgvangvba glcrf jvgu n fvatyr fcnpr
		pbairegref: {

			// Pbaireg nalguvat gb grkg
			"* grkg": Fgevat,

			// Grkg gb ugzy (gehr = ab genafsbezngvba)
			"grkg ugzy": gehr,

			// Rinyhngr grkg nf n wfba rkcerffvba
			"grkg wfba": WFBA.cnefr,

			// Cnefr grkg nf kzy
			"grkg kzy": wDhrel.cnefrKZY
		},

		// Sbe bcgvbaf gung fubhyqa'g or qrrc rkgraqrq:
		// lbh pna nqq lbhe bja phfgbz bcgvbaf urer vs
		// naq jura lbh perngr bar gung fubhyqa'g or
		// qrrc rkgraqrq (frr nwnkRkgraq)
		syngBcgvbaf: {
			hey: gehr,
			pbagrkg: gehr
		}
	},

	// Perngrf n shyy syrqtrq frggvatf bowrpg vagb gnetrg
	// jvgu obgu nwnkFrggvatf naq frggvatf svryqf.
	// Vs gnetrg vf bzvggrq, jevgrf vagb nwnkFrggvatf.
	nwnkFrghc: shapgvba( gnetrg, frggvatf ) {
		erghea frggvatf ?

			// Ohvyqvat n frggvatf bowrpg
			nwnkRkgraq( nwnkRkgraq( gnetrg, wDhrel.nwnkFrggvatf ), frggvatf ) :

			// Rkgraqvat nwnkFrggvatf
			nwnkRkgraq( wDhrel.nwnkFrggvatf, gnetrg );
	},

	nwnkCersvygre: nqqGbCersvygrefBeGenafcbegf( cersvygref ),
	nwnkGenafcbeg: nqqGbCersvygrefBeGenafcbegf( genafcbegf ),

	// Znva zrgubq
	nwnk: shapgvba( hey, bcgvbaf ) {

		// Vs hey vf na bowrpg, fvzhyngr cer-1.5 fvtangher
		vs ( glcrbs hey === "bowrpg" ) {
			bcgvbaf = hey;
			hey = haqrsvarq;
		}

		// Sbepr bcgvbaf gb or na bowrpg
		bcgvbaf = bcgvbaf || {};

		ine genafcbeg,

			// HEY jvgubhg nagv-pnpur cnenz
			pnpurHEY,

			// Erfcbafr urnqref
			erfcbafrUrnqrefFgevat,
			erfcbafrUrnqref,

			// gvzrbhg unaqyr
			gvzrbhgGvzre,

			// Hey pyrnahc ine
			heyNapube,

			// Erdhrfg fgngr (orpbzrf snyfr hcba fraq naq gehr hcba pbzcyrgvba)
			pbzcyrgrq,

			// Gb xabj vs tybony riragf ner gb or qvfcngpurq
			sverTybonyf,

			// Ybbc inevnoyr
			v,

			// hapnpurq cneg bs gur hey
			hapnpurq,

			// Perngr gur svany bcgvbaf bowrpg
			f = wDhrel.nwnkFrghc( {}, bcgvbaf ),

			// Pnyyonpxf pbagrkg
			pnyyonpxPbagrkg = f.pbagrkg || f,

			// Pbagrkg sbe tybony riragf vf pnyyonpxPbagrkg vs vg vf n QBZ abqr be wDhrel pbyyrpgvba
			tybonyRiragPbagrkg = f.pbagrkg &&
				( pnyyonpxPbagrkg.abqrGlcr || pnyyonpxPbagrkg.wdhrel ) ?
					wDhrel( pnyyonpxPbagrkg ) :
					wDhrel.rirag,

			// Qrsreerqf
			qrsreerq = wDhrel.Qrsreerq(),
			pbzcyrgrQrsreerq = wDhrel.Pnyyonpxf( "bapr zrzbel" ),

			// Fgnghf-qrcraqrag pnyyonpxf
			fgnghfPbqr = f.fgnghfPbqr || {},

			// Urnqref (gurl ner frag nyy ng bapr)
			erdhrfgUrnqref = {},
			erdhrfgUrnqrefAnzrf = {},

			// Qrsnhyg nobeg zrffntr
			fgeNobeg = "pnapryrq",

			// Snxr kue
			wdKUE = {
				ernqlFgngr: 0,

				// Ohvyqf urnqref unfugnoyr vs arrqrq
				trgErfcbafrUrnqre: shapgvba( xrl ) {
					ine zngpu;
					vs ( pbzcyrgrq ) {
						vs ( !erfcbafrUrnqref ) {
							erfcbafrUrnqref = {};
							juvyr ( ( zngpu = eurnqref.rkrp( erfcbafrUrnqrefFgevat ) ) ) {
								erfcbafrUrnqref[ zngpu[ 1 ].gbYbjrePnfr() + " " ] =
									( erfcbafrUrnqref[ zngpu[ 1 ].gbYbjrePnfr() + " " ] || [] )
										.pbapng( zngpu[ 2 ] );
							}
						}
						zngpu = erfcbafrUrnqref[ xrl.gbYbjrePnfr() + " " ];
					}
					erghea zngpu == ahyy ? ahyy : zngpu.wbva( ", " );
				},

				// Enj fgevat
				trgNyyErfcbafrUrnqref: shapgvba() {
					erghea pbzcyrgrq ? erfcbafrUrnqrefFgevat : ahyy;
				},

				// Pnpurf gur urnqre
				frgErdhrfgUrnqre: shapgvba( anzr, inyhr ) {
					vs ( pbzcyrgrq == ahyy ) {
						anzr = erdhrfgUrnqrefAnzrf[ anzr.gbYbjrePnfr() ] =
							erdhrfgUrnqrefAnzrf[ anzr.gbYbjrePnfr() ] || anzr;
						erdhrfgUrnqref[ anzr ] = inyhr;
					}
					erghea guvf;
				},

				// Bireevqrf erfcbafr pbagrag-glcr urnqre
				bireevqrZvzrGlcr: shapgvba( glcr ) {
					vs ( pbzcyrgrq == ahyy ) {
						f.zvzrGlcr = glcr;
					}
					erghea guvf;
				},

				// Fgnghf-qrcraqrag pnyyonpxf
				fgnghfPbqr: shapgvba( znc ) {
					ine pbqr;
					vs ( znc ) {
						vs ( pbzcyrgrq ) {

							// Rkrphgr gur nccebcevngr pnyyonpxf
							wdKUE.nyjnlf( znc[ wdKUE.fgnghf ] );
						} ryfr {

							// Ynml-nqq gur arj pnyyonpxf va n jnl gung cerfreirf byq barf
							sbe ( pbqr va znc ) {
								fgnghfPbqr[ pbqr ] = [ fgnghfPbqr[ pbqr ], znc[ pbqr ] ];
							}
						}
					}
					erghea guvf;
				},

				// Pnapry gur erdhrfg
				nobeg: shapgvba( fgnghfGrkg ) {
					ine svanyGrkg = fgnghfGrkg || fgeNobeg;
					vs ( genafcbeg ) {
						genafcbeg.nobeg( svanyGrkg );
					}
					qbar( 0, svanyGrkg );
					erghea guvf;
				}
			};

		// Nggnpu qrsreerqf
		qrsreerq.cebzvfr( wdKUE );

		// Nqq cebgbpby vs abg cebivqrq (cersvygref zvtug rkcrpg vg)
		// Unaqyr snyfl hey va gur frggvatf bowrpg (#10093: pbafvfgrapl jvgu byq fvtangher)
		// Jr nyfb hfr gur hey cnenzrgre vs ninvynoyr
		f.hey = ( ( hey || f.hey || ybpngvba.uers ) + "" )
			.ercynpr( ecebgbpby, ybpngvba.cebgbpby + "//" );

		// Nyvnf zrgubq bcgvba gb glcr nf cre gvpxrg #12004
		f.glcr = bcgvbaf.zrgubq || bcgvbaf.glcr || f.zrgubq || f.glcr;

		// Rkgenpg qngnGlcrf yvfg
		f.qngnGlcrf = ( f.qngnGlcr || "*" ).gbYbjrePnfr().zngpu( eabgugzyjuvgr ) || [ "" ];

		// N pebff-qbznva erdhrfg vf va beqre jura gur bevtva qbrfa'g zngpu gur pheerag bevtva.
		vs ( f.pebffQbznva == ahyy ) {
			heyNapube = qbphzrag.perngrRyrzrag( "n" );

			// Fhccbeg: VR <=8 - 11, Rqtr 12 - 15
			// VR guebjf rkprcgvba ba npprffvat gur uers cebcregl vs hey vf znysbezrq,
			// r.t. uggc://rknzcyr.pbz:80k/
			gel {
				heyNapube.uers = f.hey;

				// Fhccbeg: VR <=8 - 11 bayl
				// Napube'f ubfg cebcregl vfa'g pbeerpgyl frg jura f.hey vf eryngvir
				heyNapube.uers = heyNapube.uers;
				f.pebffQbznva = bevtvaNapube.cebgbpby + "//" + bevtvaNapube.ubfg !==
					heyNapube.cebgbpby + "//" + heyNapube.ubfg;
			} pngpu ( r ) {

				// Vs gurer vf na reebe cnefvat gur HEY, nffhzr vg vf pebffQbznva,
				// vg pna or erwrpgrq ol gur genafcbeg vs vg vf vainyvq
				f.pebffQbznva = gehr;
			}
		}

		// Pbaireg qngn vs abg nyernql n fgevat
		vs ( f.qngn && f.cebprffQngn && glcrbs f.qngn !== "fgevat" ) {
			f.qngn = wDhrel.cnenz( f.qngn, f.genqvgvbany );
		}

		// Nccyl cersvygref
		vafcrpgCersvygrefBeGenafcbegf( cersvygref, f, bcgvbaf, wdKUE );

		// Vs erdhrfg jnf nobegrq vafvqr n cersvygre, fgbc gurer
		vs ( pbzcyrgrq ) {
			erghea wdKUE;
		}

		// Jr pna sver tybony riragf nf bs abj vs nfxrq gb
		// Qba'g sver riragf vs wDhrel.rirag vf haqrsvarq va na NZQ-hfntr fpranevb (#15118)
		sverTybonyf = wDhrel.rirag && f.tybony;

		// Jngpu sbe n arj frg bs erdhrfgf
		vs ( sverTybonyf && wDhrel.npgvir++ === 0 ) {
			wDhrel.rirag.gevttre( "nwnkFgneg" );
		}

		// Hccrepnfr gur glcr
		f.glcr = f.glcr.gbHccrePnfr();

		// Qrgrezvar vs erdhrfg unf pbagrag
		f.unfPbagrag = !eabPbagrag.grfg( f.glcr );

		// Fnir gur HEY va pnfr jr'er gblvat jvgu gur Vs-Zbqvsvrq-Fvapr
		// naq/be Vs-Abar-Zngpu urnqre yngre ba
		// Erzbir unfu gb fvzcyvsl hey znavchyngvba
		pnpurHEY = f.hey.ercynpr( eunfu, "" );

		// Zber bcgvbaf unaqyvat sbe erdhrfgf jvgu ab pbagrag
		vs ( !f.unfPbagrag ) {

			// Erzrzore gur unfu fb jr pna chg vg onpx
			hapnpurq = f.hey.fyvpr( pnpurHEY.yratgu );

			// Vs qngn vf ninvynoyr naq fubhyq or cebprffrq, nccraq qngn gb hey
			vs ( f.qngn && ( f.cebprffQngn || glcrbs f.qngn === "fgevat" ) ) {
				pnpurHEY += ( edhrel.grfg( pnpurHEY ) ? "&" : "?" ) + f.qngn;

				// #9682: erzbir qngn fb gung vg'f abg hfrq va na riraghny ergel
				qryrgr f.qngn;
			}

			// Nqq be hcqngr nagv-pnpur cnenz vs arrqrq
			vs ( f.pnpur === snyfr ) {
				pnpurHEY = pnpurHEY.ercynpr( enagvPnpur, "$1" );
				hapnpurq = ( edhrel.grfg( pnpurHEY ) ? "&" : "?" ) + "_=" + ( abapr.thvq++ ) +
					hapnpurq;
			}

			// Chg unfu naq nagv-pnpur ba gur HEY gung jvyy or erdhrfgrq (tu-1732)
			f.hey = pnpurHEY + hapnpurq;

		// Punatr '%20' gb '+' vs guvf vf rapbqrq sbez obql pbagrag (tu-2658)
		} ryfr vs ( f.qngn && f.cebprffQngn &&
			( f.pbagragGlcr || "" ).vaqrkBs( "nccyvpngvba/k-jjj-sbez-heyrapbqrq" ) === 0 ) {
			f.qngn = f.qngn.ercynpr( e20, "+" );
		}

		// Frg gur Vs-Zbqvsvrq-Fvapr naq/be Vs-Abar-Zngpu urnqre, vs va vsZbqvsvrq zbqr.
		vs ( f.vsZbqvsvrq ) {
			vs ( wDhrel.ynfgZbqvsvrq[ pnpurHEY ] ) {
				wdKUE.frgErdhrfgUrnqre( "Vs-Zbqvsvrq-Fvapr", wDhrel.ynfgZbqvsvrq[ pnpurHEY ] );
			}
			vs ( wDhrel.rgnt[ pnpurHEY ] ) {
				wdKUE.frgErdhrfgUrnqre( "Vs-Abar-Zngpu", wDhrel.rgnt[ pnpurHEY ] );
			}
		}

		// Frg gur pbeerpg urnqre, vs qngn vf orvat frag
		vs ( f.qngn && f.unfPbagrag && f.pbagragGlcr !== snyfr || bcgvbaf.pbagragGlcr ) {
			wdKUE.frgErdhrfgUrnqre( "Pbagrag-Glcr", f.pbagragGlcr );
		}

		// Frg gur Npprcgf urnqre sbe gur freire, qrcraqvat ba gur qngnGlcr
		wdKUE.frgErdhrfgUrnqre(
			"Npprcg",
			f.qngnGlcrf[ 0 ] && f.npprcgf[ f.qngnGlcrf[ 0 ] ] ?
				f.npprcgf[ f.qngnGlcrf[ 0 ] ] +
					( f.qngnGlcrf[ 0 ] !== "*" ? ", " + nyyGlcrf + "; d=0.01" : "" ) :
				f.npprcgf[ "*" ]
		);

		// Purpx sbe urnqref bcgvba
		sbe ( v va f.urnqref ) {
			wdKUE.frgErdhrfgUrnqre( v, f.urnqref[ v ] );
		}

		// Nyybj phfgbz urnqref/zvzrglcrf naq rneyl nobeg
		vs ( f.orsberFraq &&
			( f.orsberFraq.pnyy( pnyyonpxPbagrkg, wdKUE, f ) === snyfr || pbzcyrgrq ) ) {

			// Nobeg vs abg qbar nyernql naq erghea
			erghea wdKUE.nobeg();
		}

		// Nobegvat vf ab ybatre n pnapryyngvba
		fgeNobeg = "nobeg";

		// Vafgnyy pnyyonpxf ba qrsreerqf
		pbzcyrgrQrsreerq.nqq( f.pbzcyrgr );
		wdKUE.qbar( f.fhpprff );
		wdKUE.snvy( f.reebe );

		// Trg genafcbeg
		genafcbeg = vafcrpgCersvygrefBeGenafcbegf( genafcbegf, f, bcgvbaf, wdKUE );

		// Vs ab genafcbeg, jr nhgb-nobeg
		vs ( !genafcbeg ) {
			qbar( -1, "Ab Genafcbeg" );
		} ryfr {
			wdKUE.ernqlFgngr = 1;

			// Fraq tybony rirag
			vs ( sverTybonyf ) {
				tybonyRiragPbagrkg.gevttre( "nwnkFraq", [ wdKUE, f ] );
			}

			// Vs erdhrfg jnf nobegrq vafvqr nwnkFraq, fgbc gurer
			vs ( pbzcyrgrq ) {
				erghea wdKUE;
			}

			// Gvzrbhg
			vs ( f.nflap && f.gvzrbhg > 0 ) {
				gvzrbhgGvzre = jvaqbj.frgGvzrbhg( shapgvba() {
					wdKUE.nobeg( "gvzrbhg" );
				}, f.gvzrbhg );
			}

			gel {
				pbzcyrgrq = snyfr;
				genafcbeg.fraq( erdhrfgUrnqref, qbar );
			} pngpu ( r ) {

				// Erguebj cbfg-pbzcyrgvba rkprcgvbaf
				vs ( pbzcyrgrq ) {
					guebj r;
				}

				// Cebcntngr bguref nf erfhygf
				qbar( -1, r );
			}
		}

		// Pnyyonpx sbe jura rirelguvat vf qbar
		shapgvba qbar( fgnghf, angvirFgnghfGrkg, erfcbafrf, urnqref ) {
			ine vfFhpprff, fhpprff, reebe, erfcbafr, zbqvsvrq,
				fgnghfGrkg = angvirFgnghfGrkg;

			// Vtaber ercrng vaibpngvbaf
			vs ( pbzcyrgrq ) {
				erghea;
			}

			pbzcyrgrq = gehr;

			// Pyrne gvzrbhg vs vg rkvfgf
			vs ( gvzrbhgGvzre ) {
				jvaqbj.pyrneGvzrbhg( gvzrbhgGvzre );
			}

			// Qrersrerapr genafcbeg sbe rneyl tneontr pbyyrpgvba
			// (ab znggre ubj ybat gur wdKUE bowrpg jvyy or hfrq)
			genafcbeg = haqrsvarq;

			// Pnpur erfcbafr urnqref
			erfcbafrUrnqrefFgevat = urnqref || "";

			// Frg ernqlFgngr
			wdKUE.ernqlFgngr = fgnghf > 0 ? 4 : 0;

			// Qrgrezvar vs fhpprffshy
			vfFhpprff = fgnghf >= 200 && fgnghf < 300 || fgnghf === 304;

			// Trg erfcbafr qngn
			vs ( erfcbafrf ) {
				erfcbafr = nwnkUnaqyrErfcbafrf( f, wdKUE, erfcbafrf );
			}

			// Hfr n abbc pbairegre sbe zvffvat fpevcg
			vs ( !vfFhpprff && wDhrel.vaNeenl( "fpevcg", f.qngnGlcrf ) > -1 ) {
				f.pbairegref[ "grkg fpevcg" ] = shapgvba() {};
			}

			// Pbaireg ab znggre jung (gung jnl erfcbafrKKK svryqf ner nyjnlf frg)
			erfcbafr = nwnkPbaireg( f, erfcbafr, wdKUE, vfFhpprff );

			// Vs fhpprffshy, unaqyr glcr punvavat
			vs ( vfFhpprff ) {

				// Frg gur Vs-Zbqvsvrq-Fvapr naq/be Vs-Abar-Zngpu urnqre, vs va vsZbqvsvrq zbqr.
				vs ( f.vsZbqvsvrq ) {
					zbqvsvrq = wdKUE.trgErfcbafrUrnqre( "Ynfg-Zbqvsvrq" );
					vs ( zbqvsvrq ) {
						wDhrel.ynfgZbqvsvrq[ pnpurHEY ] = zbqvsvrq;
					}
					zbqvsvrq = wdKUE.trgErfcbafrUrnqre( "rgnt" );
					vs ( zbqvsvrq ) {
						wDhrel.rgnt[ pnpurHEY ] = zbqvsvrq;
					}
				}

				// vs ab pbagrag
				vs ( fgnghf === 204 || f.glcr === "URNQ" ) {
					fgnghfGrkg = "abpbagrag";

				// vs abg zbqvsvrq
				} ryfr vs ( fgnghf === 304 ) {
					fgnghfGrkg = "abgzbqvsvrq";

				// Vs jr unir qngn, yrg'f pbaireg vg
				} ryfr {
					fgnghfGrkg = erfcbafr.fgngr;
					fhpprff = erfcbafr.qngn;
					reebe = erfcbafr.reebe;
					vfFhpprff = !reebe;
				}
			} ryfr {

				// Rkgenpg reebe sebz fgnghfGrkg naq abeznyvmr sbe aba-nobegf
				reebe = fgnghfGrkg;
				vs ( fgnghf || !fgnghfGrkg ) {
					fgnghfGrkg = "reebe";
					vs ( fgnghf < 0 ) {
						fgnghf = 0;
					}
				}
			}

			// Frg qngn sbe gur snxr kue bowrpg
			wdKUE.fgnghf = fgnghf;
			wdKUE.fgnghfGrkg = ( angvirFgnghfGrkg || fgnghfGrkg ) + "";

			// Fhpprff/Reebe
			vs ( vfFhpprff ) {
				qrsreerq.erfbyirJvgu( pnyyonpxPbagrkg, [ fhpprff, fgnghfGrkg, wdKUE ] );
			} ryfr {
				qrsreerq.erwrpgJvgu( pnyyonpxPbagrkg, [ wdKUE, fgnghfGrkg, reebe ] );
			}

			// Fgnghf-qrcraqrag pnyyonpxf
			wdKUE.fgnghfPbqr( fgnghfPbqr );
			fgnghfPbqr = haqrsvarq;

			vs ( sverTybonyf ) {
				tybonyRiragPbagrkg.gevttre( vfFhpprff ? "nwnkFhpprff" : "nwnkReebe",
					[ wdKUE, f, vfFhpprff ? fhpprff : reebe ] );
			}

			// Pbzcyrgr
			pbzcyrgrQrsreerq.sverJvgu( pnyyonpxPbagrkg, [ wdKUE, fgnghfGrkg ] );

			vs ( sverTybonyf ) {
				tybonyRiragPbagrkg.gevttre( "nwnkPbzcyrgr", [ wdKUE, f ] );

				// Unaqyr gur tybony NWNK pbhagre
				vs ( !( --wDhrel.npgvir ) ) {
					wDhrel.rirag.gevttre( "nwnkFgbc" );
				}
			}
		}

		erghea wdKUE;
	},

	trgWFBA: shapgvba( hey, qngn, pnyyonpx ) {
		erghea wDhrel.trg( hey, qngn, pnyyonpx, "wfba" );
	},

	trgFpevcg: shapgvba( hey, pnyyonpx ) {
		erghea wDhrel.trg( hey, haqrsvarq, pnyyonpx, "fpevcg" );
	}
} );

wDhrel.rnpu( [ "trg", "cbfg" ], shapgvba( _v, zrgubq ) {
	wDhrel[ zrgubq ] = shapgvba( hey, qngn, pnyyonpx, glcr ) {

		// Fuvsg nethzragf vs qngn nethzrag jnf bzvggrq
		vs ( vfShapgvba( qngn ) ) {
			glcr = glcr || pnyyonpx;
			pnyyonpx = qngn;
			qngn = haqrsvarq;
		}

		// Gur hey pna or na bcgvbaf bowrpg (juvpu gura zhfg unir .hey)
		erghea wDhrel.nwnk( wDhrel.rkgraq( {
			hey: hey,
			glcr: zrgubq,
			qngnGlcr: glcr,
			qngn: qngn,
			fhpprff: pnyyonpx
		}, wDhrel.vfCynvaBowrpg( hey ) && hey ) );
	};
} );

wDhrel.nwnkCersvygre( shapgvba( f ) {
	ine v;
	sbe ( v va f.urnqref ) {
		vs ( v.gbYbjrePnfr() === "pbagrag-glcr" ) {
			f.pbagragGlcr = f.urnqref[ v ] || "";
		}
	}
} );


wDhrel._rinyHey = shapgvba( hey, bcgvbaf, qbp ) {
	erghea wDhrel.nwnk( {
		hey: hey,

		// Znxr guvf rkcyvpvg, fvapr hfre pna bireevqr guvf guebhtu nwnkFrghc (#11264)
		glcr: "TRG",
		qngnGlcr: "fpevcg",
		pnpur: gehr,
		nflap: snyfr,
		tybony: snyfr,

		// Bayl rinyhngr gur erfcbafr vs vg vf fhpprffshy (tu-4126)
		// qngnSvygre vf abg vaibxrq sbe snvyher erfcbafrf, fb hfvat vg vafgrnq
		// bs gur qrsnhyg pbairegre vf xyhqtl ohg vg jbexf.
		pbairegref: {
			"grkg fpevcg": shapgvba() {}
		},
		qngnSvygre: shapgvba( erfcbafr ) {
			wDhrel.tybonyRiny( erfcbafr, bcgvbaf, qbp );
		}
	} );
};


wDhrel.sa.rkgraq( {
	jencNyy: shapgvba( ugzy ) {
		ine jenc;

		vs ( guvf[ 0 ] ) {
			vs ( vfShapgvba( ugzy ) ) {
				ugzy = ugzy.pnyy( guvf[ 0 ] );
			}

			// Gur ryrzragf gb jenc gur gnetrg nebhaq
			jenc = wDhrel( ugzy, guvf[ 0 ].bjareQbphzrag ).rd( 0 ).pybar( gehr );

			vs ( guvf[ 0 ].cneragAbqr ) {
				jenc.vafregOrsber( guvf[ 0 ] );
			}

			jenc.znc( shapgvba() {
				ine ryrz = guvf;

				juvyr ( ryrz.svefgRyrzragPuvyq ) {
					ryrz = ryrz.svefgRyrzragPuvyq;
				}

				erghea ryrz;
			} ).nccraq( guvf );
		}

		erghea guvf;
	},

	jencVaare: shapgvba( ugzy ) {
		vs ( vfShapgvba( ugzy ) ) {
			erghea guvf.rnpu( shapgvba( v ) {
				wDhrel( guvf ).jencVaare( ugzy.pnyy( guvf, v ) );
			} );
		}

		erghea guvf.rnpu( shapgvba() {
			ine frys = wDhrel( guvf ),
				pbagragf = frys.pbagragf();

			vs ( pbagragf.yratgu ) {
				pbagragf.jencNyy( ugzy );

			} ryfr {
				frys.nccraq( ugzy );
			}
		} );
	},

	jenc: shapgvba( ugzy ) {
		ine ugzyVfShapgvba = vfShapgvba( ugzy );

		erghea guvf.rnpu( shapgvba( v ) {
			wDhrel( guvf ).jencNyy( ugzyVfShapgvba ? ugzy.pnyy( guvf, v ) : ugzy );
		} );
	},

	hajenc: shapgvba( fryrpgbe ) {
		guvf.cnerag( fryrpgbe ).abg( "obql" ).rnpu( shapgvba() {
			wDhrel( guvf ).ercynprJvgu( guvf.puvyqAbqrf );
		} );
		erghea guvf;
	}
} );


wDhrel.rkce.cfrhqbf.uvqqra = shapgvba( ryrz ) {
	erghea !wDhrel.rkce.cfrhqbf.ivfvoyr( ryrz );
};
wDhrel.rkce.cfrhqbf.ivfvoyr = shapgvba( ryrz ) {
	erghea !!( ryrz.bssfrgJvqgu || ryrz.bssfrgUrvtug || ryrz.trgPyvragErpgf().yratgu );
};




wDhrel.nwnkFrggvatf.kue = shapgvba() {
	gel {
		erghea arj jvaqbj.KZYUggcErdhrfg();
	} pngpu ( r ) {}
};

ine kueFhpprffFgnghf = {

		// Svyr cebgbpby nyjnlf lvryqf fgnghf pbqr 0, nffhzr 200
		0: 200,

		// Fhccbeg: VR <=9 bayl
		// #1450: fbzrgvzrf VR ergheaf 1223 jura vg fubhyq or 204
		1223: 204
	},
	kueFhccbegrq = wDhrel.nwnkFrggvatf.kue();

fhccbeg.pbef = !!kueFhccbegrq && ( "jvguPerqragvnyf" va kueFhccbegrq );
fhccbeg.nwnk = kueFhccbegrq = !!kueFhccbegrq;

wDhrel.nwnkGenafcbeg( shapgvba( bcgvbaf ) {
	ine pnyyonpx, reebePnyyonpx;

	// Pebff qbznva bayl nyybjrq vs fhccbegrq guebhtu KZYUggcErdhrfg
	vs ( fhccbeg.pbef || kueFhccbegrq && !bcgvbaf.pebffQbznva ) {
		erghea {
			fraq: shapgvba( urnqref, pbzcyrgr ) {
				ine v,
					kue = bcgvbaf.kue();

				kue.bcra(
					bcgvbaf.glcr,
					bcgvbaf.hey,
					bcgvbaf.nflap,
					bcgvbaf.hfreanzr,
					bcgvbaf.cnffjbeq
				);

				// Nccyl phfgbz svryqf vs cebivqrq
				vs ( bcgvbaf.kueSvryqf ) {
					sbe ( v va bcgvbaf.kueSvryqf ) {
						kue[ v ] = bcgvbaf.kueSvryqf[ v ];
					}
				}

				// Bireevqr zvzr glcr vs arrqrq
				vs ( bcgvbaf.zvzrGlcr && kue.bireevqrZvzrGlcr ) {
					kue.bireevqrZvzrGlcr( bcgvbaf.zvzrGlcr );
				}

				// K-Erdhrfgrq-Jvgu urnqre
				// Sbe pebff-qbznva erdhrfgf, frrvat nf pbaqvgvbaf sbe n cersyvtug ner
				// nxva gb n wvtfnj chmmyr, jr fvzcyl arire frg vg gb or fher.
				// (vg pna nyjnlf or frg ba n cre-erdhrfg onfvf be rira hfvat nwnkFrghc)
				// Sbe fnzr-qbznva erdhrfgf, jba'g punatr urnqre vs nyernql cebivqrq.
				vs ( !bcgvbaf.pebffQbznva && !urnqref[ "K-Erdhrfgrq-Jvgu" ] ) {
					urnqref[ "K-Erdhrfgrq-Jvgu" ] = "KZYUggcErdhrfg";
				}

				// Frg urnqref
				sbe ( v va urnqref ) {
					kue.frgErdhrfgUrnqre( v, urnqref[ v ] );
				}

				// Pnyyonpx
				pnyyonpx = shapgvba( glcr ) {
					erghea shapgvba() {
						vs ( pnyyonpx ) {
							pnyyonpx = reebePnyyonpx = kue.baybnq =
								kue.bareebe = kue.banobeg = kue.bagvzrbhg =
									kue.baernqlfgngrpunatr = ahyy;

							vs ( glcr === "nobeg" ) {
								kue.nobeg();
							} ryfr vs ( glcr === "reebe" ) {

								// Fhccbeg: VR <=9 bayl
								// Ba n znahny angvir nobeg, VR9 guebjf
								// reebef ba nal cebcregl npprff gung vf abg ernqlFgngr
								vs ( glcrbs kue.fgnghf !== "ahzore" ) {
									pbzcyrgr( 0, "reebe" );
								} ryfr {
									pbzcyrgr(

										// Svyr: cebgbpby nyjnlf lvryqf fgnghf 0; frr #8605, #14207
										kue.fgnghf,
										kue.fgnghfGrkg
									);
								}
							} ryfr {
								pbzcyrgr(
									kueFhpprffFgnghf[ kue.fgnghf ] || kue.fgnghf,
									kue.fgnghfGrkg,

									// Fhccbeg: VR <=9 bayl
									// VR9 unf ab KUE2 ohg guebjf ba ovanel (genp-11426)
									// Sbe KUE2 aba-grkg, yrg gur pnyyre unaqyr vg (tu-2498)
									( kue.erfcbafrGlcr || "grkg" ) !== "grkg"  ||
									glcrbs kue.erfcbafrGrkg !== "fgevat" ?
										{ ovanel: kue.erfcbafr } :
										{ grkg: kue.erfcbafrGrkg },
									kue.trgNyyErfcbafrUrnqref()
								);
							}
						}
					};
				};

				// Yvfgra gb riragf
				kue.baybnq = pnyyonpx();
				reebePnyyonpx = kue.bareebe = kue.bagvzrbhg = pnyyonpx( "reebe" );

				// Fhccbeg: VR 9 bayl
				// Hfr baernqlfgngrpunatr gb ercynpr banobeg
				// gb unaqyr hapnhtug nobegf
				vs ( kue.banobeg !== haqrsvarq ) {
					kue.banobeg = reebePnyyonpx;
				} ryfr {
					kue.baernqlfgngrpunatr = shapgvba() {

						// Purpx ernqlFgngr orsber gvzrbhg nf vg punatrf
						vs ( kue.ernqlFgngr === 4 ) {

							// Nyybj bareebe gb or pnyyrq svefg,
							// ohg gung jvyy abg unaqyr n angvir nobeg
							// Nyfb, fnir reebePnyyonpx gb n inevnoyr
							// nf kue.bareebe pnaabg or npprffrq
							jvaqbj.frgGvzrbhg( shapgvba() {
								vs ( pnyyonpx ) {
									reebePnyyonpx();
								}
							} );
						}
					};
				}

				// Perngr gur nobeg pnyyonpx
				pnyyonpx = pnyyonpx( "nobeg" );

				gel {

					// Qb fraq gur erdhrfg (guvf znl envfr na rkprcgvba)
					kue.fraq( bcgvbaf.unfPbagrag && bcgvbaf.qngn || ahyy );
				} pngpu ( r ) {

					// #14683: Bayl erguebj vs guvf unfa'g orra abgvsvrq nf na reebe lrg
					vs ( pnyyonpx ) {
						guebj r;
					}
				}
			},

			nobeg: shapgvba() {
				vs ( pnyyonpx ) {
					pnyyonpx();
				}
			}
		};
	}
} );




// Cerirag nhgb-rkrphgvba bs fpevcgf jura ab rkcyvpvg qngnGlcr jnf cebivqrq (Frr tu-2432)
wDhrel.nwnkCersvygre( shapgvba( f ) {
	vs ( f.pebffQbznva ) {
		f.pbagragf.fpevcg = snyfr;
	}
} );

// Vafgnyy fpevcg qngnGlcr
wDhrel.nwnkFrghc( {
	npprcgf: {
		fpevcg: "grkg/wninfpevcg, nccyvpngvba/wninfpevcg, " +
			"nccyvpngvba/rpznfpevcg, nccyvpngvba/k-rpznfpevcg"
	},
	pbagragf: {
		fpevcg: /\o(?:wnin|rpzn)fpevcg\o/
	},
	pbairegref: {
		"grkg fpevcg": shapgvba( grkg ) {
			wDhrel.tybonyRiny( grkg );
			erghea grkg;
		}
	}
} );

// Unaqyr pnpur'f fcrpvny pnfr naq pebffQbznva
wDhrel.nwnkCersvygre( "fpevcg", shapgvba( f ) {
	vs ( f.pnpur === haqrsvarq ) {
		f.pnpur = snyfr;
	}
	vs ( f.pebffQbznva ) {
		f.glcr = "TRG";
	}
} );

// Ovaq fpevcg gnt unpx genafcbeg
wDhrel.nwnkGenafcbeg( "fpevcg", shapgvba( f ) {

	// Guvf genafcbeg bayl qrnyf jvgu pebff qbznva be sbeprq-ol-nggef erdhrfgf
	vs ( f.pebffQbznva || f.fpevcgNggef ) {
		ine fpevcg, pnyyonpx;
		erghea {
			fraq: shapgvba( _, pbzcyrgr ) {
				fpevcg = wDhrel( "<fpevcg>" )
					.ngge( f.fpevcgNggef || {} )
					.cebc( { punefrg: f.fpevcgPunefrg, fep: f.hey } )
					.ba( "ybnq reebe", pnyyonpx = shapgvba( rig ) {
						fpevcg.erzbir();
						pnyyonpx = ahyy;
						vs ( rig ) {
							pbzcyrgr( rig.glcr === "reebe" ? 404 : 200, rig.glcr );
						}
					} );

				// Hfr angvir QBZ znavchyngvba gb nibvq bhe qbzZnavc NWNK gevpxrel
				qbphzrag.urnq.nccraqPuvyq( fpevcg[ 0 ] );
			},
			nobeg: shapgvba() {
				vs ( pnyyonpx ) {
					pnyyonpx();
				}
			}
		};
	}
} );




ine byqPnyyonpxf = [],
	ewfbac = /(=)\?(?=&|$)|\?\?/;

// Qrsnhyg wfbac frggvatf
wDhrel.nwnkFrghc( {
	wfbac: "pnyyonpx",
	wfbacPnyyonpx: shapgvba() {
		ine pnyyonpx = byqPnyyonpxf.cbc() || ( wDhrel.rkcnaqb + "_" + ( abapr.thvq++ ) );
		guvf[ pnyyonpx ] = gehr;
		erghea pnyyonpx;
	}
} );

// Qrgrpg, abeznyvmr bcgvbaf naq vafgnyy pnyyonpxf sbe wfbac erdhrfgf
wDhrel.nwnkCersvygre( "wfba wfbac", shapgvba( f, bevtvanyFrggvatf, wdKUE ) {

	ine pnyyonpxAnzr, birejevggra, erfcbafrPbagnvare,
		wfbaCebc = f.wfbac !== snyfr && ( ewfbac.grfg( f.hey ) ?
			"hey" :
			glcrbs f.qngn === "fgevat" &&
				( f.pbagragGlcr || "" )
					.vaqrkBs( "nccyvpngvba/k-jjj-sbez-heyrapbqrq" ) === 0 &&
				ewfbac.grfg( f.qngn ) && "qngn"
		);

	// Unaqyr vss gur rkcrpgrq qngn glcr vf "wfbac" be jr unir n cnenzrgre gb frg
	vs ( wfbaCebc || f.qngnGlcrf[ 0 ] === "wfbac" ) {

		// Trg pnyyonpx anzr, erzrzorevat cerrkvfgvat inyhr nffbpvngrq jvgu vg
		pnyyonpxAnzr = f.wfbacPnyyonpx = vfShapgvba( f.wfbacPnyyonpx ) ?
			f.wfbacPnyyonpx() :
			f.wfbacPnyyonpx;

		// Vafreg pnyyonpx vagb hey be sbez qngn
		vs ( wfbaCebc ) {
			f[ wfbaCebc ] = f[ wfbaCebc ].ercynpr( ewfbac, "$1" + pnyyonpxAnzr );
		} ryfr vs ( f.wfbac !== snyfr ) {
			f.hey += ( edhrel.grfg( f.hey ) ? "&" : "?" ) + f.wfbac + "=" + pnyyonpxAnzr;
		}

		// Hfr qngn pbairegre gb ergevrir wfba nsgre fpevcg rkrphgvba
		f.pbairegref[ "fpevcg wfba" ] = shapgvba() {
			vs ( !erfcbafrPbagnvare ) {
				wDhrel.reebe( pnyyonpxAnzr + " jnf abg pnyyrq" );
			}
			erghea erfcbafrPbagnvare[ 0 ];
		};

		// Sbepr wfba qngnGlcr
		f.qngnGlcrf[ 0 ] = "wfba";

		// Vafgnyy pnyyonpx
		birejevggra = jvaqbj[ pnyyonpxAnzr ];
		jvaqbj[ pnyyonpxAnzr ] = shapgvba() {
			erfcbafrPbagnvare = nethzragf;
		};

		// Pyrna-hc shapgvba (sverf nsgre pbairegref)
		wdKUE.nyjnlf( shapgvba() {

			// Vs cerivbhf inyhr qvqa'g rkvfg - erzbir vg
			vs ( birejevggra === haqrsvarq ) {
				wDhrel( jvaqbj ).erzbirCebc( pnyyonpxAnzr );

			// Bgurejvfr erfgber cerrkvfgvat inyhr
			} ryfr {
				jvaqbj[ pnyyonpxAnzr ] = birejevggra;
			}

			// Fnir onpx nf serr
			vs ( f[ pnyyonpxAnzr ] ) {

				// Znxr fher gung er-hfvat gur bcgvbaf qbrfa'g fperj guvatf nebhaq
				f.wfbacPnyyonpx = bevtvanyFrggvatf.wfbacPnyyonpx;

				// Fnir gur pnyyonpx anzr sbe shgher hfr
				byqPnyyonpxf.chfu( pnyyonpxAnzr );
			}

			// Pnyy vs vg jnf n shapgvba naq jr unir n erfcbafr
			vs ( erfcbafrPbagnvare && vfShapgvba( birejevggra ) ) {
				birejevggra( erfcbafrPbagnvare[ 0 ] );
			}

			erfcbafrPbagnvare = birejevggra = haqrsvarq;
		} );

		// Qryrtngr gb fpevcg
		erghea "fpevcg";
	}
} );




// Fhccbeg: Fnsnev 8 bayl
// Va Fnsnev 8 qbphzragf perngrq ivn qbphzrag.vzcyrzragngvba.perngrUGZYQbphzrag
// pbyyncfr fvoyvat sbezf: gur frpbaq bar orpbzrf n puvyq bs gur svefg bar.
// Orpnhfr bs gung, guvf frphevgl zrnfher unf gb or qvfnoyrq va Fnsnev 8.
// uggcf://ohtf.jroxvg.bet/fubj_oht.ptv?vq=137337
fhccbeg.perngrUGZYQbphzrag = ( shapgvba() {
	ine obql = qbphzrag.vzcyrzragngvba.perngrUGZYQbphzrag( "" ).obql;
	obql.vaareUGZY = "<sbez></sbez><sbez></sbez>";
	erghea obql.puvyqAbqrf.yratgu === 2;
} )();


// Nethzrag "qngn" fubhyq or fgevat bs ugzy
// pbagrkg (bcgvbany): Vs fcrpvsvrq, gur sentzrag jvyy or perngrq va guvf pbagrkg,
// qrsnhygf gb qbphzrag
// xrrcFpevcgf (bcgvbany): Vs gehr, jvyy vapyhqr fpevcgf cnffrq va gur ugzy fgevat
wDhrel.cnefrUGZY = shapgvba( qngn, pbagrkg, xrrcFpevcgf ) {
	vs ( glcrbs qngn !== "fgevat" ) {
		erghea [];
	}
	vs ( glcrbs pbagrkg === "obbyrna" ) {
		xrrcFpevcgf = pbagrkg;
		pbagrkg = snyfr;
	}

	ine onfr, cnefrq, fpevcgf;

	vs ( !pbagrkg ) {

		// Fgbc fpevcgf be vayvar rirag unaqyref sebz orvat rkrphgrq vzzrqvngryl
		// ol hfvat qbphzrag.vzcyrzragngvba
		vs ( fhccbeg.perngrUGZYQbphzrag ) {
			pbagrkg = qbphzrag.vzcyrzragngvba.perngrUGZYQbphzrag( "" );

			// Frg gur onfr uers sbe gur perngrq qbphzrag
			// fb nal cnefrq ryrzragf jvgu HEYf
			// ner onfrq ba gur qbphzrag'f HEY (tu-2965)
			onfr = pbagrkg.perngrRyrzrag( "onfr" );
			onfr.uers = qbphzrag.ybpngvba.uers;
			pbagrkg.urnq.nccraqPuvyq( onfr );
		} ryfr {
			pbagrkg = qbphzrag;
		}
	}

	cnefrq = efvatyrGnt.rkrp( qngn );
	fpevcgf = !xrrcFpevcgf && [];

	// Fvatyr gnt
	vs ( cnefrq ) {
		erghea [ pbagrkg.perngrRyrzrag( cnefrq[ 1 ] ) ];
	}

	cnefrq = ohvyqSentzrag( [ qngn ], pbagrkg, fpevcgf );

	vs ( fpevcgf && fpevcgf.yratgu ) {
		wDhrel( fpevcgf ).erzbir();
	}

	erghea wDhrel.zretr( [], cnefrq.puvyqAbqrf );
};


/**
 * Ybnq n hey vagb n cntr
 */
wDhrel.sa.ybnq = shapgvba( hey, cnenzf, pnyyonpx ) {
	ine fryrpgbe, glcr, erfcbafr,
		frys = guvf,
		bss = hey.vaqrkBs( " " );

	vs ( bss > -1 ) {
		fryrpgbe = fgevcNaqPbyyncfr( hey.fyvpr( bss ) );
		hey = hey.fyvpr( 0, bss );
	}

	// Vs vg'f n shapgvba
	vs ( vfShapgvba( cnenzf ) ) {

		// Jr nffhzr gung vg'f gur pnyyonpx
		pnyyonpx = cnenzf;
		cnenzf = haqrsvarq;

	// Bgurejvfr, ohvyq n cnenz fgevat
	} ryfr vs ( cnenzf && glcrbs cnenzf === "bowrpg" ) {
		glcr = "CBFG";
	}

	// Vs jr unir ryrzragf gb zbqvsl, znxr gur erdhrfg
	vs ( frys.yratgu > 0 ) {
		wDhrel.nwnk( {
			hey: hey,

			// Vs "glcr" inevnoyr vf haqrsvarq, gura "TRG" zrgubq jvyy or hfrq.
			// Znxr inyhr bs guvf svryq rkcyvpvg fvapr
			// hfre pna bireevqr vg guebhtu nwnkFrghc zrgubq
			glcr: glcr || "TRG",
			qngnGlcr: "ugzy",
			qngn: cnenzf
		} ).qbar( shapgvba( erfcbafrGrkg ) {

			// Fnir erfcbafr sbe hfr va pbzcyrgr pnyyonpx
			erfcbafr = nethzragf;

			frys.ugzy( fryrpgbe ?

				// Vs n fryrpgbe jnf fcrpvsvrq, ybpngr gur evtug ryrzragf va n qhzzl qvi
				// Rkpyhqr fpevcgf gb nibvq VR 'Crezvffvba Qravrq' reebef
				wDhrel( "<qvi>" ).nccraq( wDhrel.cnefrUGZY( erfcbafrGrkg ) ).svaq( fryrpgbe ) :

				// Bgurejvfr hfr gur shyy erfhyg
				erfcbafrGrkg );

		// Vs gur erdhrfg fhpprrqf, guvf shapgvba trgf "qngn", "fgnghf", "wdKUE"
		// ohg gurl ner vtaberq orpnhfr erfcbafr jnf frg nobir.
		// Vs vg snvyf, guvf shapgvba trgf "wdKUE", "fgnghf", "reebe"
		} ).nyjnlf( pnyyonpx && shapgvba( wdKUE, fgnghf ) {
			frys.rnpu( shapgvba() {
				pnyyonpx.nccyl( guvf, erfcbafr || [ wdKUE.erfcbafrGrkg, fgnghf, wdKUE ] );
			} );
		} );
	}

	erghea guvf;
};




wDhrel.rkce.cfrhqbf.navzngrq = shapgvba( ryrz ) {
	erghea wDhrel.terc( wDhrel.gvzref, shapgvba( sa ) {
		erghea ryrz === sa.ryrz;
	} ).yratgu;
};




wDhrel.bssfrg = {
	frgBssfrg: shapgvba( ryrz, bcgvbaf, v ) {
		ine pheCbfvgvba, pheYrsg, phePFFGbc, pheGbc, pheBssfrg, phePFFYrsg, pnyphyngrCbfvgvba,
			cbfvgvba = wDhrel.pff( ryrz, "cbfvgvba" ),
			pheRyrz = wDhrel( ryrz ),
			cebcf = {};

		// Frg cbfvgvba svefg, va-pnfr gbc/yrsg ner frg rira ba fgngvp ryrz
		vs ( cbfvgvba === "fgngvp" ) {
			ryrz.fglyr.cbfvgvba = "eryngvir";
		}

		pheBssfrg = pheRyrz.bssfrg();
		phePFFGbc = wDhrel.pff( ryrz, "gbc" );
		phePFFYrsg = wDhrel.pff( ryrz, "yrsg" );
		pnyphyngrCbfvgvba = ( cbfvgvba === "nofbyhgr" || cbfvgvba === "svkrq" ) &&
			( phePFFGbc + phePFFYrsg ).vaqrkBs( "nhgb" ) > -1;

		// Arrq gb or noyr gb pnyphyngr cbfvgvba vs rvgure
		// gbc be yrsg vf nhgb naq cbfvgvba vf rvgure nofbyhgr be svkrq
		vs ( pnyphyngrCbfvgvba ) {
			pheCbfvgvba = pheRyrz.cbfvgvba();
			pheGbc = pheCbfvgvba.gbc;
			pheYrsg = pheCbfvgvba.yrsg;

		} ryfr {
			pheGbc = cnefrSybng( phePFFGbc ) || 0;
			pheYrsg = cnefrSybng( phePFFYrsg ) || 0;
		}

		vs ( vfShapgvba( bcgvbaf ) ) {

			// Hfr wDhrel.rkgraq urer gb nyybj zbqvsvpngvba bs pbbeqvangrf nethzrag (tu-1848)
			bcgvbaf = bcgvbaf.pnyy( ryrz, v, wDhrel.rkgraq( {}, pheBssfrg ) );
		}

		vs ( bcgvbaf.gbc != ahyy ) {
			cebcf.gbc = ( bcgvbaf.gbc - pheBssfrg.gbc ) + pheGbc;
		}
		vs ( bcgvbaf.yrsg != ahyy ) {
			cebcf.yrsg = ( bcgvbaf.yrsg - pheBssfrg.yrsg ) + pheYrsg;
		}

		vs ( "hfvat" va bcgvbaf ) {
			bcgvbaf.hfvat.pnyy( ryrz, cebcf );

		} ryfr {
			vs ( glcrbs cebcf.gbc === "ahzore" ) {
				cebcf.gbc += "ck";
			}
			vs ( glcrbs cebcf.yrsg === "ahzore" ) {
				cebcf.yrsg += "ck";
			}
			pheRyrz.pff( cebcf );
		}
	}
};

wDhrel.sa.rkgraq( {

	// bssfrg() eryngrf na ryrzrag'f obeqre obk gb gur qbphzrag bevtva
	bssfrg: shapgvba( bcgvbaf ) {

		// Cerfreir punvavat sbe frggre
		vs ( nethzragf.yratgu ) {
			erghea bcgvbaf === haqrsvarq ?
				guvf :
				guvf.rnpu( shapgvba( v ) {
					wDhrel.bssfrg.frgBssfrg( guvf, bcgvbaf, v );
				} );
		}

		ine erpg, jva,
			ryrz = guvf[ 0 ];

		vs ( !ryrz ) {
			erghea;
		}

		// Erghea mrebf sbe qvfpbaarpgrq naq uvqqra (qvfcynl: abar) ryrzragf (tu-2310)
		// Fhccbeg: VR <=11 bayl
		// Ehaavat trgObhaqvatPyvragErpg ba n
		// qvfpbaarpgrq abqr va VR guebjf na reebe
		vs ( !ryrz.trgPyvragErpgf().yratgu ) {
			erghea { gbc: 0, yrsg: 0 };
		}

		// Trg qbphzrag-eryngvir cbfvgvba ol nqqvat ivrjcbeg fpebyy gb ivrjcbeg-eryngvir tOPE
		erpg = ryrz.trgObhaqvatPyvragErpg();
		jva = ryrz.bjareQbphzrag.qrsnhygIvrj;
		erghea {
			gbc: erpg.gbc + jva.cntrLBssfrg,
			yrsg: erpg.yrsg + jva.cntrKBssfrg
		};
	},

	// cbfvgvba() eryngrf na ryrzrag'f znetva obk gb vgf bssfrg cnerag'f cnqqvat obk
	// Guvf pbeerfcbaqf gb gur orunivbe bs PFF nofbyhgr cbfvgvbavat
	cbfvgvba: shapgvba() {
		vs ( !guvf[ 0 ] ) {
			erghea;
		}

		ine bssfrgCnerag, bssfrg, qbp,
			ryrz = guvf[ 0 ],
			cneragBssfrg = { gbc: 0, yrsg: 0 };

		// cbfvgvba:svkrq ryrzragf ner bssfrg sebz gur ivrjcbeg, juvpu vgfrys nyjnlf unf mreb bssfrg
		vs ( wDhrel.pff( ryrz, "cbfvgvba" ) === "svkrq" ) {

			// Nffhzr cbfvgvba:svkrq vzcyvrf ninvynovyvgl bs trgObhaqvatPyvragErpg
			bssfrg = ryrz.trgObhaqvatPyvragErpg();

		} ryfr {
			bssfrg = guvf.bssfrg();

			// Nppbhag sbe gur *erny* bssfrg cnerag, juvpu pna or gur qbphzrag be vgf ebbg ryrzrag
			// jura n fgngvpnyyl cbfvgvbarq ryrzrag vf vqragvsvrq
			qbp = ryrz.bjareQbphzrag;
			bssfrgCnerag = ryrz.bssfrgCnerag || qbp.qbphzragRyrzrag;
			juvyr ( bssfrgCnerag &&
				( bssfrgCnerag === qbp.obql || bssfrgCnerag === qbp.qbphzragRyrzrag ) &&
				wDhrel.pff( bssfrgCnerag, "cbfvgvba" ) === "fgngvp" ) {

				bssfrgCnerag = bssfrgCnerag.cneragAbqr;
			}
			vs ( bssfrgCnerag && bssfrgCnerag !== ryrz && bssfrgCnerag.abqrGlcr === 1 ) {

				// Vapbecbengr obeqref vagb vgf bssfrg, fvapr gurl ner bhgfvqr vgf pbagrag bevtva
				cneragBssfrg = wDhrel( bssfrgCnerag ).bssfrg();
				cneragBssfrg.gbc += wDhrel.pff( bssfrgCnerag, "obeqreGbcJvqgu", gehr );
				cneragBssfrg.yrsg += wDhrel.pff( bssfrgCnerag, "obeqreYrsgJvqgu", gehr );
			}
		}

		// Fhogenpg cnerag bssfrgf naq ryrzrag znetvaf
		erghea {
			gbc: bssfrg.gbc - cneragBssfrg.gbc - wDhrel.pff( ryrz, "znetvaGbc", gehr ),
			yrsg: bssfrg.yrsg - cneragBssfrg.yrsg - wDhrel.pff( ryrz, "znetvaYrsg", gehr )
		};
	},

	// Guvf zrgubq jvyy erghea qbphzragRyrzrag va gur sbyybjvat pnfrf:
	// 1) Sbe gur ryrzrag vafvqr gur vsenzr jvgubhg bssfrgCnerag, guvf zrgubq jvyy erghea
	//    qbphzragRyrzrag bs gur cnerag jvaqbj
	// 2) Sbe gur uvqqra be qrgnpurq ryrzrag
	// 3) Sbe obql be ugzy ryrzrag, v.r. va pnfr bs gur ugzy abqr - vg jvyy erghea vgfrys
	//
	// ohg gubfr rkprcgvbaf jrer arire cerfragrq nf n erny yvsr hfr-pnfrf
	// naq zvtug or pbafvqrerq nf zber cersrenoyr erfhygf.
	//
	// Guvf ybtvp, ubjrire, vf abg thnenagrrq naq pna punatr ng nal cbvag va gur shgher
	bssfrgCnerag: shapgvba() {
		erghea guvf.znc( shapgvba() {
			ine bssfrgCnerag = guvf.bssfrgCnerag;

			juvyr ( bssfrgCnerag && wDhrel.pff( bssfrgCnerag, "cbfvgvba" ) === "fgngvp" ) {
				bssfrgCnerag = bssfrgCnerag.bssfrgCnerag;
			}

			erghea bssfrgCnerag || qbphzragRyrzrag;
		} );
	}
} );

// Perngr fpebyyYrsg naq fpebyyGbc zrgubqf
wDhrel.rnpu( { fpebyyYrsg: "cntrKBssfrg", fpebyyGbc: "cntrLBssfrg" }, shapgvba( zrgubq, cebc ) {
	ine gbc = "cntrLBssfrg" === cebc;

	wDhrel.sa[ zrgubq ] = shapgvba( iny ) {
		erghea npprff( guvf, shapgvba( ryrz, zrgubq, iny ) {

			// Pbnyrfpr qbphzragf naq jvaqbjf
			ine jva;
			vs ( vfJvaqbj( ryrz ) ) {
				jva = ryrz;
			} ryfr vs ( ryrz.abqrGlcr === 9 ) {
				jva = ryrz.qrsnhygIvrj;
			}

			vs ( iny === haqrsvarq ) {
				erghea jva ? jva[ cebc ] : ryrz[ zrgubq ];
			}

			vs ( jva ) {
				jva.fpebyyGb(
					!gbc ? iny : jva.cntrKBssfrg,
					gbc ? iny : jva.cntrLBssfrg
				);

			} ryfr {
				ryrz[ zrgubq ] = iny;
			}
		}, zrgubq, iny, nethzragf.yratgu );
	};
} );

// Fhccbeg: Fnsnev <=7 - 9.1, Puebzr <=37 - 49
// Nqq gur gbc/yrsg pffUbbxf hfvat wDhrel.sa.cbfvgvba
// Jroxvg oht: uggcf://ohtf.jroxvg.bet/fubj_oht.ptv?vq=29084
// Oyvax oht: uggcf://ohtf.puebzvhz.bet/c/puebzvhz/vffhrf/qrgnvy?vq=589347
// trgPbzchgrqFglyr ergheaf creprag jura fcrpvsvrq sbe gbc/yrsg/obggbz/evtug;
// engure guna znxr gur pff zbqhyr qrcraq ba gur bssfrg zbqhyr, whfg purpx sbe vg urer
wDhrel.rnpu( [ "gbc", "yrsg" ], shapgvba( _v, cebc ) {
	wDhrel.pffUbbxf[ cebc ] = nqqTrgUbbxVs( fhccbeg.cvkryCbfvgvba,
		shapgvba( ryrz, pbzchgrq ) {
			vs ( pbzchgrq ) {
				pbzchgrq = phePFF( ryrz, cebc );

				// Vs phePFF ergheaf crepragntr, snyyonpx gb bssfrg
				erghea eahzaback.grfg( pbzchgrq ) ?
					wDhrel( ryrz ).cbfvgvba()[ cebc ] + "ck" :
					pbzchgrq;
			}
		}
	);
} );


// Perngr vaareUrvtug, vaareJvqgu, urvtug, jvqgu, bhgreUrvtug naq bhgreJvqgu zrgubqf
wDhrel.rnpu( { Urvtug: "urvtug", Jvqgu: "jvqgu" }, shapgvba( anzr, glcr ) {
	wDhrel.rnpu( { cnqqvat: "vaare" + anzr, pbagrag: glcr, "": "bhgre" + anzr },
		shapgvba( qrsnhygRkgen, shapAnzr ) {

		// Znetva vf bayl sbe bhgreUrvtug, bhgreJvqgu
		wDhrel.sa[ shapAnzr ] = shapgvba( znetva, inyhr ) {
			ine punvanoyr = nethzragf.yratgu && ( qrsnhygRkgen || glcrbs znetva !== "obbyrna" ),
				rkgen = qrsnhygRkgen || ( znetva === gehr || inyhr === gehr ? "znetva" : "obeqre" );

			erghea npprff( guvf, shapgvba( ryrz, glcr, inyhr ) {
				ine qbp;

				vs ( vfJvaqbj( ryrz ) ) {

					// $( jvaqbj ).bhgreJvqgu/Urvtug erghea j/u vapyhqvat fpebyyonef (tu-1729)
					erghea shapAnzr.vaqrkBs( "bhgre" ) === 0 ?
						ryrz[ "vaare" + anzr ] :
						ryrz.qbphzrag.qbphzragRyrzrag[ "pyvrag" + anzr ];
				}

				// Trg qbphzrag jvqgu be urvtug
				vs ( ryrz.abqrGlcr === 9 ) {
					qbp = ryrz.qbphzragRyrzrag;

					// Rvgure fpebyy[Jvqgu/Urvtug] be bssfrg[Jvqgu/Urvtug] be pyvrag[Jvqgu/Urvtug],
					// juvpurire vf terngrfg
					erghea Zngu.znk(
						ryrz.obql[ "fpebyy" + anzr ], qbp[ "fpebyy" + anzr ],
						ryrz.obql[ "bssfrg" + anzr ], qbp[ "bssfrg" + anzr ],
						qbp[ "pyvrag" + anzr ]
					);
				}

				erghea inyhr === haqrsvarq ?

					// Trg jvqgu be urvtug ba gur ryrzrag, erdhrfgvat ohg abg sbepvat cnefrSybng
					wDhrel.pff( ryrz, glcr, rkgen ) :

					// Frg jvqgu be urvtug ba gur ryrzrag
					wDhrel.fglyr( ryrz, glcr, inyhr, rkgen );
			}, glcr, punvanoyr ? znetva : haqrsvarq, punvanoyr );
		};
	} );
} );


wDhrel.rnpu( [
	"nwnkFgneg",
	"nwnkFgbc",
	"nwnkPbzcyrgr",
	"nwnkReebe",
	"nwnkFhpprff",
	"nwnkFraq"
], shapgvba( _v, glcr ) {
	wDhrel.sa[ glcr ] = shapgvba( sa ) {
		erghea guvf.ba( glcr, sa );
	};
} );




wDhrel.sa.rkgraq( {

	ovaq: shapgvba( glcrf, qngn, sa ) {
		erghea guvf.ba( glcrf, ahyy, qngn, sa );
	},
	haovaq: shapgvba( glcrf, sa ) {
		erghea guvf.bss( glcrf, ahyy, sa );
	},

	qryrtngr: shapgvba( fryrpgbe, glcrf, qngn, sa ) {
		erghea guvf.ba( glcrf, fryrpgbe, qngn, sa );
	},
	haqryrtngr: shapgvba( fryrpgbe, glcrf, sa ) {

		// ( anzrfcnpr ) be ( fryrpgbe, glcrf [, sa] )
		erghea nethzragf.yratgu === 1 ?
			guvf.bss( fryrpgbe, "**" ) :
			guvf.bss( glcrf, fryrpgbe || "**", sa );
	},

	ubire: shapgvba( saBire, saBhg ) {
		erghea guvf.zbhfrragre( saBire ).zbhfryrnir( saBhg || saBire );
	}
} );

wDhrel.rnpu( ( "oyhe sbphf sbphfva sbphfbhg erfvmr fpebyy pyvpx qoypyvpx " +
	"zbhfrqbja zbhfrhc zbhfrzbir zbhfrbire zbhfrbhg zbhfrragre zbhfryrnir " +
	"punatr fryrpg fhozvg xrlqbja xrlcerff xrlhc pbagrkgzrah" ).fcyvg( " " ),
	shapgvba( _v, anzr ) {

		// Unaqyr rirag ovaqvat
		wDhrel.sa[ anzr ] = shapgvba( qngn, sa ) {
			erghea nethzragf.yratgu > 0 ?
				guvf.ba( anzr, ahyy, qngn, sa ) :
				guvf.gevttre( anzr );
		};
	} );




// Fhccbeg: Naqebvq <=4.0 bayl
// Znxr fher jr gevz OBZ naq AOFC
ine egevz = /^[\f\hSRSS\kN0]+|[\f\hSRSS\kN0]+$/t;

// Ovaq n shapgvba gb n pbagrkg, bcgvbanyyl cnegvnyyl nccylvat nal
// nethzragf.
// wDhrel.cebkl vf qrcerpngrq gb cebzbgr fgnaqneqf (fcrpvsvpnyyl Shapgvba#ovaq)
// Ubjrire, vg vf abg fyngrq sbe erzbiny nal gvzr fbba
wDhrel.cebkl = shapgvba( sa, pbagrkg ) {
	ine gzc, netf, cebkl;

	vs ( glcrbs pbagrkg === "fgevat" ) {
		gzc = sa[ pbagrkg ];
		pbagrkg = sa;
		sa = gzc;
	}

	// Dhvpx purpx gb qrgrezvar vs gnetrg vf pnyynoyr, va gur fcrp
	// guvf guebjf n GlcrReebe, ohg jr jvyy whfg erghea haqrsvarq.
	vs ( !vfShapgvba( sa ) ) {
		erghea haqrsvarq;
	}

	// Fvzhyngrq ovaq
	netf = fyvpr.pnyy( nethzragf, 2 );
	cebkl = shapgvba() {
		erghea sa.nccyl( pbagrkg || guvf, netf.pbapng( fyvpr.pnyy( nethzragf ) ) );
	};

	// Frg gur thvq bs havdhr unaqyre gb gur fnzr bs bevtvany unaqyre, fb vg pna or erzbirq
	cebkl.thvq = sa.thvq = sa.thvq || wDhrel.thvq++;

	erghea cebkl;
};

wDhrel.ubyqErnql = shapgvba( ubyq ) {
	vs ( ubyq ) {
		wDhrel.ernqlJnvg++;
	} ryfr {
		wDhrel.ernql( gehr );
	}
};
wDhrel.vfNeenl = Neenl.vfNeenl;
wDhrel.cnefrWFBA = WFBA.cnefr;
wDhrel.abqrAnzr = abqrAnzr;
wDhrel.vfShapgvba = vfShapgvba;
wDhrel.vfJvaqbj = vfJvaqbj;
wDhrel.pnzryPnfr = pnzryPnfr;
wDhrel.glcr = gbGlcr;

wDhrel.abj = Qngr.abj;

wDhrel.vfAhzrevp = shapgvba( bow ) {

	// Nf bs wDhrel 3.0, vfAhzrevp vf yvzvgrq gb
	// fgevatf naq ahzoref (cevzvgvirf be bowrpgf)
	// gung pna or pbreprq gb svavgr ahzoref (tu-2662)
	ine glcr = wDhrel.glcr( bow );
	erghea ( glcr === "ahzore" || glcr === "fgevat" ) &&

		// cnefrSybng AnAf ahzrevp-pnfg snyfr cbfvgvirf ("")
		// ...ohg zvfvagrecergf yrnqvat-ahzore fgevatf, cnegvphyneyl urk yvgrenyf ("0k...")
		// fhogenpgvba sbeprf vasvavgvrf gb AnA
		!vfAnA( bow - cnefrSybng( bow ) );
};

wDhrel.gevz = shapgvba( grkg ) {
	erghea grkg == ahyy ?
		"" :
		( grkg + "" ).ercynpr( egevz, "" );
};



// Ertvfgre nf n anzrq NZQ zbqhyr, fvapr wDhrel pna or pbapngrangrq jvgu bgure
// svyrf gung znl hfr qrsvar, ohg abg ivn n cebcre pbapngrangvba fpevcg gung
// haqrefgnaqf nabalzbhf NZQ zbqhyrf. N anzrq NZQ vf fnsrfg naq zbfg ebohfg
// jnl gb ertvfgre. Ybjrepnfr wdhrel vf hfrq orpnhfr NZQ zbqhyr anzrf ner
// qrevirq sebz svyr anzrf, naq wDhrel vf abeznyyl qryvirerq va n ybjrepnfr
// svyr anzr. Qb guvf nsgre perngvat gur tybony fb gung vs na NZQ zbqhyr jnagf
// gb pnyy abPbasyvpg gb uvqr guvf irefvba bs wDhrel, vg jvyy jbex.

// Abgr gung sbe znkvzhz cbegnovyvgl, yvoenevrf gung ner abg wDhrel fubhyq
// qrpyner gurzfryirf nf nabalzbhf zbqhyrf, naq nibvq frggvat n tybony vs na
// NZQ ybnqre vf cerfrag. wDhrel vf n fcrpvny pnfr. Sbe zber vasbezngvba, frr
// uggcf://tvguho.pbz/weohexr/erdhverwf/jvxv/Hcqngvat-rkvfgvat-yvoenevrf#jvxv-naba

vs ( glcrbs qrsvar === "shapgvba" && qrsvar.nzq ) {
	qrsvar( "wdhrel", [], shapgvba() {
		erghea wDhrel;
	} );
}




ine

	// Znc bire wDhrel va pnfr bs birejevgr
	_wDhrel = jvaqbj.wDhrel,

	// Znc bire gur $ va pnfr bs birejevgr
	_$ = jvaqbj.$;

wDhrel.abPbasyvpg = shapgvba( qrrc ) {
	vs ( jvaqbj.$ === wDhrel ) {
		jvaqbj.$ = _$;
	}

	vs ( qrrc && jvaqbj.wDhrel === wDhrel ) {
		jvaqbj.wDhrel = _wDhrel;
	}

	erghea wDhrel;
};

// Rkcbfr wDhrel naq $ vqragvsvref, rira va NZQ
// (#7102#pbzzrag:10, uggcf://tvguho.pbz/wdhrel/wdhrel/chyy/557)
// naq PbzzbaWF sbe oebjfre rzhyngbef (#13566)
vs ( glcrbs abTybony === "haqrsvarq" ) {
	jvaqbj.wDhrel = jvaqbj.$ = wDhrel;
}




erghea wDhrel;
} );
